<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Asset Link Plugin API docs Farm Data Access</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="./custom-styles.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="index.html">
                    <img src="https://user-images.githubusercontent.com/30754460/184543756-4bbd5d3b-7a87-487b-b2ab-5d7244e728ac.png" alt="logo">
                </a>
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Asset Link Plugin API</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-extension-model.html">
                                Extension Model
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-farm-data-access.html">
                                Farm Data Access
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-writing-plugins.html">
                                Writing Plugins
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/symbioquine/farmOS_asset_link"
                        >
                            Github
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://www.npmjs.com/package/assetlink-plugin-api"
                        >
                            npm
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar tutorials"
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-extension-model.html">Extension Model</a></li><li><a href="tutorial-farm-data-access.html">Farm Data Access</a></li><li><a href="tutorial-writing-plugins.html">Writing Plugins</a><ul><li><a href="tutorial-simple-asset-action-plugin.html">Simple Asset Action</a></li><li><a href="tutorial-plugin-as-farm-os-module.html">Packaging a plugin as a farmOS contrib module</a></li></ul></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Tutorial</p>
                    <h1>Farm Data Access</h1>
                </header>
                <section>

<article>
    <p>Plugins in Asset Link have access to the full farmOS data model via the <a href="https://farmos.org/development/api/">farmOS/Drupal JSON:API</a>.</p>
<p>This access is mediated by a library called <a href="https://orbitjs.com/">Orbit.js</a>. Asset Link exposes <a href="https://orbitjs.com/docs/data-sources">Orbit.js sources</a>
via the <a href="IAssetLink.html">Asset Link API</a>. The most common use-cases will use <code>assetLink.entitySource</code> which first queries the in-memory data - followed
by the farmOS server if the app is online at the time.</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.query(q => q
  .findRecords(`asset--equipment`)
  .filter({ attribute: 'name', op: 'CONTAINS', value: 'slow' }));
</code></pre>
<p>That fallback logic - first querying the in memory data followed by the farmOS server - sounds ideal, but often we are happy with just using the in-memory data
and prefer that offline-first behavior from a performance standpoint. In that case we can explicitly query <code>assetLink.entitySource.cache</code> followed by
<code>assetLink.entitySource</code>.</p>
<pre class="prettyprint source lang-js"><code>const offlineResults = await assetLink.entitySource.cache.query(q => q
  .findRecords(`asset--equipment`)
  .filter({ attribute: 'name', op: 'CONTAINS', value: 'slow' }));

// Do something with the offline results right away

if (assetLink.connectionStatus.isOnline) {
  const onlineResults = await assetLink.entitySource.query(q => q
    .findRecords(`asset--equipment`)
    .filter({ attribute: 'name', op: 'CONTAINS', value: 'slow' }));

  // Update the UI with more up-to-date data if/when it becomes available
}
</code></pre>
<p>Asset Link also provides some convenience methods that handle common cases like loading an asset by ID. For example, see <a href="IAssetLink.html#resolveAsset">IAssetLink#resolveAsset</a>.</p>
<pre class="prettyprint source lang-js"><code>const asset = await assetLink.resolveAsset(42);

console.log(asset.attributes.name);
</code></pre>
<p>Modifying farmOS data occurs via Orbit.js as well, but is a little simpler. Asset Link takes care of synchronizing changes with the server the next time
the app is online. Queries of farmOS data that occur before the changes are synchronized will use the local versions of the farmOS assets/logs/etc which
include the unsynchronized changes.</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.update((t) => {
  return t.updateRecord({
    type: asset.type,
    id: asset.id,
    attributes: {
      name: &quot;Fred&quot;,
    },
  });
}, {label: `Rename asset: &quot;${asset.attributes.name}&quot; to &quot;Fred&quot;`});

const updatedAsset = await assetLink.resolveAsset(asset.id);

// updatedAsset.attributes.name === 'Fred'
</code></pre>
<p>Files can be uploaded as part of modifying asset/log relationships by specifying a '$upload' directive (key) along with the standard <code>type</code> and <code>id</code> properties:</p>
<pre class="prettyprint source lang-js"><code>const fileDataUrl = 'data:image/gif;base64,R0lGODlhyAAyAKEAAAAAAP///wAAAAAAACH5BAEKAAIALAAAAADIADIAAAL+jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUp5gOr0mqpqO9qurgvAgscQsIecM1/Hakeb866hhVtK/FE/e3HsYV5y1xIYwxYWtDcxuKL4YhWAWJZYYdjAuGAJhwdJ42hZSInwySAa+glauTk690jWd4lYyFKnqPZWm2oKmhuByWqbm+rrKBxcMkw7bAD5J5zQFtdbyuyGi7aqvDmdpRucneedDM0cfUB+t3q+nLwY3q3u/A4/rq5NXf86LZ4Pu84u30/s1D+A0tb9uqcK4UAF+vrdInhinzZX+IoRW1jOYkLeiAyrzZPYiaMJkAIDeqSYERg3hR1ZpnQIDuYWjSNVljTVEqXNdi4LltwosGFQnIIIIkP58uDPikuBJjp5Kh1Rdj8xXRu4UmTSSRZ5yjQIFVvPDxCvfS2V0ycgmjmXeh368auhq8Y4HkwrFq9YrXubMk2oFuNWwXRHILzbMiU+wRkZ8yr2RypYkoEjHn4W9+U/rNI4P50YOazPqPTGXoiFdc+u0YFWp266U7UoUibDEEVKFvdU2qzt4k7qO/bc2ahr136LJbny5cybO38OPbr06dSrW7+OPbv27dy7GygAADs='

await assetLink.entitySource.update((t) =>
  t.addToRelatedRecords({ type: asset.type, id: asset.id }, 'image', {
      type: &quot;file--file&quot;,
      // Placeholder UUID gets replaced by '$upload' directive below so the resulting 'file--file'
      // entity will have a different ID once the file/relationship gets saved to the server
      // Until https://www.drupal.org/project/drupal/issues/3021155 gets fixed anyway
      id: uuidv4(),
      '$upload': {
        fileName,
        fileDataUrl,
      },
  })
, {label: `Add photo to asset: &quot;${asset.attributes.name}&quot;`});
</code></pre>
</article>

</section>

            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>