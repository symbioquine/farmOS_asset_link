<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Asset Link docs Advanced Farm Data Queries</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="./custom-styles.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="index.html">
                    <img src="https://user-images.githubusercontent.com/30754460/184543756-4bbd5d3b-7a87-487b-b2ab-5d7244e728ac.png" alt="logo">
                </a>
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Asset Link</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-user-guide.html">
                                User Guide
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-development.html">
                                Development
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/symbioquine/farmOS_asset_link"
                        >
                            Github
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://www.npmjs.com/package/assetlink-plugin-api"
                        >
                            Plugin API ðŸ“¦
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://www.npmjs.com/package/assetlink-plugin-dev-support"
                        >
                            Dev Support ðŸ“¦
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar tutorials"
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-user-guide.html">User Guide</a><ul><li><a href="tutorial-installation-and-upgrades.html">Installation and Upgrades</a></li></ul></li><li><a href="tutorial-development.html">Development</a><ul><li><a href="tutorial-extension-model.html">Extension Model</a></li><li><a href="tutorial-farm-data-access.html">Farm Data Access</a></li><li><a href="tutorial-advanced-farm-data-queries.html">Advanced Farm Data Queries</a></li><li><a href="tutorial-writing-plugins.html">Writing Plugins</a></li><li><a href="tutorial-simple-asset-action-plugin.html">Simple Asset Action</a></li><li><a href="tutorial-plugin-as-farm-os-module.html">Packaging a plugin as a farmOS contrib module</a></li><li><a href="tutorial-custom-styles-in-plugins.html">Custom styles in plugins</a></li></ul></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Tutorial</p>
                    <h1>Advanced Farm Data Queries</h1>
                </header>
                <section>

<article>
    <p>Some of the advanced query patterns in Asset Link / Orbit.js take some getting used to. The following examples are provided to help with that.</p>
<h3 id="filtering-by-nested-relationships">Filtering by Nested Relationships</h3>
<p>Filtering by nested relationship fields is accomplished using a dotted path - e.g. 'top_level_relationship.some_nested_relationship.some_attribute'. In the case of the following query, we can find animals whose parents have the animal type named &quot;Sheep: Dorset&quot;:</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.query(q => q
  .findRecords(`asset--animal`)
  .filter({ attribute: 'parent.animal_type.name',  op: '=', value: &quot;Sheep: Dorset&quot; }));
</code></pre>
<h3 id="filtering-on-the-union%2Fintersection-of-criteria">Filtering on the Union/Intersection of Criteria</h3>
<p>Asset Link extends Orbit.js to provide support for Drupal's JSON:API filter group operators - AND/OR. In the following query we can find equipment with &quot;tractor&quot; in either the name or the model.</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.query(q => q
  .findRecords(`asset--equipment`)
  .filterGroup('OR', fg => fg
    .filter({ attribute: 'name', op: 'CONTAINS', value: 'tractor' })
    .filter({ attribute: 'model', op: 'CONTAINS', value: 'tractor' })
  ));
</code></pre>
<p>Similarly, we can also filter by the intersection of multiple criteria. In the following query we can find all the female Dorset sheep.</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.query(q => q
  .findRecords(`asset--animal`)
  .filterGroup('AND', fg => fg
    .filter({ attribute: 'sex',  op: '=', value: 'F'})
    .filter({ attribute: 'animal_type.name', op: '=', value: 'Sheep: Dorset' })
  ));
</code></pre>
<h3 id="multiple-criteria-on-the-same-nested-relationship-field">Multiple Criteria on the Same Nested Relationship Field</h3>
<p>Filtering with multiple criteria on the same nested relationship field can involve a <a href="https://www.drupal.org/project/drupal/issues/3066202#comment-13181270">known bug in Drupal</a>.</p>
<p>For example, the following query will return zero results even if there exists an animal with two parents whose <code>drupal_internal__id</code> fields are <code>42</code> and <code>1337</code>.</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.query(q => q
  .findRecords(`asset--animal`)
  .filterGroup('AND', fg => fg
    .filter({ attribute: 'parent.drupal_internal__id',  op: '=', value: '42'})
    .filter({ attribute: 'parent.drupal_internal__id', op: '=', value: '1337' })
  ));
</code></pre>
<p>In such cases, the work-around is to wrap the inner filter criteria in an extra layer of <code>OR</code> filter groups as shown below.</p>
<pre class="prettyprint source lang-js"><code>await assetLink.entitySource.query(q => q
  .findRecords(`asset--animal`)
  .filterGroup('AND', fg => fg
    .filterGroup('OR', subFg => subFg
      .filter({ attribute: 'parent.drupal_internal__id',  op: '=', value: '42'}))
    .filterGroup('OR', subFg => subFg
      .filter({ attribute: 'parent.drupal_internal__id', op: '=', value: '1337' }))
  ));
</code></pre>
<h3 id="writing-filters-without-the-builder">Writing Filters without the Builder</h3>
<p>Some parts of the API in Asset Link accept additional filters as a list of objects instead of the builder syntax demonstrated above. The object representation of such filters is equivalent to the builder syntax. The following are some examples of translating between the two;</p>
<h4 id="attributes">Attributes</h4>
<pre class="prettyprint source lang-js"><code>.filter({ attribute: 'parent.animal_type.name',  op: '=', value: &quot;Sheep: Dorset&quot; })
</code></pre>
<p>is equivalent to</p>
<pre class="prettyprint source lang-js"><code>{ kind: 'attribute', attribute: 'parent.animal_type.name',  op: '=', value: &quot;Sheep: Dorset&quot; }
</code></pre>
<h4 id="filter-groups">Filter Groups</h4>
<pre class="prettyprint source lang-js"><code>.filterGroup('OR', fg => fg
  .filter({ attribute: 'name', op: 'CONTAINS', value: 'tractor' })
  .filter({ attribute: 'model', op: 'CONTAINS', value: 'tractor' })
)
</code></pre>
<p>is equivalent to</p>
<pre class="prettyprint source lang-js"><code>{
  kind: 'group',
  op: 'OR',
  filter: [
    { kind: 'attribute', attribute: 'name',  op: 'CONTAINS', value: 'tractor' },
    { kind: 'attribute', attribute: 'model',  op: 'CONTAINS', value: 'tractor' }
  ]
}
</code></pre>
</article>

</section>

            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>