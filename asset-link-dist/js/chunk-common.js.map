{"version":3,"file":"js/chunk-common.js","mappings":"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","sources":["webpack://alinkjs/./src/DrupalJSONAPIURLBuilder.js","webpack://alinkjs/./src/DrupalJSONAPISource.js","webpack://alinkjs/./src/DrupalSyncQueryOperators.js","webpack://alinkjs/./src/AssetLinkUI.js","webpack://alinkjs/./src/AssetLinkUtil.js","webpack://alinkjs/./src/FarmOSConnectionStatusDetector.js","webpack://alinkjs/./src/PeekableAsyncIterator.js","webpack://alinkjs/./src/util/currentEpochSecond.js","webpack://alinkjs/./src/util/EventBus.js","webpack://alinkjs/./src/HttpAccessDeniedException.js","webpack://alinkjs/./src/AssetLinkPluginListsCore.js","webpack://alinkjs/./src/AssetLinkPluginLoaderCore.js","webpack://alinkjs/./src/AssetLink.js","webpack://alinkjs/./src/createDrupalUrl.js","webpack://alinkjs/./src/plugins/vuetify.js","webpack://alinkjs/./src/registerServiceWorker.js"],"sourcesContent":["import { JSONAPIURLBuilder } from \"@orbit/jsonapi\";\nimport { QueryExpressionParseError } from \"@orbit/data\";\nimport { JSONAPISerializers } from '@orbit/jsonapi';\n\n/**\n * Extends {JSONAPIURLBuilder} to add support for Drupal JSON:API query operators.\n * \n * Loosely based on https://gist.github.com/bradjones1/18ff9ebdb85455f781a2a212577653ce\n */\nexport default class DrupalJSONAPIURLBuilder extends JSONAPIURLBuilder {\n\n  constructor(settings) {\n    super(settings);\n  }\n\n  buildFilterParam(filterSpecifiers) {\n    const filters = [];\n\n    filterSpecifiers.forEach((filterSpecifier, index) => {\n      if (\n        filterSpecifier.kind === 'attribute' &&\n        filterSpecifier.op === 'equal'\n      ) {\n        const attributeFilter = filterSpecifier;\n\n        // Note: We don't know the `type` of the attribute here, so passing `undefined`\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({ [resourceAttribute]: attributeFilter.value });\n      } else if (filterSpecifier.kind === 'attribute') {\n        const attributeFilter = filterSpecifier;\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({\n          ['client-' + resourceAttribute + '-' + index]: {\n            path: resourceAttribute,\n            operator: attributeFilter.op,\n            value: attributeFilter.value\n          }\n        });\n      } else if (filterSpecifier.kind === 'relatedRecord') {\n        const relatedRecordFilter = filterSpecifier;\n        if (Array.isArray(relatedRecordFilter.record)) {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter.record\n              .map((e) => e.id)\n              .join(',')\n          });\n        } else {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter?.record?.id\n          });\n        }\n      } else if (filterSpecifier.kind === 'relatedRecords') {\n        if (filterSpecifier.op !== 'equal') {\n          throw new Error(\n            `Operation \"${filterSpecifier.op}\" is not supported in JSONAPI for relatedRecords filtering`\n          );\n        }\n        const relatedRecordsFilter = filterSpecifier;\n        filters.push({\n          [relatedRecordsFilter.relation]: relatedRecordsFilter.records\n            .map((e) => e.id)\n            .join(',')\n        });\n      } else {\n        throw new QueryExpressionParseError(\n          `Filter operation ${filterSpecifier.op} not recognized for JSONAPISource.`\n        );\n      }\n    });\n\n    return filters;\n  }\n\n  serializeAttributeAsParam(type, attribute) {\n      if (this.serializer) {\n        return this.serializer.resourceAttribute(type, attribute);\n      } else {\n        const serializer = this.serializerFor(JSONAPISerializers.ResourceFieldParam);\n        return serializer.serialize(attribute, { type });\n      }\n    }\n\n}\n","import JSONAPISource, { JSONAPISerializers } from '@orbit/jsonapi';\nimport { buildSerializerSettingsFor, buildInflector } from '@orbit/serializers';\n\nimport DrupalJSONAPIURLBuilder from '@/DrupalJSONAPIURLBuilder';\n\n\n/**\n * Handle Drupal's `type/bundle` JSON:API resource pathing.\n * Based on: https://github.com/orbitjs/orbit/issues/714#issuecomment-1013952990\n */\nexport default class DrupalJSONAPISource extends JSONAPISource {\n  constructor(settings) {\n    const defaultFetchSettings = Object.assign({}, settings.defaultFetchSettings || {}, {\n      headers:{\n        Accept: 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json',\n      },\n    });\n\n    super(Object.assign({}, settings, {\n      defaultFetchSettings,\n      serializerSettingsFor: buildSerializerSettingsFor({\n        sharedSettings: {\n          inflectors: {\n            drupal: buildInflector(\n              {},\n              (input) => input.replace('--', '/')\n            )\n          }\n        },\n        settingsByType: {\n          [JSONAPISerializers.ResourceTypePath]: {\n            serializationOptions: {inflectors: ['drupal']}\n          }\n        }\n      }),\n      URLBuilderClass: DrupalJSONAPIURLBuilder,\n    }));\n  }\n\n}\n","import { SyncQueryOperators } from '@orbit/record-cache';\nimport { QueryExpressionParseError } from '@orbit/data';\nimport { RecordNotFoundException } from '@orbit/records';\nimport { deepGet, isNone } from '@orbit/utils';\n\n// Based on https://github.com/orbitjs/orbit/blob/2c4bf7038d2f74ba31e45e949c70ec4161ced28f/packages/@orbit/record-cache/src/operators/sync-query-operators.ts\nexport default {\n  findRecord: SyncQueryOperators.findRecord,\n  findRelatedRecord: SyncQueryOperators.findRelatedRecord,\n\n  findRecords(\n      cache,\n      expression,\n      // eslint-disable-next-line no-unused-vars\n      options\n    ) {\n      let exp = expression;\n      let results = cache.getRecordsSync(exp.records || exp.type);\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n\n  findRelatedRecords(\n      cache,\n      expression,\n      options\n    ) {\n      const exp = expression;\n      const { record, relationship } = exp;\n      const relatedIds = cache.getRelatedRecordsSync(record, relationship);\n      if (!relatedIds || relatedIds.length === 0) {\n        if (!cache.getRecordSync(record)) {\n          if (options?.raiseNotFoundExceptions) {\n            throw new RecordNotFoundException(record.type, record.id);\n          } else {\n            return undefined;\n          }\n        }\n\n        return [];\n      }\n      let results = cache.getRecordsSync(relatedIds);\n\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n}\n\nfunction filterRecords(records, filters) {\n  return records.filter((record) => {\n    for (let i = 0, l = filters.length; i < l; i++) {\n      if (!applyFilter(record, filters[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction applyFilter(record, filter) {\n\n  if (filter.kind === 'attribute') {\n    let attributeKey = filter.attribute.split('.');\n\n    let actual = deepGet(record, ['attributes', ...attributeKey]);\n\n    let expected = filter.value;\n\n    // https://api.drupal.org/api/drupal/core%21modules%21jsonapi%21src%21Query%21EntityCondition.php/property/EntityCondition%3A%3AallowedOperators/9.4.x\n    switch (filter.op) {\n      case 'equal':\n      case '=':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() === expected.toLowerCase();\n        }\n        return actual === expected;\n      case '<>':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() !== expected.toLowerCase();\n        }\n        return actual !== expected;\n      case '>':\n        return actual > expected;\n      case '>=':\n        return actual >= expected;\n      case '<':\n        return actual < expected;\n      case '<=':\n        return actual <= expected;\n      case 'STARTS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().startsWith(expected.toLowerCase());\n      case 'CONTAINS':\n        return typeof actual === 'string' && actual.toLowerCase().includes(expected.toLowerCase());\n      case 'ENDS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().endsWith(expected.toLowerCase());\n      case 'IN':\n      case 'NOT IN':\n      case 'BETWEEN':\n      case 'NOT BETWEEN':\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} is not yet implemented for Store.`);\n      case 'IS NULL':\n        return actual === undefined || actual === null;\n      case 'IS NOT NULL':\n        return actual !== undefined && actual !== null;\n      default:\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} not recognized for Store.`);\n    }\n  }\n  return SyncQueryOperators.applyFilter(record, filter);\n}\n\nfunction sortRecords(\n    records,\n    sortSpecifiers\n  ) {\n  const comparisonValues = new Map();\n\n  records.forEach((record) => {\n    comparisonValues.set(\n      record,\n      sortSpecifiers.map((sortSpecifier) => {\n        if (sortSpecifier.kind === 'attribute') {\n          let attributeKey = sortSpecifier.attribute.split('.');\n\n          return deepGet(record, [\n            'attributes',\n            ...attributeKey,\n          ]);\n        } else {\n          throw new QueryExpressionParseError(\n            'Sort specifier ${sortSpecifier.kind} not recognized for Store.'\n          );\n        }\n      })\n    );\n  });\n\n  const comparisonOrders = sortSpecifiers.map((sortExpression) =>\n    sortExpression.order === 'descending' ? -1 : 1\n  );\n\n  return records.sort((record1, record2) => {\n    const values1 = comparisonValues.get(record1);\n    const values2 = comparisonValues.get(record2);\n    for (let i = 0; i < sortSpecifiers.length; i++) {\n      if (values1[i] < values2[i]) {\n        return -comparisonOrders[i];\n      } else if (values1[i] > values2[i]) {\n        return comparisonOrders[i];\n      } else if (isNone(values1[i]) && !isNone(values2[i])) {\n        return comparisonOrders[i];\n      } else if (isNone(values2[i]) && !isNone(values1[i])) {\n        return -comparisonOrders[i];\n      }\n    }\n    return 0;\n  });\n}\n\nfunction paginateRecords(\n  records,\n  paginationOptions\n) {\n  if (paginationOptions.limit !== undefined) {\n    let offset =\n      paginationOptions.offset === undefined ? 0 : paginationOptions.offset;\n    let limit = paginationOptions.limit;\n\n    return records.slice(offset, offset + limit);\n  } else {\n    throw new QueryExpressionParseError(\n      'Pagination options not recognized for Store. Please specify `offset` and `limit`.'\n    );\n  }\n}\n","import Vue from 'vue';\nimport {\n  VBtn,\n  VDialog,\n  VListItem,\n  VListItemTitle,\n} from 'vuetify/lib'\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class AssetLinkUI {\n\n  constructor(app) {\n    this._app = app;\n  }\n\n  /**\n   * Provide some basic components to support Asset Link plugins defined as single (uncompiled) JS\n   * files.\n   * \n   * Commonly accessed via `assetLink.ui.c` e.g. `h(assetLink.ui.c.VBtn, { props: ...`\n   */\n  get c() {\n    return {\n      VBtn,\n      VListItem,\n      VListItemTitle,\n    };\n  }\n\n  /**\n   * \n   */\n  get dialog() {\n    return {\n      confirm: async (text) => {\n        return await this._app.$dialog.confirm({\n          text,\n          title: 'Confirmation'\n        });\n      },\n      promptText: async (text) => {\n        return await this._app.$dialog.prompt({\n          text,\n          title: 'Input',\n        });\n      },\n      custom: async (component, params) => {\n        const id = uuidv4();\n\n        const context = new Vue({});\n\n        const result = await new Promise(resolve => {\n          context.$on('submit', resolve);\n\n          this._app.dialogs.push({\n            id,\n            context,\n            componentFn: (wrapper, h) =>\n              h(VDialog, {\n                props: { value: true, fullscreen: true },\n                on: {\n                  input: () => resolve(undefined),\n                },\n              },  [h(component, {ref: 'dialogComponent', ...params})] ),\n          });\n        });\n\n        this._app.dialogs = this._app.dialogs.filter(d => d.id !== id);\n\n        return result;\n      },\n    };\n  }\n\n}\n","import { formatRFC3339 } from 'date-fns'\nimport createDrupalUrl from '@/createDrupalUrl';\nimport geohash from 'ngeohash';\nimport haversine from 'haversine-distance';\n\nexport default class AssetLinkUtil {\n\n  /**\n   * Format a date object as an RFC 3339 date string. e.g. '2019-09-18T19:00:52Z'\n   */\n  get formatRFC3339() {\n    return formatRFC3339;\n  }\n\n  /**\n   * Create a URL relative to the Drupal installation base path given the URL path suffix.\n   */\n  get createDrupalUrl() {\n    return createDrupalUrl;\n  }\n\n  /**\n   * The node-geohash module: https://github.com/sunng87/node-geohash\n   */\n  get geohash() {\n    return geohash;\n  }\n\n  /**\n   * A haversine distance function: https://github.com/dcousens/haversine-distance\n   */\n  get haversine() {\n    return haversine;\n  }\n\n  /**\n   * Roughly implements the same convention encoded in\n   * https://github.com/farmOS/farmOS/blob/04bf771d91cde8276b67090d2b97c4e4558332b9/modules/core/log/farm_log.module#L74-L88\n   */\n  summarizeAssetNames(assets) {\n    if (assets.length <= 3) {\n      return assets.map(a => a.attributes.name).join(\", \");\n    }\n    return `${assets[0].attributes.name} (+${assets.length - 1} more)`;\n  }\n\n}\n","import Vue from 'vue';\nimport fetch from 'cross-fetch';\nimport throttle from '@jcoreio/async-throttle'\nimport createDrupalUrl from '@/createDrupalUrl';\n\n/**\n * Responsible for detecting online/offline/login status\n * for our connection to the farmOS server both through\n * self-initiated polling and by observing the outcome of\n * decorated fetch requests.\n * \n * @implements {IHttpFetcher}\n */\nconst FarmOSConnectionStatusDetector = Vue.extend({\n\n  props: {\n    fetcherDelegate: {\n      type: Object,\n      default: function () {\n        return { fetch: fetch };\n      }\n    }\n  },\n\n  data() {\n    return {\n      $_running: false,\n      $_barrier: new Barrier(),\n\n      hasNetworkConnection: window.navigator.onLine,\n      canReachFarmOS: undefined,\n      isLoggedIn: undefined,\n    };\n  },\n\n  created() {\n    window.addEventListener('offline', () => {\n      this.hasNetworkConnection = false;\n      this.canReachFarmOS = false;\n    });\n    window.addEventListener('online', () => {\n      this.hasNetworkConnection = true;\n      this.$data.$_barrier.release();\n    });\n    if (window.navigator && window.navigator.connection) {\n      window.navigator.connection.addEventListener('change', () => this.$data.$_barrier.release());\n    }\n    this.$_mainLoop();\n  },\n\n  computed: {\n    isOnline() {\n      return this.canReachFarmOS && this.isLoggedIn;\n    },\n  },\n\n  beforeDestroy() {\n    this.$data.$_running = false;\n    this.$data.$_barrier.release();\n  },\n\n  methods: {\n\n    /**\n     * Decorate fetch requests to detect connection/authentication problems with\n     * requests that are already being sent.\n     */\n    async fetch(url, opts) {\n      const options = opts || {};\n\n      if (!options.method) options.method = 'GET';\n\n      const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n      const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n\n      try {\n        const res = await this.fetcherDelegate.fetch(url, options);\n        if (isFarmOSRequest && res.status === 403) {\n          this.$data.$_barrier.release();\n        }\n        return res;\n      } catch (error) {\n        if (isFarmOSRequest) {\n          this.$data.$_barrier.release();\n        }\n        throw error;\n      }\n    },\n\n    async $_mainLoop() {\n      this.$data.$_running = true;\n\n      const checkConnectionStatus = throttle(() => this.$_checkConnectionStatus(), 1000);\n\n      while (this.$data.$_running) {\n        await checkConnectionStatus();\n        await this.$data.$_barrier.arrive(60 * 1000);\n      }\n    },\n\n    async $_checkConnectionStatus() {\n      if (!this.hasNetworkConnection) {\n        return;\n      }\n\n      const apiUrl = createDrupalUrl(`api?cacheBust=${currentEpochSecond()}`);\n\n      try {\n        const res = await fetch(apiUrl, {credentials: 'same-origin', cache: 'no-cache'});\n\n        if (res.status !== 200) {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        const apiData = await res.json();\n\n        const farmOsVersion = apiData.meta?.farm?.version;\n\n        if (farmOsVersion !== '2.x') {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        this.canReachFarmOS = true;\n\n        const userRef = apiData.meta?.links?.me?.href;\n\n        this.isLoggedIn = userRef !== undefined\n      } catch (error) {\n        this.canReachFarmOS = false;\n      }\n    },\n  },\n\n});\n\nfunction sleep(millis) {\n  return new Promise(resolve => setTimeout(resolve, millis));\n}\n\nfunction currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n\nclass Barrier {\n  constructor() {\n    this.waiting = [];\n  }\n\n  arrive(timeoutMillis) {\n    return Promise.race([\n      sleep(timeoutMillis),\n      new Promise(resolve => this.waiting.push(resolve)),\n    ]);\n  }\n\n  release() {\n    const toBeReleased = this.waiting.splice(0);\n    toBeReleased.forEach(p => p());\n  }\n}\n\nexport default FarmOSConnectionStatusDetector;\n","export default class PeekableAsyncIterator {\n  constructor(delegate) {\n    this._delegate = delegate;\n    this._next_iteration_result = undefined;\n  }\n\n  async next() {\n    if (this._next_iteration_result !== undefined) {\n      const next = this._next_iteration_result;\n      this._next_iteration_result = undefined;\n      return next;\n    }\n    return await this._delegate.next();\n  }\n\n  async peek() {\n    if (this._next_iteration_result === undefined) {\n      this._next_iteration_result = await this._delegate.next();\n    }\n    return this._next_iteration_result;\n  }\n\n}\n","export default function currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n","/**\n * A simple async event bus.\n */\nexport default class EventBus {\n\n  constructor() {\n    this._handlersByEventName = {};\n  }\n\n  $on(eventName, handler) {\n    if (!Object.hasOwn(this._handlersByEventName, eventName)) {\n      this._handlersByEventName[eventName] = [];\n    }\n\n    this._handlersByEventName[eventName].push(handler);\n  }\n\n  async $emit(eventName, arg) {\n    const handlers = this._handlersByEventName[eventName] || [];\n\n    const promises = handlers.map(h => h(arg));\n\n    return Promise.all(promises).then(() => true);\n  }\n\n}\n","export default class HttpAccessDeniedException extends Error {\n  constructor(message, options) {\n    super(message, options);\n  }\n}\n","import Vue from 'vue';\n\nimport createDrupalUrl from '@/createDrupalUrl';\nimport currentEpochSecond from '@/util/currentEpochSecond';\nimport EventBus from '@/util/EventBus';\nimport HttpAccessDeniedException from '@/HttpAccessDeniedException';\n\nexport default class AssetLinkPluginListsCore {\n\n  constructor(assetLink) {\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        lists: [],\n      },\n    });\n\n    this._eventBus = new EventBus();\n\n    this._pluginReferenceTracker = new PluginReferenceTracker(this._eventBus);\n\n    this._defaultPluginList = new HttpPluginList(\n        assetLink._store, \n        createDrupalUrl('/alink/backend/default-plugins.repo.json'),\n        this._pluginReferenceTracker,\n        true,\n    );\n    this._localPluginList = new LocalPluginList(\n        assetLink._store,\n        this._pluginReferenceTracker,\n    );\n    this._extraPluginLists = [];\n\n    this._extraPluginListStoreKey = 'asset-link-extra-plugin-lists';\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  /**\n   * An async event bus used to signal when plugins are added/removed.\n   */\n  get eventBus() {\n    return this._eventBus;\n  }\n\n  async boot() {\n    const extraPluginListUrls = await this._getExtraPluginListUrls();\n\n    this._extraPluginLists = extraPluginListUrls.map(pluginListUrl =>\n      new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false));\n\n    for (let pluginList of [\n          this._defaultPluginList,\n          this._localPluginList,\n          ...this._extraPluginLists,\n        ]) {\n\n      const pluginListView = await pluginList.load();\n\n      this._updatePluginListViewInViewModel(pluginListView);\n    }\n  }\n\n  async addPluginToLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.addPlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removePluginFromLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.removePlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async addExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx >= 0) {\n        return false;\n      }\n      extraPluginListUrls.push(pluginListUrl);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex >= 0) {\n      return;\n    }\n\n    const pluginList = new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false);\n\n    this._extraPluginLists.push(pluginList);\n\n    const pluginListView = await pluginList.load();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removeExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx < 0) {\n        return false;\n      }\n      extraPluginListUrls.splice(idx, 1);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex < 0) {\n      return;\n    }\n\n    const pluginList = this._extraPluginLists.splice(pluginListIndex, 1)[0];\n\n    await pluginList.unload();\n\n    this._removePluginListViewFromViewModel(pluginListUrl);\n  }\n\n  async reloadPluginList(pluginListUrl) {\n    const pluginList = [\n      this._defaultPluginList,\n      this._localPluginList,\n      ...this._extraPluginLists,\n    ].find(pl => pl._url === pluginListUrl);\n\n    if (!pluginList) {\n      return;\n    }\n\n    const pluginListView = await pluginList.reload();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async _getExtraPluginListUrls() {\n    const pluginListUrlsItem = await this._store.getItem(this._extraPluginListStoreKey);\n\n    if (pluginListUrlsItem) {\n      return pluginListUrlsItem.value.map(u => new URL(u));\n    }\n\n    return [];\n  }\n\n  async _modifyAndWriteStoredExtraPluginListUrls(mutatorFn) {\n    const pluginListUrls = await this._getExtraPluginListUrls();\n    const shouldWrite = mutatorFn(pluginListUrls) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._extraPluginListStoreKey, {key: this._extraPluginListStoreKey, timestamp: currentEpochSecond(), value: pluginListUrls});\n    }\n    return pluginListUrls;\n  }\n\n  _updatePluginListViewInViewModel(pluginListView) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListView.sourceUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1, pluginListView);\n    } else {\n      vm.lists.push(pluginListView);\n    }\n  }\n\n  _removePluginListViewFromViewModel(pluginListUrl) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1);\n    }\n  }\n\n}\n\nclass PluginReferenceTracker {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    // Track which lists reference a given plugin by keeping\n    // a mapping between the plugin url and the list urls which\n    // reference it.\n    this._pluginReferences = {\n        // 'https://example.com/alink-plugins/MyAwesomePlugin.alink.js': [ 'https://example.com/cool-alink-plugins.repo.json' ],\n    };\n  }\n\n  /* eslint-disable no-console */\n  async ackPluginReference(pluginUrl, listUrl) {\n    console.log('ackPluginReference', pluginUrl.toString(), listUrl.toString());\n\n    const pluginExists = Object.hasOwn(this._pluginReferences, pluginUrl.toString());\n\n    if (!pluginExists) {\n      this._pluginReferences[pluginUrl.toString()] = [];\n    }\n\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx < 0) {\n      pluginReferences.push(listUrl);\n    }\n\n    if (!pluginExists) {\n      await this._eventBus.$emit('add-plugin', pluginUrl);\n    }\n  }\n\n  /* eslint-disable no-console */\n  async freePluginReference(pluginUrl, listUrl) {\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    if (!pluginReferences) {\n      console.log('freePluginReference unexpectedly found plugin missing from internal reference tracking', pluginUrl.toString(), listUrl.toString(), JSON.stringify(this._pluginReferences));\n      return;\n    }\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx >= 0) {\n      pluginReferences.splice(listIdx, 1);\n    } else {\n      console.log('freePluginReference unexpectedly found plugin without expected reference', pluginUrl.toString(), listUrl.toString(), JSON.stringify(pluginReferences));\n    }\n\n    if (pluginReferences.length > 0) {\n      return;\n    }\n\n    await this._eventBus.$emit('remove-plugin', pluginUrl);\n  }\n}\n\nclass HttpPluginList {\n  constructor(store, url, pluginReferenceTracker, isDefault) {\n    this._store = store;\n    this._storeKey = `asset-link-cached-plugin-list:${url}`;\n    this._url = url;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n    this._isDefault = isDefault;\n\n    this._latestPluginListView = undefined;\n  }\n\n  async load(skipCache) {\n    this._latestPluginListView = postProcessPluginList(await this._getHttpPluginList(skipCache), false, this._url);\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return this._latestPluginListView;\n  }\n\n  async unload() {\n    if (!this._latestPluginListView) {\n      return;\n    }\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.freePluginReference(pRef.url, this._url)));\n\n    await this._store.removeItem(this._storeKey);\n  }\n\n  async reload() {\n    return await this.load(true);\n  }\n\n  async _getHttpPluginList(skipCache) {\n    const cacheItem = skipCache ? undefined : await this._store.getItem(this._storeKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginListRes = await fetch(this._url);\n\n    console.log(pluginListRes);\n    if (pluginListRes.status === 403) {\n      throw new HttpAccessDeniedException(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    } else if (!pluginListRes.ok) {\n      throw new Error(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    }\n\n    const pluginList = await pluginListRes.json();\n\n    await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp, value: pluginList});\n\n    return pluginList;\n  }\n\n}\n\nclass LocalPluginList {\n  constructor(store, pluginReferenceTracker) {\n    this._store = store;\n    this._storeKey = 'local-plugin-list.repo.json';\n    this._url = new URL(\"indexeddb://asset-link/data/local-plugin-list.repo.json\", window.location.origin);\n    this._pluginReferenceTracker = pluginReferenceTracker;\n  }\n\n  async load() {\n    const pluginListView = postProcessPluginList(await this._getLocalPluginList(), false, this._url);\n\n    await Promise.all(pluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return pluginListView;\n  }\n\n  async reload() {\n    return await this.load();\n  }\n\n  async addPlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      if (pl.plugins.find(pRef => pRef.url === pluginUrl.toString())) {\n        return false;\n      }\n      pl.plugins.push({ url: pluginUrl.toString() });\n    });\n\n    await this._pluginReferenceTracker.ackPluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async removePlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      const pluginIndex = pl.plugins.findIndex(pRef => pRef.url === pluginUrl.toString())\n\n      if (pluginIndex < 0) {\n        return false;\n      }\n\n      pl.plugins.splice(pluginIndex, 1);\n    });\n\n    await this._pluginReferenceTracker.freePluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async _getLocalPluginList() {\n    const pluginListItem = await this._store.getItem(this._storeKey);\n\n    if (!pluginListItem) {\n      return { plugins: [] };\n    }\n\n    return pluginListItem.value;\n  }\n\n  async _modifyAndWriteStoredList(mutatorFn) {\n    const pluginList = await this._getLocalPluginList();\n    const shouldWrite = mutatorFn(pluginList) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp: currentEpochSecond(), value: pluginList});\n    }\n    return pluginList;\n  }\n}\n\nconst postProcessPluginList = (pluginList, isDefault, sourceUrl) => {\n  pluginList.isDefault = isDefault;\n  pluginList.sourceUrl = sourceUrl;\n\n  if (!pluginList.error) {\n    pluginList.error = undefined;\n  }\n\n  if (!pluginList.plugins) {\n    pluginList.plugins = [];\n  }\n\n  pluginList.plugins = pluginList.plugins.map(pluginRef => {\n    // Resolve relative paths on this server, but still allow for\n    // arbitrary absolute/third-party urls\n    const pluginUrl = new URL(pluginRef.url, window.location.origin);\n\n    return {\n      url: pluginUrl,\n    };\n  });\n\n  return pluginList;\n};\n","import Vue from 'vue';\n\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { loadModule } from 'vue3-sfc-loader/dist/vue2-sfc-loader.esm.js';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nexport default class AssetLinkPluginLoaderCore {\n\n  constructor(assetLink) {\n    this._assetLink = assetLink;\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        plugins: [],\n      },\n    });\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  async boot() {\n    // TODO: ?\n  }\n\n  async loadPlugin(pluginUrl, opts) {\n    const options = opts || {};\n\n    const startTime = performance.now();\n\n    let pluginInstance = undefined;\n\n    try {\n      let pluginDataUrl = await this._fetchPlugin(pluginUrl, options);\n\n      if (pluginUrl.pathname.endsWith('alink.js')) {\n        const pluginCls = (await import(/* webpackIgnore: true */ pluginDataUrl)).default;\n        pluginInstance = new pluginCls();\n      } else if (pluginUrl.pathname.endsWith('alink.vue')) {\n        const pluginUrlWithoutParams = new URL(pluginUrl.toString());\n        pluginUrlWithoutParams.search = '';\n\n        const vuetify = await import('vuetify/lib');\n\n        const vuetifyComponents = {};\n        const vuetifyDirectives = {};\n\n        Object.entries(vuetify).forEach(([entryName, entry]) => {\n          if (Object.prototype.hasOwnProperty.call(entry, 'component')) {\n            vuetifyComponents[entryName] = entry;\n          } else if (['bind', 'inserted', 'update', 'componentUpdated', 'unbind'].find(directiveHook => Object.prototype.hasOwnProperty.call(entry, directiveHook))) {\n            vuetifyDirectives[entryName] = entry;\n          }\n        });\n\n        let rawPluginFileData = await fetch(pluginDataUrl).then(r => r.text());\n\n        // Roughly based on https://harlanzw.com/blog/vue-automatic-component-imports/\n        // and https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/loader.js#L110-L144\n        const compiler = await import('vue-template-compiler');\n\n        const tags = new Set()\n        const attrs = new Set()\n        const component = compiler.parseComponent(rawPluginFileData);\n\n        if (component.errors.length > 0) {\n          throw new Error(`Could not parse component plugin: ${component.errors.join('\\n')}`);\n        }\n\n        if (component.template) {\n          if (component.template.src) {\n            throw new Error(`External component template content is not supported.`);\n          }\n          compiler.compile(component.template.content, {\n            modules: [{\n              postTransformNode: node => {\n                if (\"directives\" in node) {\n                  node.directives.forEach(({ name }) => attrs.add(name))\n                }\n                tags.add(node.tag)\n              }\n            }]\n          });\n        }\n\n        /* eslint-disable no-unused-vars */\n        const usedVuetifyTags = Array.from(tags).map(item => [hyphenate(item), capitalize(camelize(item))])\n          .filter(([kebabTag, camelTag]) => kebabTag.startsWith('v-') && Object.prototype.hasOwnProperty.call(vuetifyComponents, camelTag))\n          .map(([kebabTag, camelTag]) => [camelTag, vuetifyComponents[camelTag]]);\n\n        const usedVuetifyDirectives = Array.from(attrs).map(item => capitalize(camelize(item)))\n          .filter(camelAttr => Object.prototype.hasOwnProperty.call(vuetifyDirectives, camelAttr))\n          .map(camelAttr => [camelAttr, vuetifyDirectives[camelAttr]]);\n\n        if (!this.moduleCache) {\n          this.moduleCache = Object.assign(Object.create(null), {\n            vue: Vue,\n            'vuetify/lib': vuetify,\n\n            // TODO: Figure out how to make loading these cleaner/on-demand\n            'vue-codemirror': import('vue-codemirror'),\n            'codemirror/mode/javascript/javascript.js': import('codemirror/mode/javascript/javascript.js'),\n            'codemirror/mode/vue/vue.js': import('codemirror/mode/vue/vue.js'),\n            'codemirror/lib/codemirror.css': import('codemirror/lib/codemirror.css'),\n            'codemirror/theme/base16-dark.css': import('codemirror/theme/base16-dark.css'),\n          });\n        }\n\n        const options = {\n          moduleCache: this.moduleCache,\n          compiledCache: {\n            set: (key, str) => this._store.setItem(`asset-link-cached-compiled-plugin:${key}`, str),\n            get: (key) => this._store.getItem(`asset-link-cached-compiled-plugin:${key}`),\n          },\n          async getFile(url) {\n            if ( url === pluginUrlWithoutParams ) {\n              return rawPluginFileData;\n            } else {\n              throw new Error(`Secondary imports are not supported. url=${url}`);\n            }\n          },\n          addStyle() { /* TODO */ },\n        };\n\n        pluginInstance = await loadModule(pluginUrlWithoutParams, options);\n\n        if (!pluginInstance.name) {\n          pluginInstance.name = `unnamed-sfc-plugin-${uuidv4()}`;\n        }\n\n        if (usedVuetifyTags.length && !pluginInstance.components) pluginInstance.components = {};\n        usedVuetifyTags.filter(t => !pluginInstance.components[t[0]]).forEach(t => pluginInstance.components[t[0]] = t[1]);\n\n        if (usedVuetifyDirectives.length && !pluginInstance.directives) pluginInstance.directives = {};\n        usedVuetifyDirectives.filter(t => !pluginInstance.directives[t[0]]).forEach(t => pluginInstance.directives[t[0]] = t[1]);\n\n        Vue.component(pluginInstance.name, pluginInstance);\n      } else {\n        throw new Error(`Cannot load plugin ${pluginUrl} with unsupported type. Path of url must end in '.alink.js' or '.alink.vue'`);\n      }\n\n      pluginInstance.pluginUrl = pluginUrl;\n\n      this.registerPlugin(pluginInstance);\n    } catch (error) {\n      console.log(error);\n      pluginInstance = {};\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.error = error;\n      this.registerPlugin(pluginInstance);\n    } finally {\n      const endTime = performance.now();\n      console.log(`Loading plugin ${pluginUrl} took ${endTime - startTime} milliseconds`);\n    }\n  }\n\n  /**\n   * Directly register a plugin with Asset Link. Note that plugins registered this way\n   * will not persist between sessions/reloads.\n   */\n  registerPlugin(plugin) {\n    plugin.definedRoutes = {};\n    plugin.definedSlots = {};\n    plugin.definedWidgetDecorators = {};\n\n    this.vm.plugins.push(plugin);\n\n    if (typeof plugin.onLoad === 'function') {\n      const handle = new AssetLinkPluginHandle(plugin, this.vm);\n\n      plugin.onLoad(handle, this._assetLink);\n    }\n  }\n\n  async unloadPlugin(pluginUrl) {\n    const pluginIdx = this.vm.plugins.findIndex(p => p.pluginUrl.toString() === pluginUrl.toString());\n\n    if (pluginIdx !== -1) {\n      this.vm.plugins.splice(pluginIdx, 1);\n    }\n  }\n\n  async reloadPlugin(pluginUrl) {\n    await this.unloadPlugin(pluginUrl);\n    await this.loadPlugin(pluginUrl, { skipCache: true });\n  }\n\n  async _fetchPlugin(url, opts) {\n    const options = opts || {};\n\n    const skipCache = options.skipCache || (url.searchParams && url.searchParams.get('skipCache'));\n\n    const cacheKey = `asset-link-cached-plugin-src:${url}`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (!skipCache && cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginSrc = await fetch(url).then(r => r.text());\n\n    const pluginSrcWithSourceInfo = `${pluginSrc}\\n//# sourceURL=asset-link-plugin:./${encodeURIComponent(url)}\\n`;\n\n    const pluginDataUrl = \"data:application/javascript;base64,\" + btoa(pluginSrcWithSourceInfo);\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: pluginDataUrl});\n\n    return pluginDataUrl;\n  }\n\n}\n\nclass AssetLinkPluginHandle {\n\n  constructor(pluginInstance, vm) {\n    this._pluginInstance = pluginInstance;\n    this._vm = vm;\n  }\n\n  get thisPlugin() {\n    return this._pluginInstance;\n  }\n\n  defineRoute(routeName, routeDefiner) {\n    const routeDef = {name: routeName};\n\n    const routeHandle = {\n        path(path) {\n          routeDef.path = path;\n        },\n        componentFn(componentFn) {\n          routeDef.componentFn = componentFn;\n        },\n    };\n\n    routeDefiner(routeHandle);\n\n    const missingFields = Object.entries({'path': 'string', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof routeDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Action '${routeName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, routeDef);\n      return;\n    }\n\n    this._pluginInstance.definedRoutes[routeName] = routeDef;\n\n    this._vm.$emit('add-route', routeDef);\n  }\n\n  defineSlot(slotName, slotDefiner) {\n    const slotDef = {name: slotName};\n\n    const slotHandle = {\n        type(type) {\n          slotDef.type = type;\n        },\n        showIf(predicateFn) {\n          slotDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          slotDef.componentFn = componentFn;\n        },\n    };\n\n    slotDefiner(slotHandle);\n\n    const missingFields = Object.entries({'type': 'string', 'predicateFn': 'function', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof slotDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Slot '${slotName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, slotDef);\n      return;\n    }\n\n    const providedPredicateFn = slotDef.predicateFn;\n\n    // Decorate the predicate function to make the slots automatically filtered by type\n    slotDef.predicateFn = (context) => context.type === slotDef.type && providedPredicateFn(context);\n\n    this._pluginInstance.definedSlots[slotName] = slotDef;\n  }\n\n  defineWidgetDecorator(widgetDecoratorName, widgetDecoratorDefiner) {\n    const widgetDecoratorDef = { name: widgetDecoratorName };\n\n    const widgetDecoratorHandle = {\n        targetWidgetName(targetWidgetName) {\n          widgetDecoratorDef.targetWidgetName = targetWidgetName;\n        },\n        appliesIf(predicateFn) {\n          widgetDecoratorDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          widgetDecoratorDef.componentFn = componentFn;\n        },\n    };\n\n    widgetDecoratorDefiner(widgetDecoratorHandle);\n\n    const missingFields = Object.entries({'targetWidgetName': 'string', 'predicateFn': 'function', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof widgetDecoratorDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Widget decorator '${widgetDecoratorName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, widgetDecoratorDef);\n      return;\n    }\n\n    const providedPredicateFn = widgetDecoratorDef.predicateFn;\n\n    // Decorate the predicate function to make the widget decorators automatically filtered by targetWidgetName\n    widgetDecoratorDef.predicateFn = (context) =>\n      context.widgetName === widgetDecoratorDef.targetWidgetName && providedPredicateFn(context);\n\n    this._pluginInstance.definedWidgetDecorators[widgetDecoratorName] = widgetDecoratorDef;\n  }\n\n}\n\n//Copied from https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/util.js#L6-L18\nconst camelizeRE = /-(\\w)/g\nconst camelize = str => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n}\n\nconst capitalize = str => {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst hyphenateRE = /\\B([A-Z])/g\nconst hyphenate = str => {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n","import Vue from 'vue';\n\nimport { Coordinator, RequestStrategy, SyncStrategy } from '@orbit/coordinator';\nimport { Orbit } from '@orbit/core';\nimport { IndexedDBBucket } from '@orbit/indexeddb-bucket';\nimport { IndexedDBSource } from '@orbit/indexeddb';\nimport { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\nimport DrupalJSONAPISource from '@/DrupalJSONAPISource';\nimport DrupalSyncQueryOperators from '@/DrupalSyncQueryOperators';\n\nimport localforage from 'localforage';\n\nimport fetch from 'cross-fetch';\n\nimport AssetLinkUI from '@/AssetLinkUI';\nimport AssetLinkUtil from '@/AssetLinkUtil';\nimport createDrupalUrl from '@/createDrupalUrl';\nimport FarmOSConnectionStatusDetector from '@/FarmOSConnectionStatusDetector';\nimport PeekableAsyncIterator from '@/PeekableAsyncIterator';\nimport AssetLinkPluginListsCore from '@/AssetLinkPluginListsCore';\nimport AssetLinkPluginLoaderCore from '@/AssetLinkPluginLoaderCore';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nconst fetchJson = (url, args) => fetch(url, args).then(response => response.json());\n\n\n\n/**\n * Core of the larger Asset Link application and API entry-point for plugins.\n * \n * TODO: Break out some of the responsibilities of this class into classes that can be\n * delegated to. e.g. plugin management, entities CRUD, etc.\n */\nexport default class AssetLink {\n\n  constructor(app) {\n    this._app = app;\n    this._viewModel = new Vue({\n      data: {\n        booted: false,\n        bootProgress: 0,\n        bootText: \"Starting\",\n\n        connectionStatus: new FarmOSConnectionStatusDetector(),\n\n        pendingUpdates: [],\n\n        messages: [],\n      },\n    });\n\n    this._booted = new Promise((resolve) => {\n      this._viewModel.$once('booted', () => {\n        this._viewModel.booted = true;\n        resolve(true);\n      });\n    });\n\n    this._store = localforage.createInstance({\n      name: 'asset-link',\n      storeName: 'data',\n    });\n\n    this._cores = {};\n    this._cores.pluginLists = new AssetLinkPluginListsCore(this);\n    this._cores.pluginLoader = new AssetLinkPluginLoaderCore(this);\n\n    this._memory = undefined;\n    this._remote = undefined;\n\n    this._ui = new AssetLinkUI(app);\n    this._util = new AssetLinkUtil();\n  }\n\n  /**\n   * The top-level {Vue} app component.\n   */\n  get app() {\n    return this._app;\n  }\n\n  /**\n   * A {Vue} instance used to expose some of Asset Link's state to\n   * its UI in a reactive way.\n   */\n  get viewModel() {\n    return this._viewModel;\n  }\n\n  /**\n   * UI components/methods exposed for Asset Link plugins.\n   */\n  get ui() {\n    return this._ui;\n  }\n\n  /**\n   * Utility methods exposed for Asset Link plugins.\n   */\n  get util() {\n    return this._util;\n  }\n\n  /**\n   * The map of AssetLink cores.\n   */\n  get cores() {\n    return this._cores;\n  }\n\n  /**\n   * The Orbit.js {MemorySource} which is used to access/modify farmOS assets/logs/etc.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get entitySource() {\n    return this._memory;\n  }\n\n  /**\n   * The Orbit.js {JSONAPISource} which is used to directly access/modify\n   * farmOS assets/logs/etc - unless you know what you are doing, use {#entitySource}\n   * instead.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get remoteEntitySource() {\n    return this._remote;\n  }\n\n  /**\n   * The currently loaded plugins.\n   */\n  get plugins() {\n    return this._cores.pluginLoader.vm.plugins;\n  }\n\n  /**\n   * A {Promise} that is fulfilled once Asset Link has booted.\n   */\n  get booted() {\n    return this._booted;\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async boot() {\n    this.viewModel.bootText = \"Initializing storage\";\n\n    await this._store.ready();\n\n    this._cores.pluginLists.eventBus.$on('add-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.loadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLists.eventBus.$on('remove-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.unloadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLoader.vm.$on('add-route', routeDef => {\n      if (typeof this.app.addRoute === 'function') {\n        this.app.addRoute(routeDef);\n      }\n    });\n\n    this._cores.pluginLoader.vm.$on('remove-route', routeDef => {\n      if (typeof this.app.removeRoute === 'function') {\n        this.app.removeRoute(routeDef);\n      }\n    });\n\n    window.addEventListener('asset-link-plugin-changed', async e => {\n      await this._cores.pluginLoader.reloadPlugin(new URL(e.detail.pluginUrl));\n    });\n\n    await this._cores.pluginLoader.boot();\n    await this._cores.pluginLists.boot();\n\n    this.viewModel.bootText = \"Loading models...\";\n    this._models = await this._loadModels();\n\n    Orbit.fetch = this._csrfAwareFetch.bind(this);\n\n    this._schema = new RecordSchema({ models: this._models });\n\n    const bucket = new IndexedDBBucket({ namespace: 'asset-link-orbitjs-bucket' });\n\n    this._memory = new MemorySource({\n      schema: this._schema,\n      cacheSettings: {\n        queryOperators: DrupalSyncQueryOperators,\n      },\n    });\n\n    this._remote = new DrupalJSONAPISource({\n      schema: this._schema,\n      name: 'remote',\n      host: createDrupalUrl('/api'),\n      defaultFetchSettings: {\n        timeout: 10000,\n      },\n      bucket,\n      requestQueueSettings: {\n        autoProcess: this.viewModel.connectionStatus.isOnline || false,\n      },\n    });\n\n    const updateViewModelPendingUpdates = () => {\n      this.viewModel.pendingUpdates = this._remote.requestQueue.entries.filter(r => r.type === 'update');\n    };\n\n    this._remote.requestQueue.reified.then(updateViewModelPendingUpdates);\n    this._remote.requestQueue.on('change', updateViewModelPendingUpdates);\n\n    this._backup = new IndexedDBSource({\n      schema: this._schema,\n      name: 'backup',\n      namespace: 'asset-link-orbitjs-entities',\n      defaultTransformOptions: {\n        useBuffer: true,\n      },\n    });\n\n    this._coordinator = new Coordinator({\n      sources: [this._memory, this._remote, this._backup]\n    });\n\n    // Query the remote server when the memory source is queried (and online)\n    this._remoteQueryStrategy = new RequestStrategy({\n      name: 'remoteRequestStrategy',\n\n      source: 'memory',\n      on: 'beforeQuery',\n\n      target: 'remote',\n      action: 'query',\n\n      blocking: true\n    });\n    // Only use the remote query strategy when online\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._coordinator.addStrategy(this._remoteQueryStrategy);\n    }\n\n    // Update the remote server whenever the memory source is updated\n    this._coordinator.addStrategy(\n      new RequestStrategy({\n        source: 'memory',\n        on: 'beforeUpdate',\n\n        target: 'remote',\n        action: 'update',\n\n        blocking: false\n      })\n    );\n\n    // Sync all changes received from the remote server to the memory source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'remote',\n        target: 'memory',\n        blocking: false\n      })\n    );\n\n    // Sync all changes to the backup source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'memory',\n        target: 'backup',\n        blocking: true\n      })\n    );\n\n    // Restore the backup source\n    const allRecordsFromBackup = await this._backup.query((q) => q.findRecords());\n    await this._memory.sync((t) => allRecordsFromBackup.map((r) => t.addRecord(r)));\n\n    await this._coordinator.activate();\n\n    this.viewModel.bootProgress = 100;\n\n    this._memory.on('update', update => {\n      console.log('_memory::update', update);\n\n      if (update.operations.op === 'updateRecord' && update.operations.record.type.startsWith('asset--')) {\n        this.viewModel.$emit('changed:asset', update.operations.record.type, update.operations.record.id);\n      }\n\n    });\n\n    this.viewModel.connectionStatus.$watch('isOnline', async (isOnline) => {\n      this._remote.requestQueue.autoProcess = isOnline;\n      if (isOnline && !this._remote.requestQueue.empty) {\n        this._remote.requestQueue.process();\n      }\n\n      await this._coordinator.deactivate();\n      if (isOnline) {\n        if (!this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.addStrategy(this._remoteQueryStrategy);\n        }\n      } else {\n        if (this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.removeStrategy(this._remoteQueryStrategy.name);\n        }\n      }\n      await this._coordinator.activate();\n    });\n\n    this.viewModel.$emit('booted');\n\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._precache();\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets the model for an entity type given that the type name. e.g. \"asset--plant\"\n   */\n  async getEntityModel(typeName) {\n    await this._booted;\n\n    return this._models[typeName];\n  }\n\n  async _precache() {\n    // Precache the current page's asset\n    const matches = window.location.href.match(/https?:\\/\\/.*\\/asset\\/(\\d+)/);\n    if (matches && matches.length >= 2) {\n      const thisAsset = await this.resolveAsset(matches[1]);\n      console.log(\"thisAsset=\", thisAsset);\n    }\n\n    const timestamp = currentEpochSecond();\n\n    const lastPrecacheTimeKey = `asset-link-last-precache-time`;\n\n    const lastPrecacheTime = await this._store.getItem(lastPrecacheTimeKey);\n\n    if (lastPrecacheTime && (timestamp - lastPrecacheTime) < 900) {\n      console.log(\"Skipping Asset Link precaching because it was done recently...\");\n      return;\n    }\n\n    // Precache recently changed assets\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    await this._memory.query((q) => assetTypes.map(assetType => q.findRecords(`asset--${assetType}`)\n        .sort('-changed')\n        .page({ offset: 0, limit: 100 })));\n\n    // TODO: Consider also precaching recently changed and recent/upcoming logs\n\n    await this._store.setItem(lastPrecacheTimeKey, timestamp);\n  }\n\n  /**\n   * Get a list of the asset_type entities.\n   */\n  async getAssetTypes() {\n    const listAssetTypes = async (source) => {\n      return await source.query((q) => q\n          .findRecords(`asset_type--asset_type`)\n          .sort('drupal_internal__id'));\n    };\n\n    const assetTypes = await listAssetTypes(this._memory.cache);\n\n    if (assetTypes.length) {\n      return assetTypes;\n    }\n\n    return await listAssetTypes(this._memory);\n  }\n\n  /**\n   * Get an asset by UUID or Drupal internal id.\n   */\n  async resolveAsset(assetRef) {\n    await this._booted;\n\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    const isRefNumeric = /^-?\\d+$/.test(assetRef);\n\n    let filter = { attribute: 'id', value: assetRef };\n    if (isRefNumeric) {\n      filter = { attribute: 'drupal_internal__id', value: parseInt(assetRef) };\n    }\n\n    const findAsset = async (source) => {\n      const results = await source.query(q => assetTypes.map(assetType => q\n          .findRecords(`asset--${assetType}`)\n          .filter(filter)\n          .sort('drupal_internal__id')));\n\n      const assets = results.flatMap(l => l);\n\n      return assets.find(a => a);\n    };\n\n    const asset = await findAsset(this._memory.cache);\n\n    if (asset) {\n      return asset;\n    }\n\n    return await findAsset(this._memory);\n  }\n\n  /**\n   * Central asset searching entry-point. Responsible for delegating to asset searching plugins.\n   */\n  searchAssets(searchRequest, searchPhase) {\n    console.log(\"searchAssets:\", JSON.stringify(searchRequest), searchPhase);\n\n    const assetSearchPlugins = this.plugins.filter(p => typeof p.searchAssets === 'function');\n\n    const searchResultCursors = [];\n\n    for (let i = 0; i < assetSearchPlugins.length; i += 1) {\n      const plugin = assetSearchPlugins[i];\n\n      /* eslint-disable no-await-in-loop */\n      const searchResultCursor = plugin.searchAssets(this, searchRequest, searchPhase);\n\n      if (searchResultCursor !== undefined) {\n        searchResultCursors.push(searchResultCursor);\n      }\n    }\n\n    async function* coiterateSearchCursors() {\n      console.log(\"coiterateSearchCursors: searchResultCursors =\", searchResultCursors);\n\n      const peekableSearchResultCursors = searchResultCursors.map(c => new PeekableAsyncIterator(c));\n\n      while(peekableSearchResultCursors.length > 0) {\n\n        console.log(\"coiterateSearchCursors: peekableSearchResultCursors.length =\", peekableSearchResultCursors.length, peekableSearchResultCursors);\n\n        let bestNextCursor = undefined;\n        let doneBestNextCursorIndex = undefined;\n        for (let i = 0; i < peekableSearchResultCursors.length; i += 1) {\n          const thisCursor = peekableSearchResultCursors[i];\n\n          const thisCursorNextResult = await thisCursor.peek();\n\n          if (thisCursorNextResult.value === undefined) {\n            continue;\n          }\n\n          if (bestNextCursor === undefined || thisCursorNextResult.value.weight < (await bestNextCursor.peek()).value.weight) {\n            bestNextCursor = thisCursor;\n            doneBestNextCursorIndex = thisCursorNextResult.done ? i : undefined;\n          }\n        }\n\n        if (bestNextCursor === undefined) {\n          return;\n        }\n\n        const bestCursorNextResult = await bestNextCursor.next();\n\n        if (bestCursorNextResult.value) {\n          yield bestCursorNextResult.value;\n        }\n\n        if (doneBestNextCursorIndex !== undefined) {\n          peekableSearchResultCursors.splice(doneBestNextCursorIndex, 1);\n        }\n\n      }\n    }\n\n    return coiterateSearchCursors();\n  }\n\n  getSlots(context) {\n    return this.getPluginDefinedComponents('definedSlots', context);\n  }\n\n  getWidgetDecorators(context) {\n    return this.getPluginDefinedComponents('definedWidgetDecorators', context);\n  }\n\n  getPluginDefinedComponents(componentDefKey, context) {\n    const sortingFn = (a1, a2) => {\n      if (a1.weight < a2.weight) {\n        return -1;\n      }\n      if (a1.weight > a2.weight) {\n        return 1;\n      }\n      if (a1.id < a2.id) {\n        return -1;\n      }\n      if (a1.id > a2.id) {\n        return 1;\n      }\n      return 0;\n    };\n\n    const componentDefs = plugin => plugin[componentDefKey] || {};\n\n    return this.plugins.flatMap(plugin => Object.values(componentDefs(plugin)))\n      .filter(a => a.predicateFn(context))\n      .map(a => ({\n        id: a.id,\n        componentFn: (wrapper, h, children) => a.componentFn(wrapper, h, context, children),\n        weight: a.weight || 100,\n      }))\n      .sort(sortingFn);\n  }\n\n  async _csrfAwareFetch(url, opts) {\n    const options = opts || {};\n\n    if (!options.method) options.method = 'GET';\n\n    const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n    const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n    const isUnsafeMethod = !['HEAD', 'GET', 'OPTIONS', 'TRACE'].includes(options.method.toUpperCase());\n\n    const addCsrfHeader = isFarmOSRequest && isUnsafeMethod;\n\n    try {\n      if (addCsrfHeader) {\n        const tokenResponse = await this.viewModel.connectionStatus.fetch(createDrupalUrl('/session/token'));\n\n        console.log(\"tokenResponse:\", tokenResponse);\n\n        const token = await tokenResponse.text();\n\n        // TODO: Cache the token\n        if (!options.headers) options.headers = {};\n        options.headers['X-CSRF-Token'] = token;\n      }\n  \n      return await this.viewModel.connectionStatus.fetch(url, options);\n    } catch (error) {\n      console.log(\"Error in _csrfAwareFetch\", typeof error, error);\n      if (error.message === 'Network request failed') {\n        return new Response(null, {\n          status: 503,\n          statusText: 'Service unavailable due to network error',\n        });\n      }\n      throw error;\n    }\n  }\n\n  async _loadModels() {\n    const cacheKey = `asset-link-cached-entity-models`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    if (cacheItem) {\n      // TODO: If cache item is stale, schedule background refresh\n      return cacheItem.value;\n    }\n\n    const models = await this._loadModelsFromServer();\n\n    const timestamp = currentEpochSecond();\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: models});\n\n    return models;\n  }\n\n  async _loadModelsFromServer() {\n    this.viewModel.bootText = \"Loading server schema\";\n    const serverSchema = await fetchJson(createDrupalUrl('/api/schema'));\n\n    const serverRelatedSchemas = serverSchema.allOf.flatMap(schemaRef => schemaRef.links || []);\n\n    const models = {};\n\n    await Promise.all(serverRelatedSchemas.map(async (serverRelatedSchema) => {\n      const relatedSchema = await fetchJson(serverRelatedSchema.targetSchema);\n\n      const relatedItemSchema = await fetchJson(relatedSchema.definitions.data.items.$ref);\n\n      const typeName = relatedItemSchema.definitions.type['const'];\n\n      models[typeName] = {\n        attributes: Object.fromEntries(\n            Object.entries(relatedItemSchema.definitions.attributes.properties)\n              .map(([attrName, attr]) => {\n                // Orbit.js seems to only support 'number', not 'integer' but handles the former well enough\n                if (attr.type === 'integer') {\n                  attr.type = 'number';\n                }\n\n                // https://www.drupal.org/project/jsonapi_schema/issues/3058850\n                if (attrName === 'third_party_settings') {\n                  attr.type = 'object';\n                }\n\n                return [attrName, attr];\n              })\n        ),\n        relationships: relatedItemSchema.definitions?.relationships?.properties || {},\n      };\n\n      this.viewModel.bootProgress = ((Object.keys(models).length / serverRelatedSchemas.length) * 100).toFixed(1);\n    }));\n\n    return models;\n  }\n\n}\n","export default function createDrupalUrl(pathSuffix) {\n  return new URL(pathSuffix, window.location.origin + window.assetLinkDrupalBasePath);\n}","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n"],"names":["DrupalJSONAPIURLBuilder","JSONAPIURLBuilder","constructor","settings","super","buildFilterParam","filterSpecifiers","filters","forEach","filterSpecifier","index","kind","op","attributeFilter","resourceAttribute","this","serializeAttributeAsParam","undefined","attribute","push","value","path","operator","relatedRecordFilter","Array","isArray","record","relation","map","e","id","join","QueryExpressionParseError","Error","relatedRecordsFilter","records","type","serializer","serializerFor","JSONAPISerializers","serialize","DrupalJSONAPISource","JSONAPISource","defaultFetchSettings","Object","assign","headers","Accept","serializerSettingsFor","buildSerializerSettingsFor","sharedSettings","inflectors","drupal","buildInflector","input","replace","settingsByType","serializationOptions","URLBuilderClass","findRecord","SyncQueryOperators","findRelatedRecord","findRecords","cache","expression","options","exp","results","getRecordsSync","filter","filterRecords","sort","sortRecords","page","paginateRecords","findRelatedRecords","relationship","relatedIds","getRelatedRecordsSync","length","getRecordSync","raiseNotFoundExceptions","RecordNotFoundException","i","l","applyFilter","attributeKey","split","actual","deepGet","expected","toLowerCase","startsWith","includes","endsWith","sortSpecifiers","comparisonValues","Map","set","sortSpecifier","comparisonOrders","sortExpression","order","record1","record2","values1","get","values2","isNone","paginationOptions","limit","offset","slice","AssetLinkUI","app","_app","c","VBtn","VListItem","VListItemTitle","dialog","confirm","async","$dialog","text","title","promptText","prompt","custom","component","params","uuidv4","context","Vue","result","Promise","resolve","$on","dialogs","componentFn","wrapper","h","VDialog","props","fullscreen","on","ref","d","AssetLinkUtil","formatRFC3339","createDrupalUrl","geohash","haversine","summarizeAssetNames","assets","a","attributes","name","FarmOSConnectionStatusDetector","fetcherDelegate","default","fetch","data","$_running","$_barrier","Barrier","hasNetworkConnection","window","navigator","onLine","canReachFarmOS","isLoggedIn","created","addEventListener","$data","release","connection","$_mainLoop","computed","isOnline","beforeDestroy","methods","url","opts","method","requestUrl","URL","location","origin","assetLinkDrupalBasePath","isFarmOSRequest","host","pathname","res","status","error","checkConnectionStatus","throttle","$_checkConnectionStatus","arrive","apiUrl","currentEpochSecond","credentials","apiData","json","farmOsVersion","meta","farm","version","userRef","links","me","href","sleep","millis","setTimeout","parseInt","Date","getTime","waiting","timeoutMillis","race","toBeReleased","splice","p","PeekableAsyncIterator","delegate","_delegate","_next_iteration_result","next","EventBus","_handlersByEventName","eventName","handler","hasOwn","arg","handlers","promises","all","then","HttpAccessDeniedException","message","AssetLinkPluginListsCore","assetLink","_store","_vm","lists","_eventBus","_pluginReferenceTracker","PluginReferenceTracker","_defaultPluginList","HttpPluginList","_localPluginList","LocalPluginList","_extraPluginLists","_extraPluginListStoreKey","vm","eventBus","extraPluginListUrls","_getExtraPluginListUrls","pluginListUrl","pluginList","pluginListView","load","_updatePluginListViewInViewModel","pluginUrl","addPlugin","removePlugin","_modifyAndWriteStoredExtraPluginListUrls","idx","findIndex","plUrl","pluginListIndex","pl","_url","unload","_removePluginListViewFromViewModel","find","reload","pluginListUrlsItem","getItem","u","mutatorFn","pluginListUrls","shouldWrite","setItem","key","timestamp","plVIndex","plV","sourceUrl","_pluginReferences","listUrl","console","log","toString","pluginExists","pluginReferences","listIdx","indexOf","$emit","JSON","stringify","store","pluginReferenceTracker","isDefault","_storeKey","_isDefault","_latestPluginListView","skipCache","postProcessPluginList","_getHttpPluginList","plugins","pRef","ackPluginReference","freePluginReference","removeItem","cacheItem","pluginListRes","statusText","ok","_getLocalPluginList","_modifyAndWriteStoredList","pluginIndex","pluginListItem","pluginRef","AssetLinkPluginLoaderCore","_assetLink","startTime","performance","now","pluginInstance","pluginDataUrl","_fetchPlugin","pluginCls","import","pluginUrlWithoutParams","search","vuetify","vuetifyComponents","vuetifyDirectives","entries","entryName","entry","prototype","hasOwnProperty","call","directiveHook","rawPluginFileData","r","compiler","tags","Set","attrs","parseComponent","errors","template","src","compile","content","modules","postTransformNode","node","directives","add","tag","usedVuetifyTags","from","item","hyphenate","capitalize","camelize","kebabTag","camelTag","usedVuetifyDirectives","camelAttr","moduleCache","create","vue","compiledCache","str","addStyle","loadModule","components","t","registerPlugin","endTime","plugin","definedRoutes","definedSlots","definedWidgetDecorators","onLoad","handle","AssetLinkPluginHandle","pluginIdx","unloadPlugin","loadPlugin","searchParams","cacheKey","pluginSrc","pluginSrcWithSourceInfo","encodeURIComponent","btoa","_pluginInstance","thisPlugin","defineRoute","routeName","routeDefiner","routeDef","routeHandle","missingFields","attr","expectedType","defineSlot","slotName","slotDefiner","slotDef","slotHandle","showIf","predicateFn","providedPredicateFn","defineWidgetDecorator","widgetDecoratorName","widgetDecoratorDefiner","widgetDecoratorDef","widgetDecoratorHandle","targetWidgetName","appliesIf","widgetName","camelizeRE","_","toUpperCase","charAt","hyphenateRE","fetchJson","args","response","AssetLink","_viewModel","booted","bootProgress","bootText","connectionStatus","pendingUpdates","messages","_booted","$once","localforage","storeName","_cores","pluginLists","pluginLoader","_memory","_remote","_ui","_util","viewModel","ui","util","cores","entitySource","remoteEntitySource","ready","addRoute","removeRoute","reloadPlugin","detail","boot","_models","_loadModels","Orbit","_csrfAwareFetch","bind","_schema","RecordSchema","models","bucket","IndexedDBBucket","namespace","MemorySource","schema","cacheSettings","queryOperators","DrupalSyncQueryOperators","timeout","requestQueueSettings","autoProcess","updateViewModelPendingUpdates","requestQueue","reified","_backup","IndexedDBSource","defaultTransformOptions","useBuffer","_coordinator","Coordinator","sources","_remoteQueryStrategy","RequestStrategy","source","target","action","blocking","addStrategy","SyncStrategy","allRecordsFromBackup","query","q","sync","addRecord","activate","update","operations","$watch","empty","process","deactivate","strategies","removeStrategy","_precache","typeName","matches","match","thisAsset","resolveAsset","lastPrecacheTimeKey","lastPrecacheTime","assetTypes","getAssetTypes","drupal_internal__id","assetType","listAssetTypes","assetRef","isRefNumeric","test","findAsset","flatMap","asset","searchAssets","searchRequest","searchPhase","assetSearchPlugins","searchResultCursors","searchResultCursor","coiterateSearchCursors","peekableSearchResultCursors","bestNextCursor","doneBestNextCursorIndex","thisCursor","thisCursorNextResult","peek","weight","done","bestCursorNextResult","getSlots","getPluginDefinedComponents","getWidgetDecorators","componentDefKey","sortingFn","a1","a2","componentDefs","values","children","isUnsafeMethod","addCsrfHeader","tokenResponse","token","Response","_loadModelsFromServer","serverSchema","serverRelatedSchemas","allOf","schemaRef","relatedSchema","serverRelatedSchema","targetSchema","relatedItemSchema","definitions","items","$ref","fromEntries","properties","attrName","relationships","keys","toFixed","pathSuffix","Vuetify","register","registered","cached","updatefound","updated","offline"],"sourceRoot":""}