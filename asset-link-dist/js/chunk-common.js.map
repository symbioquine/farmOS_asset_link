{"version":3,"file":"js/chunk-common.js","mappings":"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","sources":["webpack://alinkjs/./src/DrupalJSONAPIURLBuilder.js","webpack://alinkjs/./src/DrupalJSONAPISource.js","webpack://alinkjs/./src/DrupalSyncQueryOperators.js","webpack://alinkjs/./src/AssetLinkUI.js","webpack://alinkjs/./src/AssetLinkUtil.js","webpack://alinkjs/./src/FarmOSConnectionStatusDetector.js","webpack://alinkjs/./src/PeekableAsyncIterator.js","webpack://alinkjs/./src/util/currentEpochSecond.js","webpack://alinkjs/./src/util/EventBus.js","webpack://alinkjs/./src/HttpAccessDeniedException.js","webpack://alinkjs/./src/AssetLinkPluginListsCore.js","webpack://alinkjs/./src/AssetLinkPluginLoaderCore.js","webpack://alinkjs/./src/AssetLink.js","webpack://alinkjs/./src/createDrupalUrl.js","webpack://alinkjs/./src/plugins/vuetify.js","webpack://alinkjs/./src/registerServiceWorker.js"],"sourcesContent":["import { JSONAPIURLBuilder } from \"@orbit/jsonapi\";\nimport { QueryExpressionParseError } from \"@orbit/data\";\nimport { JSONAPISerializers } from '@orbit/jsonapi';\n\n/**\n * Extends {JSONAPIURLBuilder} to add support for Drupal JSON:API query operators.\n * \n * Loosely based on https://gist.github.com/bradjones1/18ff9ebdb85455f781a2a212577653ce\n */\nexport default class DrupalJSONAPIURLBuilder extends JSONAPIURLBuilder {\n\n  constructor(settings) {\n    super(settings);\n  }\n\n  buildFilterParam(filterSpecifiers) {\n    const filters = [];\n\n    filterSpecifiers.forEach((filterSpecifier, index) => {\n      if (\n        filterSpecifier.kind === 'attribute' &&\n        filterSpecifier.op === 'equal'\n      ) {\n        const attributeFilter = filterSpecifier;\n\n        // Note: We don't know the `type` of the attribute here, so passing `undefined`\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({ [resourceAttribute]: attributeFilter.value });\n      } else if (filterSpecifier.kind === 'attribute') {\n        const attributeFilter = filterSpecifier;\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({\n          ['client-' + resourceAttribute + '-' + index]: {\n            path: resourceAttribute,\n            operator: attributeFilter.op,\n            value: attributeFilter.value\n          }\n        });\n      } else if (filterSpecifier.kind === 'relatedRecord') {\n        const relatedRecordFilter = filterSpecifier;\n        if (Array.isArray(relatedRecordFilter.record)) {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter.record\n              .map((e) => e.id)\n              .join(',')\n          });\n        } else {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter?.record?.id\n          });\n        }\n      } else if (filterSpecifier.kind === 'relatedRecords') {\n        if (filterSpecifier.op !== 'equal') {\n          throw new Error(\n            `Operation \"${filterSpecifier.op}\" is not supported in JSONAPI for relatedRecords filtering`\n          );\n        }\n        const relatedRecordsFilter = filterSpecifier;\n        filters.push({\n          [relatedRecordsFilter.relation]: relatedRecordsFilter.records\n            .map((e) => e.id)\n            .join(',')\n        });\n      } else {\n        throw new QueryExpressionParseError(\n          `Filter operation ${filterSpecifier.op} not recognized for JSONAPISource.`\n        );\n      }\n    });\n\n    return filters;\n  }\n\n  serializeAttributeAsParam(type, attribute) {\n      if (this.serializer) {\n        return this.serializer.resourceAttribute(type, attribute);\n      } else {\n        const serializer = this.serializerFor(JSONAPISerializers.ResourceFieldParam);\n        return serializer.serialize(attribute, { type });\n      }\n    }\n\n}\n","import JSONAPISource, { JSONAPISerializers } from '@orbit/jsonapi';\nimport { buildSerializerSettingsFor, buildInflector } from '@orbit/serializers';\n\nimport DrupalJSONAPIURLBuilder from '@/DrupalJSONAPIURLBuilder';\n\n\n/**\n * Handle Drupal's `type/bundle` JSON:API resource pathing.\n * Based on: https://github.com/orbitjs/orbit/issues/714#issuecomment-1013952990\n */\nexport default class DrupalJSONAPISource extends JSONAPISource {\n  constructor(settings) {\n    const defaultFetchSettings = Object.assign({}, settings.defaultFetchSettings || {}, {\n      headers:{\n        Accept: 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json',\n      },\n    });\n\n    super(Object.assign({}, settings, {\n      defaultFetchSettings,\n      serializerSettingsFor: buildSerializerSettingsFor({\n        sharedSettings: {\n          inflectors: {\n            drupal: buildInflector(\n              {},\n              (input) => input.replace('--', '/')\n            )\n          }\n        },\n        settingsByType: {\n          [JSONAPISerializers.ResourceTypePath]: {\n            serializationOptions: {inflectors: ['drupal']}\n          }\n        }\n      }),\n      URLBuilderClass: DrupalJSONAPIURLBuilder,\n    }));\n  }\n\n}\n","import { SyncQueryOperators } from '@orbit/record-cache';\nimport { QueryExpressionParseError } from '@orbit/data';\nimport { RecordNotFoundException } from '@orbit/records';\nimport { deepGet, isNone } from '@orbit/utils';\n\n// Based on https://github.com/orbitjs/orbit/blob/2c4bf7038d2f74ba31e45e949c70ec4161ced28f/packages/@orbit/record-cache/src/operators/sync-query-operators.ts\nexport default {\n  findRecord: SyncQueryOperators.findRecord,\n  findRelatedRecord: SyncQueryOperators.findRelatedRecord,\n\n  findRecords(\n      cache,\n      expression,\n      // eslint-disable-next-line no-unused-vars\n      options\n    ) {\n      let exp = expression;\n      let results = cache.getRecordsSync(exp.records || exp.type);\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n\n  findRelatedRecords(\n      cache,\n      expression,\n      options\n    ) {\n      const exp = expression;\n      const { record, relationship } = exp;\n      const relatedIds = cache.getRelatedRecordsSync(record, relationship);\n      if (!relatedIds || relatedIds.length === 0) {\n        if (!cache.getRecordSync(record)) {\n          if (options?.raiseNotFoundExceptions) {\n            throw new RecordNotFoundException(record.type, record.id);\n          } else {\n            return undefined;\n          }\n        }\n\n        return [];\n      }\n      let results = cache.getRecordsSync(relatedIds);\n\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n}\n\nfunction filterRecords(records, filters) {\n  return records.filter((record) => {\n    for (let i = 0, l = filters.length; i < l; i++) {\n      if (!applyFilter(record, filters[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction applyFilter(record, filter) {\n\n  if (filter.kind === 'attribute') {\n    let attributeKey = filter.attribute.split('.');\n\n    let actual = deepGet(record, ['attributes', ...attributeKey]);\n\n    let expected = filter.value;\n\n    // https://api.drupal.org/api/drupal/core%21modules%21jsonapi%21src%21Query%21EntityCondition.php/property/EntityCondition%3A%3AallowedOperators/9.4.x\n    switch (filter.op) {\n      case 'equal':\n      case '=':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() === expected.toLowerCase();\n        }\n        return actual === expected;\n      case '<>':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() !== expected.toLowerCase();\n        }\n        return actual !== expected;\n      case '>':\n        return actual > expected;\n      case '>=':\n        return actual >= expected;\n      case '<':\n        return actual < expected;\n      case '<=':\n        return actual <= expected;\n      case 'STARTS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().startsWith(expected.toLowerCase());\n      case 'CONTAINS':\n        return typeof actual === 'string' && actual.toLowerCase().includes(expected.toLowerCase());\n      case 'ENDS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().endsWith(expected.toLowerCase());\n      case 'IN':\n      case 'NOT IN':\n      case 'BETWEEN':\n      case 'NOT BETWEEN':\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} is not yet implemented for Store.`);\n      case 'IS NULL':\n        return actual === undefined || actual === null;\n      case 'IS NOT NULL':\n        return actual !== undefined && actual !== null;\n      default:\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} not recognized for Store.`);\n    }\n  }\n  return SyncQueryOperators.applyFilter(record, filter);\n}\n\nfunction sortRecords(\n    records,\n    sortSpecifiers\n  ) {\n  const comparisonValues = new Map();\n\n  records.forEach((record) => {\n    comparisonValues.set(\n      record,\n      sortSpecifiers.map((sortSpecifier) => {\n        if (sortSpecifier.kind === 'attribute') {\n          let attributeKey = sortSpecifier.attribute.split('.');\n\n          return deepGet(record, [\n            'attributes',\n            ...attributeKey,\n          ]);\n        } else {\n          throw new QueryExpressionParseError(\n            'Sort specifier ${sortSpecifier.kind} not recognized for Store.'\n          );\n        }\n      })\n    );\n  });\n\n  const comparisonOrders = sortSpecifiers.map((sortExpression) =>\n    sortExpression.order === 'descending' ? -1 : 1\n  );\n\n  return records.sort((record1, record2) => {\n    const values1 = comparisonValues.get(record1);\n    const values2 = comparisonValues.get(record2);\n    for (let i = 0; i < sortSpecifiers.length; i++) {\n      if (values1[i] < values2[i]) {\n        return -comparisonOrders[i];\n      } else if (values1[i] > values2[i]) {\n        return comparisonOrders[i];\n      } else if (isNone(values1[i]) && !isNone(values2[i])) {\n        return comparisonOrders[i];\n      } else if (isNone(values2[i]) && !isNone(values1[i])) {\n        return -comparisonOrders[i];\n      }\n    }\n    return 0;\n  });\n}\n\nfunction paginateRecords(\n  records,\n  paginationOptions\n) {\n  if (paginationOptions.limit !== undefined) {\n    let offset =\n      paginationOptions.offset === undefined ? 0 : paginationOptions.offset;\n    let limit = paginationOptions.limit;\n\n    return records.slice(offset, offset + limit);\n  } else {\n    throw new QueryExpressionParseError(\n      'Pagination options not recognized for Store. Please specify `offset` and `limit`.'\n    );\n  }\n}\n","import Vue from 'vue';\nimport {\n  VBtn,\n  VDialog,\n  VListItem,\n  VListItemTitle,\n} from 'vuetify/lib'\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class AssetLinkUI {\n\n  constructor(app) {\n    this._app = app;\n  }\n\n  /**\n   * Provide some basic components to support Asset Link plugins defined as single (uncompiled) JS\n   * files.\n   * \n   * Commonly accessed via `assetLink.ui.c` e.g. `h(assetLink.ui.c.VBtn, { props: ...`\n   */\n  get c() {\n    return {\n      VBtn,\n      VListItem,\n      VListItemTitle,\n    };\n  }\n\n  /**\n   * \n   */\n  get dialog() {\n    return {\n      confirm: async (text) => {\n        return await this._app.$dialog.confirm({\n          text,\n          title: 'Confirmation'\n        });\n      },\n      promptText: async (text) => {\n        return await this._app.$dialog.prompt({\n          text,\n          title: 'Input',\n        });\n      },\n      custom: async (component, params) => {\n        const id = uuidv4();\n\n        const context = new Vue({});\n\n        const result = await new Promise(resolve => {\n          context.$on('submit', resolve);\n\n          this.app.dialogs.push({\n            id,\n            context,\n            componentFn: (wrapper, h) =>\n              h(VDialog, {\n                props: { value: true, fullscreen: true },\n                on: {\n                  input: () => resolve(undefined),\n                },\n              },  [h(component, {ref: 'dialogComponent', ...params})] ),\n          });\n        });\n\n        this.app.dialogs = this._app.dialogs.filter(d => d.id !== id);\n\n        return result;\n      },\n    };\n  }\n\n}\n","import { formatRFC3339 } from 'date-fns'\nimport createDrupalUrl from '@/createDrupalUrl';\nimport geohash from 'ngeohash';\nimport haversine from 'haversine-distance';\n\nexport default class AssetLinkUtil {\n\n  /**\n   * Format a date object as an RFC 3339 date string. e.g. '2019-09-18T19:00:52Z'\n   */\n  get formatRFC3339() {\n    return formatRFC3339;\n  }\n\n  /**\n   * Create a URL relative to the Drupal installation base path given the URL path suffix.\n   */\n  get createDrupalUrl() {\n    return createDrupalUrl;\n  }\n\n  /**\n   * The node-geohash module: https://github.com/sunng87/node-geohash\n   */\n  get geohash() {\n    return geohash;\n  }\n\n  /**\n   * A haversine distance function: https://github.com/dcousens/haversine-distance\n   */\n  get haversine() {\n    return haversine;\n  }\n\n}\n","import Vue from 'vue';\nimport fetch from 'cross-fetch';\nimport throttle from '@jcoreio/async-throttle'\nimport createDrupalUrl from '@/createDrupalUrl';\n\n/**\n * Responsible for detecting online/offline/login status\n * for our connection to the farmOS server both through\n * self-initiated polling and by observing the outcome of\n * decorated fetch requests.\n * \n * @implements {IHttpFetcher}\n */\nconst FarmOSConnectionStatusDetector = Vue.extend({\n\n  props: {\n    fetcherDelegate: {\n      type: Object,\n      default: function () {\n        return { fetch: fetch };\n      }\n    }\n  },\n\n  data() {\n    return {\n      $_running: false,\n      $_barrier: new Barrier(),\n\n      hasNetworkConnection: window.navigator.onLine,\n      canReachFarmOS: undefined,\n      isLoggedIn: undefined,\n    };\n  },\n\n  created() {\n    window.addEventListener('offline', () => {\n      this.hasNetworkConnection = false;\n      this.canReachFarmOS = false;\n    });\n    window.addEventListener('online', () => {\n      this.hasNetworkConnection = true;\n      this.$data.$_barrier.release();\n    });\n    if (window.navigator && window.navigator.connection) {\n      window.navigator.connection.addEventListener('change', () => this.$data.$_barrier.release());\n    }\n    this.$_mainLoop();\n  },\n\n  computed: {\n    isOnline() {\n      return this.canReachFarmOS && this.isLoggedIn;\n    },\n  },\n\n  beforeDestroy() {\n    this.$data.$_running = false;\n    this.$data.$_barrier.release();\n  },\n\n  methods: {\n\n    /**\n     * Decorate fetch requests to detect connection/authentication problems with\n     * requests that are already being sent.\n     */\n    async fetch(url, opts) {\n      const options = opts || {};\n\n      if (!options.method) options.method = 'GET';\n\n      const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n      const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n\n      try {\n        const res = await this.fetcherDelegate.fetch(url, options);\n        if (isFarmOSRequest && res.status === 403) {\n          this.$data.$_barrier.release();\n        }\n        return res;\n      } catch (error) {\n        if (isFarmOSRequest) {\n          this.$data.$_barrier.release();\n        }\n        throw error;\n      }\n    },\n\n    async $_mainLoop() {\n      this.$data.$_running = true;\n\n      const checkConnectionStatus = throttle(() => this.$_checkConnectionStatus(), 1000);\n\n      while (this.$data.$_running) {\n        console.log('$_mainLoop iteration');\n        await checkConnectionStatus();\n        await this.$data.$_barrier.arrive(60 * 1000);\n      }\n    },\n\n    async $_checkConnectionStatus() {\n\n      console.log('$_checkConnectionStatus invocation');\n\n      if (!this.hasNetworkConnection) {\n        return;\n      }\n\n      const apiUrl = createDrupalUrl(`api?cacheBust=${currentEpochSecond()}`);\n\n      try {\n        const res = await fetch(apiUrl, {credentials: 'same-origin', cache: 'no-cache'});\n\n        if (res.status !== 200) {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        const apiData = await res.json();\n\n        const farmOsVersion = apiData.meta?.farm?.version;\n\n        if (farmOsVersion !== '2.x') {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        this.canReachFarmOS = true;\n\n        const userRef = apiData.meta?.links?.me?.href;\n\n        console.log('apiData', apiData);\n\n        this.isLoggedIn = userRef !== undefined\n      } catch (error) {\n        this.canReachFarmOS = false;\n      }\n    },\n  },\n\n});\n\nfunction sleep(millis) {\n  return new Promise(resolve => setTimeout(resolve, millis));\n}\n\nfunction currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n\nclass Barrier {\n  constructor() {\n    this.waiting = [];\n  }\n\n  arrive(timeoutMillis) {\n    return Promise.race([\n      sleep(timeoutMillis),\n      new Promise(resolve => this.waiting.push(resolve)),\n    ]);\n  }\n\n  release() {\n    const toBeReleased = this.waiting.splice(0);\n    toBeReleased.forEach(p => p());\n  }\n}\n\nexport default FarmOSConnectionStatusDetector;\n","export default class PeekableAsyncIterator {\n  constructor(delegate) {\n    this._delegate = delegate;\n    this._next_iteration_result = undefined;\n  }\n\n  async next() {\n    if (this._next_iteration_result !== undefined) {\n      const next = this._next_iteration_result;\n      this._next_iteration_result = undefined;\n      return next;\n    }\n    return await this._delegate.next();\n  }\n\n  async peek() {\n    if (this._next_iteration_result === undefined) {\n      this._next_iteration_result = await this._delegate.next();\n    }\n    return this._next_iteration_result;\n  }\n\n}\n","export default function currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n","/**\n * A simple async event bus.\n */\nexport default class EventBus {\n\n  constructor() {\n    this._handlersByEventName = {};\n  }\n\n  $on(eventName, handler) {\n    if (!Object.hasOwn(this._handlersByEventName, eventName)) {\n      this._handlersByEventName[eventName] = [];\n    }\n\n    this._handlersByEventName[eventName].push(handler);\n  }\n\n  async $emit(eventName, arg) {\n    const handlers = this._handlersByEventName[eventName] || [];\n\n    const promises = handlers.map(h => h(arg));\n\n    return Promise.all(promises).then(() => true);\n  }\n\n}\n","export default class HttpAccessDeniedException extends Error {\n  constructor(message, options) {\n    super(message, options);\n  }\n}\n","import Vue from 'vue';\n\nimport createDrupalUrl from '@/createDrupalUrl';\nimport currentEpochSecond from '@/util/currentEpochSecond';\nimport EventBus from '@/util/EventBus';\nimport HttpAccessDeniedException from '@/HttpAccessDeniedException';\n\nexport default class AssetLinkPluginListsCore {\n\n  constructor(assetLink) {\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        lists: [],\n      },\n    });\n\n    this._eventBus = new EventBus();\n\n    this._pluginReferenceTracker = new PluginReferenceTracker(this._eventBus);\n\n    this._defaultPluginList = new HttpPluginList(\n        assetLink._store, \n        createDrupalUrl('/alink/backend/default-plugins.repo.json'),\n        this._pluginReferenceTracker,\n        true,\n    );\n    this._localPluginList = new LocalPluginList(\n        assetLink._store,\n        this._pluginReferenceTracker,\n    );\n    this._extraPluginLists = [];\n\n    this._extraPluginListStoreKey = 'asset-link-extra-plugin-lists';\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  /**\n   * An async event bus used to signal when plugins are added/removed.\n   */\n  get eventBus() {\n    return this._eventBus;\n  }\n\n  async boot() {\n    const extraPluginListUrls = await this._getExtraPluginListUrls();\n\n    this._extraPluginLists = extraPluginListUrls.map(pluginListUrl =>\n      new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false));\n\n    for (let pluginList of [\n          this._defaultPluginList,\n          this._localPluginList,\n          ...this._extraPluginLists,\n        ]) {\n\n      const pluginListView = await pluginList.load();\n\n      this._updatePluginListViewInViewModel(pluginListView);\n    }\n  }\n\n  async addPluginToLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.addPlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removePluginFromLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.removePlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async addExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx >= 0) {\n        return false;\n      }\n      extraPluginListUrls.push(pluginListUrl);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex >= 0) {\n      return;\n    }\n\n    const pluginList = new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false);\n\n    this._extraPluginLists.push(pluginList);\n\n    const pluginListView = await pluginList.load();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removeExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx < 0) {\n        return false;\n      }\n      extraPluginListUrls.splice(idx, 1);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex < 0) {\n      return;\n    }\n\n    const pluginList = this._extraPluginLists.splice(pluginListIndex, 1)[0];\n\n    await pluginList.unload();\n\n    this._removePluginListViewFromViewModel(pluginListUrl);\n  }\n\n  async reloadPluginList(pluginListUrl) {\n    const pluginList = [\n      this._defaultPluginList,\n      this._localPluginList,\n      ...this._extraPluginLists,\n    ].find(pl => pl._url === pluginListUrl);\n\n    if (!pluginList) {\n      return;\n    }\n\n    const pluginListView = await pluginList.reload();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async _getExtraPluginListUrls() {\n    const pluginListUrlsItem = await this._store.getItem(this._extraPluginListStoreKey);\n\n    if (pluginListUrlsItem) {\n      return pluginListUrlsItem.value.map(u => new URL(u));\n    }\n\n    return [];\n  }\n\n  async _modifyAndWriteStoredExtraPluginListUrls(mutatorFn) {\n    const pluginListUrls = await this._getExtraPluginListUrls();\n    const shouldWrite = mutatorFn(pluginListUrls) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._extraPluginListStoreKey, {key: this._extraPluginListStoreKey, timestamp: currentEpochSecond(), value: pluginListUrls});\n    }\n    return pluginListUrls;\n  }\n\n  _updatePluginListViewInViewModel(pluginListView) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListView.sourceUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1, pluginListView);\n    } else {\n      vm.lists.push(pluginListView);\n    }\n  }\n\n  _removePluginListViewFromViewModel(pluginListUrl) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1);\n    }\n  }\n\n}\n\nclass PluginReferenceTracker {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    // Track which lists reference a given plugin by keeping\n    // a mapping between the plugin url and the list urls which\n    // reference it.\n    this._pluginReferences = {\n        // 'https://example.com/alink-plugins/MyAwesomePlugin.alink.js': [ 'https://example.com/cool-alink-plugins.repo.json' ],\n    };\n  }\n\n  /* eslint-disable no-console */\n  async ackPluginReference(pluginUrl, listUrl) {\n    console.log('ackPluginReference', pluginUrl.toString(), listUrl.toString());\n\n    const pluginExists = Object.hasOwn(this._pluginReferences, pluginUrl.toString());\n\n    if (!pluginExists) {\n      this._pluginReferences[pluginUrl.toString()] = [];\n    }\n\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx < 0) {\n      pluginReferences.push(listUrl);\n    }\n\n    if (!pluginExists) {\n      await this._eventBus.$emit('add-plugin', pluginUrl);\n    }\n  }\n\n  /* eslint-disable no-console */\n  async freePluginReference(pluginUrl, listUrl) {\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    if (!pluginReferences) {\n      console.log('freePluginReference unexpectedly found plugin missing from internal reference tracking', pluginUrl.toString(), listUrl.toString(), JSON.stringify(this._pluginReferences));\n      return;\n    }\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx >= 0) {\n      pluginReferences.splice(listIdx, 1);\n    } else {\n      console.log('freePluginReference unexpectedly found plugin without expected reference', pluginUrl.toString(), listUrl.toString(), JSON.stringify(pluginReferences));\n    }\n\n    if (pluginReferences.length > 0) {\n      return;\n    }\n\n    await this._eventBus.$emit('remove-plugin', pluginUrl);\n  }\n}\n\nclass HttpPluginList {\n  constructor(store, url, pluginReferenceTracker, isDefault) {\n    this._store = store;\n    this._storeKey = `asset-link-cached-plugin-list:${url}`;\n    this._url = url;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n    this._isDefault = isDefault;\n\n    this._latestPluginListView = undefined;\n  }\n\n  async load(skipCache) {\n    this._latestPluginListView = postProcessPluginList(await this._getHttpPluginList(skipCache), false, this._url);\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return this._latestPluginListView;\n  }\n\n  async unload() {\n    if (!this._latestPluginListView) {\n      return;\n    }\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.freePluginReference(pRef.url, this._url)));\n\n    await this._store.removeItem(this._storeKey);\n  }\n\n  async reload() {\n    return await this.load(true);\n  }\n\n  async _getHttpPluginList(skipCache) {\n    const cacheItem = skipCache ? undefined : await this._store.getItem(this._storeKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginListRes = await fetch(this._url);\n\n    console.log(pluginListRes);\n    if (pluginListRes.status === 403) {\n      throw new HttpAccessDeniedException(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    } else if (!pluginListRes.ok) {\n      throw new Error(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    }\n\n    const pluginList = await pluginListRes.json();\n\n    await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp, value: pluginList});\n\n    return pluginList;\n  }\n\n}\n\nclass LocalPluginList {\n  constructor(store, pluginReferenceTracker) {\n    this._store = store;\n    this._storeKey = 'local-plugin-list.repo.json';\n    this._url = new URL(\"indexeddb://asset-link/data/local-plugin-list.repo.json\", window.location.origin);\n    this._pluginReferenceTracker = pluginReferenceTracker;\n  }\n\n  async load() {\n    const pluginListView = postProcessPluginList(await this._getLocalPluginList(), false, this._url);\n\n    await Promise.all(pluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return pluginListView;\n  }\n\n  async reload() {\n    return await this.load();\n  }\n\n  async addPlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      if (pl.plugins.find(pRef => pRef.url === pluginUrl.toString())) {\n        return false;\n      }\n      pl.plugins.push({ url: pluginUrl.toString() });\n    });\n\n    await this._pluginReferenceTracker.ackPluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async removePlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      const pluginIndex = pl.plugins.findIndex(pRef => pRef.url === pluginUrl.toString())\n\n      if (pluginIndex < 0) {\n        return false;\n      }\n\n      pl.plugins.splice(pluginIndex, 1);\n    });\n\n    await this._pluginReferenceTracker.freePluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async _getLocalPluginList() {\n    const pluginListItem = await this._store.getItem(this._storeKey);\n\n    if (!pluginListItem) {\n      return { plugins: [] };\n    }\n\n    return pluginListItem.value;\n  }\n\n  async _modifyAndWriteStoredList(mutatorFn) {\n    const pluginList = await this._getLocalPluginList();\n    const shouldWrite = mutatorFn(pluginList) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp: currentEpochSecond(), value: pluginList});\n    }\n    return pluginList;\n  }\n}\n\nconst postProcessPluginList = (pluginList, isDefault, sourceUrl) => {\n  pluginList.isDefault = isDefault;\n  pluginList.sourceUrl = sourceUrl;\n\n  if (!pluginList.error) {\n    pluginList.error = undefined;\n  }\n\n  if (!pluginList.plugins) {\n    pluginList.plugins = [];\n  }\n\n  pluginList.plugins = pluginList.plugins.map(pluginRef => {\n    // Resolve relative paths on this server, but still allow for\n    // arbitrary absolute/third-party urls\n    const pluginUrl = new URL(pluginRef.url, window.location.origin);\n\n    return {\n      url: pluginUrl,\n    };\n  });\n\n  return pluginList;\n};\n","import Vue from 'vue';\n\nimport { loadModule } from 'vue3-sfc-loader/dist/vue2-sfc-loader.js';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nexport default class AssetLinkPluginLoaderCore {\n\n  constructor(assetLink) {\n    this._assetLink = assetLink;\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        plugins: [],\n      },\n    });\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  async boot() {\n    // TODO: ?\n  }\n\n  async loadPlugin(pluginUrl) {\n    const startTime = performance.now();\n\n    let pluginInstance = undefined;\n\n    try {\n      let pluginDataUrl = await this._fetchPlugin(pluginUrl);\n\n      if (pluginUrl.pathname.endsWith('alink.js')) {\n        const pluginCls = (await import(/* webpackIgnore: true */ pluginDataUrl)).default;\n        pluginInstance = new pluginCls();\n      } else if (pluginUrl.pathname.endsWith('alink.vue')) {\n        const pluginUrlWithoutParams = new URL(pluginUrl.toString());\n        pluginUrlWithoutParams.search = '';\n\n        const vuetify = await import('vuetify/lib');\n\n        const vuetifyComponents = {};\n        const vuetifyDirectives = {};\n\n        Object.entries(vuetify).forEach(([entryName, entry]) => {\n          if (Object.prototype.hasOwnProperty.call(entry, 'component')) {\n            vuetifyComponents[entryName] = entry;\n          } else if (['bind', 'inserted', 'update', 'componentUpdated', 'unbind'].find(directiveHook => Object.prototype.hasOwnProperty.call(entry, directiveHook))) {\n            vuetifyDirectives[entryName] = entry;\n          }\n        });\n\n        let rawPluginFileData = await fetch(pluginDataUrl).then(r => r.text());\n\n        // Roughly based on https://harlanzw.com/blog/vue-automatic-component-imports/\n        // and https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/loader.js#L110-L144\n        const compiler = await import('vue-template-compiler');\n\n        const tags = new Set()\n        const attrs = new Set()\n        const component = compiler.parseComponent(rawPluginFileData)\n        if (component.template) {\n          if (component.template.src) {\n            throw new Error(`External component template content is not supported.`);\n          }\n          compiler.compile(component.template.content, {\n            modules: [{\n              postTransformNode: node => {\n                if (\"directives\" in node) {\n                  node.directives.forEach(({ name }) => attrs.add(name))\n                }\n                tags.add(node.tag)\n              }\n            }]\n          });\n        }\n\n        /* eslint-disable no-unused-vars */\n        const usedVuetifyTags = Array.from(tags).map(item => [hyphenate(item), capitalize(camelize(item))])\n          .filter(([kebabTag, camelTag]) => kebabTag.startsWith('v-') && Object.prototype.hasOwnProperty.call(vuetifyComponents, camelTag))\n          .map(([kebabTag, camelTag]) => [camelTag, vuetifyComponents[camelTag]]);\n\n        const usedVuetifyDirectives = Array.from(attrs).map(item => capitalize(camelize(item)))\n          .filter(camelAttr => Object.prototype.hasOwnProperty.call(vuetifyDirectives, camelAttr))\n          .map(camelAttr => [camelAttr, vuetifyDirectives[camelAttr]]);\n\n        const options = {\n          moduleCache: {\n            vue: Vue,\n            'vuetify/lib': vuetify,\n\n            // TODO: Figure out how to make loading these cleaner/on-demand\n            'vue-codemirror': await import('vue-codemirror'),\n            'codemirror/mode/javascript/javascript.js': await import('codemirror/mode/javascript/javascript.js'),\n            'codemirror/mode/vue/vue.js': await import('codemirror/mode/vue/vue.js'),\n            'codemirror/lib/codemirror.css': await import('codemirror/lib/codemirror.css'),\n            'codemirror/theme/base16-dark.css': await import('codemirror/theme/base16-dark.css'),\n          },\n          async getFile(url) {\n            if ( url === pluginUrlWithoutParams ) {\n              return rawPluginFileData;\n            } else {\n              throw new Error(`Secondary imports are not supported. url=${url}`);\n            }\n          },\n          addStyle() { /* TODO */ },\n        };\n\n        pluginInstance = await loadModule(pluginUrlWithoutParams, options);\n\n        if (usedVuetifyTags.length && !pluginInstance.components) pluginInstance.components = {};\n        usedVuetifyTags.filter(t => !pluginInstance.components[t[0]]).forEach(t => pluginInstance.components[t[0]] = t[1]);\n\n        if (usedVuetifyDirectives.length && !pluginInstance.directives) pluginInstance.directives = {};\n        usedVuetifyDirectives.filter(t => !pluginInstance.directives[t[0]]).forEach(t => pluginInstance.directives[t[0]] = t[1]);\n\n        Vue.component(pluginInstance.name, pluginInstance);\n      } else {\n        throw new Error(`Cannot load plugin ${pluginUrl} with unsupported type. Path of url must end in '.alink.js' or '.alink.vue'`);\n      }\n\n      pluginInstance.pluginUrl = pluginUrl;\n\n      this.registerPlugin(pluginInstance);\n    } catch (error) {\n      console.log(error);\n      pluginInstance = {};\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.error = error;\n      this.registerPlugin(pluginInstance);\n    } finally {\n      const endTime = performance.now();\n      console.log(`Loading plugin ${pluginUrl} took ${endTime - startTime} milliseconds`);\n    }\n  }\n\n  /**\n   * Directly register a plugin with Asset Link. Note that plugins registered this way\n   * will not persist between sessions/reloads.\n   */\n  registerPlugin(plugin) {\n    plugin.definedRoutes = {};\n    plugin.definedActions = {};\n    plugin.definedMetaActions = {};\n    plugin.definedConfigActions = {};\n\n    this.vm.plugins.push(plugin);\n\n    if (typeof plugin.onLoad === 'function') {\n      const handle = new AssetLinkPluginHandle(plugin, this.vm);\n\n      plugin.onLoad(handle, this._assetLink);\n    }\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async unloadPlugin(pluginUrl) {\n    // TODO: implement\n  }\n\n  async _fetchPlugin(url) {\n    const skipCache = url.searchParams && url.searchParams.get('skipCache');\n\n    const cacheKey = `asset-link-cached-plugin-src:${url}`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (!skipCache && cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginSrc = await fetch(url).then(r => r.text());\n\n    const pluginDataUrl = \"data:application/javascript;base64,\" + btoa(pluginSrc);\n\n    if (!skipCache) {\n      await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: pluginDataUrl});\n    }\n\n    return pluginDataUrl;\n  }\n\n}\n\nclass AssetLinkPluginHandle {\n\n  constructor(pluginInstance, vm) {\n    this._pluginInstance = pluginInstance;\n    this._vm = vm;\n  }\n\n  defineRoute(routeName, routeDefiner) {\n    const routeDef = {name: routeName};\n\n    const routeHandle = {\n        path(path) {\n          routeDef.path = path;\n        },\n        componentFn(componentFn) {\n          routeDef.componentFn = componentFn;\n        },\n    };\n\n    routeDefiner(routeHandle);\n\n    const missingFields = Object.entries({'path': 'string', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof routeDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Action '${routeName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, routeDef);\n      return;\n    }\n\n    this._pluginInstance.definedRoutes[routeName] = routeDef;\n\n    this._vm.$emit('add-route', routeDef);\n  }\n\n  defineAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n    \n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedActions[actionId] = actionDef;\n  }\n\n  defineMetaAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n\n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedMetaActions[actionId] = actionDef;\n  }\n\n  defineConfigAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n\n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedConfigActions[actionId] = actionDef;\n  }\n\n}\n\n//Copied from https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/util.js#L6-L18\nconst camelizeRE = /-(\\w)/g\nconst camelize = str => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n}\n\nconst capitalize = str => {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst hyphenateRE = /\\B([A-Z])/g\nconst hyphenate = str => {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n","import Vue from 'vue';\n\nimport { Coordinator, RequestStrategy, SyncStrategy } from '@orbit/coordinator';\nimport { Orbit } from '@orbit/core';\nimport { IndexedDBBucket } from '@orbit/indexeddb-bucket';\nimport { IndexedDBSource } from '@orbit/indexeddb';\nimport { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\nimport DrupalJSONAPISource from '@/DrupalJSONAPISource';\nimport DrupalSyncQueryOperators from '@/DrupalSyncQueryOperators';\n\nimport localforage from 'localforage';\n\nimport fetch from 'cross-fetch';\n\nimport AssetLinkUI from '@/AssetLinkUI';\nimport AssetLinkUtil from '@/AssetLinkUtil';\nimport createDrupalUrl from '@/createDrupalUrl';\nimport FarmOSConnectionStatusDetector from '@/FarmOSConnectionStatusDetector';\nimport PeekableAsyncIterator from '@/PeekableAsyncIterator';\nimport AssetLinkPluginListsCore from '@/AssetLinkPluginListsCore';\nimport AssetLinkPluginLoaderCore from '@/AssetLinkPluginLoaderCore';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nconst fetchJson = (url, args) => fetch(url, args).then(response => response.json());\n\n\n\n/**\n * Core of the larger Asset Link application and API entry-point for plugins.\n * \n * TODO: Break out some of the responsibilities of this class into classes that can be\n * delegated to. e.g. plugin management, entities CRUD, etc.\n */\nexport default class AssetLink {\n\n  constructor(app) {\n    this._app = app;\n    this._viewModel = new Vue({\n      data: {\n        booted: false,\n        bootProgress: 0,\n        bootText: \"Starting\",\n\n        connectionStatus: new FarmOSConnectionStatusDetector(),\n\n        pendingUpdates: [],\n\n        messages: [],\n      },\n    });\n\n    this._booted = new Promise((resolve) => {\n      this._viewModel.$once('booted', () => {\n        this._viewModel.booted = true;\n        resolve(true);\n      });\n    });\n\n    this._store = localforage.createInstance({\n      name: 'asset-link',\n      storeName: 'data',\n    });\n\n    this._cores = {};\n    this._cores.pluginLists = new AssetLinkPluginListsCore(this);\n    this._cores.pluginLoader = new AssetLinkPluginLoaderCore(this);\n\n    this._memory = undefined;\n    this._remote = undefined;\n\n    this._ui = new AssetLinkUI(app);\n    this._util = new AssetLinkUtil();\n  }\n\n  /**\n   * The top-level {Vue} app component.\n   */\n  get app() {\n    return this._app;\n  }\n\n  /**\n   * A {Vue} instance used to expose some of Asset Link's state to\n   * its UI in a reactive way.\n   */\n  get viewModel() {\n    return this._viewModel;\n  }\n\n  /**\n   * UI components/methods exposed for Asset Link plugins.\n   */\n  get ui() {\n    return this._ui;\n  }\n\n  /**\n   * Utility methods exposed for Asset Link plugins.\n   */\n  get util() {\n    return this._util;\n  }\n\n  /**\n   * The map of AssetLink cores.\n   */\n  get cores() {\n    return this._cores;\n  }\n\n  /**\n   * The Orbit.js {MemorySource} which is used to access/modify farmOS assets/logs/etc.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get entitySource() {\n    return this._memory;\n  }\n\n  /**\n   * The Orbit.js {JSONAPISource} which is used to directly access/modify\n   * farmOS assets/logs/etc - unless you know what you are doing, use {#entitySource}\n   * instead.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get remoteEntitySource() {\n    return this._remote;\n  }\n\n  /**\n   * The currently loaded plugins.\n   */\n  get plugins() {\n    return this._cores.pluginLoader.vm.plugins;\n  }\n\n  /**\n   * A {Promise} that is fulfilled once Asset Link has booted.\n   */\n  get booted() {\n    return this._booted;\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async boot() {\n    this.viewModel.bootText = \"Initializing storage\";\n\n    await this._store.ready();\n\n    this._cores.pluginLists.eventBus.$on('add-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.loadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLists.eventBus.$on('remove-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.unloadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLoader.vm.$on('add-route', routeDef => {\n      if (typeof this.app.addRoute === 'function') {\n        this.app.addRoute(routeDef);\n      }\n    });\n\n    this._cores.pluginLoader.vm.$on('remove-route', routeDef => {\n      if (typeof this.app.removeRoute === 'function') {\n        this.app.removeRoute(routeDef);\n      }\n    });\n\n    await this._cores.pluginLoader.boot();\n    await this._cores.pluginLists.boot();\n\n    this.viewModel.bootText = \"Loading models...\";\n    this._models = await this._loadModels();\n\n    Orbit.fetch = this._csrfAwareFetch.bind(this);\n\n    this._schema = new RecordSchema({ models: this._models });\n\n    const bucket = new IndexedDBBucket({ namespace: 'asset-link-orbitjs-bucket' });\n\n    this._memory = new MemorySource({\n      schema: this._schema,\n      cacheSettings: {\n        queryOperators: DrupalSyncQueryOperators,\n      },\n    });\n\n    this._remote = new DrupalJSONAPISource({\n      schema: this._schema,\n      name: 'remote',\n      host: createDrupalUrl('/api'),\n      defaultFetchSettings: {\n        timeout: 10000,\n      },\n      bucket,\n      requestQueueSettings: {\n        autoProcess: this.viewModel.connectionStatus.isOnline || false,\n      },\n    });\n\n    const updateViewModelPendingUpdates = () => {\n      this.viewModel.pendingUpdates = this._remote.requestQueue.entries.filter(r => r.type === 'update');\n    };\n\n    this._remote.requestQueue.reified.then(updateViewModelPendingUpdates);\n    this._remote.requestQueue.on('change', updateViewModelPendingUpdates);\n\n    this._backup = new IndexedDBSource({\n      schema: this._schema,\n      name: 'backup',\n      namespace: 'asset-link-orbitjs-entities',\n      defaultTransformOptions: {\n        useBuffer: true,\n      },\n    });\n\n    this._coordinator = new Coordinator({\n      sources: [this._memory, this._remote, this._backup]\n    });\n\n    // Query the remote server when the memory source is queried (and online)\n    this._remoteQueryStrategy = new RequestStrategy({\n      name: 'remoteRequestStrategy',\n\n      source: 'memory',\n      on: 'beforeQuery',\n\n      target: 'remote',\n      action: 'query',\n\n      blocking: true\n    });\n    // Only use the remote query strategy when online\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._coordinator.addStrategy(this._remoteQueryStrategy);\n    }\n\n    // Update the remote server whenever the memory source is updated\n    this._coordinator.addStrategy(\n      new RequestStrategy({\n        source: 'memory',\n        on: 'beforeUpdate',\n\n        target: 'remote',\n        action: 'update',\n\n        blocking: false\n      })\n    );\n\n    // Sync all changes received from the remote server to the memory source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'remote',\n        target: 'memory',\n        blocking: false\n      })\n    );\n\n    // Sync all changes to the backup source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'memory',\n        target: 'backup',\n        blocking: true\n      })\n    );\n\n    // Restore the backup source\n    const allRecordsFromBackup = await this._backup.query((q) => q.findRecords());\n    await this._memory.sync((t) => allRecordsFromBackup.map((r) => t.addRecord(r)));\n\n    await this._coordinator.activate();\n\n    this.viewModel.bootProgress = 100;\n\n    this._memory.on('update', update => {\n      console.log('_memory::update', update);\n\n      if (update.operations.op === 'updateRecord' && update.operations.record.type.startsWith('asset--')) {\n        this.viewModel.$emit('changed:asset', update.operations.record.type, update.operations.record.id);\n      }\n\n    });\n\n    this.viewModel.connectionStatus.$watch('isOnline', async (isOnline) => {\n      this._remote.requestQueue.autoProcess = isOnline;\n      if (isOnline && !this._remote.requestQueue.empty) {\n        this._remote.requestQueue.process();\n      }\n\n      await this._coordinator.deactivate();\n      if (isOnline) {\n        if (!this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.addStrategy(this._remoteQueryStrategy);\n        }\n      } else {\n        if (this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.removeStrategy(this._remoteQueryStrategy.name);\n        }\n      }\n      await this._coordinator.activate();\n    });\n\n    this.viewModel.$emit('booted');\n\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._precache();\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets the model for an entity type given that the type name. e.g. \"asset--plant\"\n   */\n  async getEntityModel(typeName) {\n    await this._booted;\n\n    return this._models[typeName];\n  }\n\n  async _precache() {\n    // Precache the current page's asset\n    const matches = window.location.href.match(/https?:\\/\\/.*\\/asset\\/(\\d+)/);\n    if (matches && matches.length >= 2) {\n      const thisAsset = await this.resolveAsset(matches[1]);\n      console.log(\"thisAsset=\", thisAsset);\n    }\n\n    const timestamp = currentEpochSecond();\n\n    const lastPrecacheTimeKey = `asset-link-last-precache-time`;\n\n    const lastPrecacheTime = await this._store.getItem(lastPrecacheTimeKey);\n\n    if (lastPrecacheTime && (timestamp - lastPrecacheTime) < 900) {\n      console.log(\"Skipping Asset Link precaching because it was done recently...\");\n      return;\n    }\n\n    // Precache recently changed assets\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    await this._memory.query((q) => assetTypes.map(assetType => q.findRecords(`asset--${assetType}`)\n        .sort('-changed')\n        .page({ offset: 0, limit: 100 })));\n\n    // TODO: Consider also precaching recently changed and recent/upcoming logs\n\n    await this._store.setItem(lastPrecacheTimeKey, timestamp);\n  }\n\n  /**\n   * Get a list of the asset_type entities.\n   */\n  async getAssetTypes() {\n    const listAssetTypes = async (source) => {\n      return await source.query((q) => q\n          .findRecords(`asset_type--asset_type`)\n          .sort('drupal_internal__id'));\n    };\n\n    const assetTypes = await listAssetTypes(this._memory.cache);\n\n    if (assetTypes.length) {\n      return assetTypes;\n    }\n\n    return await listAssetTypes(this._memory);\n  }\n\n  /**\n   * Get an asset by UUID or Drupal internal id.\n   */\n  async resolveAsset(assetRef) {\n    await this._booted;\n\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    const isRefNumeric = /^-?\\d+$/.test(assetRef);\n\n    let filter = { attribute: 'id', value: assetRef };\n    if (isRefNumeric) {\n      filter = { attribute: 'drupal_internal__id', value: parseInt(assetRef) };\n    }\n\n    const findAsset = async (source) => {\n      const results = await source.query(q => assetTypes.map(assetType => q\n          .findRecords(`asset--${assetType}`)\n          .filter(filter)\n          .sort('drupal_internal__id')));\n\n      const assets = results.flatMap(l => l);\n\n      return assets.find(a => a);\n    };\n\n    const asset = await findAsset(this._memory.cache);\n\n    if (asset) {\n      return asset;\n    }\n\n    return await findAsset(this._memory);\n  }\n\n  /**\n   * Central asset searching entry-point. Responsible for delegating to asset searching plugins.\n   */\n  searchAssets(searchRequest, searchPhase) {\n    console.log(\"searchAssets:\", JSON.stringify(searchRequest), searchPhase);\n\n    const assetSearchPlugins = this.plugins.filter(p => typeof p.searchAssets === 'function');\n\n    const searchResultCursors = [];\n\n    for (let i = 0; i < assetSearchPlugins.length; i += 1) {\n      const plugin = assetSearchPlugins[i];\n\n      /* eslint-disable no-await-in-loop */\n      const searchResultCursor = plugin.searchAssets(this, searchRequest, searchPhase);\n\n      if (searchResultCursor !== undefined) {\n        searchResultCursors.push(searchResultCursor);\n      }\n    }\n\n    async function* coiterateSearchCursors() {\n      console.log(\"coiterateSearchCursors: searchResultCursors =\", searchResultCursors);\n\n      const peekableSearchResultCursors = searchResultCursors.map(c => new PeekableAsyncIterator(c));\n\n      while(peekableSearchResultCursors.length > 0) {\n\n        console.log(\"coiterateSearchCursors: peekableSearchResultCursors.length =\", peekableSearchResultCursors.length, peekableSearchResultCursors);\n\n        let bestNextCursor = undefined;\n        let doneBestNextCursorIndex = undefined;\n        for (let i = 0; i < peekableSearchResultCursors.length; i += 1) {\n          const thisCursor = peekableSearchResultCursors[i];\n\n          const thisCursorNextResult = await thisCursor.peek();\n\n          if (thisCursorNextResult.value === undefined) {\n            continue;\n          }\n\n          if (bestNextCursor === undefined || thisCursorNextResult.value.weight < (await bestNextCursor.peek()).value.weight) {\n            bestNextCursor = thisCursor;\n            doneBestNextCursorIndex = thisCursorNextResult.done ? i : undefined;\n          }\n        }\n\n        if (bestNextCursor === undefined) {\n          return;\n        }\n\n        const bestCursorNextResult = await bestNextCursor.next();\n\n        if (bestCursorNextResult.value) {\n          yield bestCursorNextResult.value;\n        }\n\n        if (doneBestNextCursorIndex !== undefined) {\n          peekableSearchResultCursors.splice(doneBestNextCursorIndex, 1);\n        }\n\n      }\n    }\n\n    return coiterateSearchCursors();\n  }\n\n  getRelevantActions(asset) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedActions))\n        .filter(a => a.predicateFn(asset))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, asset),\n        }));\n\n    return actions;\n  }\n\n  getRelevantMetaActions(asset) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedMetaActions))\n        .filter(a => a.predicateFn(asset))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, asset),\n        }));\n\n    return actions;\n  }\n\n  getRelevantConfigActions(route) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedConfigActions))\n        .filter(a => a.predicateFn(route))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, route),\n        }));\n\n    return actions;\n  }\n\n  async _csrfAwareFetch(url, opts) {\n    const options = opts || {};\n\n    if (!options.method) options.method = 'GET';\n\n    const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n    const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n    const isUnsafeMethod = !['HEAD', 'GET', 'OPTIONS', 'TRACE'].includes(options.method.toUpperCase());\n\n    const addCsrfHeader = isFarmOSRequest && isUnsafeMethod;\n\n    try {\n      if (addCsrfHeader) {\n        const tokenResponse = await this.viewModel.connectionStatus.fetch(createDrupalUrl('/session/token'));\n\n        console.log(\"tokenResponse:\", tokenResponse);\n\n        const token = await tokenResponse.text();\n\n        // TODO: Cache the token\n        if (!options.headers) options.headers = {};\n        options.headers['X-CSRF-Token'] = token;\n      }\n  \n      return await this.viewModel.connectionStatus.fetch(url, options);\n    } catch (error) {\n      console.log(\"Error in _csrfAwareFetch\", typeof error, error);\n      if (error.message === 'Network request failed') {\n        return new Response(null, {\n          status: 503,\n          statusText: 'Service unavailable due to network error',\n        });\n      }\n      throw error;\n    }\n  }\n\n  async _loadModels() {\n    const cacheKey = `asset-link-cached-entity-models`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    if (cacheItem) {\n      // TODO: If cache item is stale, schedule background refresh\n      return cacheItem.value;\n    }\n\n    const models = await this._loadModelsFromServer();\n\n    const timestamp = currentEpochSecond();\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: models});\n\n    return models;\n  }\n\n  async _loadModelsFromServer() {\n    this.viewModel.bootText = \"Loading server schema\";\n    const serverSchema = await fetchJson(createDrupalUrl('/api/schema'));\n\n    const serverRelatedSchemas = serverSchema.allOf.flatMap(schemaRef => schemaRef.links || []);\n\n    const models = {};\n\n    await Promise.all(serverRelatedSchemas.map(async (serverRelatedSchema) => {\n      const relatedSchema = await fetchJson(serverRelatedSchema.targetSchema);\n\n      const relatedItemSchema = await fetchJson(relatedSchema.definitions.data.items.$ref);\n\n      const typeName = relatedItemSchema.definitions.type['const'];\n\n      models[typeName] = {\n        attributes: Object.fromEntries(\n            Object.entries(relatedItemSchema.definitions.attributes.properties)\n              .map(([attrName, attr]) => {\n                // Orbit.js seems to only support 'number', not 'integer' but handles the former well enough\n                if (attr.type === 'integer') {\n                  attr.type = 'number';\n                }\n\n                // https://www.drupal.org/project/jsonapi_schema/issues/3058850\n                if (attrName === 'third_party_settings') {\n                  attr.type = 'object';\n                }\n\n                return [attrName, attr];\n              })\n        ),\n        relationships: relatedItemSchema.definitions?.relationships?.properties || {},\n      };\n\n      this.viewModel.bootProgress = ((Object.keys(models).length / serverRelatedSchemas.length) * 100).toFixed(1);\n    }));\n\n    return models;\n  }\n\n}\n","export default function createDrupalUrl(pathSuffix) {\n  return new URL(pathSuffix, window.location.origin + window.assetLinkDrupalBasePath);\n}","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n"],"names":["DrupalJSONAPIURLBuilder","JSONAPIURLBuilder","constructor","settings","super","buildFilterParam","filterSpecifiers","filters","forEach","filterSpecifier","index","kind","op","attributeFilter","resourceAttribute","this","serializeAttributeAsParam","undefined","attribute","push","value","path","operator","relatedRecordFilter","Array","isArray","record","relation","map","e","id","join","QueryExpressionParseError","Error","relatedRecordsFilter","records","type","serializer","serializerFor","JSONAPISerializers","serialize","DrupalJSONAPISource","JSONAPISource","defaultFetchSettings","Object","assign","headers","Accept","serializerSettingsFor","buildSerializerSettingsFor","sharedSettings","inflectors","drupal","buildInflector","input","replace","settingsByType","serializationOptions","URLBuilderClass","findRecord","SyncQueryOperators","findRelatedRecord","findRecords","cache","expression","options","exp","results","getRecordsSync","filter","filterRecords","sort","sortRecords","page","paginateRecords","findRelatedRecords","relationship","relatedIds","getRelatedRecordsSync","length","getRecordSync","raiseNotFoundExceptions","RecordNotFoundException","i","l","applyFilter","attributeKey","split","actual","deepGet","expected","toLowerCase","startsWith","includes","endsWith","sortSpecifiers","comparisonValues","Map","set","sortSpecifier","comparisonOrders","sortExpression","order","record1","record2","values1","get","values2","isNone","paginationOptions","limit","offset","slice","AssetLinkUI","app","_app","c","VBtn","VListItem","VListItemTitle","dialog","confirm","async","$dialog","text","title","promptText","prompt","custom","component","params","uuidv4","context","Vue","result","Promise","resolve","$on","dialogs","componentFn","wrapper","h","VDialog","props","fullscreen","on","ref","d","AssetLinkUtil","formatRFC3339","createDrupalUrl","geohash","haversine","FarmOSConnectionStatusDetector","fetcherDelegate","default","fetch","data","$_running","$_barrier","Barrier","hasNetworkConnection","window","navigator","onLine","canReachFarmOS","isLoggedIn","created","addEventListener","$data","release","connection","$_mainLoop","computed","isOnline","beforeDestroy","methods","url","opts","method","requestUrl","URL","location","origin","assetLinkDrupalBasePath","isFarmOSRequest","host","pathname","res","status","error","checkConnectionStatus","throttle","$_checkConnectionStatus","console","log","arrive","apiUrl","currentEpochSecond","credentials","apiData","json","farmOsVersion","meta","farm","version","userRef","links","me","href","sleep","millis","setTimeout","parseInt","Date","getTime","waiting","timeoutMillis","race","toBeReleased","splice","p","PeekableAsyncIterator","delegate","_delegate","_next_iteration_result","next","EventBus","_handlersByEventName","eventName","handler","hasOwn","arg","handlers","promises","all","then","HttpAccessDeniedException","message","AssetLinkPluginListsCore","assetLink","_store","_vm","lists","_eventBus","_pluginReferenceTracker","PluginReferenceTracker","_defaultPluginList","HttpPluginList","_localPluginList","LocalPluginList","_extraPluginLists","_extraPluginListStoreKey","vm","eventBus","extraPluginListUrls","_getExtraPluginListUrls","pluginListUrl","pluginList","pluginListView","load","_updatePluginListViewInViewModel","pluginUrl","addPlugin","removePlugin","_modifyAndWriteStoredExtraPluginListUrls","idx","findIndex","plUrl","pluginListIndex","pl","_url","unload","_removePluginListViewFromViewModel","find","reload","pluginListUrlsItem","getItem","u","mutatorFn","pluginListUrls","shouldWrite","setItem","key","timestamp","plVIndex","plV","sourceUrl","_pluginReferences","listUrl","toString","pluginExists","pluginReferences","listIdx","indexOf","$emit","JSON","stringify","store","pluginReferenceTracker","isDefault","_storeKey","_isDefault","_latestPluginListView","skipCache","postProcessPluginList","_getHttpPluginList","plugins","pRef","ackPluginReference","freePluginReference","removeItem","cacheItem","pluginListRes","statusText","ok","_getLocalPluginList","_modifyAndWriteStoredList","pluginIndex","pluginListItem","pluginRef","AssetLinkPluginLoaderCore","_assetLink","startTime","performance","now","pluginInstance","pluginDataUrl","_fetchPlugin","pluginCls","import","pluginUrlWithoutParams","search","vuetify","vuetifyComponents","vuetifyDirectives","entries","entryName","entry","prototype","hasOwnProperty","call","directiveHook","rawPluginFileData","r","compiler","tags","Set","attrs","parseComponent","template","src","compile","content","modules","postTransformNode","node","directives","name","add","tag","usedVuetifyTags","from","item","hyphenate","capitalize","camelize","kebabTag","camelTag","usedVuetifyDirectives","camelAttr","moduleCache","vue","addStyle","loadModule","components","t","registerPlugin","endTime","plugin","definedRoutes","definedActions","definedMetaActions","definedConfigActions","onLoad","handle","AssetLinkPluginHandle","searchParams","cacheKey","pluginSrc","btoa","_pluginInstance","defineRoute","routeName","routeDefiner","routeDef","routeHandle","missingFields","attr","expectedType","defineAction","actionId","actionDefiner","actionDef","actionHandle","showIf","predicateFn","missingCallbacks","defineMetaAction","defineConfigAction","camelizeRE","str","_","toUpperCase","charAt","hyphenateRE","fetchJson","args","response","AssetLink","_viewModel","booted","bootProgress","bootText","connectionStatus","pendingUpdates","messages","_booted","$once","localforage","storeName","_cores","pluginLists","pluginLoader","_memory","_remote","_ui","_util","viewModel","ui","util","cores","entitySource","remoteEntitySource","ready","loadPlugin","unloadPlugin","addRoute","removeRoute","boot","_models","_loadModels","Orbit","_csrfAwareFetch","bind","_schema","RecordSchema","models","bucket","IndexedDBBucket","namespace","MemorySource","schema","cacheSettings","queryOperators","DrupalSyncQueryOperators","timeout","requestQueueSettings","autoProcess","updateViewModelPendingUpdates","requestQueue","reified","_backup","IndexedDBSource","defaultTransformOptions","useBuffer","_coordinator","Coordinator","sources","_remoteQueryStrategy","RequestStrategy","source","target","action","blocking","addStrategy","SyncStrategy","allRecordsFromBackup","query","q","sync","addRecord","activate","update","operations","$watch","empty","process","deactivate","strategies","removeStrategy","_precache","typeName","matches","match","thisAsset","resolveAsset","lastPrecacheTimeKey","lastPrecacheTime","assetTypes","getAssetTypes","attributes","drupal_internal__id","assetType","listAssetTypes","assetRef","isRefNumeric","test","findAsset","assets","flatMap","a","asset","searchAssets","searchRequest","searchPhase","assetSearchPlugins","searchResultCursors","searchResultCursor","coiterateSearchCursors","peekableSearchResultCursors","bestNextCursor","doneBestNextCursorIndex","thisCursor","thisCursorNextResult","peek","weight","done","bestCursorNextResult","getRelevantActions","actions","values","getRelevantMetaActions","getRelevantConfigActions","route","isUnsafeMethod","addCsrfHeader","tokenResponse","token","Response","_loadModelsFromServer","serverSchema","serverRelatedSchemas","allOf","schemaRef","relatedSchema","serverRelatedSchema","targetSchema","relatedItemSchema","definitions","items","$ref","fromEntries","properties","attrName","relationships","keys","toFixed","pathSuffix","Vuetify","register","registered","cached","updatefound","updated","offline"],"sourceRoot":""}