{"version":3,"file":"js/chunk-common.js","mappings":"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","sources":["webpack://alinkjs/./src/DrupalJSONAPIURLBuilder.js","webpack://alinkjs/./src/DrupalJSONAPISource.js","webpack://alinkjs/./src/DrupalSyncQueryOperators.js","webpack://alinkjs/./src/AssetLinkUI.js","webpack://alinkjs/./src/AssetLinkUtil.js","webpack://alinkjs/./src/FarmOSConnectionStatusDetector.js","webpack://alinkjs/./src/PeekableAsyncIterator.js","webpack://alinkjs/./src/util/currentEpochSecond.js","webpack://alinkjs/./src/util/EventBus.js","webpack://alinkjs/./src/HttpAccessDeniedException.js","webpack://alinkjs/./src/AssetLinkPluginListsCore.js","webpack://alinkjs/./src/AssetLinkPluginLoaderCore.js","webpack://alinkjs/./src/AssetLink.js","webpack://alinkjs/./src/createDrupalUrl.js","webpack://alinkjs/./src/plugins/vuetify.js","webpack://alinkjs/./src/registerServiceWorker.js"],"sourcesContent":["import { JSONAPIURLBuilder } from \"@orbit/jsonapi\";\nimport { QueryExpressionParseError } from \"@orbit/data\";\nimport { JSONAPISerializers } from '@orbit/jsonapi';\n\n/**\n * Extends {JSONAPIURLBuilder} to add support for Drupal JSON:API query operators.\n * \n * Loosely based on https://gist.github.com/bradjones1/18ff9ebdb85455f781a2a212577653ce\n */\nexport default class DrupalJSONAPIURLBuilder extends JSONAPIURLBuilder {\n\n  constructor(settings) {\n    super(settings);\n  }\n\n  buildFilterParam(filterSpecifiers) {\n    const filters = [];\n\n    filterSpecifiers.forEach((filterSpecifier, index) => {\n      if (\n        filterSpecifier.kind === 'attribute' &&\n        filterSpecifier.op === 'equal'\n      ) {\n        const attributeFilter = filterSpecifier;\n\n        // Note: We don't know the `type` of the attribute here, so passing `undefined`\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({ [resourceAttribute]: attributeFilter.value });\n      } else if (filterSpecifier.kind === 'attribute') {\n        const attributeFilter = filterSpecifier;\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({\n          ['client-' + resourceAttribute + '-' + index]: {\n            path: resourceAttribute,\n            operator: attributeFilter.op,\n            value: attributeFilter.value\n          }\n        });\n      } else if (filterSpecifier.kind === 'relatedRecord') {\n        const relatedRecordFilter = filterSpecifier;\n        if (Array.isArray(relatedRecordFilter.record)) {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter.record\n              .map((e) => e.id)\n              .join(',')\n          });\n        } else {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter?.record?.id\n          });\n        }\n      } else if (filterSpecifier.kind === 'relatedRecords') {\n        if (filterSpecifier.op !== 'equal') {\n          throw new Error(\n            `Operation \"${filterSpecifier.op}\" is not supported in JSONAPI for relatedRecords filtering`\n          );\n        }\n        const relatedRecordsFilter = filterSpecifier;\n        filters.push({\n          [relatedRecordsFilter.relation]: relatedRecordsFilter.records\n            .map((e) => e.id)\n            .join(',')\n        });\n      } else {\n        throw new QueryExpressionParseError(\n          `Filter operation ${filterSpecifier.op} not recognized for JSONAPISource.`\n        );\n      }\n    });\n\n    return filters;\n  }\n\n  serializeAttributeAsParam(type, attribute) {\n      if (this.serializer) {\n        return this.serializer.resourceAttribute(type, attribute);\n      } else {\n        const serializer = this.serializerFor(JSONAPISerializers.ResourceFieldParam);\n        return serializer.serialize(attribute, { type });\n      }\n    }\n\n}\n","import JSONAPISource, { JSONAPISerializers } from '@orbit/jsonapi';\nimport { buildSerializerSettingsFor, buildInflector } from '@orbit/serializers';\n\nimport DrupalJSONAPIURLBuilder from '@/DrupalJSONAPIURLBuilder';\n\n\n/**\n * Handle Drupal's `type/bundle` JSON:API resource pathing.\n * Based on: https://github.com/orbitjs/orbit/issues/714#issuecomment-1013952990\n */\nexport default class DrupalJSONAPISource extends JSONAPISource {\n  constructor(settings) {\n    const defaultFetchSettings = Object.assign({}, settings.defaultFetchSettings || {}, {\n      headers:{\n        Accept: 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json',\n      },\n    });\n\n    super(Object.assign({}, settings, {\n      defaultFetchSettings,\n      serializerSettingsFor: buildSerializerSettingsFor({\n        sharedSettings: {\n          inflectors: {\n            drupal: buildInflector(\n              {},\n              (input) => input.replace('--', '/')\n            )\n          }\n        },\n        settingsByType: {\n          [JSONAPISerializers.ResourceTypePath]: {\n            serializationOptions: {inflectors: ['drupal']}\n          }\n        }\n      }),\n      URLBuilderClass: DrupalJSONAPIURLBuilder,\n    }));\n  }\n\n}\n","import { SyncQueryOperators } from '@orbit/record-cache';\nimport { QueryExpressionParseError } from '@orbit/data';\nimport { RecordNotFoundException } from '@orbit/records';\nimport { deepGet, isNone } from '@orbit/utils';\n\n// Based on https://github.com/orbitjs/orbit/blob/2c4bf7038d2f74ba31e45e949c70ec4161ced28f/packages/@orbit/record-cache/src/operators/sync-query-operators.ts\nexport default {\n  findRecord: SyncQueryOperators.findRecord,\n  findRelatedRecord: SyncQueryOperators.findRelatedRecord,\n\n  findRecords(\n      cache,\n      expression,\n      // eslint-disable-next-line no-unused-vars\n      options\n    ) {\n      let exp = expression;\n      let results = cache.getRecordsSync(exp.records || exp.type);\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n\n  findRelatedRecords(\n      cache,\n      expression,\n      options\n    ) {\n      const exp = expression;\n      const { record, relationship } = exp;\n      const relatedIds = cache.getRelatedRecordsSync(record, relationship);\n      if (!relatedIds || relatedIds.length === 0) {\n        if (!cache.getRecordSync(record)) {\n          if (options?.raiseNotFoundExceptions) {\n            throw new RecordNotFoundException(record.type, record.id);\n          } else {\n            return undefined;\n          }\n        }\n\n        return [];\n      }\n      let results = cache.getRecordsSync(relatedIds);\n\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n}\n\nfunction filterRecords(records, filters) {\n  return records.filter((record) => {\n    for (let i = 0, l = filters.length; i < l; i++) {\n      if (!applyFilter(record, filters[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction applyFilter(record, filter) {\n\n  if (filter.kind === 'attribute') {\n    let attributeKey = filter.attribute.split('.');\n\n    let actual = deepGet(record, ['attributes', ...attributeKey]);\n\n    let expected = filter.value;\n\n    // https://api.drupal.org/api/drupal/core%21modules%21jsonapi%21src%21Query%21EntityCondition.php/property/EntityCondition%3A%3AallowedOperators/9.4.x\n    switch (filter.op) {\n      case 'equal':\n      case '=':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() === expected.toLowerCase();\n        }\n        return actual === expected;\n      case '<>':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() !== expected.toLowerCase();\n        }\n        return actual !== expected;\n      case '>':\n        return actual > expected;\n      case '>=':\n        return actual >= expected;\n      case '<':\n        return actual < expected;\n      case '<=':\n        return actual <= expected;\n      case 'STARTS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().startsWith(expected.toLowerCase());\n      case 'CONTAINS':\n        return typeof actual === 'string' && actual.toLowerCase().includes(expected.toLowerCase());\n      case 'ENDS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().endsWith(expected.toLowerCase());\n      case 'IN':\n      case 'NOT IN':\n      case 'BETWEEN':\n      case 'NOT BETWEEN':\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} is not yet implemented for Store.`);\n      case 'IS NULL':\n        return actual === undefined || actual === null;\n      case 'IS NOT NULL':\n        return actual !== undefined && actual !== null;\n      default:\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} not recognized for Store.`);\n    }\n  }\n  return SyncQueryOperators.applyFilter(record, filter);\n}\n\nfunction sortRecords(\n    records,\n    sortSpecifiers\n  ) {\n  const comparisonValues = new Map();\n\n  records.forEach((record) => {\n    comparisonValues.set(\n      record,\n      sortSpecifiers.map((sortSpecifier) => {\n        if (sortSpecifier.kind === 'attribute') {\n          let attributeKey = sortSpecifier.attribute.split('.');\n\n          return deepGet(record, [\n            'attributes',\n            ...attributeKey,\n          ]);\n        } else {\n          throw new QueryExpressionParseError(\n            'Sort specifier ${sortSpecifier.kind} not recognized for Store.'\n          );\n        }\n      })\n    );\n  });\n\n  const comparisonOrders = sortSpecifiers.map((sortExpression) =>\n    sortExpression.order === 'descending' ? -1 : 1\n  );\n\n  return records.sort((record1, record2) => {\n    const values1 = comparisonValues.get(record1);\n    const values2 = comparisonValues.get(record2);\n    for (let i = 0; i < sortSpecifiers.length; i++) {\n      if (values1[i] < values2[i]) {\n        return -comparisonOrders[i];\n      } else if (values1[i] > values2[i]) {\n        return comparisonOrders[i];\n      } else if (isNone(values1[i]) && !isNone(values2[i])) {\n        return comparisonOrders[i];\n      } else if (isNone(values2[i]) && !isNone(values1[i])) {\n        return -comparisonOrders[i];\n      }\n    }\n    return 0;\n  });\n}\n\nfunction paginateRecords(\n  records,\n  paginationOptions\n) {\n  if (paginationOptions.limit !== undefined) {\n    let offset =\n      paginationOptions.offset === undefined ? 0 : paginationOptions.offset;\n    let limit = paginationOptions.limit;\n\n    return records.slice(offset, offset + limit);\n  } else {\n    throw new QueryExpressionParseError(\n      'Pagination options not recognized for Store. Please specify `offset` and `limit`.'\n    );\n  }\n}\n","import Vue from 'vue';\nimport {\n  VBtn,\n  VDialog,\n  VListItem,\n  VListItemTitle,\n} from 'vuetify/lib'\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class AssetLinkUI {\n\n  constructor(app) {\n    this._app = app;\n  }\n\n  /**\n   * Provide some basic components to support Asset Link plugins defined as single (uncompiled) JS\n   * files.\n   * \n   * Commonly accessed via `assetLink.ui.c` e.g. `h(assetLink.ui.c.VBtn, { props: ...`\n   */\n  get c() {\n    return {\n      VBtn,\n      VListItem,\n      VListItemTitle,\n    };\n  }\n\n  /**\n   * \n   */\n  get dialog() {\n    return {\n      confirm: async (text) => {\n        return await this._app.$dialog.confirm({\n          text,\n          title: 'Confirmation'\n        });\n      },\n      promptText: async (text) => {\n        return await this._app.$dialog.prompt({\n          text,\n          title: 'Input',\n        });\n      },\n      custom: async (component, params) => {\n        const id = uuidv4();\n\n        const context = new Vue({});\n\n        const result = await new Promise(resolve => {\n          context.$on('submit', resolve);\n\n          this._app.dialogs.push({\n            id,\n            context,\n            componentFn: (wrapper, h) =>\n              h(VDialog, {\n                props: { value: true, fullscreen: true },\n                on: {\n                  input: () => resolve(undefined),\n                },\n              },  [h(component, {ref: 'dialogComponent', ...params})] ),\n          });\n        });\n\n        this._app.dialogs = this._app.dialogs.filter(d => d.id !== id);\n\n        return result;\n      },\n    };\n  }\n\n}\n","import { formatRFC3339 } from 'date-fns'\nimport createDrupalUrl from '@/createDrupalUrl';\nimport geohash from 'ngeohash';\nimport haversine from 'haversine-distance';\n\nexport default class AssetLinkUtil {\n\n  /**\n   * Format a date object as an RFC 3339 date string. e.g. '2019-09-18T19:00:52Z'\n   */\n  get formatRFC3339() {\n    return formatRFC3339;\n  }\n\n  /**\n   * Create a URL relative to the Drupal installation base path given the URL path suffix.\n   */\n  get createDrupalUrl() {\n    return createDrupalUrl;\n  }\n\n  /**\n   * The node-geohash module: https://github.com/sunng87/node-geohash\n   */\n  get geohash() {\n    return geohash;\n  }\n\n  /**\n   * A haversine distance function: https://github.com/dcousens/haversine-distance\n   */\n  get haversine() {\n    return haversine;\n  }\n\n  /**\n   * Roughly implements the same convention encoded in\n   * https://github.com/farmOS/farmOS/blob/04bf771d91cde8276b67090d2b97c4e4558332b9/modules/core/log/farm_log.module#L74-L88\n   */\n  summarizeAssetNames(assets) {\n    if (assets.length <= 3) {\n      return assets.map(a => a.attributes.name).join(\", \");\n    }\n    return `${assets[0].attributes.name} (+${assets.length - 1} more)`;\n  }\n\n}\n","import Vue from 'vue';\nimport fetch from 'cross-fetch';\nimport throttle from '@jcoreio/async-throttle'\nimport createDrupalUrl from '@/createDrupalUrl';\n\n/**\n * Responsible for detecting online/offline/login status\n * for our connection to the farmOS server both through\n * self-initiated polling and by observing the outcome of\n * decorated fetch requests.\n * \n * @implements {IHttpFetcher}\n */\nconst FarmOSConnectionStatusDetector = Vue.extend({\n\n  props: {\n    fetcherDelegate: {\n      type: Object,\n      default: function () {\n        return { fetch: fetch };\n      }\n    }\n  },\n\n  data() {\n    return {\n      $_running: false,\n      $_barrier: new Barrier(),\n\n      hasNetworkConnection: window.navigator.onLine,\n      canReachFarmOS: undefined,\n      isLoggedIn: undefined,\n    };\n  },\n\n  created() {\n    window.addEventListener('offline', () => {\n      this.hasNetworkConnection = false;\n      this.canReachFarmOS = false;\n    });\n    window.addEventListener('online', () => {\n      this.hasNetworkConnection = true;\n      this.$data.$_barrier.release();\n    });\n    if (window.navigator && window.navigator.connection) {\n      window.navigator.connection.addEventListener('change', () => this.$data.$_barrier.release());\n    }\n    this.$_mainLoop();\n  },\n\n  computed: {\n    isOnline() {\n      return this.canReachFarmOS && this.isLoggedIn;\n    },\n  },\n\n  beforeDestroy() {\n    this.$data.$_running = false;\n    this.$data.$_barrier.release();\n  },\n\n  methods: {\n\n    /**\n     * Decorate fetch requests to detect connection/authentication problems with\n     * requests that are already being sent.\n     */\n    async fetch(url, opts) {\n      const options = opts || {};\n\n      if (!options.method) options.method = 'GET';\n\n      const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n      const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n\n      try {\n        const res = await this.fetcherDelegate.fetch(url, options);\n        if (isFarmOSRequest && res.status === 403) {\n          this.$data.$_barrier.release();\n        }\n        return res;\n      } catch (error) {\n        if (isFarmOSRequest) {\n          this.$data.$_barrier.release();\n        }\n        throw error;\n      }\n    },\n\n    async $_mainLoop() {\n      this.$data.$_running = true;\n\n      const checkConnectionStatus = throttle(() => this.$_checkConnectionStatus(), 1000);\n\n      while (this.$data.$_running) {\n        await checkConnectionStatus();\n        await this.$data.$_barrier.arrive(60 * 1000);\n      }\n    },\n\n    async $_checkConnectionStatus() {\n      if (!this.hasNetworkConnection) {\n        return;\n      }\n\n      const apiUrl = createDrupalUrl(`api?cacheBust=${currentEpochSecond()}`);\n\n      try {\n        const res = await fetch(apiUrl, {credentials: 'same-origin', cache: 'no-cache'});\n\n        if (res.status !== 200) {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        const apiData = await res.json();\n\n        const farmOsVersion = apiData.meta?.farm?.version;\n\n        if (farmOsVersion !== '2.x') {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        this.canReachFarmOS = true;\n\n        const userRef = apiData.meta?.links?.me?.href;\n\n        this.isLoggedIn = userRef !== undefined\n      } catch (error) {\n        this.canReachFarmOS = false;\n      }\n    },\n  },\n\n});\n\nfunction sleep(millis) {\n  return new Promise(resolve => setTimeout(resolve, millis));\n}\n\nfunction currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n\nclass Barrier {\n  constructor() {\n    this.waiting = [];\n  }\n\n  arrive(timeoutMillis) {\n    return Promise.race([\n      sleep(timeoutMillis),\n      new Promise(resolve => this.waiting.push(resolve)),\n    ]);\n  }\n\n  release() {\n    const toBeReleased = this.waiting.splice(0);\n    toBeReleased.forEach(p => p());\n  }\n}\n\nexport default FarmOSConnectionStatusDetector;\n","export default class PeekableAsyncIterator {\n  constructor(delegate) {\n    this._delegate = delegate;\n    this._next_iteration_result = undefined;\n  }\n\n  async next() {\n    if (this._next_iteration_result !== undefined) {\n      const next = this._next_iteration_result;\n      this._next_iteration_result = undefined;\n      return next;\n    }\n    return await this._delegate.next();\n  }\n\n  async peek() {\n    if (this._next_iteration_result === undefined) {\n      this._next_iteration_result = await this._delegate.next();\n    }\n    return this._next_iteration_result;\n  }\n\n}\n","export default function currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n","/**\n * A simple async event bus.\n */\nexport default class EventBus {\n\n  constructor() {\n    this._handlersByEventName = {};\n  }\n\n  $on(eventName, handler) {\n    if (!Object.hasOwn(this._handlersByEventName, eventName)) {\n      this._handlersByEventName[eventName] = [];\n    }\n\n    this._handlersByEventName[eventName].push(handler);\n  }\n\n  async $emit(eventName, arg) {\n    const handlers = this._handlersByEventName[eventName] || [];\n\n    const promises = handlers.map(h => h(arg));\n\n    return Promise.all(promises).then(() => true);\n  }\n\n}\n","export default class HttpAccessDeniedException extends Error {\n  constructor(message, options) {\n    super(message, options);\n  }\n}\n","import Vue from 'vue';\n\nimport createDrupalUrl from '@/createDrupalUrl';\nimport currentEpochSecond from '@/util/currentEpochSecond';\nimport EventBus from '@/util/EventBus';\nimport HttpAccessDeniedException from '@/HttpAccessDeniedException';\n\nexport default class AssetLinkPluginListsCore {\n\n  constructor(assetLink) {\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        lists: [],\n      },\n    });\n\n    this._eventBus = new EventBus();\n\n    this._pluginReferenceTracker = new PluginReferenceTracker(this._eventBus);\n\n    this._defaultPluginList = new HttpPluginList(\n        assetLink._store, \n        createDrupalUrl('/alink/backend/default-plugins.repo.json'),\n        this._pluginReferenceTracker,\n        true,\n    );\n    this._localPluginList = new LocalPluginList(\n        assetLink._store,\n        this._pluginReferenceTracker,\n    );\n    this._extraPluginLists = [];\n\n    this._extraPluginListStoreKey = 'asset-link-extra-plugin-lists';\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  /**\n   * An async event bus used to signal when plugins are added/removed.\n   */\n  get eventBus() {\n    return this._eventBus;\n  }\n\n  async boot() {\n    const extraPluginListUrls = await this._getExtraPluginListUrls();\n\n    this._extraPluginLists = extraPluginListUrls.map(pluginListUrl =>\n      new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false));\n\n    for (let pluginList of [\n          this._defaultPluginList,\n          this._localPluginList,\n          ...this._extraPluginLists,\n        ]) {\n\n      const pluginListView = await pluginList.load();\n\n      this._updatePluginListViewInViewModel(pluginListView);\n    }\n  }\n\n  async addPluginToLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.addPlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removePluginFromLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.removePlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async addExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx >= 0) {\n        return false;\n      }\n      extraPluginListUrls.push(pluginListUrl);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex >= 0) {\n      return;\n    }\n\n    const pluginList = new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false);\n\n    this._extraPluginLists.push(pluginList);\n\n    const pluginListView = await pluginList.load();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removeExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx < 0) {\n        return false;\n      }\n      extraPluginListUrls.splice(idx, 1);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex < 0) {\n      return;\n    }\n\n    const pluginList = this._extraPluginLists.splice(pluginListIndex, 1)[0];\n\n    await pluginList.unload();\n\n    this._removePluginListViewFromViewModel(pluginListUrl);\n  }\n\n  async reloadPluginList(pluginListUrl) {\n    const pluginList = [\n      this._defaultPluginList,\n      this._localPluginList,\n      ...this._extraPluginLists,\n    ].find(pl => pl._url === pluginListUrl);\n\n    if (!pluginList) {\n      return;\n    }\n\n    const pluginListView = await pluginList.reload();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async _getExtraPluginListUrls() {\n    const pluginListUrlsItem = await this._store.getItem(this._extraPluginListStoreKey);\n\n    if (pluginListUrlsItem) {\n      return pluginListUrlsItem.value.map(u => new URL(u));\n    }\n\n    return [];\n  }\n\n  async _modifyAndWriteStoredExtraPluginListUrls(mutatorFn) {\n    const pluginListUrls = await this._getExtraPluginListUrls();\n    const shouldWrite = mutatorFn(pluginListUrls) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._extraPluginListStoreKey, {key: this._extraPluginListStoreKey, timestamp: currentEpochSecond(), value: pluginListUrls});\n    }\n    return pluginListUrls;\n  }\n\n  _updatePluginListViewInViewModel(pluginListView) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListView.sourceUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1, pluginListView);\n    } else {\n      vm.lists.push(pluginListView);\n    }\n  }\n\n  _removePluginListViewFromViewModel(pluginListUrl) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1);\n    }\n  }\n\n}\n\nclass PluginReferenceTracker {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    // Track which lists reference a given plugin by keeping\n    // a mapping between the plugin url and the list urls which\n    // reference it.\n    this._pluginReferences = {\n        // 'https://example.com/alink-plugins/MyAwesomePlugin.alink.js': [ 'https://example.com/cool-alink-plugins.repo.json' ],\n    };\n  }\n\n  /* eslint-disable no-console */\n  async ackPluginReference(pluginUrl, listUrl) {\n    console.log('ackPluginReference', pluginUrl.toString(), listUrl.toString());\n\n    const pluginExists = Object.hasOwn(this._pluginReferences, pluginUrl.toString());\n\n    if (!pluginExists) {\n      this._pluginReferences[pluginUrl.toString()] = [];\n    }\n\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx < 0) {\n      pluginReferences.push(listUrl);\n    }\n\n    if (!pluginExists) {\n      await this._eventBus.$emit('add-plugin', pluginUrl);\n    }\n  }\n\n  /* eslint-disable no-console */\n  async freePluginReference(pluginUrl, listUrl) {\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    if (!pluginReferences) {\n      console.log('freePluginReference unexpectedly found plugin missing from internal reference tracking', pluginUrl.toString(), listUrl.toString(), JSON.stringify(this._pluginReferences));\n      return;\n    }\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx >= 0) {\n      pluginReferences.splice(listIdx, 1);\n    } else {\n      console.log('freePluginReference unexpectedly found plugin without expected reference', pluginUrl.toString(), listUrl.toString(), JSON.stringify(pluginReferences));\n    }\n\n    if (pluginReferences.length > 0) {\n      return;\n    }\n\n    await this._eventBus.$emit('remove-plugin', pluginUrl);\n  }\n}\n\nclass HttpPluginList {\n  constructor(store, url, pluginReferenceTracker, isDefault) {\n    this._store = store;\n    this._storeKey = `asset-link-cached-plugin-list:${url}`;\n    this._url = url;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n    this._isDefault = isDefault;\n    this._isLocal = false;\n\n    this._latestPluginListView = undefined;\n  }\n\n  async load(skipCache) {\n    this._latestPluginListView = postProcessPluginList(await this._getHttpPluginList(skipCache), this._isDefault, this._isLocal, this._url);\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return this._latestPluginListView;\n  }\n\n  async unload() {\n    if (!this._latestPluginListView) {\n      return;\n    }\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.freePluginReference(pRef.url, this._url)));\n\n    await this._store.removeItem(this._storeKey);\n  }\n\n  async reload() {\n    return await this.load(true);\n  }\n\n  async _getHttpPluginList(skipCache) {\n    const cacheItem = skipCache ? undefined : await this._store.getItem(this._storeKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginListRes = await fetch(this._url);\n\n    console.log(pluginListRes);\n    if (pluginListRes.status === 403) {\n      throw new HttpAccessDeniedException(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    } else if (!pluginListRes.ok) {\n      throw new Error(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    }\n\n    const pluginList = await pluginListRes.json();\n\n    await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp, value: pluginList});\n\n    return pluginList;\n  }\n\n}\n\nclass LocalPluginList {\n  constructor(store, pluginReferenceTracker) {\n    this._store = store;\n    this._storeKey = 'local-plugin-list.repo.json';\n    this._url = new URL(\"indexeddb://asset-link/data/local-plugin-list.repo.json\", window.location.origin);\n    this._isDefault = false;\n    this._isLocal = true;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n  }\n\n  async load() {\n    const pluginListView = postProcessPluginList(await this._getLocalPluginList(), this._isDefault, this._isLocal, this._url);\n\n    await Promise.all(pluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return pluginListView;\n  }\n\n  async reload() {\n    return await this.load();\n  }\n\n  async addPlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      if (pl.plugins.find(pRef => pRef.url === pluginUrl.toString())) {\n        return false;\n      }\n      pl.plugins.push({ url: pluginUrl.toString() });\n    });\n\n    await this._pluginReferenceTracker.ackPluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, this._isDefault, this._isLocal, this._url);\n  }\n\n  async removePlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      const pluginIndex = pl.plugins.findIndex(pRef => pRef.url === pluginUrl.toString())\n\n      if (pluginIndex < 0) {\n        return false;\n      }\n\n      pl.plugins.splice(pluginIndex, 1);\n    });\n\n    await this._pluginReferenceTracker.freePluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, this._isDefault, this._isLocal, this._url);\n  }\n\n  async _getLocalPluginList() {\n    const pluginListItem = await this._store.getItem(this._storeKey);\n\n    if (!pluginListItem) {\n      return { plugins: [] };\n    }\n\n    return pluginListItem.value;\n  }\n\n  async _modifyAndWriteStoredList(mutatorFn) {\n    const pluginList = await this._getLocalPluginList();\n    const shouldWrite = mutatorFn(pluginList) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp: currentEpochSecond(), value: pluginList});\n    }\n    return pluginList;\n  }\n}\n\nconst postProcessPluginList = (pluginList, isDefault, isLocal, sourceUrl) => {\n  pluginList.isDefault = isDefault;\n  pluginList.isLocal = isLocal;\n  pluginList.sourceUrl = sourceUrl;\n\n  if (!pluginList.error) {\n    pluginList.error = undefined;\n  }\n\n  if (!pluginList.plugins) {\n    pluginList.plugins = [];\n  }\n\n  pluginList.plugins = pluginList.plugins.map(pluginRef => {\n    // Resolve relative paths on this server, but still allow for\n    // arbitrary absolute/third-party urls\n    const pluginUrl = new URL(pluginRef.url, isLocal ? window.location.origin : pluginList.sourceUrl);\n\n    return {\n      url: pluginUrl,\n    };\n  });\n\n  return pluginList;\n};\n","import Vue from 'vue';\n\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { loadModule } from 'vue3-sfc-loader/dist/vue2-sfc-loader.esm.js';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nexport default class AssetLinkPluginLoaderCore {\n\n  constructor(assetLink) {\n    this._assetLink = assetLink;\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        plugins: [],\n      },\n    });\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  async boot() {\n    // TODO: ?\n  }\n\n  async loadPlugin(pluginUrl, opts) {\n    const options = opts || {};\n\n    const startTime = performance.now();\n\n    let pluginInstance = undefined;\n\n    try {\n      let pluginDataUrl = await this._fetchPlugin(pluginUrl, options);\n\n      if (pluginUrl.pathname.endsWith('alink.js')) {\n        const pluginCls = (await import(/* webpackIgnore: true */ pluginDataUrl)).default;\n        pluginInstance = new pluginCls();\n      } else if (pluginUrl.pathname.endsWith('alink.vue')) {\n        const pluginUrlWithoutParams = new URL(pluginUrl.toString());\n        pluginUrlWithoutParams.search = '';\n\n        const vuetify = await import('vuetify/lib');\n\n        const vuetifyComponents = {};\n        const vuetifyDirectives = {};\n\n        Object.entries(vuetify).forEach(([entryName, entry]) => {\n          if (Object.prototype.hasOwnProperty.call(entry, 'component')) {\n            vuetifyComponents[entryName] = entry;\n          } else if (['bind', 'inserted', 'update', 'componentUpdated', 'unbind'].find(directiveHook => Object.prototype.hasOwnProperty.call(entry, directiveHook))) {\n            vuetifyDirectives[entryName] = entry;\n          }\n        });\n\n        let rawPluginFileData = await fetch(pluginDataUrl).then(r => r.text());\n\n        // Roughly based on https://harlanzw.com/blog/vue-automatic-component-imports/\n        // and https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/loader.js#L110-L144\n        const compiler = await import('vue-template-compiler');\n\n        const tags = new Set()\n        const attrs = new Set()\n        const component = compiler.parseComponent(rawPluginFileData);\n\n        if (component.errors.length > 0) {\n          throw new Error(`Could not parse component plugin: ${component.errors.join('\\n')}`);\n        }\n\n        if (component.template) {\n          if (component.template.src) {\n            throw new Error(`External component template content is not supported.`);\n          }\n          compiler.compile(component.template.content, {\n            modules: [{\n              postTransformNode: node => {\n                if (\"directives\" in node) {\n                  node.directives.forEach(({ name }) => attrs.add(name))\n                }\n                tags.add(node.tag)\n              }\n            }]\n          });\n        }\n\n        /* eslint-disable no-unused-vars */\n        const usedVuetifyTags = Array.from(tags).map(item => [hyphenate(item), capitalize(camelize(item))])\n          .filter(([kebabTag, camelTag]) => kebabTag.startsWith('v-') && Object.prototype.hasOwnProperty.call(vuetifyComponents, camelTag))\n          .map(([kebabTag, camelTag]) => [camelTag, vuetifyComponents[camelTag]]);\n\n        const usedVuetifyDirectives = Array.from(attrs).map(item => capitalize(camelize(item)))\n          .filter(camelAttr => Object.prototype.hasOwnProperty.call(vuetifyDirectives, camelAttr))\n          .map(camelAttr => [camelAttr, vuetifyDirectives[camelAttr]]);\n\n        if (!this.moduleCache) {\n          this.moduleCache = Object.assign(Object.create(null), {\n            vue: Vue,\n            'vuetify/lib': vuetify,\n\n            // TODO: Figure out how to make loading these cleaner/on-demand\n            'vue-codemirror': import('vue-codemirror'),\n            'codemirror/mode/javascript/javascript.js': import('codemirror/mode/javascript/javascript.js'),\n            'codemirror/mode/vue/vue.js': import('codemirror/mode/vue/vue.js'),\n            'codemirror/lib/codemirror.css': import('codemirror/lib/codemirror.css'),\n            'codemirror/theme/base16-dark.css': import('codemirror/theme/base16-dark.css'),\n          });\n        }\n\n        const options = {\n          moduleCache: this.moduleCache,\n          compiledCache: {\n            set: (key, str) => this._store.setItem(`asset-link-cached-compiled-plugin:${key}`, str),\n            get: (key) => this._store.getItem(`asset-link-cached-compiled-plugin:${key}`),\n          },\n          async getFile(url) {\n            if ( url === pluginUrlWithoutParams ) {\n              return rawPluginFileData;\n            } else {\n              throw new Error(`Secondary imports are not supported. url=${url}`);\n            }\n          },\n          addStyle() {\n            /* TODO: https://github.com/FranckFreiburger/vue3-sfc-loader/blob/80f10f9fd82d7dde6c8681d23d36e9ac3ab9a654/docs/examples.md?plain=1#L403-L453 */\n          },\n        };\n\n        pluginInstance = await loadModule(pluginUrlWithoutParams, options);\n\n        if (!pluginInstance.name) {\n          pluginInstance.name = `unnamed-sfc-plugin-${uuidv4()}`;\n        }\n\n        if (usedVuetifyTags.length && !pluginInstance.components) pluginInstance.components = {};\n        usedVuetifyTags.filter(t => !pluginInstance.components[t[0]]).forEach(t => pluginInstance.components[t[0]] = t[1]);\n\n        if (usedVuetifyDirectives.length && !pluginInstance.directives) pluginInstance.directives = {};\n        usedVuetifyDirectives.filter(t => !pluginInstance.directives[t[0]]).forEach(t => pluginInstance.directives[t[0]] = t[1]);\n\n        Vue.component(pluginInstance.name, pluginInstance);\n      } else {\n        throw new Error(`Cannot load plugin ${pluginUrl} with unsupported type. Path of url must end in '.alink.js' or '.alink.vue'`);\n      }\n\n      pluginInstance.pluginUrl = pluginUrl;\n\n      this.registerPlugin(pluginInstance);\n    } catch (error) {\n      console.log(error);\n      pluginInstance = {};\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.error = error;\n      this.registerPlugin(pluginInstance);\n    } finally {\n      const endTime = performance.now();\n      console.log(`Loading plugin ${pluginUrl} took ${endTime - startTime} milliseconds`);\n    }\n  }\n\n  /**\n   * Directly register a plugin with Asset Link. Note that plugins registered this way\n   * will not persist between sessions/reloads.\n   */\n  registerPlugin(plugin) {\n    plugin.definedRoutes = {};\n    plugin.definedSlots = {};\n    plugin.definedWidgetDecorators = {};\n\n    this.vm.plugins.push(plugin);\n\n    if (typeof plugin.onLoad === 'function') {\n      const handle = new AssetLinkPluginHandle(plugin, this.vm);\n\n      plugin.onLoad(handle, this._assetLink);\n    }\n  }\n\n  async unloadPlugin(pluginUrl) {\n    const pluginIdx = this.vm.plugins.findIndex(p => p.pluginUrl.toString() === pluginUrl.toString());\n\n    if (pluginIdx !== -1) {\n      this.vm.plugins.splice(pluginIdx, 1);\n    }\n  }\n\n  async reloadPlugin(pluginUrl) {\n    await this.unloadPlugin(pluginUrl);\n    await this.loadPlugin(pluginUrl, { skipCache: true });\n  }\n\n  async _fetchPlugin(url, opts) {\n    const options = opts || {};\n\n    const skipCache = options.skipCache || (url.searchParams && url.searchParams.get('skipCache'));\n\n    const cacheKey = `asset-link-cached-plugin-src:${url}`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (!skipCache && cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginSrcRes = await fetch(url);\n\n    if (!pluginSrcRes.ok) {\n      throw new Error(`HTTP Error ${pluginSrcRes.status}: ${pluginSrcRes.statusText}`);\n    }\n\n    const pluginSrc = await pluginSrcRes.text();\n\n    const pluginSrcWithSourceInfo = `${pluginSrc}\\n//# sourceURL=asset-link-plugin:./${encodeURIComponent(url)}\\n`;\n\n    const pluginDataUrl = \"data:application/javascript;base64,\" + btoa(pluginSrcWithSourceInfo);\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: pluginDataUrl});\n\n    return pluginDataUrl;\n  }\n\n}\n\nclass AssetLinkPluginHandle {\n\n  constructor(pluginInstance, vm) {\n    this._pluginInstance = pluginInstance;\n    this._vm = vm;\n  }\n\n  get thisPlugin() {\n    return this._pluginInstance;\n  }\n\n  defineRoute(routeName, routeDefiner) {\n    const routeDef = {name: routeName};\n\n    const routeHandle = {\n        path(path) {\n          routeDef.path = path;\n        },\n        componentFn(componentFn) {\n          routeDef.componentFn = componentFn;\n        },\n    };\n\n    routeDefiner(routeHandle);\n\n    const missingFields = Object.entries({'path': 'string', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof routeDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Action '${routeName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, routeDef);\n      return;\n    }\n\n    this._pluginInstance.definedRoutes[routeName] = routeDef;\n\n    this._vm.$emit('add-route', routeDef);\n  }\n\n  defineSlot(slotName, slotDefiner) {\n    const slotDef = {name: slotName};\n\n    const slotHandle = {\n        type(type) {\n          slotDef.type = type;\n        },\n        showIf(predicateFn) {\n          slotDef.predicateFn = predicateFn;\n        },\n        multiplexContext(contextMultiplexerFn) {\n          slotDef.contextMultiplexerFn = contextMultiplexerFn;\n        },\n        weight(weightFn) {\n          slotDef.weightFn = weightFn;\n        },\n        componentFn(componentFn) {\n          slotDef.componentFn = componentFn;\n        },\n    };\n\n    slotDefiner(slotHandle);\n\n    let missingFields = Object.entries({'type': 'string', 'predicateFn': 'function', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof slotDef[attr] !== expectedType);\n\n    if (!['undefined', 'function'].includes(typeof slotDef.contextMultiplexerFn)) {\n      missingFields.push(['contextMultiplexerFn', 'function?']);\n    }\n\n    if (!['undefined', 'function', 'number'].includes(typeof slotDef.weightFn)) {\n      missingFields.push(['weightFn', '(function|number)?']);\n    }\n\n    if (missingFields.length) {\n      console.log(`Slot '${slotName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, slotDef);\n      return;\n    }\n\n    const providedPredicateFn = slotDef.predicateFn;\n\n    // Decorate the predicate function to make the slots automatically filtered by type\n    slotDef.predicateFn = (context) => context.type === slotDef.type && providedPredicateFn(context);\n\n    const providedWeightFn = slotDef.weightFn;\n    // If no weight was provided, use the default of 100\n    if (providedWeightFn === undefined) {\n      slotDef.weightFn = () => 100;\n    }\n    // If the weight is a constant number, wrap it in a function that returns that number\n    else if (typeof providedWeightFn === 'number') {\n      slotDef.weightFn = () => providedWeightFn;\n    }\n\n    this._pluginInstance.definedSlots[slotName] = slotDef;\n  }\n\n  defineWidgetDecorator(widgetDecoratorName, widgetDecoratorDefiner) {\n    const widgetDecoratorDef = { name: widgetDecoratorName };\n\n    const widgetDecoratorHandle = {\n        targetWidgetName(targetWidgetName) {\n          widgetDecoratorDef.targetWidgetName = targetWidgetName;\n        },\n        appliesIf(predicateFn) {\n          widgetDecoratorDef.predicateFn = predicateFn;\n        },\n        weight(weightFn) {\n          widgetDecoratorDef.weightFn = weightFn;\n        },\n        componentFn(componentFn) {\n          widgetDecoratorDef.componentFn = componentFn;\n        },\n    };\n\n    widgetDecoratorDefiner(widgetDecoratorHandle);\n\n    const missingFields = Object.entries({'targetWidgetName': 'string', 'predicateFn': 'function', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof widgetDecoratorDef[attr] !== expectedType);\n\n    if (!['undefined', 'function', 'number'].includes(typeof widgetDecoratorDef.weightFn)) {\n      missingFields.push(['weightFn', '(function|number)?']);\n    }\n\n    if (missingFields.length) {\n      console.log(`Widget decorator '${widgetDecoratorName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, widgetDecoratorDef);\n      return;\n    }\n\n    const providedPredicateFn = widgetDecoratorDef.predicateFn;\n\n    // Decorate the predicate function to make the widget decorators automatically filtered by targetWidgetName\n    widgetDecoratorDef.predicateFn = (context) =>\n      context.widgetName === widgetDecoratorDef.targetWidgetName && providedPredicateFn(context);\n\n    const providedWeightFn = widgetDecoratorDef.weightFn;\n    // If no weight was provided, use the default of 100\n    if (providedWeightFn === undefined) {\n      widgetDecoratorDef.weightFn = () => 100;\n    }\n    // If the weight is a constant number, wrap it in a function that returns that number\n    else if (typeof providedWeightFn === 'number') {\n      widgetDecoratorDef.weightFn = () => providedWeightFn;\n    }\n\n    this._pluginInstance.definedWidgetDecorators[widgetDecoratorName] = widgetDecoratorDef;\n  }\n\n}\n\n//Copied from https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/util.js#L6-L18\nconst camelizeRE = /-(\\w)/g\nconst camelize = str => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n}\n\nconst capitalize = str => {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst hyphenateRE = /\\B([A-Z])/g\nconst hyphenate = str => {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n","import Vue from 'vue';\n\nimport { Coordinator, RequestStrategy, SyncStrategy } from '@orbit/coordinator';\nimport { Orbit } from '@orbit/core';\nimport { IndexedDBBucket } from '@orbit/indexeddb-bucket';\nimport { IndexedDBSource } from '@orbit/indexeddb';\nimport { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\nimport DrupalJSONAPISource from '@/DrupalJSONAPISource';\nimport DrupalSyncQueryOperators from '@/DrupalSyncQueryOperators';\n\nimport localforage from 'localforage';\n\nimport fetch from 'cross-fetch';\n\nimport AssetLinkUI from '@/AssetLinkUI';\nimport AssetLinkUtil from '@/AssetLinkUtil';\nimport createDrupalUrl from '@/createDrupalUrl';\nimport FarmOSConnectionStatusDetector from '@/FarmOSConnectionStatusDetector';\nimport PeekableAsyncIterator from '@/PeekableAsyncIterator';\nimport AssetLinkPluginListsCore from '@/AssetLinkPluginListsCore';\nimport AssetLinkPluginLoaderCore from '@/AssetLinkPluginLoaderCore';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nconst fetchJson = (url, args) => fetch(url, args).then(response => response.json());\n\n\n\n/**\n * Core of the larger Asset Link application and API entry-point for plugins.\n * \n * TODO: Break out some of the responsibilities of this class into classes that can be\n * delegated to. e.g. plugin management, entities CRUD, etc.\n */\nexport default class AssetLink {\n\n  constructor(app) {\n    this._app = app;\n    this._viewModel = new Vue({\n      data: {\n        booted: false,\n        bootProgress: 0,\n        bootText: \"Starting\",\n\n        connectionStatus: new FarmOSConnectionStatusDetector(),\n\n        pendingUpdates: [],\n\n        messages: [],\n      },\n    });\n\n    this._booted = new Promise((resolve) => {\n      this._viewModel.$once('booted', () => {\n        this._viewModel.booted = true;\n        resolve(true);\n      });\n    });\n\n    this._store = localforage.createInstance({\n      name: 'asset-link',\n      storeName: 'data',\n    });\n\n    this._cores = {};\n    this._cores.pluginLists = new AssetLinkPluginListsCore(this);\n    this._cores.pluginLoader = new AssetLinkPluginLoaderCore(this);\n\n    this._memory = undefined;\n    this._remote = undefined;\n\n    this._ui = new AssetLinkUI(app);\n    this._util = new AssetLinkUtil();\n  }\n\n  /**\n   * The top-level {Vue} app component.\n   */\n  get app() {\n    return this._app;\n  }\n\n  /**\n   * A {Vue} instance used to expose some of Asset Link's state to\n   * its UI in a reactive way.\n   */\n  get viewModel() {\n    return this._viewModel;\n  }\n\n  /**\n   * UI components/methods exposed for Asset Link plugins.\n   */\n  get ui() {\n    return this._ui;\n  }\n\n  /**\n   * Utility methods exposed for Asset Link plugins.\n   */\n  get util() {\n    return this._util;\n  }\n\n  /**\n   * The map of AssetLink cores.\n   */\n  get cores() {\n    return this._cores;\n  }\n\n  /**\n   * The Orbit.js {MemorySource} which is used to access/modify farmOS assets/logs/etc.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get entitySource() {\n    return this._memory;\n  }\n\n  /**\n   * The Orbit.js {JSONAPISource} which is used to directly access/modify\n   * farmOS assets/logs/etc - unless you know what you are doing, use {#entitySource}\n   * instead.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get remoteEntitySource() {\n    return this._remote;\n  }\n\n  /**\n   * The currently loaded plugins.\n   */\n  get plugins() {\n    return this._cores.pluginLoader.vm.plugins;\n  }\n\n  /**\n   * A {Promise} that is fulfilled once Asset Link has booted.\n   */\n  get booted() {\n    return this._booted;\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async boot() {\n    this.viewModel.bootText = \"Initializing storage\";\n\n    await this._store.ready();\n\n    this._cores.pluginLists.eventBus.$on('add-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.loadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLists.eventBus.$on('remove-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.unloadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLoader.vm.$on('add-route', routeDef => {\n      if (typeof this.app.addRoute === 'function') {\n        this.app.addRoute(routeDef);\n      }\n    });\n\n    this._cores.pluginLoader.vm.$on('remove-route', routeDef => {\n      if (typeof this.app.removeRoute === 'function') {\n        this.app.removeRoute(routeDef);\n      }\n    });\n\n    window.addEventListener('asset-link-plugin-changed', async e => {\n      await this._cores.pluginLoader.reloadPlugin(new URL(e.detail.pluginUrl));\n    });\n\n    await this._cores.pluginLoader.boot();\n    await this._cores.pluginLists.boot();\n\n    this.viewModel.bootText = \"Loading models...\";\n    this._models = await this._loadModels();\n\n    Orbit.fetch = this._csrfAwareFetch.bind(this);\n\n    this._schema = new RecordSchema({ models: this._models });\n\n    const bucket = new IndexedDBBucket({ namespace: 'asset-link-orbitjs-bucket' });\n\n    this._memory = new MemorySource({\n      schema: this._schema,\n      cacheSettings: {\n        queryOperators: DrupalSyncQueryOperators,\n      },\n    });\n\n    this._remote = new DrupalJSONAPISource({\n      schema: this._schema,\n      name: 'remote',\n      host: createDrupalUrl('/api'),\n      defaultFetchSettings: {\n        timeout: 10000,\n      },\n      bucket,\n      requestQueueSettings: {\n        autoProcess: this.viewModel.connectionStatus.isOnline || false,\n      },\n    });\n\n    const updateViewModelPendingUpdates = () => {\n      this.viewModel.pendingUpdates = this._remote.requestQueue.entries.filter(r => r.type === 'update');\n    };\n\n    this._remote.requestQueue.reified.then(updateViewModelPendingUpdates);\n    this._remote.requestQueue.on('change', updateViewModelPendingUpdates);\n\n    this._backup = new IndexedDBSource({\n      schema: this._schema,\n      name: 'backup',\n      namespace: 'asset-link-orbitjs-entities',\n      defaultTransformOptions: {\n        useBuffer: true,\n      },\n    });\n\n    this._coordinator = new Coordinator({\n      sources: [this._memory, this._remote, this._backup]\n    });\n\n    // Query the remote server when the memory source is queried (and online)\n    this._remoteQueryStrategy = new RequestStrategy({\n      name: 'remoteRequestStrategy',\n\n      source: 'memory',\n      on: 'beforeQuery',\n\n      target: 'remote',\n      action: 'query',\n\n      blocking: true\n    });\n    // Only use the remote query strategy when online\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._coordinator.addStrategy(this._remoteQueryStrategy);\n    }\n\n    // Update the remote server whenever the memory source is updated\n    this._coordinator.addStrategy(\n      new RequestStrategy({\n        source: 'memory',\n        on: 'beforeUpdate',\n\n        target: 'remote',\n        action: 'update',\n\n        blocking: false\n      })\n    );\n\n    // Sync all changes received from the remote server to the memory source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'remote',\n        target: 'memory',\n        blocking: false\n      })\n    );\n\n    // Sync all changes to the backup source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'memory',\n        target: 'backup',\n        blocking: true\n      })\n    );\n\n    // Restore the backup source\n    const allRecordsFromBackup = await this._backup.query((q) => q.findRecords());\n    await this._memory.sync((t) => allRecordsFromBackup.map((r) => t.addRecord(r)));\n\n    await this._coordinator.activate();\n\n    this.viewModel.bootProgress = 100;\n\n    this._memory.on('update', update => {\n      console.log('_memory::update', update);\n\n      if (update.operations.op === 'updateRecord' && update.operations.record.type.startsWith('asset--')) {\n        this.viewModel.$emit('changed:asset', update.operations.record.type, update.operations.record.id);\n      }\n\n    });\n\n    this.viewModel.connectionStatus.$watch('isOnline', async (isOnline) => {\n      this._remote.requestQueue.autoProcess = isOnline;\n      if (isOnline && !this._remote.requestQueue.empty) {\n        this._remote.requestQueue.process();\n      }\n\n      await this._coordinator.deactivate();\n      if (isOnline) {\n        if (!this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.addStrategy(this._remoteQueryStrategy);\n        }\n      } else {\n        if (this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.removeStrategy(this._remoteQueryStrategy.name);\n        }\n      }\n      await this._coordinator.activate();\n    });\n\n    this.viewModel.$emit('booted');\n\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._precache();\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets the model for an entity type given that the type name. e.g. \"asset--plant\"\n   */\n  async getEntityModel(typeName) {\n    await this._booted;\n\n    return this._models[typeName];\n  }\n\n  async _precache() {\n    // Precache the current page's asset\n    const matches = window.location.href.match(/https?:\\/\\/.*\\/asset\\/(\\d+)/);\n    if (matches && matches.length >= 2) {\n      const thisAsset = await this.resolveAsset(matches[1]);\n      console.log(\"thisAsset=\", thisAsset);\n    }\n\n    const timestamp = currentEpochSecond();\n\n    const lastPrecacheTimeKey = `asset-link-last-precache-time`;\n\n    const lastPrecacheTime = await this._store.getItem(lastPrecacheTimeKey);\n\n    if (lastPrecacheTime && (timestamp - lastPrecacheTime) < 900) {\n      console.log(\"Skipping Asset Link precaching because it was done recently...\");\n      return;\n    }\n\n    // Precache recently changed assets\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    await this._memory.query((q) => assetTypes.map(assetType => q.findRecords(`asset--${assetType}`)\n        .sort('-changed')\n        .page({ offset: 0, limit: 100 })));\n\n    // TODO: Consider also precaching recently changed and recent/upcoming logs\n\n    await this._store.setItem(lastPrecacheTimeKey, timestamp);\n  }\n\n  /**\n   * Get a list of the asset_type entities.\n   */\n  async getAssetTypes() {\n    const listAssetTypes = async (source) => {\n      return await source.query((q) => q\n          .findRecords(`asset_type--asset_type`)\n          .sort('drupal_internal__id'));\n    };\n\n    const assetTypes = await listAssetTypes(this._memory.cache);\n\n    if (assetTypes.length) {\n      return assetTypes;\n    }\n\n    return await listAssetTypes(this._memory);\n  }\n\n  /**\n   * Get an asset by UUID or Drupal internal id.\n   */\n  async resolveAsset(assetRef) {\n    await this._booted;\n\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    const isRefNumeric = /^-?\\d+$/.test(assetRef);\n\n    let filter = { attribute: 'id', value: assetRef };\n    if (isRefNumeric) {\n      filter = { attribute: 'drupal_internal__id', value: parseInt(assetRef) };\n    }\n\n    const findAsset = async (source) => {\n      const results = await source.query(q => assetTypes.map(assetType => q\n          .findRecords(`asset--${assetType}`)\n          .filter(filter)\n          .sort('drupal_internal__id')));\n\n      const assets = results.flatMap(l => l);\n\n      return assets.find(a => a);\n    };\n\n    const asset = await findAsset(this._memory.cache);\n\n    if (asset) {\n      return asset;\n    }\n\n    return await findAsset(this._memory);\n  }\n\n  /**\n   * Central asset searching entry-point. Responsible for delegating to asset searching plugins.\n   */\n  searchAssets(searchRequest, searchPhase) {\n    console.log(\"searchAssets:\", JSON.stringify(searchRequest), searchPhase);\n\n    const assetSearchPlugins = this.plugins.filter(p => typeof p.searchAssets === 'function');\n\n    const searchResultCursors = [];\n\n    for (let i = 0; i < assetSearchPlugins.length; i += 1) {\n      const plugin = assetSearchPlugins[i];\n\n      /* eslint-disable no-await-in-loop */\n      const searchResultCursor = plugin.searchAssets(this, searchRequest, searchPhase);\n\n      if (searchResultCursor !== undefined) {\n        searchResultCursors.push(searchResultCursor);\n      }\n    }\n\n    async function* coiterateSearchCursors() {\n      console.log(\"coiterateSearchCursors: searchResultCursors =\", searchResultCursors);\n\n      const peekableSearchResultCursors = searchResultCursors.map(c => new PeekableAsyncIterator(c));\n\n      while(peekableSearchResultCursors.length > 0) {\n\n        console.log(\"coiterateSearchCursors: peekableSearchResultCursors.length =\", peekableSearchResultCursors.length, peekableSearchResultCursors);\n\n        let bestNextCursor = undefined;\n        let doneBestNextCursorIndex = undefined;\n        for (let i = 0; i < peekableSearchResultCursors.length; i += 1) {\n          const thisCursor = peekableSearchResultCursors[i];\n\n          const thisCursorNextResult = await thisCursor.peek();\n\n          if (thisCursorNextResult.value === undefined) {\n            continue;\n          }\n\n          if (bestNextCursor === undefined || thisCursorNextResult.value.weight < (await bestNextCursor.peek()).value.weight) {\n            bestNextCursor = thisCursor;\n            doneBestNextCursorIndex = thisCursorNextResult.done ? i : undefined;\n          }\n        }\n\n        if (bestNextCursor === undefined) {\n          return;\n        }\n\n        const bestCursorNextResult = await bestNextCursor.next();\n\n        if (bestCursorNextResult.value) {\n          yield bestCursorNextResult.value;\n        }\n\n        if (doneBestNextCursorIndex !== undefined) {\n          peekableSearchResultCursors.splice(doneBestNextCursorIndex, 1);\n        }\n\n      }\n    }\n\n    return coiterateSearchCursors();\n  }\n\n  getSlots(context) {\n    return this.getPluginDefinedComponents('definedSlots', context);\n  }\n\n  getWidgetDecorators(context) {\n    return this.getPluginDefinedComponents('definedWidgetDecorators', context);\n  }\n\n  getPluginDefinedComponents(componentDefKey, context) {\n    const sortingFn = (a1, a2) => {\n      if (a1.weight < a2.weight) {\n        return -1;\n      }\n      if (a1.weight > a2.weight) {\n        return 1;\n      }\n      if (a1.id < a2.id) {\n        return -1;\n      }\n      if (a1.id > a2.id) {\n        return 1;\n      }\n      return 0;\n    };\n\n    const componentDefs = plugin => plugin[componentDefKey] || {};\n\n    return this.plugins.flatMap(plugin => Object.values(componentDefs(plugin)))\n      .filter(a => a.predicateFn(context))\n      .flatMap(a => {\n\n        let contexts = [context];\n        if (typeof a.contextMultiplexerFn === 'function') {\n          contexts = a.contextMultiplexerFn(context);\n        }\n\n        return contexts.map((c, idx) => ({\n            id: contexts.length === 1 ? a.id : (a.id + '.' + idx),\n            componentFn: (wrapper, h, children) => a.componentFn(wrapper, h, c, children),\n            weight: a.weightFn(c),\n        }));\n\n      })\n      .sort(sortingFn);\n  }\n\n  async _csrfAwareFetch(url, opts) {\n    const options = opts || {};\n\n    if (!options.method) options.method = 'GET';\n\n    const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n    const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n    const isUnsafeMethod = !['HEAD', 'GET', 'OPTIONS', 'TRACE'].includes(options.method.toUpperCase());\n\n    const addCsrfHeader = isFarmOSRequest && isUnsafeMethod;\n\n    try {\n      if (addCsrfHeader) {\n        const tokenResponse = await this.viewModel.connectionStatus.fetch(createDrupalUrl('/session/token'));\n\n        console.log(\"tokenResponse:\", tokenResponse);\n\n        const token = await tokenResponse.text();\n\n        // TODO: Cache the token\n        if (!options.headers) options.headers = {};\n        options.headers['X-CSRF-Token'] = token;\n      }\n  \n      return await this.viewModel.connectionStatus.fetch(url, options);\n    } catch (error) {\n      console.log(\"Error in _csrfAwareFetch\", typeof error, error);\n      if (error.message === 'Network request failed') {\n        return new Response(null, {\n          status: 503,\n          statusText: 'Service unavailable due to network error',\n        });\n      }\n      throw error;\n    }\n  }\n\n  async _loadModels() {\n    const cacheKey = `asset-link-cached-entity-models`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    if (cacheItem) {\n      // TODO: If cache item is stale, schedule background refresh\n      return cacheItem.value;\n    }\n\n    const models = await this._loadModelsFromServer();\n\n    const timestamp = currentEpochSecond();\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: models});\n\n    return models;\n  }\n\n  async _loadModelsFromServer() {\n    this.viewModel.bootText = \"Loading server schema\";\n    const serverSchema = await fetchJson(createDrupalUrl('/api/schema'));\n\n    const serverRelatedSchemas = serverSchema.allOf.flatMap(schemaRef => schemaRef.links || []);\n\n    const models = {};\n\n    await Promise.all(serverRelatedSchemas.map(async (serverRelatedSchema) => {\n      const relatedSchema = await fetchJson(serverRelatedSchema.targetSchema);\n\n      const relatedItemSchema = await fetchJson(relatedSchema.definitions.data.items.$ref);\n\n      const typeName = relatedItemSchema.definitions.type['const'];\n\n      models[typeName] = {\n        attributes: Object.fromEntries(\n            Object.entries(relatedItemSchema.definitions.attributes.properties)\n              .map(([attrName, attr]) => {\n                // Orbit.js seems to only support 'number', not 'integer' but handles the former well enough\n                if (attr.type === 'integer') {\n                  attr.type = 'number';\n                }\n\n                // https://www.drupal.org/project/jsonapi_schema/issues/3058850\n                if (attrName === 'third_party_settings') {\n                  attr.type = 'object';\n                }\n\n                return [attrName, attr];\n              })\n        ),\n        relationships: relatedItemSchema.definitions?.relationships?.properties || {},\n      };\n\n      this.viewModel.bootProgress = ((Object.keys(models).length / serverRelatedSchemas.length) * 100).toFixed(1);\n    }));\n\n    return models;\n  }\n\n}\n","export default function createDrupalUrl(pathSuffix) {\n  return new URL(pathSuffix, window.location.origin + window.assetLinkDrupalBasePath);\n}","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n"],"names":["DrupalJSONAPIURLBuilder","JSONAPIURLBuilder","constructor","settings","super","buildFilterParam","filterSpecifiers","filters","forEach","filterSpecifier","index","kind","op","attributeFilter","resourceAttribute","this","serializeAttributeAsParam","undefined","attribute","push","value","path","operator","relatedRecordFilter","Array","isArray","record","relation","map","e","id","join","QueryExpressionParseError","Error","relatedRecordsFilter","records","type","serializer","serializerFor","JSONAPISerializers","serialize","DrupalJSONAPISource","JSONAPISource","defaultFetchSettings","Object","assign","headers","Accept","serializerSettingsFor","buildSerializerSettingsFor","sharedSettings","inflectors","drupal","buildInflector","input","replace","settingsByType","serializationOptions","URLBuilderClass","findRecord","SyncQueryOperators","findRelatedRecord","findRecords","cache","expression","options","exp","results","getRecordsSync","filter","filterRecords","sort","sortRecords","page","paginateRecords","findRelatedRecords","relationship","relatedIds","getRelatedRecordsSync","length","getRecordSync","raiseNotFoundExceptions","RecordNotFoundException","i","l","applyFilter","attributeKey","split","actual","deepGet","expected","toLowerCase","startsWith","includes","endsWith","sortSpecifiers","comparisonValues","Map","set","sortSpecifier","comparisonOrders","sortExpression","order","record1","record2","values1","get","values2","isNone","paginationOptions","limit","offset","slice","AssetLinkUI","app","_app","c","VBtn","VListItem","VListItemTitle","dialog","confirm","async","$dialog","text","title","promptText","prompt","custom","component","params","uuidv4","context","Vue","result","Promise","resolve","$on","dialogs","componentFn","wrapper","h","VDialog","props","fullscreen","on","ref","d","AssetLinkUtil","formatRFC3339","createDrupalUrl","geohash","haversine","summarizeAssetNames","assets","a","attributes","name","FarmOSConnectionStatusDetector","fetcherDelegate","default","fetch","data","$_running","$_barrier","Barrier","hasNetworkConnection","window","navigator","onLine","canReachFarmOS","isLoggedIn","created","addEventListener","$data","release","connection","$_mainLoop","computed","isOnline","beforeDestroy","methods","url","opts","method","requestUrl","URL","location","origin","assetLinkDrupalBasePath","isFarmOSRequest","host","pathname","res","status","error","checkConnectionStatus","throttle","$_checkConnectionStatus","arrive","apiUrl","currentEpochSecond","credentials","apiData","json","farmOsVersion","meta","farm","version","userRef","links","me","href","sleep","millis","setTimeout","parseInt","Date","getTime","waiting","timeoutMillis","race","toBeReleased","splice","p","PeekableAsyncIterator","delegate","_delegate","_next_iteration_result","next","EventBus","_handlersByEventName","eventName","handler","hasOwn","arg","handlers","promises","all","then","HttpAccessDeniedException","message","AssetLinkPluginListsCore","assetLink","_store","_vm","lists","_eventBus","_pluginReferenceTracker","PluginReferenceTracker","_defaultPluginList","HttpPluginList","_localPluginList","LocalPluginList","_extraPluginLists","_extraPluginListStoreKey","vm","eventBus","extraPluginListUrls","_getExtraPluginListUrls","pluginListUrl","pluginList","pluginListView","load","_updatePluginListViewInViewModel","pluginUrl","addPlugin","removePlugin","_modifyAndWriteStoredExtraPluginListUrls","idx","findIndex","plUrl","pluginListIndex","pl","_url","unload","_removePluginListViewFromViewModel","find","reload","pluginListUrlsItem","getItem","u","mutatorFn","pluginListUrls","shouldWrite","setItem","key","timestamp","plVIndex","plV","sourceUrl","_pluginReferences","listUrl","console","log","toString","pluginExists","pluginReferences","listIdx","indexOf","$emit","JSON","stringify","store","pluginReferenceTracker","isDefault","_storeKey","_isDefault","_isLocal","_latestPluginListView","skipCache","postProcessPluginList","_getHttpPluginList","plugins","pRef","ackPluginReference","freePluginReference","removeItem","cacheItem","pluginListRes","statusText","ok","_getLocalPluginList","_modifyAndWriteStoredList","pluginIndex","pluginListItem","isLocal","pluginRef","AssetLinkPluginLoaderCore","_assetLink","startTime","performance","now","pluginInstance","pluginDataUrl","_fetchPlugin","pluginCls","import","pluginUrlWithoutParams","search","vuetify","vuetifyComponents","vuetifyDirectives","entries","entryName","entry","prototype","hasOwnProperty","call","directiveHook","rawPluginFileData","r","compiler","tags","Set","attrs","parseComponent","errors","template","src","compile","content","modules","postTransformNode","node","directives","add","tag","usedVuetifyTags","from","item","hyphenate","capitalize","camelize","kebabTag","camelTag","usedVuetifyDirectives","camelAttr","moduleCache","create","vue","compiledCache","str","addStyle","loadModule","components","t","registerPlugin","endTime","plugin","definedRoutes","definedSlots","definedWidgetDecorators","onLoad","handle","AssetLinkPluginHandle","pluginIdx","unloadPlugin","loadPlugin","searchParams","cacheKey","pluginSrcRes","pluginSrc","pluginSrcWithSourceInfo","encodeURIComponent","btoa","_pluginInstance","thisPlugin","defineRoute","routeName","routeDefiner","routeDef","routeHandle","missingFields","attr","expectedType","defineSlot","slotName","slotDefiner","slotDef","slotHandle","showIf","predicateFn","multiplexContext","contextMultiplexerFn","weight","weightFn","providedPredicateFn","providedWeightFn","defineWidgetDecorator","widgetDecoratorName","widgetDecoratorDefiner","widgetDecoratorDef","widgetDecoratorHandle","targetWidgetName","appliesIf","widgetName","camelizeRE","_","toUpperCase","charAt","hyphenateRE","fetchJson","args","response","AssetLink","_viewModel","booted","bootProgress","bootText","connectionStatus","pendingUpdates","messages","_booted","$once","localforage","storeName","_cores","pluginLists","pluginLoader","_memory","_remote","_ui","_util","viewModel","ui","util","cores","entitySource","remoteEntitySource","ready","addRoute","removeRoute","reloadPlugin","detail","boot","_models","_loadModels","Orbit","_csrfAwareFetch","bind","_schema","RecordSchema","models","bucket","IndexedDBBucket","namespace","MemorySource","schema","cacheSettings","queryOperators","DrupalSyncQueryOperators","timeout","requestQueueSettings","autoProcess","updateViewModelPendingUpdates","requestQueue","reified","_backup","IndexedDBSource","defaultTransformOptions","useBuffer","_coordinator","Coordinator","sources","_remoteQueryStrategy","RequestStrategy","source","target","action","blocking","addStrategy","SyncStrategy","allRecordsFromBackup","query","q","sync","addRecord","activate","update","operations","$watch","empty","process","deactivate","strategies","removeStrategy","_precache","typeName","matches","match","thisAsset","resolveAsset","lastPrecacheTimeKey","lastPrecacheTime","assetTypes","getAssetTypes","drupal_internal__id","assetType","listAssetTypes","assetRef","isRefNumeric","test","findAsset","flatMap","asset","searchAssets","searchRequest","searchPhase","assetSearchPlugins","searchResultCursors","searchResultCursor","coiterateSearchCursors","peekableSearchResultCursors","bestNextCursor","doneBestNextCursorIndex","thisCursor","thisCursorNextResult","peek","done","bestCursorNextResult","getSlots","getPluginDefinedComponents","getWidgetDecorators","componentDefKey","sortingFn","a1","a2","componentDefs","values","contexts","children","isUnsafeMethod","addCsrfHeader","tokenResponse","token","Response","_loadModelsFromServer","serverSchema","serverRelatedSchemas","allOf","schemaRef","relatedSchema","serverRelatedSchema","targetSchema","relatedItemSchema","definitions","items","$ref","fromEntries","properties","attrName","relationships","keys","toFixed","pathSuffix","Vuetify","register","registered","cached","updatefound","updated","offline"],"sourceRoot":""}