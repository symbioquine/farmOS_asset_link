{"version":3,"file":"js/chunk-common-legacy.js","mappings":"2kBASqBA,EAAAA,SAAAA,I,6BAEnB,WAAYC,GAAU,kCACdA,G,+CAGR,SAAiBC,GAAkB,WAC3BC,EAAU,GA4DhB,OA1DAD,EAAiBE,SAAQ,SAACC,EAAiBC,GACzC,GAC2B,cAAzBD,EAAgBE,MACO,UAAvBF,EAAgBG,GAChB,CACA,IAAMC,EAAkBJ,EAGlBK,EAAoB,EAAKC,+BAC7BC,EACAH,EAAgBI,WAElBV,EAAQW,MAAR,UAAgBJ,EAAoBD,EAAgBM,aAC/C,GAA6B,cAAzBV,EAAgBE,KAAsB,CAC/C,IAAME,EAAkBJ,EAClBK,EAAoB,EAAKC,+BAC7BC,EACAH,EAAgBI,WAElBV,EAAQW,MAAR,UACG,UAAYJ,EAAoB,IAAMJ,EAAQ,CAC7CU,KAAMN,EACNO,SAAUR,EAAgBD,GAC1BO,MAAON,EAAgBM,cAGtB,GAA6B,kBAAzBV,EAAgBE,KAA0B,CACnD,IAOO,EAPDW,EAAsBb,EAC5B,GAAIc,MAAMC,QAAQF,EAAoBG,QACpClB,EAAQW,MAAR,UACGI,EAAoBI,SAAWJ,EAAoBG,OACjDE,KAAI,SAACC,GAAD,OAAOA,EAAEC,MACbC,KAAK,YAGVvB,EAAQW,MAAR,UACGI,EAAoBI,SADvB,OACkCJ,QADlC,IACkCA,GADlC,UACkCA,EAAqBG,cADvD,aACkC,EAA6BI,SAG5D,IAA6B,mBAAzBpB,EAAgBE,KAazB,MAAM,IAAIoB,EAAAA,GAAJ,2BACgBtB,EAAgBG,GADhC,uCAZN,GAA2B,UAAvBH,EAAgBG,GAClB,MAAM,IAAIoB,MAAJ,qBACUvB,EAAgBG,GAD1B,+DAIR,IAAMqB,EAAuBxB,EAC7BF,EAAQW,MAAR,UACGe,EAAqBP,SAAWO,EAAqBC,QACnDP,KAAI,SAACC,GAAD,OAAOA,EAAEC,MACbC,KAAK,WASPvB,I,uCAGT,SAA0B4B,EAAMlB,GAC5B,GAAImB,KAAKC,WACP,OAAOD,KAAKC,WAAWvB,kBAAkBqB,EAAMlB,GAE/C,IAAMoB,EAAaD,KAAKE,cAAcC,EAAAA,GAAAA,oBACtC,OAAOF,EAAWG,UAAUvB,EAAW,CAAEkB,KAAAA,Q,EA3E5B/B,CAAgCqC,EAAAA,ICChCC,EAAAA,SAAAA,I,6BACnB,WAAYrC,IAAU,eACpB,IAAMsC,EAAuBC,OAAOC,OAAO,GAAIxC,EAASsC,sBAAwB,GAAI,CAClFG,QAAQ,CACNC,OAAQ,2BACR,eAAgB,8BAJA,mBAQdH,OAAOC,OAAO,GAAIxC,EAAU,CAChCsC,qBAAAA,EACAK,uBAAuBC,EAAAA,EAAAA,IAA2B,CAChDC,eAAgB,CACdC,WAAY,CACVC,QAAQC,EAAAA,EAAAA,IACN,IACA,SAACC,GAAD,OAAWA,EAAMC,QAAQ,KAAM,UAIrCC,gBAAgB,UACbjB,EAAAA,GAAAA,iBAAsC,CACrCkB,qBAAsB,CAACN,WAAY,CAAC,eAI1CO,gBAAiBtD,K,iBA1BFsC,CAA4BiB,EAAAA,I,uECJjD,GACEC,WAAYC,EAAAA,GAAAA,WACZC,kBAAmBD,EAAAA,GAAAA,kBAEnBE,YAJa,SAKTC,EACAC,EAEAC,GAEA,IAAIC,EAAMF,EACNG,EAAUJ,EAAMK,eAAeF,EAAIjC,SAAWiC,EAAIhC,MAUtD,OATIgC,EAAIG,SACNF,EAAUG,EAAcH,EAASD,EAAIG,SAEnCH,EAAIK,OACNJ,EAAUK,EAAYL,EAASD,EAAIK,OAEjCL,EAAIO,OACNN,EAAUO,EAAgBP,EAASD,EAAIO,OAElCN,GAGXQ,mBAxBa,SAyBTZ,EACAC,EACAC,GAEA,IAAMC,EAAMF,EACJxC,EAAyB0C,EAAzB1C,OAAQoD,EAAiBV,EAAjBU,aACVC,EAAad,EAAMe,sBAAsBtD,EAAQoD,GACvD,IAAKC,GAAoC,IAAtBA,EAAWE,OAAc,CAC1C,IAAKhB,EAAMiB,cAAcxD,GAAS,CAChC,UAAIyC,QAAJ,IAAIA,GAAAA,EAASgB,wBACX,MAAM,IAAIC,EAAAA,GAAwB1D,EAAOU,KAAMV,EAAOI,IAEtD,OAIJ,MAAO,GAET,IAAIuC,EAAUJ,EAAMK,eAAeS,GAWnC,OATIX,EAAIG,SACNF,EAAUG,EAAcH,EAASD,EAAIG,SAEnCH,EAAIK,OACNJ,EAAUK,EAAYL,EAASD,EAAIK,OAEjCL,EAAIO,OACNN,EAAUO,EAAgBP,EAASD,EAAIO,OAElCN,IAIb,SAASG,EAAcrC,EAAS3B,GAC9B,OAAO2B,EAAQoC,QAAO,SAAC7C,GACrB,IAAK,IAAI2D,EAAI,EAAGC,EAAI9E,EAAQyE,OAAQI,EAAIC,EAAGD,IACzC,IAAKE,EAAY7D,EAAQlB,EAAQ6E,IAC/B,OAAO,EAGX,OAAO,KAIX,SAASE,EAAY7D,EAAQ6C,GAE3B,GAAoB,cAAhBA,EAAO3D,KAAsB,CAC/B,IAAI4E,EAAejB,EAAOrD,UAAUuE,MAAM,KAEtCC,GAASC,EAAAA,EAAAA,IAAQjE,EAAD,CAAU,cAAV,eAA2B8D,KAE3CI,EAAWrB,EAAOnD,MAGtB,OAAQmD,EAAO1D,IACb,IAAK,QACL,IAAK,IACH,MAAsB,kBAAX6E,EACFA,EAAOG,gBAAkBD,EAASC,cAEpCH,IAAWE,EACpB,IAAK,KACH,MAAsB,kBAAXF,EACFA,EAAOG,gBAAkBD,EAASC,cAEpCH,IAAWE,EACpB,IAAK,IACH,OAAOF,EAASE,EAClB,IAAK,KACH,OAAOF,GAAUE,EACnB,IAAK,IACH,OAAOF,EAASE,EAClB,IAAK,KACH,OAAOF,GAAUE,EACnB,IAAK,cACH,MAAyB,kBAAXF,GAAuBA,EAAOG,cAAcC,WAAWF,EAASC,eAChF,IAAK,WACH,MAAyB,kBAAXH,GAAuBA,EAAOG,cAAcE,SAASH,EAASC,eAC9E,IAAK,YACH,MAAyB,kBAAXH,GAAuBA,EAAOG,cAAcG,SAASJ,EAASC,eAC9E,IAAK,KACL,IAAK,SACL,IAAK,UACL,IAAK,cACH,MAAM,IAAI7D,EAAAA,GAAJ,2BAAkDuC,EAAO1D,GAAzD,uCACR,IAAK,UACH,YAAkBI,IAAXyE,GAAmC,OAAXA,EACjC,IAAK,cACH,YAAkBzE,IAAXyE,GAAmC,OAAXA,EACjC,QACE,MAAM,IAAI1D,EAAAA,GAAJ,2BAAkDuC,EAAO1D,GAAzD,gCAGZ,OAAOiD,EAAAA,GAAAA,YAA+BpC,EAAQ6C,GAGhD,SAASG,EACLvC,EACA8D,GAEF,IAAMC,EAAmB,IAAIC,IAE7BhE,EAAQ1B,SAAQ,SAACiB,GACfwE,EAAiBE,IACf1E,EACAuE,EAAerE,KAAI,SAACyE,GAClB,GAA2B,cAAvBA,EAAczF,KAAsB,CACtC,IAAI4E,EAAea,EAAcnF,UAAUuE,MAAM,KAEjD,OAAOE,EAAAA,EAAAA,IAAQjE,EAAD,CACZ,cADY,eAET8D,KAGL,MAAM,IAAIxD,EAAAA,GACR,yEAOV,IAAMsE,EAAmBL,EAAerE,KAAI,SAAC2E,GAAD,MACjB,eAAzBA,EAAeC,OAA0B,EAAI,KAG/C,OAAOrE,EAAQsC,MAAK,SAACgC,EAASC,GAG5B,IAFA,IAAMC,EAAUT,EAAiBU,IAAIH,GAC/BI,EAAUX,EAAiBU,IAAIF,GAC5BrB,EAAI,EAAGA,EAAIY,EAAehB,OAAQI,IAAK,CAC9C,GAAIsB,EAAQtB,GAAKwB,EAAQxB,GACvB,OAAQiB,EAAiBjB,GACpB,GAAIsB,EAAQtB,GAAKwB,EAAQxB,GAC9B,OAAOiB,EAAiBjB,GACnB,IAAIyB,EAAAA,EAAAA,IAAOH,EAAQtB,OAAQyB,EAAAA,EAAAA,IAAOD,EAAQxB,IAC/C,OAAOiB,EAAiBjB,GACnB,IAAIyB,EAAAA,EAAAA,IAAOD,EAAQxB,OAAQyB,EAAAA,EAAAA,IAAOH,EAAQtB,IAC/C,OAAQiB,EAAiBjB,GAG7B,OAAO,KAIX,SAAST,EACPzC,EACA4E,GAEA,QAAgC9F,IAA5B8F,EAAkBC,MAAqB,CACzC,IAAIC,OAC2BhG,IAA7B8F,EAAkBE,OAAuB,EAAIF,EAAkBE,OAC7DD,EAAQD,EAAkBC,MAE9B,OAAO7E,EAAQ+E,MAAMD,EAAQA,EAASD,GAEtC,MAAM,IAAIhF,EAAAA,GACR,qF,sGClLemF,EAAAA,WAEnB,WAAYC,IAAK,eACf/E,KAAKgF,KAAOD,E,8BASd,WACE,MAAO,CACLE,KAAAA,EAAAA,EACAC,UAAAA,EAAAA,EACAC,eAAAA,EAAAA,M,kBAOJ,WAAa,WACX,MAAO,CACLC,QAAS,WAAF,uCAAE,WAAOC,GAAP,iGACM,EAAKL,KAAKM,QAAQF,QAAQ,CACrCC,KAAAA,EACAE,MAAO,iBAHF,mFAAF,sDAAE,GAMTC,WAAY,WAAF,uCAAE,WAAOH,GAAP,iGACG,EAAKL,KAAKM,QAAQG,OAAO,CACpCJ,KAAAA,EACAE,MAAO,UAHC,mFAAF,sDAAE,GAMZG,OAAQ,WAAF,uCAAE,WAAOC,EAAWC,GAAlB,kGACAnG,GAAKoG,EAAAA,EAAAA,KAELC,EAAU,IAAIC,EAAAA,EAAI,IAHlB,SAKe,IAAIC,SAAQ,SAAAC,GAC/BH,EAAQI,IAAI,SAAUD,GAEtB,EAAKlB,IAAIoB,QAAQrH,KAAK,CACpBW,GAAAA,EACAqG,QAAAA,EACAM,YAAa,SAACC,EAASC,GAAV,OACXA,EAAEC,EAAAA,EAAS,CACTC,MAAO,CAAEzH,OAAO,EAAM0H,YAAY,GAClCC,GAAI,CACFxF,MAAO,kBAAM+E,OAAQrH,MAErB,CAAC0H,EAAEX,GAAD,QAAagB,IAAK,mBAAsBf,YAjB9C,cAKAgB,EALA,OAqBN,EAAK7B,IAAIoB,QAAU,EAAKnB,KAAKmB,QAAQjE,QAAO,SAAA2E,GAAC,OAAIA,EAAEpH,KAAOA,KArBpD,kBAuBCmH,GAvBD,2CAAF,wDAAE,Q,EArCO9B,G,yDCJAgC,EAAAA,W,uEAKnB,WACE,OAAOC,EAAAA,I,2BAMT,WACE,OAAOC,EAAAA,I,mBAMT,WACE,OAAOC,M,qBAMT,WACE,OAAOC,Q,EA3BUJ,G,mBCQfK,EAAiCpB,EAAAA,EAAAA,OAAW,CAEhDS,MAAO,CACLY,gBAAiB,CACfrH,KAAMS,OACN6G,QAAS,WACP,MAAO,CAAEC,MAAOA,QAKtBC,KAXgD,WAY9C,MAAO,CACLC,WAAW,EACXC,UAAW,IAAIC,GAEfC,qBAAsBC,OAAOC,UAAUC,OACvCC,oBAAgBnJ,EAChBoJ,gBAAYpJ,IAIhBqJ,QAtBgD,WAsBtC,WACRL,OAAOM,iBAAiB,WAAW,WACjC,EAAKP,sBAAuB,EAC5B,EAAKI,gBAAiB,KAExBH,OAAOM,iBAAiB,UAAU,WAChC,EAAKP,sBAAuB,EAC5B,EAAKQ,MAAMV,UAAUW,aAEnBR,OAAOC,WAAaD,OAAOC,UAAUQ,YACvCT,OAAOC,UAAUQ,WAAWH,iBAAiB,UAAU,kBAAM,EAAKC,MAAMV,UAAUW,aAEpFpI,KAAKsI,cAGPC,SAAU,CACRC,SADQ,WAEN,OAAOxI,KAAK+H,gBAAkB/H,KAAKgI,aAIvCS,cA3CgD,WA4C9CzI,KAAKmI,MAAMX,WAAY,EACvBxH,KAAKmI,MAAMV,UAAUW,WAGvBM,QAAS,CAMDpB,MANC,SAMKqB,EAAKC,GAAM,mKACf9G,EAAU8G,GAAQ,GAEnB9G,EAAQ+G,SAAQ/G,EAAQ+G,OAAS,OAEhCC,EAAa,IAAIC,IAAIJ,EAAKf,OAAOoB,SAASC,OAASrB,OAAOsB,yBAE1DC,EAAkBL,EAAWM,OAASxB,OAAOoB,SAASI,MAAQN,EAAWO,SAAS5F,WAAWmE,OAAOsB,yBAPrF,kBAUD,EAAK9B,gBAAgBE,MAAMqB,EAAK7G,GAV/B,cAUbwH,EAVa,OAWfH,GAAkC,MAAfG,EAAIC,QACzB,EAAKpB,MAAMV,UAAUW,UAZJ,kBAcZkB,GAdY,2CAgBfH,GACF,EAAKhB,MAAMV,UAAUW,UAjBJ,kEAuBjBE,WA7BC,WA6BY,sJACjB,EAAKH,MAAMX,WAAY,EAEjBgC,EAAwBC,GAAAA,EAAS,kBAAM,EAAKC,4BAA2B,KAH5D,WAKV,EAAKvB,MAAMX,UALD,wBAMfmC,QAAQC,IAAI,wBANG,SAOTJ,IAPS,uBAQT,EAAKrB,MAAMV,UAAUoC,OAAO,KARnB,qEAYbH,wBAzCC,WAyCyB,2KAE9BC,QAAQC,IAAI,sCAEP,EAAKjC,qBAJoB,wDAQxBmC,GAAS9C,EAAAA,EAAAA,GAAgB,iBAAD,OAAkB+C,OARlB,kBAWVzC,GAAAA,CAAMwC,EAAQ,CAACE,YAAa,cAAepI,MAAO,aAXxC,UAWtB0H,EAXsB,OAaT,MAAfA,EAAIC,OAboB,wBAc1B,EAAKxB,gBAAiB,EAdI,4CAkBNuB,EAAIW,OAlBE,WAkBtBC,EAlBsB,OAoBtBC,EApBsB,UAoBND,EAAQE,YApBF,iBAoBN,EAAcC,YApBR,aAoBN,EAAoBC,QAEpB,QAAlBH,EAtBwB,wBAuB1B,EAAKpC,gBAAiB,EAvBI,2BA2B5B,EAAKA,gBAAiB,EAEhBwC,EA7BsB,UA6BZL,EAAQE,YA7BI,iBA6BZ,EAAcI,aA7BF,iBA6BZ,EAAqBC,UA7BT,aA6BZ,EAAyBC,KAEzCf,QAAQC,IAAI,UAAWM,GAEvB,EAAKlC,gBAAyBpJ,IAAZ2L,EAjCU,qDAmC5B,EAAKxC,gBAAiB,EAnCM,gEA0CpC,SAAS4C,GAAMC,GACb,OAAO,IAAI5E,SAAQ,SAAAC,GAAO,OAAI4E,WAAW5E,EAAS2E,MAGpD,SAASb,KACP,OAAOe,UAAS,IAAIC,MAAOC,UAAY,K,IAGnCtD,GAAAA,WACJ,cAAc,eACZ1H,KAAKiL,QAAU,G,qCAGjB,SAAOC,GAAe,WACpB,OAAOlF,QAAQmF,KAAK,CAClBR,GAAMO,GACN,IAAIlF,SAAQ,SAAAC,GAAO,OAAI,EAAKgF,QAAQnM,KAAKmH,U,qBAI7C,WACE,IAAMmF,EAAepL,KAAKiL,QAAQI,OAAO,GACzCD,EAAahN,SAAQ,SAAAkN,GAAC,OAAIA,W,EAdxB5D,GAkBN,KC1KqB6D,GAAAA,WACnB,WAAYC,IAAU,eACpBxL,KAAKyL,UAAYD,EACjBxL,KAAK0L,4BAAyB9M,E,qFAGhC,4GACsCA,IAAhCoB,KAAK0L,uBADX,uBAEUC,EAAO3L,KAAK0L,uBAClB1L,KAAK0L,4BAAyB9M,EAHlC,kBAIW+M,GAJX,uBAMe3L,KAAKyL,UAAUE,OAN9B,wF,6HASA,sGACsC/M,IAAhCoB,KAAK0L,uBADX,gCAEwC1L,KAAKyL,UAAUE,OAFvD,OAEI3L,KAAK0L,uBAFT,uCAIS1L,KAAK0L,wBAJd,gD,6DAfmBH,G,wBCAN,SAASxB,KACtB,OAAOe,UAAS,IAAIC,MAAOC,UAAY,K,ICEpBY,GAAAA,WAEnB,cAAc,eACZ5L,KAAK6L,qBAAuB,G,kCAG9B,SAAIC,EAAWC,GACRvL,OAAOwL,OAAOhM,KAAK6L,qBAAsBC,KAC5C9L,KAAK6L,qBAAqBC,GAAa,IAGzC9L,KAAK6L,qBAAqBC,GAAWhN,KAAKiN,K,qEAG5C,WAAYD,EAAWG,GAAvB,gGACQC,EAAWlM,KAAK6L,qBAAqBC,IAAc,GAEnDK,EAAWD,EAAS3M,KAAI,SAAA+G,GAAC,OAAIA,EAAE2F,MAHvC,kBAKSjG,QAAQoG,IAAID,GAAUE,MAAK,kBAAM,MAL1C,gD,gEAdmBT,G,WCHAU,GAAAA,SAAAA,I,6BACnB,WAAYC,EAASzK,GAAS,kCACtByK,EAASzK,G,iBAFEwK,E,QAAkC1M,QCOlC4M,GAAAA,WAEnB,WAAYC,IAAW,eACrBzM,KAAK0M,OAASD,EAAUC,OAExB1M,KAAK2M,IAAM,IAAI5G,EAAAA,EAAI,CACjBwB,KAAM,CACJqF,MAAO,MAIX5M,KAAK6M,UAAY,IAAIjB,GAErB5L,KAAK8M,wBAA0B,IAAIC,GAAuB/M,KAAK6M,WAE/D7M,KAAKgN,mBAAqB,IAAIC,GAC1BR,EAAUC,QACV1F,EAAAA,EAAAA,GAAgB,4CAChBhH,KAAK8M,yBACL,GAEJ9M,KAAKkN,iBAAmB,IAAIC,GACxBV,EAAUC,OACV1M,KAAK8M,yBAET9M,KAAKoN,kBAAoB,GAEzBpN,KAAKqN,yBAA2B,gC,+BAOlC,WACE,OAAOrN,KAAK2M,M,oBAMd,WACE,OAAO3M,KAAK6M,Y,oEAGd,mIACoC7M,KAAKsN,0BADzC,OACQC,EADR,OAGEvN,KAAKoN,kBAAoBG,EAAoBhO,KAAI,SAAAiO,GAAa,OAC5D,IAAIP,GAAe,EAAKP,OAAQc,EAAe,EAAKV,yBAAyB,MAJjF,OAOQ9M,KAAKgN,mBACLhN,KAAKkN,kBARb,eASWlN,KAAKoN,oBAThB,gDAMWK,EANX,cAYiCA,EAAWC,OAZ5C,OAYUC,EAZV,OAcI3N,KAAK4N,iCAAiCD,GAd1C,4E,6IAkBA,WAA2BE,GAA3B,uGAC+B7N,KAAKkN,iBAAiBY,UAAUD,GAD/D,OACQF,EADR,OAGE3N,KAAK4N,iCAAiCD,GAHxC,gD,mJAMA,WAAgCE,GAAhC,uGAC+B7N,KAAKkN,iBAAiBa,aAAaF,GADlE,OACQF,EADR,OAGE3N,KAAK4N,iCAAiCD,GAHxC,gD,4IAMA,WAAyBH,GAAzB,8FACExN,KAAKgO,0CAAyC,SAAAT,GAC5C,IAAMU,EAAMV,EAAoBW,WAAU,SAAAC,GAAK,OAAIA,IAAUX,KAC7D,GAAIS,GAAO,EACT,OAAO,EAETV,EAAoBzO,KAAK0O,MAGrBY,EAAkBpO,KAAKoN,kBAAkBc,WAAU,SAAAG,GAAE,OAAIA,EAAGC,OAASd,OAEvEY,GAAmB,GAXzB,wDAeQX,EAAa,IAAIR,GAAejN,KAAK0M,OAAQc,EAAexN,KAAK8M,yBAAyB,GAEhG9M,KAAKoN,kBAAkBtO,KAAK2O,GAjB9B,SAmB+BA,EAAWC,OAnB1C,OAmBQC,EAnBR,OAqBE3N,KAAK4N,iCAAiCD,GArBxC,iD,+IAwBA,WAA4BH,GAA5B,4FACExN,KAAKgO,0CAAyC,SAAAT,GAC5C,IAAMU,EAAMV,EAAoBW,WAAU,SAAAC,GAAK,OAAIA,IAAUX,KAC7D,GAAIS,EAAM,EACR,OAAO,EAETV,EAAoBlC,OAAO4C,EAAK,MAG5BG,EAAkBpO,KAAKoN,kBAAkBc,WAAU,SAAAG,GAAE,OAAIA,EAAGC,OAASd,OAEvEY,EAAkB,GAXxB,wDAeQX,EAAazN,KAAKoN,kBAAkB/B,OAAO+C,EAAiB,GAAG,GAfvE,SAiBQX,EAAWc,SAjBnB,OAmBEvO,KAAKwO,mCAAmChB,GAnB1C,gD,0IAsBA,WAAuBA,GAAvB,4FACQC,EAAa,CACjBzN,KAAKgN,mBACLhN,KAAKkN,kBAFY,eAGdlN,KAAKoN,oBACRqB,MAAK,SAAAJ,GAAE,OAAIA,EAAGC,OAASd,KAEpBC,EAPP,iEAW+BA,EAAWiB,SAX1C,OAWQf,EAXR,OAaE3N,KAAK4N,iCAAiCD,GAbxC,gD,iJAgBA,oHACmC3N,KAAK0M,OAAOiC,QAAQ3O,KAAKqN,0BAD5D,UACQuB,EADR,QAGMA,EAHN,yCAIWA,EAAmB7P,MAAMQ,KAAI,SAAAsP,GAAC,OAAI,IAAI9F,IAAI8F,OAJrD,gCAOS,IAPT,gD,iKAUA,WAA+CC,GAA/C,yGAC+B9O,KAAKsN,0BADpC,UACQyB,EADR,OAEQC,GAA4C,IAA9BF,EAAUC,IAC1BC,EAHN,gCAIUhP,KAAK0M,OAAOuC,QAAQjP,KAAKqN,yBAA0B,CAAC6B,IAAKlP,KAAKqN,yBAA0B8B,UAAWpF,KAAsBhL,MAAOgQ,IAJ1I,gCAMSA,GANT,gD,wGASA,SAAiCpB,GAC/B,IAAMyB,EAAKpP,KAAKoP,GAEVC,EAAWD,EAAGxC,MAAMsB,WAAU,SAAAoB,GAAG,OAAIA,EAAIC,YAAc5B,EAAe4B,aAExEF,GAAY,EACdD,EAAGxC,MAAMvB,OAAOgE,EAAU,EAAG1B,GAE7ByB,EAAGxC,MAAM9N,KAAK6O,K,gDAIlB,SAAmCH,GACjC,IAAM4B,EAAKpP,KAAKoP,GAEVC,EAAWD,EAAGxC,MAAMsB,WAAU,SAAAoB,GAAG,OAAIA,EAAIC,YAAc/B,KAEzD6B,GAAY,GACdD,EAAGxC,MAAMvB,OAAOgE,EAAU,O,EA9KX7C,GAoLfO,GAAAA,WACJ,WAAYyC,IAAU,eACpBxP,KAAK6M,UAAY2C,EAKjBxP,KAAKyP,kBAAoB,G,mGAM3B,WAAyB5B,EAAW6B,GAApC,8FACE/F,QAAQC,IAAI,qBAAsBiE,EAAU8B,WAAYD,EAAQC,YAE1DC,EAAepP,OAAOwL,OAAOhM,KAAKyP,kBAAmB5B,EAAU8B,YAEhEC,IACH5P,KAAKyP,kBAAkB5B,EAAU8B,YAAc,IAG3CE,EAAmB7P,KAAKyP,kBAAkB5B,EAAU8B,YAEpDG,EAAUD,EAAiBE,QAAQL,EAAQC,YAE7CG,EAAU,GACZD,EAAiB/Q,KAAK4Q,GAGnBE,EAjBP,gCAkBU5P,KAAK6M,UAAUmD,MAAM,aAAcnC,GAlB7C,gD,+IAuBA,WAA0BA,EAAW6B,GAArC,4FACQG,EAAmB7P,KAAKyP,kBAAkB5B,EAAU8B,YAErDE,EAHP,uBAIIlG,QAAQC,IAAI,yFAA0FiE,EAAU8B,WAAYD,EAAQC,WAAYM,KAAKC,UAAUlQ,KAAKyP,oBAJxK,6BAQQK,EAAUD,EAAiBE,QAAQL,EAAQC,YAE7CG,GAAW,EACbD,EAAiBxE,OAAOyE,EAAS,GAEjCnG,QAAQC,IAAI,2EAA4EiE,EAAU8B,WAAYD,EAAQC,WAAYM,KAAKC,UAAUL,MAG/IA,EAAiBjN,OAAS,GAhBhC,kEAoBQ5C,KAAK6M,UAAUmD,MAAM,gBAAiBnC,GApB9C,iD,gEApCId,GA4DAE,GAAAA,WACJ,WAAYkD,EAAOxH,EAAKyH,EAAwBC,IAAW,eACzDrQ,KAAK0M,OAASyD,EACdnQ,KAAKsQ,UAAL,wCAAkD3H,GAClD3I,KAAKsO,KAAO3F,EACZ3I,KAAK8M,wBAA0BsD,EAC/BpQ,KAAKuQ,WAAaF,EAElBrQ,KAAKwQ,2BAAwB5R,E,qFAG/B,WAAW6R,GAAX,wGAC+BC,GAD/B,SAC2D1Q,KAAK2Q,mBAAmBF,GADnF,+BACsGzQ,KAAKsO,KAAzGtO,KAAKwQ,uBADP,cAC+F,EAD/F,eAGQxK,QAAQoG,IAAIpM,KAAKwQ,sBAAsBI,QAAQrR,KAAI,SAAAsR,GAAI,OAAI,EAAK/D,wBAAwBgE,mBAAmBD,EAAKlI,IAAK,EAAK2F,UAHlI,gCAKStO,KAAKwQ,uBALd,gD,gIAQA,4GACOxQ,KAAKwQ,sBADZ,iEAKQxK,QAAQoG,IAAIpM,KAAKwQ,sBAAsBI,QAAQrR,KAAI,SAAAsR,GAAI,OAAI,EAAK/D,wBAAwBiE,oBAAoBF,EAAKlI,IAAK,EAAK2F,UALnI,uBAOQtO,KAAK0M,OAAOsE,WAAWhR,KAAKsQ,WAPpC,gD,+HAUA,8GACetQ,KAAK0N,MAAK,GADzB,wF,2IAIA,WAAyB+C,GAAzB,iGACoBA,EADpB,0BACgC7R,EADhC,sCACkDoB,KAAK0M,OAAOiC,QAAQ3O,KAAKsQ,WAD3E,6BACQW,EADR,KAGQ9B,EAAYpF,OAEdkH,GAAc9B,EAAY8B,EAAU9B,UAAa,KALvD,0CAMW8B,EAAUlS,OANrB,yBAS8BuI,MAAMtH,KAAKsO,MATzC,WASQ4C,EATR,OAWEvH,QAAQC,IAAIsH,GACiB,MAAzBA,EAAc3H,OAZpB,uBAaU,IAAI+C,GAAJ,qBAA4C4E,EAAc3H,OAA1D,aAAqE2H,EAAcC,aAb7F,WAccD,EAAcE,GAd5B,uBAeU,IAAIxR,MAAJ,qBAAwBsR,EAAc3H,OAAtC,aAAiD2H,EAAcC,aAfzE,yBAkB2BD,EAAcjH,OAlBzC,eAkBQwD,EAlBR,iBAoBQzN,KAAK0M,OAAOuC,QAAQjP,KAAKsQ,UAAW,CAACpB,IAAKlP,KAAKsQ,UAAWnB,UAAAA,EAAWpQ,MAAO0O,IApBpF,iCAsBSA,GAtBT,iD,8DAjCIR,GA4DAE,GAAAA,WACJ,WAAYgD,EAAOC,IAAwB,eACzCpQ,KAAK0M,OAASyD,EACdnQ,KAAKsQ,UAAY,8BACjBtQ,KAAKsO,KAAO,IAAIvF,IAAI,0DAA2DnB,OAAOoB,SAASC,QAC/FjJ,KAAK8M,wBAA0BsD,E,qFAGjC,uHACyBM,GADzB,SACqD1Q,KAAKqR,sBAD1D,+BACwFrR,KAAKsO,KAArFX,GADR,cACiF,EADjF,eAGQ3H,QAAQoG,IAAIuB,EAAeiD,QAAQrR,KAAI,SAAAsR,GAAI,OAAI,EAAK/D,wBAAwBgE,mBAAmBD,EAAKlI,IAAK,EAAK2F,UAHtH,gCAKSX,GALT,gD,+HAQA,8GACe3N,KAAK0N,OADpB,wF,kIAIA,WAAgBG,GAAhB,uGAC2B7N,KAAKsR,2BAA0B,SAAAjD,GACtD,GAAIA,EAAGuC,QAAQnC,MAAK,SAAAoC,GAAI,OAAIA,EAAKlI,MAAQkF,EAAU8B,cACjD,OAAO,EAETtB,EAAGuC,QAAQ9R,KAAK,CAAE6J,IAAKkF,EAAU8B,gBALrC,cACQlC,EADR,gBAQQzN,KAAK8M,wBAAwBgE,mBAAmBjD,EAAW7N,KAAKsO,MARxE,gCAUSoC,GAAsBjD,GAAY,EAAOzN,KAAKsO,OAVvD,gD,sIAaA,WAAmBT,GAAnB,uGAC2B7N,KAAKsR,2BAA0B,SAAAjD,GACtD,IAAMkD,EAAclD,EAAGuC,QAAQ1C,WAAU,SAAA2C,GAAI,OAAIA,EAAKlI,MAAQkF,EAAU8B,cAExE,GAAI4B,EAAc,EAChB,OAAO,EAGTlD,EAAGuC,QAAQvF,OAAOkG,EAAa,MARnC,cACQ9D,EADR,gBAWQzN,KAAK8M,wBAAwBiE,oBAAoBlD,EAAW7N,KAAKsO,MAXzE,gCAaSoC,GAAsBjD,GAAY,EAAOzN,KAAKsO,OAbvD,gD,6IAgBA,oHAC+BtO,KAAK0M,OAAOiC,QAAQ3O,KAAKsQ,WADxD,UACQkB,EADR,OAGOA,EAHP,yCAIW,CAAEZ,QAAS,KAJtB,gCAOSY,EAAezS,OAPxB,gD,kJAUA,WAAgC+P,GAAhC,yGAC2B9O,KAAKqR,sBADhC,UACQ5D,EADR,OAEQuB,GAAwC,IAA1BF,EAAUrB,IAC1BuB,EAHN,gCAIUhP,KAAK0M,OAAOuC,QAAQjP,KAAKsQ,UAAW,CAACpB,IAAKlP,KAAKsQ,UAAWnB,UAAWpF,KAAsBhL,MAAO0O,IAJ5G,gCAMSA,GANT,gD,8DA3DIN,GAqEAuD,GAAwB,SAACjD,EAAY4C,EAAWd,GAsBpD,OArBA9B,EAAW4C,UAAYA,EACvB5C,EAAW8B,UAAYA,EAElB9B,EAAWgE,QACdhE,EAAWgE,WAAQ7S,GAGhB6O,EAAWmD,UACdnD,EAAWmD,QAAU,IAGvBnD,EAAWmD,QAAUnD,EAAWmD,QAAQrR,KAAI,SAAAmS,GAG1C,IAAM7D,EAAY,IAAI9E,IAAI2I,EAAU/I,IAAKf,OAAOoB,SAASC,QAEzD,MAAO,CACLN,IAAKkF,MAIFJ,G,4DCxYYkE,GAAAA,WAEnB,WAAYlF,IAAW,eACrBzM,KAAK4R,WAAanF,EAClBzM,KAAK0M,OAASD,EAAUC,OAExB1M,KAAK2M,IAAM,IAAI5G,EAAAA,EAAI,CACjBwB,KAAM,CACJqJ,QAAS,M,+BASf,WACE,OAAO5Q,KAAK2M,M,oEAGd,kI,mIAIA,WAAiBkB,GAAjB,8HACQgE,EAAYC,YAAYC,MAE1BC,OAAiBpT,EAHvB,kBAM8BoB,KAAKiS,aAAapE,GANhD,UAMQqE,EANR,QAQQrE,EAAUxE,SAAS1F,SAAS,YARpC,iCAS+BwO,OAAiCD,GAThE,OASYE,EATZ,OASgF/K,QAC1E2K,EAAiB,IAAII,EAV3B,4BAWevE,EAAUxE,SAAS1F,SAAS,aAX3C,wBAYY0O,EAAyB,IAAItJ,IAAI8E,EAAU8B,YACjD0C,EAAuBC,OAAS,GAbtC,UAe4B,8BAf5B,eAeYC,EAfZ,OAiBYC,EAAoB,GACpBC,EAAoB,GAE1BjS,OAAOkS,QAAQH,GAASnU,SAAQ,YAAwB,mBAAtBuU,EAAsB,KAAXC,EAAW,KAClDpS,OAAOqS,UAAUC,eAAeC,KAAKH,EAAO,aAC9CJ,EAAkBG,GAAaC,EACtB,CAAC,OAAQ,WAAY,SAAU,mBAAoB,UAAUnE,MAAK,SAAAuE,GAAa,OAAIxS,OAAOqS,UAAUC,eAAeC,KAAKH,EAAOI,QACxIP,EAAkBE,GAAaC,MAxBzC,UA4BoCtL,MAAM4K,GAAe7F,MAAK,SAAA4G,GAAC,OAAIA,EAAE5N,UA5BrE,eA4BU6N,EA5BV,iBAgC6B,kCAhC7B,WAgCYC,EAhCZ,OAkCYC,EAAO,IAAIC,IACXC,EAAQ,IAAID,IACZ1N,EAAYwN,EAASI,eAAeL,IACtCvN,EAAU6N,SArCpB,qBAsCY7N,EAAU6N,SAASC,IAtC/B,uBAuCgB,IAAI7T,MAAJ,yDAvChB,QAyCQuT,EAASO,QAAQ/N,EAAU6N,SAASG,QAAS,CAC3CC,QAAS,CAAC,CACRC,kBAAmB,SAAAC,GACb,eAAgBA,GAClBA,EAAKC,WAAW3V,SAAQ,gBAAG4V,EAAH,EAAGA,KAAH,OAAcV,EAAMW,IAAID,MAElDZ,EAAKa,IAAIH,EAAKI,UA/C5B,eAsDYC,EAAkBhV,MAAMiV,KAAKhB,GAAM7T,KAAI,SAAA8U,GAAI,MAAI,CAACC,GAAUD,GAAOE,GAAWC,GAASH,QACxFnS,QAAO,+BAAEuS,EAAF,KAAYC,EAAZ,YAA0BD,EAAShR,WAAW,OAASjD,OAAOqS,UAAUC,eAAeC,KAAKP,EAAmBkC,MACtHnV,KAAI,+BAAYmV,GAAZ,iBAA0B,CAACA,EAAUlC,EAAkBkC,OAExDC,EAAwBxV,MAAMiV,KAAKd,GAAO/T,KAAI,SAAA8U,GAAI,OAAIE,GAAWC,GAASH,OAC7EnS,QAAO,SAAA0S,GAAS,OAAIpU,OAAOqS,UAAUC,eAAeC,KAAKN,EAAmBmC,MAC5ErV,KAAI,SAAAqV,GAAS,MAAI,CAACA,EAAWnC,EAAkBmC,OA5DxD,KAgEe7O,EAAAA,EAhEf,KAiEyBwM,EAjEzB,UAoEkC,0DApElC,qCAqE4D,2DArE5D,qCAsE8C,oEAtE9C,qCAuEiD,8BAvEjD,qCAwEoD,8BAxEpD,iCAgEUsC,IAhEV,KAiEU,cAjEV,KAoEU,iBApEV,KAqEU,2CArEV,KAsEU,6BAtEV,KAuEU,gCAvEV,KAwEU,mCAxEV,oBA0EsBlM,GAAK,wIACZA,IAAQ0J,EADI,yCAERa,GAFQ,aAIT,IAAItT,MAAJ,mDAAsD+I,IAJ7C,8CA1E3B,kBA8DY7G,EA9DZ,CA+DQgT,YA/DR,KA0EcC,QA1Ed,KAiFQC,SAjFR,iBAoF6BC,EAAAA,GAAAA,YAAW5C,EAAwBvQ,GApFhE,QAoFMkQ,EApFN,OAsFUmC,EAAgBvR,SAAWoP,EAAekD,aAAYlD,EAAekD,WAAa,IACtFf,EAAgBjS,QAAO,SAAAiT,GAAC,OAAKnD,EAAekD,WAAWC,EAAE,OAAK/W,SAAQ,SAAA+W,GAAC,OAAInD,EAAekD,WAAWC,EAAE,IAAMA,EAAE,MAE3GR,EAAsB/R,SAAWoP,EAAe+B,aAAY/B,EAAe+B,WAAa,IAC5FY,EAAsBzS,QAAO,SAAAiT,GAAC,OAAKnD,EAAe+B,WAAWoB,EAAE,OAAK/W,SAAQ,SAAA+W,GAAC,OAAInD,EAAe+B,WAAWoB,EAAE,IAAMA,EAAE,MAErHpP,EAAAA,EAAAA,UAAciM,EAAegC,KAAMhC,GA5FzC,8BA8FY,IAAIpS,MAAJ,6BAAgCiO,EAAhC,gFA9FZ,QAiGImE,EAAenE,UAAYA,EAE3B7N,KAAKoV,eAAepD,GAnGxB,sDAqGIrI,QAAQC,IAAR,OACAoI,EAAiB,GACjBA,EAAenE,UAAYA,EAC3BmE,EAAeP,MAAf,MACAzR,KAAKoV,eAAepD,GAzGxB,yBA2GUqD,EAAUvD,YAAYC,MAC5BpI,QAAQC,IAAR,yBAA8BiE,EAA9B,iBAAgDwH,EAAUxD,EAA1D,kBA5GJ,6E,sFAoHA,SAAeyD,GAQb,GAPAA,EAAOC,cAAgB,GACvBD,EAAOE,eAAiB,GACxBF,EAAOG,mBAAqB,GAC5BH,EAAOI,qBAAuB,GAE9B1V,KAAKoP,GAAGwB,QAAQ9R,KAAKwW,GAEQ,oBAAlBA,EAAOK,OAAuB,CACvC,IAAMC,EAAS,IAAIC,GAAsBP,EAAQtV,KAAKoP,IAEtDkG,EAAOK,OAAOC,EAAQ5V,KAAK4R,e,4EAK/B,WAAmB/D,GAAnB,qH,sIAIA,WAAmBlF,GAAnB,wGACQ8H,EAAY9H,EAAImN,cAAgBnN,EAAImN,aAAavR,IAAI,aAErDwR,EAHR,uCAGmDpN,GAHnD,SAK0B3I,KAAK0M,OAAOiC,QAAQoH,GAL9C,UAKQ9E,EALR,OAOQ9B,EAAYpF,QAEb0G,GAAaQ,GAAc9B,EAAY8B,EAAU9B,UAAa,KATrE,yCAUW8B,EAAUlS,OAVrB,wBAa0BuI,MAAMqB,GAAK0D,MAAK,SAAA4G,GAAC,OAAIA,EAAE5N,UAbjD,WAaQ2Q,EAbR,OAeQ9D,EAAgB,sCAAwC+D,KAAKD,GAE9DvF,EAjBP,kCAkBUzQ,KAAK0M,OAAOuC,QAAQ8G,EAAU,CAAC7G,IAAK6G,EAAU5G,UAAAA,EAAWpQ,MAAOmT,IAlB1E,iCAqBSA,GArBT,iD,8DAjKmBP,GA2LfkE,GAAAA,WAEJ,WAAY7D,EAAgB5C,IAAI,eAC9BpP,KAAKkW,gBAAkBlE,EACvBhS,KAAK2M,IAAMyC,E,0CAGb,SAAY+G,EAAWC,GACrB,IAAMC,EAAW,CAACrC,KAAMmC,GAElBG,EAAc,CAChBtX,KADgB,SACXA,GACHqX,EAASrX,KAAOA,GAElBoH,YAJgB,SAIJA,GACViQ,EAASjQ,YAAcA,IAI7BgQ,EAAaE,GAEb,IAAMC,EAAgB/V,OAAOkS,QAAQ,CAAC,KAAQ,SAAU,YAAe,aACpExQ,QAAO,+BAAEsU,EAAF,KAAQC,EAAR,YAA0B,OAAOJ,EAASG,MAAUC,KAE1DF,EAAc3T,OAChB+G,QAAQC,IAAR,kBAAuBuM,EAAvB,uEAA+FlG,KAAKC,UAAUqG,IAAkBF,IAIlIrW,KAAKkW,gBAAgBX,cAAcY,GAAaE,EAEhDrW,KAAK2M,IAAIqD,MAAM,YAAaqG,M,0BAG9B,SAAaK,EAAUC,GACrB,IAAMC,EAAY,CAACnX,GAAIiX,GAEjBG,EAAe,CACjBC,OADiB,SACVC,GACLH,EAAUG,YAAcA,GAE1B3Q,YAJiB,SAILA,GACVwQ,EAAUxQ,YAAcA,IAI9BuQ,EAAcE,GAEd,IAAMG,EAAmB,CAAC,cAAe,eACtC9U,QAAO,SAAAsU,GAAI,MAA+B,oBAApBI,EAAUJ,MAE/BQ,EAAiBpU,OACnB+G,QAAQC,IAAR,kBAAuB8M,EAAvB,kEAAyFzG,KAAKC,UAAU8G,IAAqBJ,GAI/H5W,KAAKkW,gBAAgBV,eAAekB,GAAYE,I,8BAGlD,SAAiBF,EAAUC,GACzB,IAAMC,EAAY,CAACnX,GAAIiX,GAEjBG,EAAe,CACjBC,OADiB,SACVC,GACLH,EAAUG,YAAcA,GAE1B3Q,YAJiB,SAILA,GACVwQ,EAAUxQ,YAAcA,IAI9BuQ,EAAcE,GAEd,IAAMG,EAAmB,CAAC,cAAe,eACtC9U,QAAO,SAAAsU,GAAI,MAA+B,oBAApBI,EAAUJ,MAE/BQ,EAAiBpU,OACnB+G,QAAQC,IAAR,kBAAuB8M,EAAvB,kEAAyFzG,KAAKC,UAAU8G,IAAqBJ,GAI/H5W,KAAKkW,gBAAgBT,mBAAmBiB,GAAYE,I,gCAGtD,SAAmBF,EAAUC,GAC3B,IAAMC,EAAY,CAACnX,GAAIiX,GAEjBG,EAAe,CACjBC,OADiB,SACVC,GACLH,EAAUG,YAAcA,GAE1B3Q,YAJiB,SAILA,GACVwQ,EAAUxQ,YAAcA,IAI9BuQ,EAAcE,GAEd,IAAMG,EAAmB,CAAC,cAAe,eACtC9U,QAAO,SAAAsU,GAAI,MAA+B,oBAApBI,EAAUJ,MAE/BQ,EAAiBpU,OACnB+G,QAAQC,IAAR,kBAAuB8M,EAAvB,kEAAyFzG,KAAKC,UAAU8G,IAAqBJ,GAI/H5W,KAAKkW,gBAAgBR,qBAAqBgB,GAAYE,M,EA1GpDf,GAgHAoB,GAAa,SACbzC,GAAW,SAAA0C,GACf,OAAOA,EAAI/V,QAAQ8V,IAAY,SAACE,EAAGC,GAAJ,OAAUA,EAAIA,EAAEC,cAAgB,OAG3D9C,GAAa,SAAA2C,GACjB,OAAOA,EAAII,OAAO,GAAGD,cAAgBH,EAAIrS,MAAM,IAG3C0S,GAAc,aACdjD,GAAY,SAAA4C,GAChB,OAAOA,EAAI/V,QAAQoW,GAAa,OAAO/T,eCnSnCgU,GAAY,SAAC7O,EAAK8O,GAAN,OAAenQ,GAAAA,CAAMqB,EAAK8O,GAAMpL,MAAK,SAAAqL,GAAQ,OAAIA,EAASzN,WAUvD0N,GAAAA,WAEnB,WAAY5S,GAAK,2BACf/E,KAAKgF,KAAOD,EACZ/E,KAAK4X,WAAa,IAAI7R,EAAAA,EAAI,CACxBwB,KAAM,CACJsQ,QAAQ,EACRC,aAAc,EACdC,SAAU,WAEVC,iBAAkB,IAAI7Q,GAEtB8Q,eAAgB,GAEhBC,SAAU,MAIdlY,KAAKmY,QAAU,IAAInS,SAAQ,SAACC,GAC1B,EAAK2R,WAAWQ,MAAM,UAAU,WAC9B,EAAKR,WAAWC,QAAS,EACzB5R,GAAQ,SAIZjG,KAAK0M,OAAS2L,IAAAA,eAA2B,CACvCrE,KAAM,aACNsE,UAAW,SAGbtY,KAAKuY,OAAS,GACdvY,KAAKuY,OAAOC,YAAc,IAAIhM,GAAyBxM,MACvDA,KAAKuY,OAAOE,aAAe,IAAI9G,GAA0B3R,MAEzDA,KAAK0Y,aAAU9Z,EACfoB,KAAK2Y,aAAU/Z,EAEfoB,KAAK4Y,IAAM,IAAI9T,EAAYC,GAC3B/E,KAAK6Y,MAAQ,IAAI/R,E,gCAMnB,WACE,OAAO9G,KAAKgF,O,qBAOd,WACE,OAAOhF,KAAK4X,a,cAMd,WACE,OAAO5X,KAAK4Y,M,gBAMd,WACE,OAAO5Y,KAAK6Y,Q,iBAMd,WACE,OAAO7Y,KAAKuY,S,wBAQd,WACE,OAAOvY,KAAK0Y,U,8BAUd,WACE,OAAO1Y,KAAK2Y,U,mBAMd,WACE,OAAO3Y,KAAKuY,OAAOE,aAAarJ,GAAGwB,U,kBAMrC,WACE,OAAO5Q,KAAKmY,U,oEAId,sHACEnY,KAAK8Y,UAAUf,SAAW,uBAD5B,SAGQ/X,KAAK0M,OAAOqM,QAHpB,cAKE/Y,KAAKuY,OAAOC,YAAYhJ,SAAStJ,IAAI,aAArC,kDAAmD,WAAM2H,GAAN,iGAC3C,EAAK0K,OAAOE,aAAaO,WAAWnL,GADO,2CAAnD,kCAAA7N,KAAA,gBAIAA,KAAKuY,OAAOC,YAAYhJ,SAAStJ,IAAI,gBAArC,kDAAsD,WAAM2H,GAAN,iGAC9C,EAAK0K,OAAOE,aAAaQ,aAAapL,GADQ,2CAAtD,kCAAA7N,KAAA,gBAIAA,KAAKuY,OAAOE,aAAarJ,GAAGlJ,IAAI,aAAa,SAAAmQ,GACV,oBAAtB,EAAKtR,IAAImU,UAClB,EAAKnU,IAAImU,SAAS7C,MAItBrW,KAAKuY,OAAOE,aAAarJ,GAAGlJ,IAAI,gBAAgB,SAAAmQ,GACV,oBAAzB,EAAKtR,IAAIoU,aAClB,EAAKpU,IAAIoU,YAAY9C,MArB3B,SAyBQrW,KAAKuY,OAAOE,aAAaW,OAzBjC,wBA0BQpZ,KAAKuY,OAAOC,YAAYY,OA1BhC,eA4BEpZ,KAAK8Y,UAAUf,SAAW,oBA5B5B,UA6BuB/X,KAAKqZ,cA7B5B,eA6BErZ,KAAKsZ,QA7BP,OA+BEC,EAAAA,GAAAA,MAAcvZ,KAAKwZ,gBAAgBC,KAAKzZ,MAExCA,KAAK0Z,QAAU,IAAIC,EAAAA,GAAa,CAAEC,OAAQ5Z,KAAKsZ,UAEzCO,EAAS,IAAIC,EAAAA,GAAgB,CAAEC,UAAW,8BAEhD/Z,KAAK0Y,QAAU,IAAIsB,EAAAA,GAAa,CAC9BC,OAAQja,KAAK0Z,QACbQ,cAAe,CACbC,eAAgBC,KAIpBpa,KAAK2Y,QAAU,IAAIrY,EAAoB,CACrC2Z,OAAQja,KAAK0Z,QACb1F,KAAM,SACN5K,MAAMpC,EAAAA,EAAAA,GAAgB,QACtBzG,qBAAsB,CACpB8Z,QAAS,KAEXR,OAAAA,EACAS,qBAAsB,CACpBC,YAAava,KAAK8Y,UAAUd,iBAAiBxP,WAAY,KAIvDgS,EAAgC,WACpC,EAAK1B,UAAUb,eAAiB,EAAKU,QAAQ8B,aAAa/H,QAAQxQ,QAAO,SAAA+Q,GAAC,MAAe,WAAXA,EAAElT,SAGlFC,KAAK2Y,QAAQ8B,aAAaC,QAAQrO,KAAKmO,GACvCxa,KAAK2Y,QAAQ8B,aAAa/T,GAAG,SAAU8T,GAEvCxa,KAAK2a,QAAU,IAAIC,EAAAA,GAAgB,CACjCX,OAAQja,KAAK0Z,QACb1F,KAAM,SACN+F,UAAW,8BACXc,wBAAyB,CACvBC,WAAW,KAIf9a,KAAK+a,aAAe,IAAIC,EAAAA,GAAY,CAClCC,QAAS,CAACjb,KAAK0Y,QAAS1Y,KAAK2Y,QAAS3Y,KAAK2a,WAI7C3a,KAAKkb,qBAAuB,IAAIC,EAAAA,GAAgB,CAC9CnH,KAAM,wBAENoH,OAAQ,SACR1U,GAAI,cAEJ2U,OAAQ,SACRC,OAAQ,QAERC,UAAU,IAGRvb,KAAK8Y,UAAUd,iBAAiBxP,UAClCxI,KAAK+a,aAAaS,YAAYxb,KAAKkb,sBAIrClb,KAAK+a,aAAaS,YAChB,IAAIL,EAAAA,GAAgB,CAClBC,OAAQ,SACR1U,GAAI,eAEJ2U,OAAQ,SACRC,OAAQ,SAERC,UAAU,KAKdvb,KAAK+a,aAAaS,YAChB,IAAIC,EAAAA,GAAa,CACfL,OAAQ,SACRC,OAAQ,SACRE,UAAU,KAKdvb,KAAK+a,aAAaS,YAChB,IAAIC,EAAAA,GAAa,CACfL,OAAQ,SACRC,OAAQ,SACRE,UAAU,KAzHhB,UA8HqCvb,KAAK2a,QAAQe,OAAM,SAACC,GAAD,OAAOA,EAAEha,iBA9HjE,eA8HQia,EA9HR,iBA+HQ5b,KAAK0Y,QAAQmD,MAAK,SAAC1G,GAAD,OAAOyG,EAAqBrc,KAAI,SAAC0T,GAAD,OAAOkC,EAAE2G,UAAU7I,SA/H7E,yBAiIQjT,KAAK+a,aAAagB,WAjI1B,eAmIE/b,KAAK8Y,UAAUhB,aAAe,IAE9B9X,KAAK0Y,QAAQhS,GAAG,UAAU,SAAAsV,GACxBrS,QAAQC,IAAI,kBAAmBoS,GAEF,iBAAzBA,EAAOC,WAAWzd,IAAyBwd,EAAOC,WAAW5c,OAAOU,KAAK0D,WAAW,YACtF,EAAKqV,UAAU9I,MAAM,gBAAiBgM,EAAOC,WAAW5c,OAAOU,KAAMic,EAAOC,WAAW5c,OAAOI,OAKlGO,KAAK8Y,UAAUd,iBAAiBkE,OAAO,WAAvC,kDAAmD,WAAO1T,GAAP,wFACjD,EAAKmQ,QAAQ8B,aAAaF,YAAc/R,EACpCA,IAAa,EAAKmQ,QAAQ8B,aAAa0B,OACzC,EAAKxD,QAAQ8B,aAAa2B,UAHqB,SAM3C,EAAKrB,aAAasB,aANyB,cAO7C7T,EACG,EAAKuS,aAAauB,WAAW5Y,SAAS,EAAKwX,uBAC9C,EAAKH,aAAaS,YAAY,EAAKN,sBAGjC,EAAKH,aAAauB,WAAW5Y,SAAS,EAAKwX,uBAC7C,EAAKH,aAAawB,eAAe,EAAKrB,qBAAqBlH,MAbd,SAgB3C,EAAK+G,aAAagB,WAhByB,2CAAnD,kCAAA/b,KAAA,gBAmBAA,KAAK8Y,UAAU9I,MAAM,UAEjBhQ,KAAK8Y,UAAUd,iBAAiBxP,UAClCxI,KAAKwc,YApKT,mBAuKS,GAvKT,iD,uIA6KA,WAAqBC,GAArB,iGACQzc,KAAKmY,QADb,gCAGSnY,KAAKsZ,QAAQmD,IAHtB,gD,mIAMA,iHAEQC,EAAU9U,OAAOoB,SAAS0B,KAAKiS,MAAM,iCACvCD,GAAWA,EAAQ9Z,QAAU,GAHnC,gCAI4B5C,KAAK4c,aAAaF,EAAQ,IAJtD,OAIUG,EAJV,OAKIlT,QAAQC,IAAI,aAAciT,GAL9B,cAQQ1N,EAAYpF,KAEZ+S,EAVR,0CAYiC9c,KAAK0M,OAAOiC,QAAQmO,GAZrD,WAYQC,EAZR,SAcMA,GAAqB5N,EAAY4N,EAAoB,KAd3D,wBAeIpT,QAAQC,IAAI,kEAfhB,4CAoB4B5J,KAAKgd,gBApBjC,eAoBQC,EApBR,OAoBkD1d,KAAI,SAAA4V,GAAC,OAAIA,EAAE+H,WAAWC,uBApBxE,UAsBQnd,KAAK0Y,QAAQgD,OAAM,SAACC,GAAD,OAAOsB,EAAW1d,KAAI,SAAA6d,GAAS,OAAIzB,EAAEha,YAAF,iBAAwByb,IAC/Ehb,KAAK,YACLE,KAAK,CAAEsC,OAAQ,EAAGD,MAAO,YAxBhC,yBA4BQ3E,KAAK0M,OAAOuC,QAAQ6N,EAAqB3N,GA5BjD,iD,sIAkCA,6GACQkO,EADR,kDACyB,WAAOjC,GAAP,iGACRA,EAAOM,OAAM,SAACC,GAAD,OAAOA,EAC5Bha,YAD4B,0BAE5BS,KAAK,0BAHW,mFADzB,+DAO2Bib,EAAerd,KAAK0Y,QAAQ9W,OAPvD,UAOQqb,EAPR,QASMA,EAAWra,OATjB,yCAUWqa,GAVX,uBAaeI,EAAerd,KAAK0Y,SAbnC,wF,qIAmBA,WAAmB4E,GAAnB,+GACQtd,KAAKmY,QADb,uBAG4BnY,KAAKgd,gBAHjC,cAGQC,EAHR,OAGkD1d,KAAI,SAAA4V,GAAC,OAAIA,EAAE+H,WAAWC,uBAEhEI,EAAe,UAAUC,KAAKF,GAEhCpb,EAAS,CAAErD,UAAW,KAAME,MAAOue,GACnCC,IACFrb,EAAS,CAAErD,UAAW,sBAAuBE,MAAO+L,SAASwS,KAGzDG,EAZR,kDAYoB,WAAOrC,GAAP,yGACMA,EAAOM,OAAM,SAAAC,GAAC,OAAIsB,EAAW1d,KAAI,SAAA6d,GAAS,OAAIzB,EAC/Dha,YAD+D,iBACzCyb,IACtBlb,OAAOA,GACPE,KAAK,6BAJM,cACVJ,EADU,OAMV0b,EAAS1b,EAAQ2b,SAAQ,SAAA1a,GAAC,OAAIA,KANpB,kBAQTya,EAAOjP,MAAK,SAAAmP,GAAC,OAAIA,MARR,2CAZpB,gEAuBsBH,EAAUzd,KAAK0Y,QAAQ9W,OAvB7C,WAuBQic,EAvBR,QAyBMA,EAzBN,0CA0BWA,GA1BX,yBA6BeJ,EAAUzd,KAAK0Y,SA7B9B,0F,oFAmCA,SAAaoF,EAAeC,GAC1BpU,QAAQC,IAAI,gBAAiBqG,KAAKC,UAAU4N,GAAgBC,GAM5D,IAJA,IAAMC,EAAqBhe,KAAK4Q,QAAQ1O,QAAO,SAAAoJ,GAAC,MAA8B,oBAAnBA,EAAE2S,gBAEvDC,EAAsB,GAEnBlb,EAAI,EAAGA,EAAIgb,EAAmBpb,OAAQI,GAAK,EAAG,CACrD,IAAMsS,EAAS0I,EAAmBhb,GAG5Bmb,EAAqB7I,EAAO2I,aAAaje,KAAM8d,EAAeC,QAEzCnf,IAAvBuf,GACFD,EAAoBpf,KAAKqf,GAdU,SAkBvBC,IAlBuB,sFAkBvC,gHACEzU,QAAQC,IAAI,gDAAiDsU,GAEvDG,EAA8BH,EAAoB3e,KAAI,SAAA6X,GAAC,OAAI,IAAI7L,GAAsB6L,MAH7F,YAKQiH,EAA4Bzb,OAAS,GAL7C,iBAOI+G,QAAQC,IAAI,+DAAgEyU,EAA4Bzb,OAAQyb,GAE5GC,OAAiB1f,EACjB2f,OAA0B3f,EACrBoE,EAAI,EAXjB,YAWoBA,EAAIqb,EAA4Bzb,QAXpD,wBAYY4b,EAAaH,EAA4Brb,GAZrD,kBAcyCwb,EAAWC,QAdpD,WAcYC,EAdZ,YAgByC9f,IAA/B8f,EAAqB3f,MAhB/B,qEAoB6BH,IAAnB0f,EApBV,kCAoB0CI,EAAqB3f,MAAM4f,OApBrE,kBAoBqFL,EAAeG,QApBpG,oBAoB4G1f,MAAM4f,OApBlH,iDAqBQL,EAAiBE,EACjBD,EAA0BG,EAAqBE,KAAO5b,OAAIpE,EAtBlE,QAW4DoE,GAAK,EAXjE,+BA0B2BpE,IAAnB0f,EA1BR,4EA8BuCA,EAAe3S,QA9BtD,WA8BUkT,EA9BV,QAgCQA,EAAqB9f,MAhC7B,iBAiCM,OAjCN,UAiCY8f,EAAqB9f,MAjCjC,aAoCoCH,IAA5B2f,GACFF,EAA4BhT,OAAOkT,EAAyB,GArClE,2DAlBuC,wBA6DvC,OAAOH,M,gCAGT,SAAmBP,GACjB,IAAMiB,EAAU9e,KAAK4Q,QAAQ+M,SAAQ,SAAArI,GAAM,OAAI9U,OAAOue,OAAOzJ,EAAOE,mBAC/DtT,QAAO,SAAA0b,GAAC,OAAIA,EAAE7G,YAAY8G,MAC1Bte,KAAI,SAAAqe,GAAC,MAAK,CACTne,GAAIme,EAAEne,GACN2G,YAAa,SAACC,EAASC,GAAV,OAAgBsX,EAAExX,YAAYC,EAASC,EAAGuX,QAG7D,OAAOiB,I,oCAGT,SAAuBjB,GACrB,IAAMiB,EAAU9e,KAAK4Q,QAAQ+M,SAAQ,SAAArI,GAAM,OAAI9U,OAAOue,OAAOzJ,EAAOG,uBAC/DvT,QAAO,SAAA0b,GAAC,OAAIA,EAAE7G,YAAY8G,MAC1Bte,KAAI,SAAAqe,GAAC,MAAK,CACTne,GAAIme,EAAEne,GACN2G,YAAa,SAACC,EAASC,GAAV,OAAgBsX,EAAExX,YAAYC,EAASC,EAAGuX,QAG7D,OAAOiB,I,sCAGT,SAAyBE,GACvB,IAAMF,EAAU9e,KAAK4Q,QAAQ+M,SAAQ,SAAArI,GAAM,OAAI9U,OAAOue,OAAOzJ,EAAOI,yBAC/DxT,QAAO,SAAA0b,GAAC,OAAIA,EAAE7G,YAAYiI,MAC1Bzf,KAAI,SAAAqe,GAAC,MAAK,CACTne,GAAIme,EAAEne,GACN2G,YAAa,SAACC,EAASC,GAAV,OAAgBsX,EAAExX,YAAYC,EAASC,EAAG0Y,QAG7D,OAAOF,I,+EAGT,WAAsBnW,EAAKC,GAA3B,sGACQ9G,EAAU8G,GAAQ,GAEnB9G,EAAQ+G,SAAQ/G,EAAQ+G,OAAS,OAEhCC,EAAa,IAAIC,IAAIJ,EAAKf,OAAOoB,SAASC,OAASrB,OAAOsB,yBAE1DC,EAAkBL,EAAWM,OAASxB,OAAOoB,SAASI,MAAQN,EAAWO,SAAS5F,WAAWmE,OAAOsB,yBACpG+V,GAAkB,CAAC,OAAQ,MAAO,UAAW,SAASvb,SAAS5B,EAAQ+G,OAAOwO,eAE9E6H,EAAgB/V,GAAmB8V,EAV3C,UAaQC,EAbR,kCAckClf,KAAK8Y,UAAUd,iBAAiB1Q,OAAMN,EAAAA,EAAAA,GAAgB,mBAdxF,eAcYmY,EAdZ,OAgBMxV,QAAQC,IAAI,iBAAkBuV,GAhBpC,UAkB0BA,EAAc9Z,OAlBxC,QAkBY+Z,EAlBZ,OAqBWtd,EAAQpB,UAASoB,EAAQpB,QAAU,IACxCoB,EAAQpB,QAAQ,gBAAkB0e,EAtBxC,yBAyBiBpf,KAAK8Y,UAAUd,iBAAiB1Q,MAAMqB,EAAK7G,GAzB5D,iFA2BI6H,QAAQC,IAAI,4BAAZ,mBACsB,2BAAlB,KAAM2C,QA5Bd,0CA6Ba,IAAI8S,SAAS,KAAM,CACxB9V,OAAQ,IACR4H,WAAY,8CA/BpB,6E,uIAsCA,iHACQ4E,EADR,2CAG0B/V,KAAK0M,OAAOiC,QAAQoH,GAH9C,UAGQ9E,EAHR,QAKMA,EALN,yCAOWA,EAAUlS,OAPrB,uBAUuBiB,KAAKsf,wBAV5B,cAUQ1F,EAVR,OAYQzK,EAAYpF,KAZpB,UAcQ/J,KAAK0M,OAAOuC,QAAQ8G,EAAU,CAAC7G,IAAK6G,EAAU5G,UAAAA,EAAWpQ,MAAO6a,IAdxE,iCAgBSA,GAhBT,iD,8IAmBA,sHACE5Z,KAAK8Y,UAAUf,SAAW,wBAD5B,SAE6BP,IAAUxQ,EAAAA,EAAAA,GAAgB,gBAFvD,cAEQuY,EAFR,OAIQC,EAAuBD,EAAaE,MAAM9B,SAAQ,SAAA+B,GAAS,OAAIA,EAAUlV,OAAS,MAElFoP,EAAS,GANjB,SAQQ5T,QAAQoG,IAAIoT,EAAqBjgB,IAArB,kDAAyB,WAAOogB,GAAP,+GACbnI,GAAUmI,EAAoBC,cADjB,cACnCC,EADmC,gBAGTrI,GAAUqI,EAAcC,YAAYvY,KAAKwY,MAAMC,MAHtC,OAGnCC,EAHmC,OAKnCxD,EAAWwD,EAAkBH,YAAY/f,KAAK,SAEpD6Z,EAAO6C,GAAY,CACjBS,WAAY1c,OAAO0f,YACf1f,OAAOkS,QAAQuN,EAAkBH,YAAY5C,WAAWiD,YACrD5gB,KAAI,YAAsB,mBAApB6gB,EAAoB,KAAV5J,EAAU,KAWzB,MATkB,YAAdA,EAAKzW,OACPyW,EAAKzW,KAAO,UAIG,yBAAbqgB,IACF5J,EAAKzW,KAAO,UAGP,CAACqgB,EAAU5J,OAG1B6J,eAAe,UAAAJ,EAAkBH,mBAAlB,mBAA+BO,qBAA/B,eAA8CF,aAAc,IAG7E,EAAKrH,UAAUhB,cAAiBtX,OAAO8f,KAAK1G,GAAQhX,OAAS4c,EAAqB5c,OAAU,KAAK2d,QAAQ,GA3BhE,2CAAzB,wDARpB,gCAsCS3G,GAtCT,gD,6DArhBmBjC,I,4FCnCN,SAAS3Q,EAAgBwZ,GACtC,OAAO,IAAIzX,IAAIyX,EAAY5Y,OAAOoB,SAASC,OAASrB,OAAOsB,2B,4CCE7DnD,EAAAA,EAAAA,IAAQ0a,EAAAA,GAER,WAAmBA,EAAAA,EAAQ,K,oCCAzBC,EAAAA,EAAAA,GAAS,GAAD,OAAItE,+DAAJ,qBAA6C,CACnDrD,MADmD,WAEjDpP,QAAQC,IACN,uGAIJ+W,WAPmD,WAQjDhX,QAAQC,IAAI,wCAEdgX,OAVmD,WAWjDjX,QAAQC,IAAI,6CAEdiX,YAbmD,WAcjDlX,QAAQC,IAAI,gCAEdkX,QAhBmD,WAiBjDnX,QAAQC,IAAI,8CAEdmX,QAnBmD,WAoBjDpX,QAAQC,IAAI,kEAEd6H,MAtBmD,SAsB5CA,GACL9H,QAAQ8H,MAAM,4CAA6CA","sources":["webpack://alinkjs/./src/DrupalJSONAPIURLBuilder.js","webpack://alinkjs/./src/DrupalJSONAPISource.js","webpack://alinkjs/./src/DrupalSyncQueryOperators.js","webpack://alinkjs/./src/AssetLinkUI.js","webpack://alinkjs/./src/AssetLinkUtil.js","webpack://alinkjs/./src/FarmOSConnectionStatusDetector.js","webpack://alinkjs/./src/PeekableAsyncIterator.js","webpack://alinkjs/./src/util/currentEpochSecond.js","webpack://alinkjs/./src/util/EventBus.js","webpack://alinkjs/./src/HttpAccessDeniedException.js","webpack://alinkjs/./src/AssetLinkPluginListsCore.js","webpack://alinkjs/./src/AssetLinkPluginLoaderCore.js","webpack://alinkjs/./src/AssetLink.js","webpack://alinkjs/./src/createDrupalUrl.js","webpack://alinkjs/./src/plugins/vuetify.js","webpack://alinkjs/./src/registerServiceWorker.js"],"sourcesContent":["import { JSONAPIURLBuilder } from \"@orbit/jsonapi\";\nimport { QueryExpressionParseError } from \"@orbit/data\";\nimport { JSONAPISerializers } from '@orbit/jsonapi';\n\n/**\n * Extends {JSONAPIURLBuilder} to add support for Drupal JSON:API query operators.\n * \n * Loosely based on https://gist.github.com/bradjones1/18ff9ebdb85455f781a2a212577653ce\n */\nexport default class DrupalJSONAPIURLBuilder extends JSONAPIURLBuilder {\n\n  constructor(settings) {\n    super(settings);\n  }\n\n  buildFilterParam(filterSpecifiers) {\n    const filters = [];\n\n    filterSpecifiers.forEach((filterSpecifier, index) => {\n      if (\n        filterSpecifier.kind === 'attribute' &&\n        filterSpecifier.op === 'equal'\n      ) {\n        const attributeFilter = filterSpecifier;\n\n        // Note: We don't know the `type` of the attribute here, so passing `undefined`\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({ [resourceAttribute]: attributeFilter.value });\n      } else if (filterSpecifier.kind === 'attribute') {\n        const attributeFilter = filterSpecifier;\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({\n          ['client-' + resourceAttribute + '-' + index]: {\n            path: resourceAttribute,\n            operator: attributeFilter.op,\n            value: attributeFilter.value\n          }\n        });\n      } else if (filterSpecifier.kind === 'relatedRecord') {\n        const relatedRecordFilter = filterSpecifier;\n        if (Array.isArray(relatedRecordFilter.record)) {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter.record\n              .map((e) => e.id)\n              .join(',')\n          });\n        } else {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter?.record?.id\n          });\n        }\n      } else if (filterSpecifier.kind === 'relatedRecords') {\n        if (filterSpecifier.op !== 'equal') {\n          throw new Error(\n            `Operation \"${filterSpecifier.op}\" is not supported in JSONAPI for relatedRecords filtering`\n          );\n        }\n        const relatedRecordsFilter = filterSpecifier;\n        filters.push({\n          [relatedRecordsFilter.relation]: relatedRecordsFilter.records\n            .map((e) => e.id)\n            .join(',')\n        });\n      } else {\n        throw new QueryExpressionParseError(\n          `Filter operation ${filterSpecifier.op} not recognized for JSONAPISource.`\n        );\n      }\n    });\n\n    return filters;\n  }\n\n  serializeAttributeAsParam(type, attribute) {\n      if (this.serializer) {\n        return this.serializer.resourceAttribute(type, attribute);\n      } else {\n        const serializer = this.serializerFor(JSONAPISerializers.ResourceFieldParam);\n        return serializer.serialize(attribute, { type });\n      }\n    }\n\n}\n","import JSONAPISource, { JSONAPISerializers } from '@orbit/jsonapi';\nimport { buildSerializerSettingsFor, buildInflector } from '@orbit/serializers';\n\nimport DrupalJSONAPIURLBuilder from '@/DrupalJSONAPIURLBuilder';\n\n\n/**\n * Handle Drupal's `type/bundle` JSON:API resource pathing.\n * Based on: https://github.com/orbitjs/orbit/issues/714#issuecomment-1013952990\n */\nexport default class DrupalJSONAPISource extends JSONAPISource {\n  constructor(settings) {\n    const defaultFetchSettings = Object.assign({}, settings.defaultFetchSettings || {}, {\n      headers:{\n        Accept: 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json',\n      },\n    });\n\n    super(Object.assign({}, settings, {\n      defaultFetchSettings,\n      serializerSettingsFor: buildSerializerSettingsFor({\n        sharedSettings: {\n          inflectors: {\n            drupal: buildInflector(\n              {},\n              (input) => input.replace('--', '/')\n            )\n          }\n        },\n        settingsByType: {\n          [JSONAPISerializers.ResourceTypePath]: {\n            serializationOptions: {inflectors: ['drupal']}\n          }\n        }\n      }),\n      URLBuilderClass: DrupalJSONAPIURLBuilder,\n    }));\n  }\n\n}\n","import { SyncQueryOperators } from '@orbit/record-cache';\nimport { QueryExpressionParseError } from '@orbit/data';\nimport { RecordNotFoundException } from '@orbit/records';\nimport { deepGet, isNone } from '@orbit/utils';\n\n// Based on https://github.com/orbitjs/orbit/blob/2c4bf7038d2f74ba31e45e949c70ec4161ced28f/packages/@orbit/record-cache/src/operators/sync-query-operators.ts\nexport default {\n  findRecord: SyncQueryOperators.findRecord,\n  findRelatedRecord: SyncQueryOperators.findRelatedRecord,\n\n  findRecords(\n      cache,\n      expression,\n      // eslint-disable-next-line no-unused-vars\n      options\n    ) {\n      let exp = expression;\n      let results = cache.getRecordsSync(exp.records || exp.type);\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n\n  findRelatedRecords(\n      cache,\n      expression,\n      options\n    ) {\n      const exp = expression;\n      const { record, relationship } = exp;\n      const relatedIds = cache.getRelatedRecordsSync(record, relationship);\n      if (!relatedIds || relatedIds.length === 0) {\n        if (!cache.getRecordSync(record)) {\n          if (options?.raiseNotFoundExceptions) {\n            throw new RecordNotFoundException(record.type, record.id);\n          } else {\n            return undefined;\n          }\n        }\n\n        return [];\n      }\n      let results = cache.getRecordsSync(relatedIds);\n\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n}\n\nfunction filterRecords(records, filters) {\n  return records.filter((record) => {\n    for (let i = 0, l = filters.length; i < l; i++) {\n      if (!applyFilter(record, filters[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction applyFilter(record, filter) {\n\n  if (filter.kind === 'attribute') {\n    let attributeKey = filter.attribute.split('.');\n\n    let actual = deepGet(record, ['attributes', ...attributeKey]);\n\n    let expected = filter.value;\n\n    // https://api.drupal.org/api/drupal/core%21modules%21jsonapi%21src%21Query%21EntityCondition.php/property/EntityCondition%3A%3AallowedOperators/9.4.x\n    switch (filter.op) {\n      case 'equal':\n      case '=':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() === expected.toLowerCase();\n        }\n        return actual === expected;\n      case '<>':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() !== expected.toLowerCase();\n        }\n        return actual !== expected;\n      case '>':\n        return actual > expected;\n      case '>=':\n        return actual >= expected;\n      case '<':\n        return actual < expected;\n      case '<=':\n        return actual <= expected;\n      case 'STARTS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().startsWith(expected.toLowerCase());\n      case 'CONTAINS':\n        return typeof actual === 'string' && actual.toLowerCase().includes(expected.toLowerCase());\n      case 'ENDS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().endsWith(expected.toLowerCase());\n      case 'IN':\n      case 'NOT IN':\n      case 'BETWEEN':\n      case 'NOT BETWEEN':\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} is not yet implemented for Store.`);\n      case 'IS NULL':\n        return actual === undefined || actual === null;\n      case 'IS NOT NULL':\n        return actual !== undefined && actual !== null;\n      default:\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} not recognized for Store.`);\n    }\n  }\n  return SyncQueryOperators.applyFilter(record, filter);\n}\n\nfunction sortRecords(\n    records,\n    sortSpecifiers\n  ) {\n  const comparisonValues = new Map();\n\n  records.forEach((record) => {\n    comparisonValues.set(\n      record,\n      sortSpecifiers.map((sortSpecifier) => {\n        if (sortSpecifier.kind === 'attribute') {\n          let attributeKey = sortSpecifier.attribute.split('.');\n\n          return deepGet(record, [\n            'attributes',\n            ...attributeKey,\n          ]);\n        } else {\n          throw new QueryExpressionParseError(\n            'Sort specifier ${sortSpecifier.kind} not recognized for Store.'\n          );\n        }\n      })\n    );\n  });\n\n  const comparisonOrders = sortSpecifiers.map((sortExpression) =>\n    sortExpression.order === 'descending' ? -1 : 1\n  );\n\n  return records.sort((record1, record2) => {\n    const values1 = comparisonValues.get(record1);\n    const values2 = comparisonValues.get(record2);\n    for (let i = 0; i < sortSpecifiers.length; i++) {\n      if (values1[i] < values2[i]) {\n        return -comparisonOrders[i];\n      } else if (values1[i] > values2[i]) {\n        return comparisonOrders[i];\n      } else if (isNone(values1[i]) && !isNone(values2[i])) {\n        return comparisonOrders[i];\n      } else if (isNone(values2[i]) && !isNone(values1[i])) {\n        return -comparisonOrders[i];\n      }\n    }\n    return 0;\n  });\n}\n\nfunction paginateRecords(\n  records,\n  paginationOptions\n) {\n  if (paginationOptions.limit !== undefined) {\n    let offset =\n      paginationOptions.offset === undefined ? 0 : paginationOptions.offset;\n    let limit = paginationOptions.limit;\n\n    return records.slice(offset, offset + limit);\n  } else {\n    throw new QueryExpressionParseError(\n      'Pagination options not recognized for Store. Please specify `offset` and `limit`.'\n    );\n  }\n}\n","import Vue from 'vue';\nimport {\n  VBtn,\n  VDialog,\n  VListItem,\n  VListItemTitle,\n} from 'vuetify/lib'\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class AssetLinkUI {\n\n  constructor(app) {\n    this._app = app;\n  }\n\n  /**\n   * Provide some basic components to support Asset Link plugins defined as single (uncompiled) JS\n   * files.\n   * \n   * Commonly accessed via `assetLink.ui.c` e.g. `h(assetLink.ui.c.VBtn, { props: ...`\n   */\n  get c() {\n    return {\n      VBtn,\n      VListItem,\n      VListItemTitle,\n    };\n  }\n\n  /**\n   * \n   */\n  get dialog() {\n    return {\n      confirm: async (text) => {\n        return await this._app.$dialog.confirm({\n          text,\n          title: 'Confirmation'\n        });\n      },\n      promptText: async (text) => {\n        return await this._app.$dialog.prompt({\n          text,\n          title: 'Input',\n        });\n      },\n      custom: async (component, params) => {\n        const id = uuidv4();\n\n        const context = new Vue({});\n\n        const result = await new Promise(resolve => {\n          context.$on('submit', resolve);\n\n          this.app.dialogs.push({\n            id,\n            context,\n            componentFn: (wrapper, h) =>\n              h(VDialog, {\n                props: { value: true, fullscreen: true },\n                on: {\n                  input: () => resolve(undefined),\n                },\n              },  [h(component, {ref: 'dialogComponent', ...params})] ),\n          });\n        });\n\n        this.app.dialogs = this._app.dialogs.filter(d => d.id !== id);\n\n        return result;\n      },\n    };\n  }\n\n}\n","import { formatRFC3339 } from 'date-fns'\nimport createDrupalUrl from '@/createDrupalUrl';\nimport geohash from 'ngeohash';\nimport haversine from 'haversine-distance';\n\nexport default class AssetLinkUtil {\n\n  /**\n   * Format a date object as an RFC 3339 date string. e.g. '2019-09-18T19:00:52Z'\n   */\n  get formatRFC3339() {\n    return formatRFC3339;\n  }\n\n  /**\n   * Create a URL relative to the Drupal installation base path given the URL path suffix.\n   */\n  get createDrupalUrl() {\n    return createDrupalUrl;\n  }\n\n  /**\n   * The node-geohash module: https://github.com/sunng87/node-geohash\n   */\n  get geohash() {\n    return geohash;\n  }\n\n  /**\n   * A haversine distance function: https://github.com/dcousens/haversine-distance\n   */\n  get haversine() {\n    return haversine;\n  }\n\n}\n","import Vue from 'vue';\nimport fetch from 'cross-fetch';\nimport throttle from '@jcoreio/async-throttle'\nimport createDrupalUrl from '@/createDrupalUrl';\n\n/**\n * Responsible for detecting online/offline/login status\n * for our connection to the farmOS server both through\n * self-initiated polling and by observing the outcome of\n * decorated fetch requests.\n * \n * @implements {IHttpFetcher}\n */\nconst FarmOSConnectionStatusDetector = Vue.extend({\n\n  props: {\n    fetcherDelegate: {\n      type: Object,\n      default: function () {\n        return { fetch: fetch };\n      }\n    }\n  },\n\n  data() {\n    return {\n      $_running: false,\n      $_barrier: new Barrier(),\n\n      hasNetworkConnection: window.navigator.onLine,\n      canReachFarmOS: undefined,\n      isLoggedIn: undefined,\n    };\n  },\n\n  created() {\n    window.addEventListener('offline', () => {\n      this.hasNetworkConnection = false;\n      this.canReachFarmOS = false;\n    });\n    window.addEventListener('online', () => {\n      this.hasNetworkConnection = true;\n      this.$data.$_barrier.release();\n    });\n    if (window.navigator && window.navigator.connection) {\n      window.navigator.connection.addEventListener('change', () => this.$data.$_barrier.release());\n    }\n    this.$_mainLoop();\n  },\n\n  computed: {\n    isOnline() {\n      return this.canReachFarmOS && this.isLoggedIn;\n    },\n  },\n\n  beforeDestroy() {\n    this.$data.$_running = false;\n    this.$data.$_barrier.release();\n  },\n\n  methods: {\n\n    /**\n     * Decorate fetch requests to detect connection/authentication problems with\n     * requests that are already being sent.\n     */\n    async fetch(url, opts) {\n      const options = opts || {};\n\n      if (!options.method) options.method = 'GET';\n\n      const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n      const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n\n      try {\n        const res = await this.fetcherDelegate.fetch(url, options);\n        if (isFarmOSRequest && res.status === 403) {\n          this.$data.$_barrier.release();\n        }\n        return res;\n      } catch (error) {\n        if (isFarmOSRequest) {\n          this.$data.$_barrier.release();\n        }\n        throw error;\n      }\n    },\n\n    async $_mainLoop() {\n      this.$data.$_running = true;\n\n      const checkConnectionStatus = throttle(() => this.$_checkConnectionStatus(), 1000);\n\n      while (this.$data.$_running) {\n        console.log('$_mainLoop iteration');\n        await checkConnectionStatus();\n        await this.$data.$_barrier.arrive(60 * 1000);\n      }\n    },\n\n    async $_checkConnectionStatus() {\n\n      console.log('$_checkConnectionStatus invocation');\n\n      if (!this.hasNetworkConnection) {\n        return;\n      }\n\n      const apiUrl = createDrupalUrl(`api?cacheBust=${currentEpochSecond()}`);\n\n      try {\n        const res = await fetch(apiUrl, {credentials: 'same-origin', cache: 'no-cache'});\n\n        if (res.status !== 200) {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        const apiData = await res.json();\n\n        const farmOsVersion = apiData.meta?.farm?.version;\n\n        if (farmOsVersion !== '2.x') {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        this.canReachFarmOS = true;\n\n        const userRef = apiData.meta?.links?.me?.href;\n\n        console.log('apiData', apiData);\n\n        this.isLoggedIn = userRef !== undefined\n      } catch (error) {\n        this.canReachFarmOS = false;\n      }\n    },\n  },\n\n});\n\nfunction sleep(millis) {\n  return new Promise(resolve => setTimeout(resolve, millis));\n}\n\nfunction currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n\nclass Barrier {\n  constructor() {\n    this.waiting = [];\n  }\n\n  arrive(timeoutMillis) {\n    return Promise.race([\n      sleep(timeoutMillis),\n      new Promise(resolve => this.waiting.push(resolve)),\n    ]);\n  }\n\n  release() {\n    const toBeReleased = this.waiting.splice(0);\n    toBeReleased.forEach(p => p());\n  }\n}\n\nexport default FarmOSConnectionStatusDetector;\n","export default class PeekableAsyncIterator {\n  constructor(delegate) {\n    this._delegate = delegate;\n    this._next_iteration_result = undefined;\n  }\n\n  async next() {\n    if (this._next_iteration_result !== undefined) {\n      const next = this._next_iteration_result;\n      this._next_iteration_result = undefined;\n      return next;\n    }\n    return await this._delegate.next();\n  }\n\n  async peek() {\n    if (this._next_iteration_result === undefined) {\n      this._next_iteration_result = await this._delegate.next();\n    }\n    return this._next_iteration_result;\n  }\n\n}\n","export default function currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n","/**\n * A simple async event bus.\n */\nexport default class EventBus {\n\n  constructor() {\n    this._handlersByEventName = {};\n  }\n\n  $on(eventName, handler) {\n    if (!Object.hasOwn(this._handlersByEventName, eventName)) {\n      this._handlersByEventName[eventName] = [];\n    }\n\n    this._handlersByEventName[eventName].push(handler);\n  }\n\n  async $emit(eventName, arg) {\n    const handlers = this._handlersByEventName[eventName] || [];\n\n    const promises = handlers.map(h => h(arg));\n\n    return Promise.all(promises).then(() => true);\n  }\n\n}\n","export default class HttpAccessDeniedException extends Error {\n  constructor(message, options) {\n    super(message, options);\n  }\n}\n","import Vue from 'vue';\n\nimport createDrupalUrl from '@/createDrupalUrl';\nimport currentEpochSecond from '@/util/currentEpochSecond';\nimport EventBus from '@/util/EventBus';\nimport HttpAccessDeniedException from '@/HttpAccessDeniedException';\n\nexport default class AssetLinkPluginListsCore {\n\n  constructor(assetLink) {\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        lists: [],\n      },\n    });\n\n    this._eventBus = new EventBus();\n\n    this._pluginReferenceTracker = new PluginReferenceTracker(this._eventBus);\n\n    this._defaultPluginList = new HttpPluginList(\n        assetLink._store, \n        createDrupalUrl('/alink/backend/default-plugins.repo.json'),\n        this._pluginReferenceTracker,\n        true,\n    );\n    this._localPluginList = new LocalPluginList(\n        assetLink._store,\n        this._pluginReferenceTracker,\n    );\n    this._extraPluginLists = [];\n\n    this._extraPluginListStoreKey = 'asset-link-extra-plugin-lists';\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  /**\n   * An async event bus used to signal when plugins are added/removed.\n   */\n  get eventBus() {\n    return this._eventBus;\n  }\n\n  async boot() {\n    const extraPluginListUrls = await this._getExtraPluginListUrls();\n\n    this._extraPluginLists = extraPluginListUrls.map(pluginListUrl =>\n      new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false));\n\n    for (let pluginList of [\n          this._defaultPluginList,\n          this._localPluginList,\n          ...this._extraPluginLists,\n        ]) {\n\n      const pluginListView = await pluginList.load();\n\n      this._updatePluginListViewInViewModel(pluginListView);\n    }\n  }\n\n  async addPluginToLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.addPlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removePluginFromLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.removePlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async addExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx >= 0) {\n        return false;\n      }\n      extraPluginListUrls.push(pluginListUrl);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex >= 0) {\n      return;\n    }\n\n    const pluginList = new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false);\n\n    this._extraPluginLists.push(pluginList);\n\n    const pluginListView = await pluginList.load();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removeExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx < 0) {\n        return false;\n      }\n      extraPluginListUrls.splice(idx, 1);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex < 0) {\n      return;\n    }\n\n    const pluginList = this._extraPluginLists.splice(pluginListIndex, 1)[0];\n\n    await pluginList.unload();\n\n    this._removePluginListViewFromViewModel(pluginListUrl);\n  }\n\n  async reloadPluginList(pluginListUrl) {\n    const pluginList = [\n      this._defaultPluginList,\n      this._localPluginList,\n      ...this._extraPluginLists,\n    ].find(pl => pl._url === pluginListUrl);\n\n    if (!pluginList) {\n      return;\n    }\n\n    const pluginListView = await pluginList.reload();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async _getExtraPluginListUrls() {\n    const pluginListUrlsItem = await this._store.getItem(this._extraPluginListStoreKey);\n\n    if (pluginListUrlsItem) {\n      return pluginListUrlsItem.value.map(u => new URL(u));\n    }\n\n    return [];\n  }\n\n  async _modifyAndWriteStoredExtraPluginListUrls(mutatorFn) {\n    const pluginListUrls = await this._getExtraPluginListUrls();\n    const shouldWrite = mutatorFn(pluginListUrls) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._extraPluginListStoreKey, {key: this._extraPluginListStoreKey, timestamp: currentEpochSecond(), value: pluginListUrls});\n    }\n    return pluginListUrls;\n  }\n\n  _updatePluginListViewInViewModel(pluginListView) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListView.sourceUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1, pluginListView);\n    } else {\n      vm.lists.push(pluginListView);\n    }\n  }\n\n  _removePluginListViewFromViewModel(pluginListUrl) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1);\n    }\n  }\n\n}\n\nclass PluginReferenceTracker {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    // Track which lists reference a given plugin by keeping\n    // a mapping between the plugin url and the list urls which\n    // reference it.\n    this._pluginReferences = {\n        // 'https://example.com/alink-plugins/MyAwesomePlugin.alink.js': [ 'https://example.com/cool-alink-plugins.repo.json' ],\n    };\n  }\n\n  /* eslint-disable no-console */\n  async ackPluginReference(pluginUrl, listUrl) {\n    console.log('ackPluginReference', pluginUrl.toString(), listUrl.toString());\n\n    const pluginExists = Object.hasOwn(this._pluginReferences, pluginUrl.toString());\n\n    if (!pluginExists) {\n      this._pluginReferences[pluginUrl.toString()] = [];\n    }\n\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx < 0) {\n      pluginReferences.push(listUrl);\n    }\n\n    if (!pluginExists) {\n      await this._eventBus.$emit('add-plugin', pluginUrl);\n    }\n  }\n\n  /* eslint-disable no-console */\n  async freePluginReference(pluginUrl, listUrl) {\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    if (!pluginReferences) {\n      console.log('freePluginReference unexpectedly found plugin missing from internal reference tracking', pluginUrl.toString(), listUrl.toString(), JSON.stringify(this._pluginReferences));\n      return;\n    }\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx >= 0) {\n      pluginReferences.splice(listIdx, 1);\n    } else {\n      console.log('freePluginReference unexpectedly found plugin without expected reference', pluginUrl.toString(), listUrl.toString(), JSON.stringify(pluginReferences));\n    }\n\n    if (pluginReferences.length > 0) {\n      return;\n    }\n\n    await this._eventBus.$emit('remove-plugin', pluginUrl);\n  }\n}\n\nclass HttpPluginList {\n  constructor(store, url, pluginReferenceTracker, isDefault) {\n    this._store = store;\n    this._storeKey = `asset-link-cached-plugin-list:${url}`;\n    this._url = url;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n    this._isDefault = isDefault;\n\n    this._latestPluginListView = undefined;\n  }\n\n  async load(skipCache) {\n    this._latestPluginListView = postProcessPluginList(await this._getHttpPluginList(skipCache), false, this._url);\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return this._latestPluginListView;\n  }\n\n  async unload() {\n    if (!this._latestPluginListView) {\n      return;\n    }\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.freePluginReference(pRef.url, this._url)));\n\n    await this._store.removeItem(this._storeKey);\n  }\n\n  async reload() {\n    return await this.load(true);\n  }\n\n  async _getHttpPluginList(skipCache) {\n    const cacheItem = skipCache ? undefined : await this._store.getItem(this._storeKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginListRes = await fetch(this._url);\n\n    console.log(pluginListRes);\n    if (pluginListRes.status === 403) {\n      throw new HttpAccessDeniedException(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    } else if (!pluginListRes.ok) {\n      throw new Error(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    }\n\n    const pluginList = await pluginListRes.json();\n\n    await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp, value: pluginList});\n\n    return pluginList;\n  }\n\n}\n\nclass LocalPluginList {\n  constructor(store, pluginReferenceTracker) {\n    this._store = store;\n    this._storeKey = 'local-plugin-list.repo.json';\n    this._url = new URL(\"indexeddb://asset-link/data/local-plugin-list.repo.json\", window.location.origin);\n    this._pluginReferenceTracker = pluginReferenceTracker;\n  }\n\n  async load() {\n    const pluginListView = postProcessPluginList(await this._getLocalPluginList(), false, this._url);\n\n    await Promise.all(pluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return pluginListView;\n  }\n\n  async reload() {\n    return await this.load();\n  }\n\n  async addPlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      if (pl.plugins.find(pRef => pRef.url === pluginUrl.toString())) {\n        return false;\n      }\n      pl.plugins.push({ url: pluginUrl.toString() });\n    });\n\n    await this._pluginReferenceTracker.ackPluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async removePlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      const pluginIndex = pl.plugins.findIndex(pRef => pRef.url === pluginUrl.toString())\n\n      if (pluginIndex < 0) {\n        return false;\n      }\n\n      pl.plugins.splice(pluginIndex, 1);\n    });\n\n    await this._pluginReferenceTracker.freePluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async _getLocalPluginList() {\n    const pluginListItem = await this._store.getItem(this._storeKey);\n\n    if (!pluginListItem) {\n      return { plugins: [] };\n    }\n\n    return pluginListItem.value;\n  }\n\n  async _modifyAndWriteStoredList(mutatorFn) {\n    const pluginList = await this._getLocalPluginList();\n    const shouldWrite = mutatorFn(pluginList) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp: currentEpochSecond(), value: pluginList});\n    }\n    return pluginList;\n  }\n}\n\nconst postProcessPluginList = (pluginList, isDefault, sourceUrl) => {\n  pluginList.isDefault = isDefault;\n  pluginList.sourceUrl = sourceUrl;\n\n  if (!pluginList.error) {\n    pluginList.error = undefined;\n  }\n\n  if (!pluginList.plugins) {\n    pluginList.plugins = [];\n  }\n\n  pluginList.plugins = pluginList.plugins.map(pluginRef => {\n    // Resolve relative paths on this server, but still allow for\n    // arbitrary absolute/third-party urls\n    const pluginUrl = new URL(pluginRef.url, window.location.origin);\n\n    return {\n      url: pluginUrl,\n    };\n  });\n\n  return pluginList;\n};\n","import Vue from 'vue';\n\nimport { loadModule } from 'vue3-sfc-loader/dist/vue2-sfc-loader.js';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nexport default class AssetLinkPluginLoaderCore {\n\n  constructor(assetLink) {\n    this._assetLink = assetLink;\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        plugins: [],\n      },\n    });\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  async boot() {\n    // TODO: ?\n  }\n\n  async loadPlugin(pluginUrl) {\n    const startTime = performance.now();\n\n    let pluginInstance = undefined;\n\n    try {\n      let pluginDataUrl = await this._fetchPlugin(pluginUrl);\n\n      if (pluginUrl.pathname.endsWith('alink.js')) {\n        const pluginCls = (await import(/* webpackIgnore: true */ pluginDataUrl)).default;\n        pluginInstance = new pluginCls();\n      } else if (pluginUrl.pathname.endsWith('alink.vue')) {\n        const pluginUrlWithoutParams = new URL(pluginUrl.toString());\n        pluginUrlWithoutParams.search = '';\n\n        const vuetify = await import('vuetify/lib');\n\n        const vuetifyComponents = {};\n        const vuetifyDirectives = {};\n\n        Object.entries(vuetify).forEach(([entryName, entry]) => {\n          if (Object.prototype.hasOwnProperty.call(entry, 'component')) {\n            vuetifyComponents[entryName] = entry;\n          } else if (['bind', 'inserted', 'update', 'componentUpdated', 'unbind'].find(directiveHook => Object.prototype.hasOwnProperty.call(entry, directiveHook))) {\n            vuetifyDirectives[entryName] = entry;\n          }\n        });\n\n        let rawPluginFileData = await fetch(pluginDataUrl).then(r => r.text());\n\n        // Roughly based on https://harlanzw.com/blog/vue-automatic-component-imports/\n        // and https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/loader.js#L110-L144\n        const compiler = await import('vue-template-compiler');\n\n        const tags = new Set()\n        const attrs = new Set()\n        const component = compiler.parseComponent(rawPluginFileData)\n        if (component.template) {\n          if (component.template.src) {\n            throw new Error(`External component template content is not supported.`);\n          }\n          compiler.compile(component.template.content, {\n            modules: [{\n              postTransformNode: node => {\n                if (\"directives\" in node) {\n                  node.directives.forEach(({ name }) => attrs.add(name))\n                }\n                tags.add(node.tag)\n              }\n            }]\n          });\n        }\n\n        /* eslint-disable no-unused-vars */\n        const usedVuetifyTags = Array.from(tags).map(item => [hyphenate(item), capitalize(camelize(item))])\n          .filter(([kebabTag, camelTag]) => kebabTag.startsWith('v-') && Object.prototype.hasOwnProperty.call(vuetifyComponents, camelTag))\n          .map(([kebabTag, camelTag]) => [camelTag, vuetifyComponents[camelTag]]);\n\n        const usedVuetifyDirectives = Array.from(attrs).map(item => capitalize(camelize(item)))\n          .filter(camelAttr => Object.prototype.hasOwnProperty.call(vuetifyDirectives, camelAttr))\n          .map(camelAttr => [camelAttr, vuetifyDirectives[camelAttr]]);\n\n        const options = {\n          moduleCache: {\n            vue: Vue,\n            'vuetify/lib': vuetify,\n\n            // TODO: Figure out how to make loading these cleaner/on-demand\n            'vue-codemirror': await import('vue-codemirror'),\n            'codemirror/mode/javascript/javascript.js': await import('codemirror/mode/javascript/javascript.js'),\n            'codemirror/mode/vue/vue.js': await import('codemirror/mode/vue/vue.js'),\n            'codemirror/lib/codemirror.css': await import('codemirror/lib/codemirror.css'),\n            'codemirror/theme/base16-dark.css': await import('codemirror/theme/base16-dark.css'),\n          },\n          async getFile(url) {\n            if ( url === pluginUrlWithoutParams ) {\n              return rawPluginFileData;\n            } else {\n              throw new Error(`Secondary imports are not supported. url=${url}`);\n            }\n          },\n          addStyle() { /* TODO */ },\n        };\n\n        pluginInstance = await loadModule(pluginUrlWithoutParams, options);\n\n        if (usedVuetifyTags.length && !pluginInstance.components) pluginInstance.components = {};\n        usedVuetifyTags.filter(t => !pluginInstance.components[t[0]]).forEach(t => pluginInstance.components[t[0]] = t[1]);\n\n        if (usedVuetifyDirectives.length && !pluginInstance.directives) pluginInstance.directives = {};\n        usedVuetifyDirectives.filter(t => !pluginInstance.directives[t[0]]).forEach(t => pluginInstance.directives[t[0]] = t[1]);\n\n        Vue.component(pluginInstance.name, pluginInstance);\n      } else {\n        throw new Error(`Cannot load plugin ${pluginUrl} with unsupported type. Path of url must end in '.alink.js' or '.alink.vue'`);\n      }\n\n      pluginInstance.pluginUrl = pluginUrl;\n\n      this.registerPlugin(pluginInstance);\n    } catch (error) {\n      console.log(error);\n      pluginInstance = {};\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.error = error;\n      this.registerPlugin(pluginInstance);\n    } finally {\n      const endTime = performance.now();\n      console.log(`Loading plugin ${pluginUrl} took ${endTime - startTime} milliseconds`);\n    }\n  }\n\n  /**\n   * Directly register a plugin with Asset Link. Note that plugins registered this way\n   * will not persist between sessions/reloads.\n   */\n  registerPlugin(plugin) {\n    plugin.definedRoutes = {};\n    plugin.definedActions = {};\n    plugin.definedMetaActions = {};\n    plugin.definedConfigActions = {};\n\n    this.vm.plugins.push(plugin);\n\n    if (typeof plugin.onLoad === 'function') {\n      const handle = new AssetLinkPluginHandle(plugin, this.vm);\n\n      plugin.onLoad(handle, this._assetLink);\n    }\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async unloadPlugin(pluginUrl) {\n    // TODO: implement\n  }\n\n  async _fetchPlugin(url) {\n    const skipCache = url.searchParams && url.searchParams.get('skipCache');\n\n    const cacheKey = `asset-link-cached-plugin-src:${url}`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (!skipCache && cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginSrc = await fetch(url).then(r => r.text());\n\n    const pluginDataUrl = \"data:application/javascript;base64,\" + btoa(pluginSrc);\n\n    if (!skipCache) {\n      await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: pluginDataUrl});\n    }\n\n    return pluginDataUrl;\n  }\n\n}\n\nclass AssetLinkPluginHandle {\n\n  constructor(pluginInstance, vm) {\n    this._pluginInstance = pluginInstance;\n    this._vm = vm;\n  }\n\n  defineRoute(routeName, routeDefiner) {\n    const routeDef = {name: routeName};\n\n    const routeHandle = {\n        path(path) {\n          routeDef.path = path;\n        },\n        componentFn(componentFn) {\n          routeDef.componentFn = componentFn;\n        },\n    };\n\n    routeDefiner(routeHandle);\n\n    const missingFields = Object.entries({'path': 'string', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof routeDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Action '${routeName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, routeDef);\n      return;\n    }\n\n    this._pluginInstance.definedRoutes[routeName] = routeDef;\n\n    this._vm.$emit('add-route', routeDef);\n  }\n\n  defineAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n    \n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedActions[actionId] = actionDef;\n  }\n\n  defineMetaAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n\n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedMetaActions[actionId] = actionDef;\n  }\n\n  defineConfigAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n\n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedConfigActions[actionId] = actionDef;\n  }\n\n}\n\n//Copied from https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/util.js#L6-L18\nconst camelizeRE = /-(\\w)/g\nconst camelize = str => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n}\n\nconst capitalize = str => {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst hyphenateRE = /\\B([A-Z])/g\nconst hyphenate = str => {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n","import Vue from 'vue';\n\nimport { Coordinator, RequestStrategy, SyncStrategy } from '@orbit/coordinator';\nimport { Orbit } from '@orbit/core';\nimport { IndexedDBBucket } from '@orbit/indexeddb-bucket';\nimport { IndexedDBSource } from '@orbit/indexeddb';\nimport { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\nimport DrupalJSONAPISource from '@/DrupalJSONAPISource';\nimport DrupalSyncQueryOperators from '@/DrupalSyncQueryOperators';\n\nimport localforage from 'localforage';\n\nimport fetch from 'cross-fetch';\n\nimport AssetLinkUI from '@/AssetLinkUI';\nimport AssetLinkUtil from '@/AssetLinkUtil';\nimport createDrupalUrl from '@/createDrupalUrl';\nimport FarmOSConnectionStatusDetector from '@/FarmOSConnectionStatusDetector';\nimport PeekableAsyncIterator from '@/PeekableAsyncIterator';\nimport AssetLinkPluginListsCore from '@/AssetLinkPluginListsCore';\nimport AssetLinkPluginLoaderCore from '@/AssetLinkPluginLoaderCore';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nconst fetchJson = (url, args) => fetch(url, args).then(response => response.json());\n\n\n\n/**\n * Core of the larger Asset Link application and API entry-point for plugins.\n * \n * TODO: Break out some of the responsibilities of this class into classes that can be\n * delegated to. e.g. plugin management, entities CRUD, etc.\n */\nexport default class AssetLink {\n\n  constructor(app) {\n    this._app = app;\n    this._viewModel = new Vue({\n      data: {\n        booted: false,\n        bootProgress: 0,\n        bootText: \"Starting\",\n\n        connectionStatus: new FarmOSConnectionStatusDetector(),\n\n        pendingUpdates: [],\n\n        messages: [],\n      },\n    });\n\n    this._booted = new Promise((resolve) => {\n      this._viewModel.$once('booted', () => {\n        this._viewModel.booted = true;\n        resolve(true);\n      });\n    });\n\n    this._store = localforage.createInstance({\n      name: 'asset-link',\n      storeName: 'data',\n    });\n\n    this._cores = {};\n    this._cores.pluginLists = new AssetLinkPluginListsCore(this);\n    this._cores.pluginLoader = new AssetLinkPluginLoaderCore(this);\n\n    this._memory = undefined;\n    this._remote = undefined;\n\n    this._ui = new AssetLinkUI(app);\n    this._util = new AssetLinkUtil();\n  }\n\n  /**\n   * The top-level {Vue} app component.\n   */\n  get app() {\n    return this._app;\n  }\n\n  /**\n   * A {Vue} instance used to expose some of Asset Link's state to\n   * its UI in a reactive way.\n   */\n  get viewModel() {\n    return this._viewModel;\n  }\n\n  /**\n   * UI components/methods exposed for Asset Link plugins.\n   */\n  get ui() {\n    return this._ui;\n  }\n\n  /**\n   * Utility methods exposed for Asset Link plugins.\n   */\n  get util() {\n    return this._util;\n  }\n\n  /**\n   * The map of AssetLink cores.\n   */\n  get cores() {\n    return this._cores;\n  }\n\n  /**\n   * The Orbit.js {MemorySource} which is used to access/modify farmOS assets/logs/etc.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get entitySource() {\n    return this._memory;\n  }\n\n  /**\n   * The Orbit.js {JSONAPISource} which is used to directly access/modify\n   * farmOS assets/logs/etc - unless you know what you are doing, use {#entitySource}\n   * instead.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get remoteEntitySource() {\n    return this._remote;\n  }\n\n  /**\n   * The currently loaded plugins.\n   */\n  get plugins() {\n    return this._cores.pluginLoader.vm.plugins;\n  }\n\n  /**\n   * A {Promise} that is fulfilled once Asset Link has booted.\n   */\n  get booted() {\n    return this._booted;\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async boot() {\n    this.viewModel.bootText = \"Initializing storage\";\n\n    await this._store.ready();\n\n    this._cores.pluginLists.eventBus.$on('add-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.loadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLists.eventBus.$on('remove-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.unloadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLoader.vm.$on('add-route', routeDef => {\n      if (typeof this.app.addRoute === 'function') {\n        this.app.addRoute(routeDef);\n      }\n    });\n\n    this._cores.pluginLoader.vm.$on('remove-route', routeDef => {\n      if (typeof this.app.removeRoute === 'function') {\n        this.app.removeRoute(routeDef);\n      }\n    });\n\n    await this._cores.pluginLoader.boot();\n    await this._cores.pluginLists.boot();\n\n    this.viewModel.bootText = \"Loading models...\";\n    this._models = await this._loadModels();\n\n    Orbit.fetch = this._csrfAwareFetch.bind(this);\n\n    this._schema = new RecordSchema({ models: this._models });\n\n    const bucket = new IndexedDBBucket({ namespace: 'asset-link-orbitjs-bucket' });\n\n    this._memory = new MemorySource({\n      schema: this._schema,\n      cacheSettings: {\n        queryOperators: DrupalSyncQueryOperators,\n      },\n    });\n\n    this._remote = new DrupalJSONAPISource({\n      schema: this._schema,\n      name: 'remote',\n      host: createDrupalUrl('/api'),\n      defaultFetchSettings: {\n        timeout: 10000,\n      },\n      bucket,\n      requestQueueSettings: {\n        autoProcess: this.viewModel.connectionStatus.isOnline || false,\n      },\n    });\n\n    const updateViewModelPendingUpdates = () => {\n      this.viewModel.pendingUpdates = this._remote.requestQueue.entries.filter(r => r.type === 'update');\n    };\n\n    this._remote.requestQueue.reified.then(updateViewModelPendingUpdates);\n    this._remote.requestQueue.on('change', updateViewModelPendingUpdates);\n\n    this._backup = new IndexedDBSource({\n      schema: this._schema,\n      name: 'backup',\n      namespace: 'asset-link-orbitjs-entities',\n      defaultTransformOptions: {\n        useBuffer: true,\n      },\n    });\n\n    this._coordinator = new Coordinator({\n      sources: [this._memory, this._remote, this._backup]\n    });\n\n    // Query the remote server when the memory source is queried (and online)\n    this._remoteQueryStrategy = new RequestStrategy({\n      name: 'remoteRequestStrategy',\n\n      source: 'memory',\n      on: 'beforeQuery',\n\n      target: 'remote',\n      action: 'query',\n\n      blocking: true\n    });\n    // Only use the remote query strategy when online\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._coordinator.addStrategy(this._remoteQueryStrategy);\n    }\n\n    // Update the remote server whenever the memory source is updated\n    this._coordinator.addStrategy(\n      new RequestStrategy({\n        source: 'memory',\n        on: 'beforeUpdate',\n\n        target: 'remote',\n        action: 'update',\n\n        blocking: false\n      })\n    );\n\n    // Sync all changes received from the remote server to the memory source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'remote',\n        target: 'memory',\n        blocking: false\n      })\n    );\n\n    // Sync all changes to the backup source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'memory',\n        target: 'backup',\n        blocking: true\n      })\n    );\n\n    // Restore the backup source\n    const allRecordsFromBackup = await this._backup.query((q) => q.findRecords());\n    await this._memory.sync((t) => allRecordsFromBackup.map((r) => t.addRecord(r)));\n\n    await this._coordinator.activate();\n\n    this.viewModel.bootProgress = 100;\n\n    this._memory.on('update', update => {\n      console.log('_memory::update', update);\n\n      if (update.operations.op === 'updateRecord' && update.operations.record.type.startsWith('asset--')) {\n        this.viewModel.$emit('changed:asset', update.operations.record.type, update.operations.record.id);\n      }\n\n    });\n\n    this.viewModel.connectionStatus.$watch('isOnline', async (isOnline) => {\n      this._remote.requestQueue.autoProcess = isOnline;\n      if (isOnline && !this._remote.requestQueue.empty) {\n        this._remote.requestQueue.process();\n      }\n\n      await this._coordinator.deactivate();\n      if (isOnline) {\n        if (!this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.addStrategy(this._remoteQueryStrategy);\n        }\n      } else {\n        if (this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.removeStrategy(this._remoteQueryStrategy.name);\n        }\n      }\n      await this._coordinator.activate();\n    });\n\n    this.viewModel.$emit('booted');\n\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._precache();\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets the model for an entity type given that the type name. e.g. \"asset--plant\"\n   */\n  async getEntityModel(typeName) {\n    await this._booted;\n\n    return this._models[typeName];\n  }\n\n  async _precache() {\n    // Precache the current page's asset\n    const matches = window.location.href.match(/https?:\\/\\/.*\\/asset\\/(\\d+)/);\n    if (matches && matches.length >= 2) {\n      const thisAsset = await this.resolveAsset(matches[1]);\n      console.log(\"thisAsset=\", thisAsset);\n    }\n\n    const timestamp = currentEpochSecond();\n\n    const lastPrecacheTimeKey = `asset-link-last-precache-time`;\n\n    const lastPrecacheTime = await this._store.getItem(lastPrecacheTimeKey);\n\n    if (lastPrecacheTime && (timestamp - lastPrecacheTime) < 900) {\n      console.log(\"Skipping Asset Link precaching because it was done recently...\");\n      return;\n    }\n\n    // Precache recently changed assets\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    await this._memory.query((q) => assetTypes.map(assetType => q.findRecords(`asset--${assetType}`)\n        .sort('-changed')\n        .page({ offset: 0, limit: 100 })));\n\n    // TODO: Consider also precaching recently changed and recent/upcoming logs\n\n    await this._store.setItem(lastPrecacheTimeKey, timestamp);\n  }\n\n  /**\n   * Get a list of the asset_type entities.\n   */\n  async getAssetTypes() {\n    const listAssetTypes = async (source) => {\n      return await source.query((q) => q\n          .findRecords(`asset_type--asset_type`)\n          .sort('drupal_internal__id'));\n    };\n\n    const assetTypes = await listAssetTypes(this._memory.cache);\n\n    if (assetTypes.length) {\n      return assetTypes;\n    }\n\n    return await listAssetTypes(this._memory);\n  }\n\n  /**\n   * Get an asset by UUID or Drupal internal id.\n   */\n  async resolveAsset(assetRef) {\n    await this._booted;\n\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    const isRefNumeric = /^-?\\d+$/.test(assetRef);\n\n    let filter = { attribute: 'id', value: assetRef };\n    if (isRefNumeric) {\n      filter = { attribute: 'drupal_internal__id', value: parseInt(assetRef) };\n    }\n\n    const findAsset = async (source) => {\n      const results = await source.query(q => assetTypes.map(assetType => q\n          .findRecords(`asset--${assetType}`)\n          .filter(filter)\n          .sort('drupal_internal__id')));\n\n      const assets = results.flatMap(l => l);\n\n      return assets.find(a => a);\n    };\n\n    const asset = await findAsset(this._memory.cache);\n\n    if (asset) {\n      return asset;\n    }\n\n    return await findAsset(this._memory);\n  }\n\n  /**\n   * Central asset searching entry-point. Responsible for delegating to asset searching plugins.\n   */\n  searchAssets(searchRequest, searchPhase) {\n    console.log(\"searchAssets:\", JSON.stringify(searchRequest), searchPhase);\n\n    const assetSearchPlugins = this.plugins.filter(p => typeof p.searchAssets === 'function');\n\n    const searchResultCursors = [];\n\n    for (let i = 0; i < assetSearchPlugins.length; i += 1) {\n      const plugin = assetSearchPlugins[i];\n\n      /* eslint-disable no-await-in-loop */\n      const searchResultCursor = plugin.searchAssets(this, searchRequest, searchPhase);\n\n      if (searchResultCursor !== undefined) {\n        searchResultCursors.push(searchResultCursor);\n      }\n    }\n\n    async function* coiterateSearchCursors() {\n      console.log(\"coiterateSearchCursors: searchResultCursors =\", searchResultCursors);\n\n      const peekableSearchResultCursors = searchResultCursors.map(c => new PeekableAsyncIterator(c));\n\n      while(peekableSearchResultCursors.length > 0) {\n\n        console.log(\"coiterateSearchCursors: peekableSearchResultCursors.length =\", peekableSearchResultCursors.length, peekableSearchResultCursors);\n\n        let bestNextCursor = undefined;\n        let doneBestNextCursorIndex = undefined;\n        for (let i = 0; i < peekableSearchResultCursors.length; i += 1) {\n          const thisCursor = peekableSearchResultCursors[i];\n\n          const thisCursorNextResult = await thisCursor.peek();\n\n          if (thisCursorNextResult.value === undefined) {\n            continue;\n          }\n\n          if (bestNextCursor === undefined || thisCursorNextResult.value.weight < (await bestNextCursor.peek()).value.weight) {\n            bestNextCursor = thisCursor;\n            doneBestNextCursorIndex = thisCursorNextResult.done ? i : undefined;\n          }\n        }\n\n        if (bestNextCursor === undefined) {\n          return;\n        }\n\n        const bestCursorNextResult = await bestNextCursor.next();\n\n        if (bestCursorNextResult.value) {\n          yield bestCursorNextResult.value;\n        }\n\n        if (doneBestNextCursorIndex !== undefined) {\n          peekableSearchResultCursors.splice(doneBestNextCursorIndex, 1);\n        }\n\n      }\n    }\n\n    return coiterateSearchCursors();\n  }\n\n  getRelevantActions(asset) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedActions))\n        .filter(a => a.predicateFn(asset))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, asset),\n        }));\n\n    return actions;\n  }\n\n  getRelevantMetaActions(asset) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedMetaActions))\n        .filter(a => a.predicateFn(asset))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, asset),\n        }));\n\n    return actions;\n  }\n\n  getRelevantConfigActions(route) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedConfigActions))\n        .filter(a => a.predicateFn(route))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, route),\n        }));\n\n    return actions;\n  }\n\n  async _csrfAwareFetch(url, opts) {\n    const options = opts || {};\n\n    if (!options.method) options.method = 'GET';\n\n    const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n    const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n    const isUnsafeMethod = !['HEAD', 'GET', 'OPTIONS', 'TRACE'].includes(options.method.toUpperCase());\n\n    const addCsrfHeader = isFarmOSRequest && isUnsafeMethod;\n\n    try {\n      if (addCsrfHeader) {\n        const tokenResponse = await this.viewModel.connectionStatus.fetch(createDrupalUrl('/session/token'));\n\n        console.log(\"tokenResponse:\", tokenResponse);\n\n        const token = await tokenResponse.text();\n\n        // TODO: Cache the token\n        if (!options.headers) options.headers = {};\n        options.headers['X-CSRF-Token'] = token;\n      }\n  \n      return await this.viewModel.connectionStatus.fetch(url, options);\n    } catch (error) {\n      console.log(\"Error in _csrfAwareFetch\", typeof error, error);\n      if (error.message === 'Network request failed') {\n        return new Response(null, {\n          status: 503,\n          statusText: 'Service unavailable due to network error',\n        });\n      }\n      throw error;\n    }\n  }\n\n  async _loadModels() {\n    const cacheKey = `asset-link-cached-entity-models`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    if (cacheItem) {\n      // TODO: If cache item is stale, schedule background refresh\n      return cacheItem.value;\n    }\n\n    const models = await this._loadModelsFromServer();\n\n    const timestamp = currentEpochSecond();\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: models});\n\n    return models;\n  }\n\n  async _loadModelsFromServer() {\n    this.viewModel.bootText = \"Loading server schema\";\n    const serverSchema = await fetchJson(createDrupalUrl('/api/schema'));\n\n    const serverRelatedSchemas = serverSchema.allOf.flatMap(schemaRef => schemaRef.links || []);\n\n    const models = {};\n\n    await Promise.all(serverRelatedSchemas.map(async (serverRelatedSchema) => {\n      const relatedSchema = await fetchJson(serverRelatedSchema.targetSchema);\n\n      const relatedItemSchema = await fetchJson(relatedSchema.definitions.data.items.$ref);\n\n      const typeName = relatedItemSchema.definitions.type['const'];\n\n      models[typeName] = {\n        attributes: Object.fromEntries(\n            Object.entries(relatedItemSchema.definitions.attributes.properties)\n              .map(([attrName, attr]) => {\n                // Orbit.js seems to only support 'number', not 'integer' but handles the former well enough\n                if (attr.type === 'integer') {\n                  attr.type = 'number';\n                }\n\n                // https://www.drupal.org/project/jsonapi_schema/issues/3058850\n                if (attrName === 'third_party_settings') {\n                  attr.type = 'object';\n                }\n\n                return [attrName, attr];\n              })\n        ),\n        relationships: relatedItemSchema.definitions?.relationships?.properties || {},\n      };\n\n      this.viewModel.bootProgress = ((Object.keys(models).length / serverRelatedSchemas.length) * 100).toFixed(1);\n    }));\n\n    return models;\n  }\n\n}\n","export default function createDrupalUrl(pathSuffix) {\n  return new URL(pathSuffix, window.location.origin + window.assetLinkDrupalBasePath);\n}","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n"],"names":["DrupalJSONAPIURLBuilder","settings","filterSpecifiers","filters","forEach","filterSpecifier","index","kind","op","attributeFilter","resourceAttribute","serializeAttributeAsParam","undefined","attribute","push","value","path","operator","relatedRecordFilter","Array","isArray","record","relation","map","e","id","join","QueryExpressionParseError","Error","relatedRecordsFilter","records","type","this","serializer","serializerFor","JSONAPISerializers","serialize","JSONAPIURLBuilder","DrupalJSONAPISource","defaultFetchSettings","Object","assign","headers","Accept","serializerSettingsFor","buildSerializerSettingsFor","sharedSettings","inflectors","drupal","buildInflector","input","replace","settingsByType","serializationOptions","URLBuilderClass","JSONAPISource","findRecord","SyncQueryOperators","findRelatedRecord","findRecords","cache","expression","options","exp","results","getRecordsSync","filter","filterRecords","sort","sortRecords","page","paginateRecords","findRelatedRecords","relationship","relatedIds","getRelatedRecordsSync","length","getRecordSync","raiseNotFoundExceptions","RecordNotFoundException","i","l","applyFilter","attributeKey","split","actual","deepGet","expected","toLowerCase","startsWith","includes","endsWith","sortSpecifiers","comparisonValues","Map","set","sortSpecifier","comparisonOrders","sortExpression","order","record1","record2","values1","get","values2","isNone","paginationOptions","limit","offset","slice","AssetLinkUI","app","_app","VBtn","VListItem","VListItemTitle","confirm","text","$dialog","title","promptText","prompt","custom","component","params","uuidv4","context","Vue","Promise","resolve","$on","dialogs","componentFn","wrapper","h","VDialog","props","fullscreen","on","ref","result","d","AssetLinkUtil","formatRFC3339","createDrupalUrl","geohash","haversine","FarmOSConnectionStatusDetector","fetcherDelegate","default","fetch","data","$_running","$_barrier","Barrier","hasNetworkConnection","window","navigator","onLine","canReachFarmOS","isLoggedIn","created","addEventListener","$data","release","connection","$_mainLoop","computed","isOnline","beforeDestroy","methods","url","opts","method","requestUrl","URL","location","origin","assetLinkDrupalBasePath","isFarmOSRequest","host","pathname","res","status","checkConnectionStatus","throttle","$_checkConnectionStatus","console","log","arrive","apiUrl","currentEpochSecond","credentials","json","apiData","farmOsVersion","meta","farm","version","userRef","links","me","href","sleep","millis","setTimeout","parseInt","Date","getTime","waiting","timeoutMillis","race","toBeReleased","splice","p","PeekableAsyncIterator","delegate","_delegate","_next_iteration_result","next","EventBus","_handlersByEventName","eventName","handler","hasOwn","arg","handlers","promises","all","then","HttpAccessDeniedException","message","AssetLinkPluginListsCore","assetLink","_store","_vm","lists","_eventBus","_pluginReferenceTracker","PluginReferenceTracker","_defaultPluginList","HttpPluginList","_localPluginList","LocalPluginList","_extraPluginLists","_extraPluginListStoreKey","_getExtraPluginListUrls","extraPluginListUrls","pluginListUrl","pluginList","load","pluginListView","_updatePluginListViewInViewModel","pluginUrl","addPlugin","removePlugin","_modifyAndWriteStoredExtraPluginListUrls","idx","findIndex","plUrl","pluginListIndex","pl","_url","unload","_removePluginListViewFromViewModel","find","reload","getItem","pluginListUrlsItem","u","mutatorFn","pluginListUrls","shouldWrite","setItem","key","timestamp","vm","plVIndex","plV","sourceUrl","eventBus","_pluginReferences","listUrl","toString","pluginExists","pluginReferences","listIdx","indexOf","$emit","JSON","stringify","store","pluginReferenceTracker","isDefault","_storeKey","_isDefault","_latestPluginListView","skipCache","postProcessPluginList","_getHttpPluginList","plugins","pRef","ackPluginReference","freePluginReference","removeItem","cacheItem","pluginListRes","statusText","ok","_getLocalPluginList","_modifyAndWriteStoredList","pluginIndex","pluginListItem","error","pluginRef","AssetLinkPluginLoaderCore","_assetLink","startTime","performance","now","pluginInstance","_fetchPlugin","pluginDataUrl","import","pluginCls","pluginUrlWithoutParams","search","vuetify","vuetifyComponents","vuetifyDirectives","entries","entryName","entry","prototype","hasOwnProperty","call","directiveHook","r","rawPluginFileData","compiler","tags","Set","attrs","parseComponent","template","src","compile","content","modules","postTransformNode","node","directives","name","add","tag","usedVuetifyTags","from","item","hyphenate","capitalize","camelize","kebabTag","camelTag","usedVuetifyDirectives","camelAttr","vue","moduleCache","getFile","addStyle","loadModule","components","t","registerPlugin","endTime","plugin","definedRoutes","definedActions","definedMetaActions","definedConfigActions","onLoad","handle","AssetLinkPluginHandle","searchParams","cacheKey","pluginSrc","btoa","_pluginInstance","routeName","routeDefiner","routeDef","routeHandle","missingFields","attr","expectedType","actionId","actionDefiner","actionDef","actionHandle","showIf","predicateFn","missingCallbacks","camelizeRE","str","_","c","toUpperCase","charAt","hyphenateRE","fetchJson","args","response","AssetLink","_viewModel","booted","bootProgress","bootText","connectionStatus","pendingUpdates","messages","_booted","$once","localforage","storeName","_cores","pluginLists","pluginLoader","_memory","_remote","_ui","_util","viewModel","ready","loadPlugin","unloadPlugin","addRoute","removeRoute","boot","_loadModels","_models","Orbit","_csrfAwareFetch","bind","_schema","RecordSchema","models","bucket","IndexedDBBucket","namespace","MemorySource","schema","cacheSettings","queryOperators","DrupalSyncQueryOperators","timeout","requestQueueSettings","autoProcess","updateViewModelPendingUpdates","requestQueue","reified","_backup","IndexedDBSource","defaultTransformOptions","useBuffer","_coordinator","Coordinator","sources","_remoteQueryStrategy","RequestStrategy","source","target","action","blocking","addStrategy","SyncStrategy","query","q","allRecordsFromBackup","sync","addRecord","activate","update","operations","$watch","empty","process","deactivate","strategies","removeStrategy","_precache","typeName","matches","match","resolveAsset","thisAsset","lastPrecacheTimeKey","lastPrecacheTime","getAssetTypes","assetTypes","attributes","drupal_internal__id","assetType","listAssetTypes","assetRef","isRefNumeric","test","findAsset","assets","flatMap","a","asset","searchRequest","searchPhase","assetSearchPlugins","searchAssets","searchResultCursors","searchResultCursor","coiterateSearchCursors","peekableSearchResultCursors","bestNextCursor","doneBestNextCursorIndex","thisCursor","peek","thisCursorNextResult","weight","done","bestCursorNextResult","actions","values","route","isUnsafeMethod","addCsrfHeader","tokenResponse","token","Response","_loadModelsFromServer","serverSchema","serverRelatedSchemas","allOf","schemaRef","serverRelatedSchema","targetSchema","relatedSchema","definitions","items","$ref","relatedItemSchema","fromEntries","properties","attrName","relationships","keys","toFixed","pathSuffix","Vuetify","register","registered","cached","updatefound","updated","offline"],"sourceRoot":""}