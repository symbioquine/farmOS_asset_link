{"version":3,"file":"js/chunk-common-legacy.js","mappings":"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","sources":["webpack://alinkjs/./src/DrupalJSONAPIURLBuilder.js","webpack://alinkjs/./src/DrupalJSONAPISource.js","webpack://alinkjs/./src/DrupalSyncQueryOperators.js","webpack://alinkjs/./src/AssetLinkUI.js","webpack://alinkjs/./src/AssetLinkUtil.js","webpack://alinkjs/./src/FarmOSConnectionStatusDetector.js","webpack://alinkjs/./src/PeekableAsyncIterator.js","webpack://alinkjs/./src/util/currentEpochSecond.js","webpack://alinkjs/./src/util/EventBus.js","webpack://alinkjs/./src/HttpAccessDeniedException.js","webpack://alinkjs/./src/AssetLinkPluginListsCore.js","webpack://alinkjs/./src/AssetLinkPluginLoaderCore.js","webpack://alinkjs/./src/AssetLink.js","webpack://alinkjs/./src/createDrupalUrl.js","webpack://alinkjs/./src/plugins/vuetify.js","webpack://alinkjs/./src/registerServiceWorker.js"],"sourcesContent":["import { JSONAPIURLBuilder } from \"@orbit/jsonapi\";\nimport { QueryExpressionParseError } from \"@orbit/data\";\nimport { JSONAPISerializers } from '@orbit/jsonapi';\n\n/**\n * Extends {JSONAPIURLBuilder} to add support for Drupal JSON:API query operators.\n * \n * Loosely based on https://gist.github.com/bradjones1/18ff9ebdb85455f781a2a212577653ce\n */\nexport default class DrupalJSONAPIURLBuilder extends JSONAPIURLBuilder {\n\n  constructor(settings) {\n    super(settings);\n  }\n\n  buildFilterParam(filterSpecifiers) {\n    const filters = [];\n\n    filterSpecifiers.forEach((filterSpecifier, index) => {\n      if (\n        filterSpecifier.kind === 'attribute' &&\n        filterSpecifier.op === 'equal'\n      ) {\n        const attributeFilter = filterSpecifier;\n\n        // Note: We don't know the `type` of the attribute here, so passing `undefined`\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({ [resourceAttribute]: attributeFilter.value });\n      } else if (filterSpecifier.kind === 'attribute') {\n        const attributeFilter = filterSpecifier;\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({\n          ['client-' + resourceAttribute + '-' + index]: {\n            path: resourceAttribute,\n            operator: attributeFilter.op,\n            value: attributeFilter.value\n          }\n        });\n      } else if (filterSpecifier.kind === 'relatedRecord') {\n        const relatedRecordFilter = filterSpecifier;\n        if (Array.isArray(relatedRecordFilter.record)) {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter.record\n              .map((e) => e.id)\n              .join(',')\n          });\n        } else {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter?.record?.id\n          });\n        }\n      } else if (filterSpecifier.kind === 'relatedRecords') {\n        if (filterSpecifier.op !== 'equal') {\n          throw new Error(\n            `Operation \"${filterSpecifier.op}\" is not supported in JSONAPI for relatedRecords filtering`\n          );\n        }\n        const relatedRecordsFilter = filterSpecifier;\n        filters.push({\n          [relatedRecordsFilter.relation]: relatedRecordsFilter.records\n            .map((e) => e.id)\n            .join(',')\n        });\n      } else {\n        throw new QueryExpressionParseError(\n          `Filter operation ${filterSpecifier.op} not recognized for JSONAPISource.`\n        );\n      }\n    });\n\n    return filters;\n  }\n\n  serializeAttributeAsParam(type, attribute) {\n      if (this.serializer) {\n        return this.serializer.resourceAttribute(type, attribute);\n      } else {\n        const serializer = this.serializerFor(JSONAPISerializers.ResourceFieldParam);\n        return serializer.serialize(attribute, { type });\n      }\n    }\n\n}\n","import JSONAPISource, { JSONAPISerializers } from '@orbit/jsonapi';\nimport { buildSerializerSettingsFor, buildInflector } from '@orbit/serializers';\n\nimport DrupalJSONAPIURLBuilder from '@/DrupalJSONAPIURLBuilder';\n\n\n/**\n * Handle Drupal's `type/bundle` JSON:API resource pathing.\n * Based on: https://github.com/orbitjs/orbit/issues/714#issuecomment-1013952990\n */\nexport default class DrupalJSONAPISource extends JSONAPISource {\n  constructor(settings) {\n    const defaultFetchSettings = Object.assign({}, settings.defaultFetchSettings || {}, {\n      headers:{\n        Accept: 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json',\n      },\n    });\n\n    super(Object.assign({}, settings, {\n      defaultFetchSettings,\n      serializerSettingsFor: buildSerializerSettingsFor({\n        sharedSettings: {\n          inflectors: {\n            drupal: buildInflector(\n              {},\n              (input) => input.replace('--', '/')\n            )\n          }\n        },\n        settingsByType: {\n          [JSONAPISerializers.ResourceTypePath]: {\n            serializationOptions: {inflectors: ['drupal']}\n          }\n        }\n      }),\n      URLBuilderClass: DrupalJSONAPIURLBuilder,\n    }));\n  }\n\n}\n","import { SyncQueryOperators } from '@orbit/record-cache';\nimport { QueryExpressionParseError } from '@orbit/data';\nimport { RecordNotFoundException } from '@orbit/records';\nimport { deepGet, isNone } from '@orbit/utils';\n\n// Based on https://github.com/orbitjs/orbit/blob/2c4bf7038d2f74ba31e45e949c70ec4161ced28f/packages/@orbit/record-cache/src/operators/sync-query-operators.ts\nexport default {\n  findRecord: SyncQueryOperators.findRecord,\n  findRelatedRecord: SyncQueryOperators.findRelatedRecord,\n\n  findRecords(\n      cache,\n      expression,\n      // eslint-disable-next-line no-unused-vars\n      options\n    ) {\n      let exp = expression;\n      let results = cache.getRecordsSync(exp.records || exp.type);\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n\n  findRelatedRecords(\n      cache,\n      expression,\n      options\n    ) {\n      const exp = expression;\n      const { record, relationship } = exp;\n      const relatedIds = cache.getRelatedRecordsSync(record, relationship);\n      if (!relatedIds || relatedIds.length === 0) {\n        if (!cache.getRecordSync(record)) {\n          if (options?.raiseNotFoundExceptions) {\n            throw new RecordNotFoundException(record.type, record.id);\n          } else {\n            return undefined;\n          }\n        }\n\n        return [];\n      }\n      let results = cache.getRecordsSync(relatedIds);\n\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n}\n\nfunction filterRecords(records, filters) {\n  return records.filter((record) => {\n    for (let i = 0, l = filters.length; i < l; i++) {\n      if (!applyFilter(record, filters[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction applyFilter(record, filter) {\n\n  if (filter.kind === 'attribute') {\n    let attributeKey = filter.attribute.split('.');\n\n    let actual = deepGet(record, ['attributes', ...attributeKey]);\n\n    let expected = filter.value;\n\n    // https://api.drupal.org/api/drupal/core%21modules%21jsonapi%21src%21Query%21EntityCondition.php/property/EntityCondition%3A%3AallowedOperators/9.4.x\n    switch (filter.op) {\n      case 'equal':\n      case '=':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() === expected.toLowerCase();\n        }\n        return actual === expected;\n      case '<>':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() !== expected.toLowerCase();\n        }\n        return actual !== expected;\n      case '>':\n        return actual > expected;\n      case '>=':\n        return actual >= expected;\n      case '<':\n        return actual < expected;\n      case '<=':\n        return actual <= expected;\n      case 'STARTS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().startsWith(expected.toLowerCase());\n      case 'CONTAINS':\n        return typeof actual === 'string' && actual.toLowerCase().includes(expected.toLowerCase());\n      case 'ENDS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().endsWith(expected.toLowerCase());\n      case 'IN':\n      case 'NOT IN':\n      case 'BETWEEN':\n      case 'NOT BETWEEN':\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} is not yet implemented for Store.`);\n      case 'IS NULL':\n        return actual === undefined || actual === null;\n      case 'IS NOT NULL':\n        return actual !== undefined && actual !== null;\n      default:\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} not recognized for Store.`);\n    }\n  }\n  return SyncQueryOperators.applyFilter(record, filter);\n}\n\nfunction sortRecords(\n    records,\n    sortSpecifiers\n  ) {\n  const comparisonValues = new Map();\n\n  records.forEach((record) => {\n    comparisonValues.set(\n      record,\n      sortSpecifiers.map((sortSpecifier) => {\n        if (sortSpecifier.kind === 'attribute') {\n          let attributeKey = sortSpecifier.attribute.split('.');\n\n          return deepGet(record, [\n            'attributes',\n            ...attributeKey,\n          ]);\n        } else {\n          throw new QueryExpressionParseError(\n            'Sort specifier ${sortSpecifier.kind} not recognized for Store.'\n          );\n        }\n      })\n    );\n  });\n\n  const comparisonOrders = sortSpecifiers.map((sortExpression) =>\n    sortExpression.order === 'descending' ? -1 : 1\n  );\n\n  return records.sort((record1, record2) => {\n    const values1 = comparisonValues.get(record1);\n    const values2 = comparisonValues.get(record2);\n    for (let i = 0; i < sortSpecifiers.length; i++) {\n      if (values1[i] < values2[i]) {\n        return -comparisonOrders[i];\n      } else if (values1[i] > values2[i]) {\n        return comparisonOrders[i];\n      } else if (isNone(values1[i]) && !isNone(values2[i])) {\n        return comparisonOrders[i];\n      } else if (isNone(values2[i]) && !isNone(values1[i])) {\n        return -comparisonOrders[i];\n      }\n    }\n    return 0;\n  });\n}\n\nfunction paginateRecords(\n  records,\n  paginationOptions\n) {\n  if (paginationOptions.limit !== undefined) {\n    let offset =\n      paginationOptions.offset === undefined ? 0 : paginationOptions.offset;\n    let limit = paginationOptions.limit;\n\n    return records.slice(offset, offset + limit);\n  } else {\n    throw new QueryExpressionParseError(\n      'Pagination options not recognized for Store. Please specify `offset` and `limit`.'\n    );\n  }\n}\n","import Vue from 'vue';\nimport {\n  VBtn,\n  VDialog,\n  VListItem,\n  VListItemTitle,\n} from 'vuetify/lib'\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class AssetLinkUI {\n\n  constructor(app) {\n    this._app = app;\n  }\n\n  /**\n   * Provide some basic components to support Asset Link plugins defined as single (uncompiled) JS\n   * files.\n   * \n   * Commonly accessed via `assetLink.ui.c` e.g. `h(assetLink.ui.c.VBtn, { props: ...`\n   */\n  get c() {\n    return {\n      VBtn,\n      VListItem,\n      VListItemTitle,\n    };\n  }\n\n  /**\n   * \n   */\n  get dialog() {\n    return {\n      confirm: async (text) => {\n        return await this._app.$dialog.confirm({\n          text,\n          title: 'Confirmation'\n        });\n      },\n      promptText: async (text) => {\n        return await this._app.$dialog.prompt({\n          text,\n          title: 'Input',\n        });\n      },\n      custom: async (component, params) => {\n        const id = uuidv4();\n\n        const context = new Vue({});\n\n        const result = await new Promise(resolve => {\n          context.$on('submit', resolve);\n\n          this._app.dialogs.push({\n            id,\n            context,\n            componentFn: (wrapper, h) =>\n              h(VDialog, {\n                props: { value: true, fullscreen: true },\n                on: {\n                  input: () => resolve(undefined),\n                },\n              },  [h(component, {ref: 'dialogComponent', ...params})] ),\n          });\n        });\n\n        this._app.dialogs = this._app.dialogs.filter(d => d.id !== id);\n\n        return result;\n      },\n    };\n  }\n\n}\n","import { formatRFC3339 } from 'date-fns'\nimport createDrupalUrl from '@/createDrupalUrl';\nimport geohash from 'ngeohash';\nimport haversine from 'haversine-distance';\n\nexport default class AssetLinkUtil {\n\n  /**\n   * Format a date object as an RFC 3339 date string. e.g. '2019-09-18T19:00:52Z'\n   */\n  get formatRFC3339() {\n    return formatRFC3339;\n  }\n\n  /**\n   * Create a URL relative to the Drupal installation base path given the URL path suffix.\n   */\n  get createDrupalUrl() {\n    return createDrupalUrl;\n  }\n\n  /**\n   * The node-geohash module: https://github.com/sunng87/node-geohash\n   */\n  get geohash() {\n    return geohash;\n  }\n\n  /**\n   * A haversine distance function: https://github.com/dcousens/haversine-distance\n   */\n  get haversine() {\n    return haversine;\n  }\n\n  /**\n   * Roughly implements the same convention encoded in\n   * https://github.com/farmOS/farmOS/blob/04bf771d91cde8276b67090d2b97c4e4558332b9/modules/core/log/farm_log.module#L74-L88\n   */\n  summarizeAssetNames(assets) {\n    if (assets.length <= 3) {\n      return assets.map(a => a.attributes.name).join(\", \");\n    }\n    return `${assets[0].attributes.name} (+${assets.length - 1} more)`;\n  }\n\n}\n","import Vue from 'vue';\nimport fetch from 'cross-fetch';\nimport throttle from '@jcoreio/async-throttle'\nimport createDrupalUrl from '@/createDrupalUrl';\n\n/**\n * Responsible for detecting online/offline/login status\n * for our connection to the farmOS server both through\n * self-initiated polling and by observing the outcome of\n * decorated fetch requests.\n * \n * @implements {IHttpFetcher}\n */\nconst FarmOSConnectionStatusDetector = Vue.extend({\n\n  props: {\n    fetcherDelegate: {\n      type: Object,\n      default: function () {\n        return { fetch: fetch };\n      }\n    }\n  },\n\n  data() {\n    return {\n      $_running: false,\n      $_barrier: new Barrier(),\n\n      hasNetworkConnection: window.navigator.onLine,\n      canReachFarmOS: undefined,\n      isLoggedIn: undefined,\n    };\n  },\n\n  created() {\n    window.addEventListener('offline', () => {\n      this.hasNetworkConnection = false;\n      this.canReachFarmOS = false;\n    });\n    window.addEventListener('online', () => {\n      this.hasNetworkConnection = true;\n      this.$data.$_barrier.release();\n    });\n    if (window.navigator && window.navigator.connection) {\n      window.navigator.connection.addEventListener('change', () => this.$data.$_barrier.release());\n    }\n    this.$_mainLoop();\n  },\n\n  computed: {\n    isOnline() {\n      return this.canReachFarmOS && this.isLoggedIn;\n    },\n  },\n\n  beforeDestroy() {\n    this.$data.$_running = false;\n    this.$data.$_barrier.release();\n  },\n\n  methods: {\n\n    /**\n     * Decorate fetch requests to detect connection/authentication problems with\n     * requests that are already being sent.\n     */\n    async fetch(url, opts) {\n      const options = opts || {};\n\n      if (!options.method) options.method = 'GET';\n\n      const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n      const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n\n      try {\n        const res = await this.fetcherDelegate.fetch(url, options);\n        if (isFarmOSRequest && res.status === 403) {\n          this.$data.$_barrier.release();\n        }\n        return res;\n      } catch (error) {\n        if (isFarmOSRequest) {\n          this.$data.$_barrier.release();\n        }\n        throw error;\n      }\n    },\n\n    async $_mainLoop() {\n      this.$data.$_running = true;\n\n      const checkConnectionStatus = throttle(() => this.$_checkConnectionStatus(), 1000);\n\n      while (this.$data.$_running) {\n        await checkConnectionStatus();\n        await this.$data.$_barrier.arrive(60 * 1000);\n      }\n    },\n\n    async $_checkConnectionStatus() {\n      if (!this.hasNetworkConnection) {\n        return;\n      }\n\n      const apiUrl = createDrupalUrl(`api?cacheBust=${currentEpochSecond()}`);\n\n      try {\n        const res = await fetch(apiUrl, {credentials: 'same-origin', cache: 'no-cache'});\n\n        if (res.status !== 200) {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        const apiData = await res.json();\n\n        const farmOsVersion = apiData.meta?.farm?.version;\n\n        if (farmOsVersion !== '2.x') {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        this.canReachFarmOS = true;\n\n        const userRef = apiData.meta?.links?.me?.href;\n\n        this.isLoggedIn = userRef !== undefined\n      } catch (error) {\n        this.canReachFarmOS = false;\n      }\n    },\n  },\n\n});\n\nfunction sleep(millis) {\n  return new Promise(resolve => setTimeout(resolve, millis));\n}\n\nfunction currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n\nclass Barrier {\n  constructor() {\n    this.waiting = [];\n  }\n\n  arrive(timeoutMillis) {\n    return Promise.race([\n      sleep(timeoutMillis),\n      new Promise(resolve => this.waiting.push(resolve)),\n    ]);\n  }\n\n  release() {\n    const toBeReleased = this.waiting.splice(0);\n    toBeReleased.forEach(p => p());\n  }\n}\n\nexport default FarmOSConnectionStatusDetector;\n","export default class PeekableAsyncIterator {\n  constructor(delegate) {\n    this._delegate = delegate;\n    this._next_iteration_result = undefined;\n  }\n\n  async next() {\n    if (this._next_iteration_result !== undefined) {\n      const next = this._next_iteration_result;\n      this._next_iteration_result = undefined;\n      return next;\n    }\n    return await this._delegate.next();\n  }\n\n  async peek() {\n    if (this._next_iteration_result === undefined) {\n      this._next_iteration_result = await this._delegate.next();\n    }\n    return this._next_iteration_result;\n  }\n\n}\n","export default function currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n","/**\n * A simple async event bus.\n */\nexport default class EventBus {\n\n  constructor() {\n    this._handlersByEventName = {};\n  }\n\n  $on(eventName, handler) {\n    if (!Object.hasOwn(this._handlersByEventName, eventName)) {\n      this._handlersByEventName[eventName] = [];\n    }\n\n    this._handlersByEventName[eventName].push(handler);\n  }\n\n  async $emit(eventName, arg) {\n    const handlers = this._handlersByEventName[eventName] || [];\n\n    const promises = handlers.map(h => h(arg));\n\n    return Promise.all(promises).then(() => true);\n  }\n\n}\n","export default class HttpAccessDeniedException extends Error {\n  constructor(message, options) {\n    super(message, options);\n  }\n}\n","import Vue from 'vue';\n\nimport createDrupalUrl from '@/createDrupalUrl';\nimport currentEpochSecond from '@/util/currentEpochSecond';\nimport EventBus from '@/util/EventBus';\nimport HttpAccessDeniedException from '@/HttpAccessDeniedException';\n\nexport default class AssetLinkPluginListsCore {\n\n  constructor(assetLink) {\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        lists: [],\n      },\n    });\n\n    this._eventBus = new EventBus();\n\n    this._pluginReferenceTracker = new PluginReferenceTracker(this._eventBus);\n\n    this._defaultPluginList = new HttpPluginList(\n        assetLink._store, \n        createDrupalUrl('/alink/backend/default-plugins.repo.json'),\n        this._pluginReferenceTracker,\n        true,\n    );\n    this._localPluginList = new LocalPluginList(\n        assetLink._store,\n        this._pluginReferenceTracker,\n    );\n    this._extraPluginLists = [];\n\n    this._extraPluginListStoreKey = 'asset-link-extra-plugin-lists';\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  /**\n   * An async event bus used to signal when plugins are added/removed.\n   */\n  get eventBus() {\n    return this._eventBus;\n  }\n\n  async boot() {\n    const extraPluginListUrls = await this._getExtraPluginListUrls();\n\n    this._extraPluginLists = extraPluginListUrls.map(pluginListUrl =>\n      new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false));\n\n    for (let pluginList of [\n          this._defaultPluginList,\n          this._localPluginList,\n          ...this._extraPluginLists,\n        ]) {\n\n      const pluginListView = await pluginList.load();\n\n      this._updatePluginListViewInViewModel(pluginListView);\n    }\n  }\n\n  async addPluginToLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.addPlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removePluginFromLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.removePlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async addExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx >= 0) {\n        return false;\n      }\n      extraPluginListUrls.push(pluginListUrl);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex >= 0) {\n      return;\n    }\n\n    const pluginList = new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false);\n\n    this._extraPluginLists.push(pluginList);\n\n    const pluginListView = await pluginList.load();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removeExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx < 0) {\n        return false;\n      }\n      extraPluginListUrls.splice(idx, 1);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex < 0) {\n      return;\n    }\n\n    const pluginList = this._extraPluginLists.splice(pluginListIndex, 1)[0];\n\n    await pluginList.unload();\n\n    this._removePluginListViewFromViewModel(pluginListUrl);\n  }\n\n  async reloadPluginList(pluginListUrl) {\n    const pluginList = [\n      this._defaultPluginList,\n      this._localPluginList,\n      ...this._extraPluginLists,\n    ].find(pl => pl._url === pluginListUrl);\n\n    if (!pluginList) {\n      return;\n    }\n\n    const pluginListView = await pluginList.reload();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async _getExtraPluginListUrls() {\n    const pluginListUrlsItem = await this._store.getItem(this._extraPluginListStoreKey);\n\n    if (pluginListUrlsItem) {\n      return pluginListUrlsItem.value.map(u => new URL(u));\n    }\n\n    return [];\n  }\n\n  async _modifyAndWriteStoredExtraPluginListUrls(mutatorFn) {\n    const pluginListUrls = await this._getExtraPluginListUrls();\n    const shouldWrite = mutatorFn(pluginListUrls) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._extraPluginListStoreKey, {key: this._extraPluginListStoreKey, timestamp: currentEpochSecond(), value: pluginListUrls});\n    }\n    return pluginListUrls;\n  }\n\n  _updatePluginListViewInViewModel(pluginListView) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListView.sourceUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1, pluginListView);\n    } else {\n      vm.lists.push(pluginListView);\n    }\n  }\n\n  _removePluginListViewFromViewModel(pluginListUrl) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1);\n    }\n  }\n\n}\n\nclass PluginReferenceTracker {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    // Track which lists reference a given plugin by keeping\n    // a mapping between the plugin url and the list urls which\n    // reference it.\n    this._pluginReferences = {\n        // 'https://example.com/alink-plugins/MyAwesomePlugin.alink.js': [ 'https://example.com/cool-alink-plugins.repo.json' ],\n    };\n  }\n\n  /* eslint-disable no-console */\n  async ackPluginReference(pluginUrl, listUrl) {\n    console.log('ackPluginReference', pluginUrl.toString(), listUrl.toString());\n\n    const pluginExists = Object.hasOwn(this._pluginReferences, pluginUrl.toString());\n\n    if (!pluginExists) {\n      this._pluginReferences[pluginUrl.toString()] = [];\n    }\n\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx < 0) {\n      pluginReferences.push(listUrl);\n    }\n\n    if (!pluginExists) {\n      await this._eventBus.$emit('add-plugin', pluginUrl);\n    }\n  }\n\n  /* eslint-disable no-console */\n  async freePluginReference(pluginUrl, listUrl) {\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    if (!pluginReferences) {\n      console.log('freePluginReference unexpectedly found plugin missing from internal reference tracking', pluginUrl.toString(), listUrl.toString(), JSON.stringify(this._pluginReferences));\n      return;\n    }\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx >= 0) {\n      pluginReferences.splice(listIdx, 1);\n    } else {\n      console.log('freePluginReference unexpectedly found plugin without expected reference', pluginUrl.toString(), listUrl.toString(), JSON.stringify(pluginReferences));\n    }\n\n    if (pluginReferences.length > 0) {\n      return;\n    }\n\n    await this._eventBus.$emit('remove-plugin', pluginUrl);\n  }\n}\n\nclass HttpPluginList {\n  constructor(store, url, pluginReferenceTracker, isDefault) {\n    this._store = store;\n    this._storeKey = `asset-link-cached-plugin-list:${url}`;\n    this._url = url;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n    this._isDefault = isDefault;\n\n    this._latestPluginListView = undefined;\n  }\n\n  async load(skipCache) {\n    this._latestPluginListView = postProcessPluginList(await this._getHttpPluginList(skipCache), false, this._url);\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return this._latestPluginListView;\n  }\n\n  async unload() {\n    if (!this._latestPluginListView) {\n      return;\n    }\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.freePluginReference(pRef.url, this._url)));\n\n    await this._store.removeItem(this._storeKey);\n  }\n\n  async reload() {\n    return await this.load(true);\n  }\n\n  async _getHttpPluginList(skipCache) {\n    const cacheItem = skipCache ? undefined : await this._store.getItem(this._storeKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginListRes = await fetch(this._url);\n\n    console.log(pluginListRes);\n    if (pluginListRes.status === 403) {\n      throw new HttpAccessDeniedException(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    } else if (!pluginListRes.ok) {\n      throw new Error(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    }\n\n    const pluginList = await pluginListRes.json();\n\n    await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp, value: pluginList});\n\n    return pluginList;\n  }\n\n}\n\nclass LocalPluginList {\n  constructor(store, pluginReferenceTracker) {\n    this._store = store;\n    this._storeKey = 'local-plugin-list.repo.json';\n    this._url = new URL(\"indexeddb://asset-link/data/local-plugin-list.repo.json\", window.location.origin);\n    this._pluginReferenceTracker = pluginReferenceTracker;\n  }\n\n  async load() {\n    const pluginListView = postProcessPluginList(await this._getLocalPluginList(), false, this._url);\n\n    await Promise.all(pluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return pluginListView;\n  }\n\n  async reload() {\n    return await this.load();\n  }\n\n  async addPlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      if (pl.plugins.find(pRef => pRef.url === pluginUrl.toString())) {\n        return false;\n      }\n      pl.plugins.push({ url: pluginUrl.toString() });\n    });\n\n    await this._pluginReferenceTracker.ackPluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async removePlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      const pluginIndex = pl.plugins.findIndex(pRef => pRef.url === pluginUrl.toString())\n\n      if (pluginIndex < 0) {\n        return false;\n      }\n\n      pl.plugins.splice(pluginIndex, 1);\n    });\n\n    await this._pluginReferenceTracker.freePluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, false, this._url);\n  }\n\n  async _getLocalPluginList() {\n    const pluginListItem = await this._store.getItem(this._storeKey);\n\n    if (!pluginListItem) {\n      return { plugins: [] };\n    }\n\n    return pluginListItem.value;\n  }\n\n  async _modifyAndWriteStoredList(mutatorFn) {\n    const pluginList = await this._getLocalPluginList();\n    const shouldWrite = mutatorFn(pluginList) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp: currentEpochSecond(), value: pluginList});\n    }\n    return pluginList;\n  }\n}\n\nconst postProcessPluginList = (pluginList, isDefault, sourceUrl) => {\n  pluginList.isDefault = isDefault;\n  pluginList.sourceUrl = sourceUrl;\n\n  if (!pluginList.error) {\n    pluginList.error = undefined;\n  }\n\n  if (!pluginList.plugins) {\n    pluginList.plugins = [];\n  }\n\n  pluginList.plugins = pluginList.plugins.map(pluginRef => {\n    // Resolve relative paths on this server, but still allow for\n    // arbitrary absolute/third-party urls\n    const pluginUrl = new URL(pluginRef.url, window.location.origin);\n\n    return {\n      url: pluginUrl,\n    };\n  });\n\n  return pluginList;\n};\n","import Vue from 'vue';\n\nimport { loadModule } from 'vue3-sfc-loader/dist/vue2-sfc-loader.js';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nexport default class AssetLinkPluginLoaderCore {\n\n  constructor(assetLink) {\n    this._assetLink = assetLink;\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        plugins: [],\n      },\n    });\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  async boot() {\n    // TODO: ?\n  }\n\n  async loadPlugin(pluginUrl, opts) {\n    const options = opts || {};\n\n    const startTime = performance.now();\n\n    let pluginInstance = undefined;\n\n    try {\n      let pluginDataUrl = await this._fetchPlugin(pluginUrl, options);\n\n      if (pluginUrl.pathname.endsWith('alink.js')) {\n        const pluginCls = (await import(/* webpackIgnore: true */ pluginDataUrl)).default;\n        pluginInstance = new pluginCls();\n      } else if (pluginUrl.pathname.endsWith('alink.vue')) {\n        const pluginUrlWithoutParams = new URL(pluginUrl.toString());\n        pluginUrlWithoutParams.search = '';\n\n        const vuetify = await import('vuetify/lib');\n\n        const vuetifyComponents = {};\n        const vuetifyDirectives = {};\n\n        Object.entries(vuetify).forEach(([entryName, entry]) => {\n          if (Object.prototype.hasOwnProperty.call(entry, 'component')) {\n            vuetifyComponents[entryName] = entry;\n          } else if (['bind', 'inserted', 'update', 'componentUpdated', 'unbind'].find(directiveHook => Object.prototype.hasOwnProperty.call(entry, directiveHook))) {\n            vuetifyDirectives[entryName] = entry;\n          }\n        });\n\n        let rawPluginFileData = await fetch(pluginDataUrl).then(r => r.text());\n\n        // Roughly based on https://harlanzw.com/blog/vue-automatic-component-imports/\n        // and https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/loader.js#L110-L144\n        const compiler = await import('vue-template-compiler');\n\n        const tags = new Set()\n        const attrs = new Set()\n        const component = compiler.parseComponent(rawPluginFileData);\n\n        if (component.errors.length > 0) {\n          throw new Error(`Could not parse component plugin: ${component.errors.join('\\n')}`);\n        }\n\n        if (component.template) {\n          if (component.template.src) {\n            throw new Error(`External component template content is not supported.`);\n          }\n          compiler.compile(component.template.content, {\n            modules: [{\n              postTransformNode: node => {\n                if (\"directives\" in node) {\n                  node.directives.forEach(({ name }) => attrs.add(name))\n                }\n                tags.add(node.tag)\n              }\n            }]\n          });\n        }\n\n        /* eslint-disable no-unused-vars */\n        const usedVuetifyTags = Array.from(tags).map(item => [hyphenate(item), capitalize(camelize(item))])\n          .filter(([kebabTag, camelTag]) => kebabTag.startsWith('v-') && Object.prototype.hasOwnProperty.call(vuetifyComponents, camelTag))\n          .map(([kebabTag, camelTag]) => [camelTag, vuetifyComponents[camelTag]]);\n\n        const usedVuetifyDirectives = Array.from(attrs).map(item => capitalize(camelize(item)))\n          .filter(camelAttr => Object.prototype.hasOwnProperty.call(vuetifyDirectives, camelAttr))\n          .map(camelAttr => [camelAttr, vuetifyDirectives[camelAttr]]);\n\n        const options = {\n          moduleCache: {\n            vue: Vue,\n            'vuetify/lib': vuetify,\n\n            // TODO: Figure out how to make loading these cleaner/on-demand\n            'vue-codemirror': await import('vue-codemirror'),\n            'codemirror/mode/javascript/javascript.js': await import('codemirror/mode/javascript/javascript.js'),\n            'codemirror/mode/vue/vue.js': await import('codemirror/mode/vue/vue.js'),\n            'codemirror/lib/codemirror.css': await import('codemirror/lib/codemirror.css'),\n            'codemirror/theme/base16-dark.css': await import('codemirror/theme/base16-dark.css'),\n          },\n          async getFile(url) {\n            if ( url === pluginUrlWithoutParams ) {\n              return rawPluginFileData;\n            } else {\n              throw new Error(`Secondary imports are not supported. url=${url}`);\n            }\n          },\n          addStyle() { /* TODO */ },\n        };\n\n        pluginInstance = await loadModule(pluginUrlWithoutParams, options);\n\n        if (usedVuetifyTags.length && !pluginInstance.components) pluginInstance.components = {};\n        usedVuetifyTags.filter(t => !pluginInstance.components[t[0]]).forEach(t => pluginInstance.components[t[0]] = t[1]);\n\n        if (usedVuetifyDirectives.length && !pluginInstance.directives) pluginInstance.directives = {};\n        usedVuetifyDirectives.filter(t => !pluginInstance.directives[t[0]]).forEach(t => pluginInstance.directives[t[0]] = t[1]);\n\n        Vue.component(pluginInstance.name, pluginInstance);\n      } else {\n        throw new Error(`Cannot load plugin ${pluginUrl} with unsupported type. Path of url must end in '.alink.js' or '.alink.vue'`);\n      }\n\n      pluginInstance.pluginUrl = pluginUrl;\n\n      this.registerPlugin(pluginInstance);\n    } catch (error) {\n      console.log(error);\n      pluginInstance = {};\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.error = error;\n      this.registerPlugin(pluginInstance);\n    } finally {\n      const endTime = performance.now();\n      console.log(`Loading plugin ${pluginUrl} took ${endTime - startTime} milliseconds`);\n    }\n  }\n\n  /**\n   * Directly register a plugin with Asset Link. Note that plugins registered this way\n   * will not persist between sessions/reloads.\n   */\n  registerPlugin(plugin) {\n    plugin.definedRoutes = {};\n    plugin.definedActions = {};\n    plugin.definedMetaActions = {};\n    plugin.definedConfigActions = {};\n\n    this.vm.plugins.push(plugin);\n\n    if (typeof plugin.onLoad === 'function') {\n      const handle = new AssetLinkPluginHandle(plugin, this.vm);\n\n      plugin.onLoad(handle, this._assetLink);\n    }\n  }\n\n  async unloadPlugin(pluginUrl) {\n    const pluginIdx = this.vm.plugins.findIndex(p => p.pluginUrl.toString() === pluginUrl.toString());\n\n    if (pluginIdx !== -1) {\n      this.vm.plugins.splice(pluginIdx, 1);\n    }\n  }\n\n  async reloadPlugin(pluginUrl) {\n    await this.unloadPlugin(pluginUrl);\n    await this.loadPlugin(pluginUrl, { skipCache: true });\n  }\n\n  async _fetchPlugin(url, opts) {\n    const options = opts || {};\n\n    const skipCache = options.skipCache || (url.searchParams && url.searchParams.get('skipCache'));\n\n    const cacheKey = `asset-link-cached-plugin-src:${url}`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (!skipCache && cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginSrc = await fetch(url).then(r => r.text());\n\n    const pluginSrcWithSourceInfo = `${pluginSrc}\\n//# sourceURL=asset-link-plugin:./${encodeURIComponent(url)}\\n`;\n\n    const pluginDataUrl = \"data:application/javascript;base64,\" + btoa(pluginSrcWithSourceInfo);\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: pluginDataUrl});\n\n    return pluginDataUrl;\n  }\n\n}\n\nclass AssetLinkPluginHandle {\n\n  constructor(pluginInstance, vm) {\n    this._pluginInstance = pluginInstance;\n    this._vm = vm;\n  }\n\n  defineRoute(routeName, routeDefiner) {\n    const routeDef = {name: routeName};\n\n    const routeHandle = {\n        path(path) {\n          routeDef.path = path;\n        },\n        componentFn(componentFn) {\n          routeDef.componentFn = componentFn;\n        },\n    };\n\n    routeDefiner(routeHandle);\n\n    const missingFields = Object.entries({'path': 'string', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof routeDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Action '${routeName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, routeDef);\n      return;\n    }\n\n    this._pluginInstance.definedRoutes[routeName] = routeDef;\n\n    this._vm.$emit('add-route', routeDef);\n  }\n\n  defineAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n    \n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedActions[actionId] = actionDef;\n  }\n\n  defineMetaAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n\n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedMetaActions[actionId] = actionDef;\n  }\n\n  defineConfigAction(actionId, actionDefiner) {\n    const actionDef = {id: actionId};\n\n    const actionHandle = {\n        showIf(predicateFn) {\n          actionDef.predicateFn = predicateFn;\n        },\n        componentFn(componentFn) {\n          actionDef.componentFn = componentFn;\n        },\n    };\n\n    actionDefiner(actionHandle);\n\n    const missingCallbacks = ['predicateFn', 'componentFn']\n      .filter(attr => typeof actionDef[attr] !== 'function');\n\n    if (missingCallbacks.length) {\n      console.log(`Action '${actionId}' is invalid due to missing or non-function callbacks: ${JSON.stringify(missingCallbacks)}`, actionDef);\n      return;\n    }\n\n    this._pluginInstance.definedConfigActions[actionId] = actionDef;\n  }\n\n}\n\n//Copied from https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/util.js#L6-L18\nconst camelizeRE = /-(\\w)/g\nconst camelize = str => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n}\n\nconst capitalize = str => {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst hyphenateRE = /\\B([A-Z])/g\nconst hyphenate = str => {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n","import Vue from 'vue';\n\nimport { Coordinator, RequestStrategy, SyncStrategy } from '@orbit/coordinator';\nimport { Orbit } from '@orbit/core';\nimport { IndexedDBBucket } from '@orbit/indexeddb-bucket';\nimport { IndexedDBSource } from '@orbit/indexeddb';\nimport { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\nimport DrupalJSONAPISource from '@/DrupalJSONAPISource';\nimport DrupalSyncQueryOperators from '@/DrupalSyncQueryOperators';\n\nimport localforage from 'localforage';\n\nimport fetch from 'cross-fetch';\n\nimport AssetLinkUI from '@/AssetLinkUI';\nimport AssetLinkUtil from '@/AssetLinkUtil';\nimport createDrupalUrl from '@/createDrupalUrl';\nimport FarmOSConnectionStatusDetector from '@/FarmOSConnectionStatusDetector';\nimport PeekableAsyncIterator from '@/PeekableAsyncIterator';\nimport AssetLinkPluginListsCore from '@/AssetLinkPluginListsCore';\nimport AssetLinkPluginLoaderCore from '@/AssetLinkPluginLoaderCore';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nconst fetchJson = (url, args) => fetch(url, args).then(response => response.json());\n\n\n\n/**\n * Core of the larger Asset Link application and API entry-point for plugins.\n * \n * TODO: Break out some of the responsibilities of this class into classes that can be\n * delegated to. e.g. plugin management, entities CRUD, etc.\n */\nexport default class AssetLink {\n\n  constructor(app) {\n    this._app = app;\n    this._viewModel = new Vue({\n      data: {\n        booted: false,\n        bootProgress: 0,\n        bootText: \"Starting\",\n\n        connectionStatus: new FarmOSConnectionStatusDetector(),\n\n        pendingUpdates: [],\n\n        messages: [],\n      },\n    });\n\n    this._booted = new Promise((resolve) => {\n      this._viewModel.$once('booted', () => {\n        this._viewModel.booted = true;\n        resolve(true);\n      });\n    });\n\n    this._store = localforage.createInstance({\n      name: 'asset-link',\n      storeName: 'data',\n    });\n\n    this._cores = {};\n    this._cores.pluginLists = new AssetLinkPluginListsCore(this);\n    this._cores.pluginLoader = new AssetLinkPluginLoaderCore(this);\n\n    this._memory = undefined;\n    this._remote = undefined;\n\n    this._ui = new AssetLinkUI(app);\n    this._util = new AssetLinkUtil();\n  }\n\n  /**\n   * The top-level {Vue} app component.\n   */\n  get app() {\n    return this._app;\n  }\n\n  /**\n   * A {Vue} instance used to expose some of Asset Link's state to\n   * its UI in a reactive way.\n   */\n  get viewModel() {\n    return this._viewModel;\n  }\n\n  /**\n   * UI components/methods exposed for Asset Link plugins.\n   */\n  get ui() {\n    return this._ui;\n  }\n\n  /**\n   * Utility methods exposed for Asset Link plugins.\n   */\n  get util() {\n    return this._util;\n  }\n\n  /**\n   * The map of AssetLink cores.\n   */\n  get cores() {\n    return this._cores;\n  }\n\n  /**\n   * The Orbit.js {MemorySource} which is used to access/modify farmOS assets/logs/etc.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get entitySource() {\n    return this._memory;\n  }\n\n  /**\n   * The Orbit.js {JSONAPISource} which is used to directly access/modify\n   * farmOS assets/logs/etc - unless you know what you are doing, use {#entitySource}\n   * instead.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get remoteEntitySource() {\n    return this._remote;\n  }\n\n  /**\n   * The currently loaded plugins.\n   */\n  get plugins() {\n    return this._cores.pluginLoader.vm.plugins;\n  }\n\n  /**\n   * A {Promise} that is fulfilled once Asset Link has booted.\n   */\n  get booted() {\n    return this._booted;\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async boot() {\n    this.viewModel.bootText = \"Initializing storage\";\n\n    await this._store.ready();\n\n    this._cores.pluginLists.eventBus.$on('add-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.loadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLists.eventBus.$on('remove-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.unloadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLoader.vm.$on('add-route', routeDef => {\n      if (typeof this.app.addRoute === 'function') {\n        this.app.addRoute(routeDef);\n      }\n    });\n\n    this._cores.pluginLoader.vm.$on('remove-route', routeDef => {\n      if (typeof this.app.removeRoute === 'function') {\n        this.app.removeRoute(routeDef);\n      }\n    });\n\n    window.addEventListener('asset-link-plugin-changed', async e => {\n      await this._cores.pluginLoader.reloadPlugin(new URL(e.detail.pluginUrl));\n    });\n\n    await this._cores.pluginLoader.boot();\n    await this._cores.pluginLists.boot();\n\n    this.viewModel.bootText = \"Loading models...\";\n    this._models = await this._loadModels();\n\n    Orbit.fetch = this._csrfAwareFetch.bind(this);\n\n    this._schema = new RecordSchema({ models: this._models });\n\n    const bucket = new IndexedDBBucket({ namespace: 'asset-link-orbitjs-bucket' });\n\n    this._memory = new MemorySource({\n      schema: this._schema,\n      cacheSettings: {\n        queryOperators: DrupalSyncQueryOperators,\n      },\n    });\n\n    this._remote = new DrupalJSONAPISource({\n      schema: this._schema,\n      name: 'remote',\n      host: createDrupalUrl('/api'),\n      defaultFetchSettings: {\n        timeout: 10000,\n      },\n      bucket,\n      requestQueueSettings: {\n        autoProcess: this.viewModel.connectionStatus.isOnline || false,\n      },\n    });\n\n    const updateViewModelPendingUpdates = () => {\n      this.viewModel.pendingUpdates = this._remote.requestQueue.entries.filter(r => r.type === 'update');\n    };\n\n    this._remote.requestQueue.reified.then(updateViewModelPendingUpdates);\n    this._remote.requestQueue.on('change', updateViewModelPendingUpdates);\n\n    this._backup = new IndexedDBSource({\n      schema: this._schema,\n      name: 'backup',\n      namespace: 'asset-link-orbitjs-entities',\n      defaultTransformOptions: {\n        useBuffer: true,\n      },\n    });\n\n    this._coordinator = new Coordinator({\n      sources: [this._memory, this._remote, this._backup]\n    });\n\n    // Query the remote server when the memory source is queried (and online)\n    this._remoteQueryStrategy = new RequestStrategy({\n      name: 'remoteRequestStrategy',\n\n      source: 'memory',\n      on: 'beforeQuery',\n\n      target: 'remote',\n      action: 'query',\n\n      blocking: true\n    });\n    // Only use the remote query strategy when online\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._coordinator.addStrategy(this._remoteQueryStrategy);\n    }\n\n    // Update the remote server whenever the memory source is updated\n    this._coordinator.addStrategy(\n      new RequestStrategy({\n        source: 'memory',\n        on: 'beforeUpdate',\n\n        target: 'remote',\n        action: 'update',\n\n        blocking: false\n      })\n    );\n\n    // Sync all changes received from the remote server to the memory source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'remote',\n        target: 'memory',\n        blocking: false\n      })\n    );\n\n    // Sync all changes to the backup source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'memory',\n        target: 'backup',\n        blocking: true\n      })\n    );\n\n    // Restore the backup source\n    const allRecordsFromBackup = await this._backup.query((q) => q.findRecords());\n    await this._memory.sync((t) => allRecordsFromBackup.map((r) => t.addRecord(r)));\n\n    await this._coordinator.activate();\n\n    this.viewModel.bootProgress = 100;\n\n    this._memory.on('update', update => {\n      console.log('_memory::update', update);\n\n      if (update.operations.op === 'updateRecord' && update.operations.record.type.startsWith('asset--')) {\n        this.viewModel.$emit('changed:asset', update.operations.record.type, update.operations.record.id);\n      }\n\n    });\n\n    this.viewModel.connectionStatus.$watch('isOnline', async (isOnline) => {\n      this._remote.requestQueue.autoProcess = isOnline;\n      if (isOnline && !this._remote.requestQueue.empty) {\n        this._remote.requestQueue.process();\n      }\n\n      await this._coordinator.deactivate();\n      if (isOnline) {\n        if (!this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.addStrategy(this._remoteQueryStrategy);\n        }\n      } else {\n        if (this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.removeStrategy(this._remoteQueryStrategy.name);\n        }\n      }\n      await this._coordinator.activate();\n    });\n\n    this.viewModel.$emit('booted');\n\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._precache();\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets the model for an entity type given that the type name. e.g. \"asset--plant\"\n   */\n  async getEntityModel(typeName) {\n    await this._booted;\n\n    return this._models[typeName];\n  }\n\n  async _precache() {\n    // Precache the current page's asset\n    const matches = window.location.href.match(/https?:\\/\\/.*\\/asset\\/(\\d+)/);\n    if (matches && matches.length >= 2) {\n      const thisAsset = await this.resolveAsset(matches[1]);\n      console.log(\"thisAsset=\", thisAsset);\n    }\n\n    const timestamp = currentEpochSecond();\n\n    const lastPrecacheTimeKey = `asset-link-last-precache-time`;\n\n    const lastPrecacheTime = await this._store.getItem(lastPrecacheTimeKey);\n\n    if (lastPrecacheTime && (timestamp - lastPrecacheTime) < 900) {\n      console.log(\"Skipping Asset Link precaching because it was done recently...\");\n      return;\n    }\n\n    // Precache recently changed assets\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    await this._memory.query((q) => assetTypes.map(assetType => q.findRecords(`asset--${assetType}`)\n        .sort('-changed')\n        .page({ offset: 0, limit: 100 })));\n\n    // TODO: Consider also precaching recently changed and recent/upcoming logs\n\n    await this._store.setItem(lastPrecacheTimeKey, timestamp);\n  }\n\n  /**\n   * Get a list of the asset_type entities.\n   */\n  async getAssetTypes() {\n    const listAssetTypes = async (source) => {\n      return await source.query((q) => q\n          .findRecords(`asset_type--asset_type`)\n          .sort('drupal_internal__id'));\n    };\n\n    const assetTypes = await listAssetTypes(this._memory.cache);\n\n    if (assetTypes.length) {\n      return assetTypes;\n    }\n\n    return await listAssetTypes(this._memory);\n  }\n\n  /**\n   * Get an asset by UUID or Drupal internal id.\n   */\n  async resolveAsset(assetRef) {\n    await this._booted;\n\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    const isRefNumeric = /^-?\\d+$/.test(assetRef);\n\n    let filter = { attribute: 'id', value: assetRef };\n    if (isRefNumeric) {\n      filter = { attribute: 'drupal_internal__id', value: parseInt(assetRef) };\n    }\n\n    const findAsset = async (source) => {\n      const results = await source.query(q => assetTypes.map(assetType => q\n          .findRecords(`asset--${assetType}`)\n          .filter(filter)\n          .sort('drupal_internal__id')));\n\n      const assets = results.flatMap(l => l);\n\n      return assets.find(a => a);\n    };\n\n    const asset = await findAsset(this._memory.cache);\n\n    if (asset) {\n      return asset;\n    }\n\n    return await findAsset(this._memory);\n  }\n\n  /**\n   * Central asset searching entry-point. Responsible for delegating to asset searching plugins.\n   */\n  searchAssets(searchRequest, searchPhase) {\n    console.log(\"searchAssets:\", JSON.stringify(searchRequest), searchPhase);\n\n    const assetSearchPlugins = this.plugins.filter(p => typeof p.searchAssets === 'function');\n\n    const searchResultCursors = [];\n\n    for (let i = 0; i < assetSearchPlugins.length; i += 1) {\n      const plugin = assetSearchPlugins[i];\n\n      /* eslint-disable no-await-in-loop */\n      const searchResultCursor = plugin.searchAssets(this, searchRequest, searchPhase);\n\n      if (searchResultCursor !== undefined) {\n        searchResultCursors.push(searchResultCursor);\n      }\n    }\n\n    async function* coiterateSearchCursors() {\n      console.log(\"coiterateSearchCursors: searchResultCursors =\", searchResultCursors);\n\n      const peekableSearchResultCursors = searchResultCursors.map(c => new PeekableAsyncIterator(c));\n\n      while(peekableSearchResultCursors.length > 0) {\n\n        console.log(\"coiterateSearchCursors: peekableSearchResultCursors.length =\", peekableSearchResultCursors.length, peekableSearchResultCursors);\n\n        let bestNextCursor = undefined;\n        let doneBestNextCursorIndex = undefined;\n        for (let i = 0; i < peekableSearchResultCursors.length; i += 1) {\n          const thisCursor = peekableSearchResultCursors[i];\n\n          const thisCursorNextResult = await thisCursor.peek();\n\n          if (thisCursorNextResult.value === undefined) {\n            continue;\n          }\n\n          if (bestNextCursor === undefined || thisCursorNextResult.value.weight < (await bestNextCursor.peek()).value.weight) {\n            bestNextCursor = thisCursor;\n            doneBestNextCursorIndex = thisCursorNextResult.done ? i : undefined;\n          }\n        }\n\n        if (bestNextCursor === undefined) {\n          return;\n        }\n\n        const bestCursorNextResult = await bestNextCursor.next();\n\n        if (bestCursorNextResult.value) {\n          yield bestCursorNextResult.value;\n        }\n\n        if (doneBestNextCursorIndex !== undefined) {\n          peekableSearchResultCursors.splice(doneBestNextCursorIndex, 1);\n        }\n\n      }\n    }\n\n    return coiterateSearchCursors();\n  }\n\n  getRelevantActions(asset) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedActions))\n        .filter(a => a.predicateFn(asset))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, asset),\n        }));\n\n    return actions;\n  }\n\n  getRelevantMetaActions(asset) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedMetaActions))\n        .filter(a => a.predicateFn(asset))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, asset),\n        }));\n\n    return actions;\n  }\n\n  getRelevantConfigActions(route) {\n    const actions = this.plugins.flatMap(plugin => Object.values(plugin.definedConfigActions))\n        .filter(a => a.predicateFn(route))\n        .map(a => ({\n          id: a.id,\n          componentFn: (wrapper, h) => a.componentFn(wrapper, h, route),\n        }));\n\n    return actions;\n  }\n\n  async _csrfAwareFetch(url, opts) {\n    const options = opts || {};\n\n    if (!options.method) options.method = 'GET';\n\n    const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n    const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n    const isUnsafeMethod = !['HEAD', 'GET', 'OPTIONS', 'TRACE'].includes(options.method.toUpperCase());\n\n    const addCsrfHeader = isFarmOSRequest && isUnsafeMethod;\n\n    try {\n      if (addCsrfHeader) {\n        const tokenResponse = await this.viewModel.connectionStatus.fetch(createDrupalUrl('/session/token'));\n\n        console.log(\"tokenResponse:\", tokenResponse);\n\n        const token = await tokenResponse.text();\n\n        // TODO: Cache the token\n        if (!options.headers) options.headers = {};\n        options.headers['X-CSRF-Token'] = token;\n      }\n  \n      return await this.viewModel.connectionStatus.fetch(url, options);\n    } catch (error) {\n      console.log(\"Error in _csrfAwareFetch\", typeof error, error);\n      if (error.message === 'Network request failed') {\n        return new Response(null, {\n          status: 503,\n          statusText: 'Service unavailable due to network error',\n        });\n      }\n      throw error;\n    }\n  }\n\n  async _loadModels() {\n    const cacheKey = `asset-link-cached-entity-models`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    if (cacheItem) {\n      // TODO: If cache item is stale, schedule background refresh\n      return cacheItem.value;\n    }\n\n    const models = await this._loadModelsFromServer();\n\n    const timestamp = currentEpochSecond();\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: models});\n\n    return models;\n  }\n\n  async _loadModelsFromServer() {\n    this.viewModel.bootText = \"Loading server schema\";\n    const serverSchema = await fetchJson(createDrupalUrl('/api/schema'));\n\n    const serverRelatedSchemas = serverSchema.allOf.flatMap(schemaRef => schemaRef.links || []);\n\n    const models = {};\n\n    await Promise.all(serverRelatedSchemas.map(async (serverRelatedSchema) => {\n      const relatedSchema = await fetchJson(serverRelatedSchema.targetSchema);\n\n      const relatedItemSchema = await fetchJson(relatedSchema.definitions.data.items.$ref);\n\n      const typeName = relatedItemSchema.definitions.type['const'];\n\n      models[typeName] = {\n        attributes: Object.fromEntries(\n            Object.entries(relatedItemSchema.definitions.attributes.properties)\n              .map(([attrName, attr]) => {\n                // Orbit.js seems to only support 'number', not 'integer' but handles the former well enough\n                if (attr.type === 'integer') {\n                  attr.type = 'number';\n                }\n\n                // https://www.drupal.org/project/jsonapi_schema/issues/3058850\n                if (attrName === 'third_party_settings') {\n                  attr.type = 'object';\n                }\n\n                return [attrName, attr];\n              })\n        ),\n        relationships: relatedItemSchema.definitions?.relationships?.properties || {},\n      };\n\n      this.viewModel.bootProgress = ((Object.keys(models).length / serverRelatedSchemas.length) * 100).toFixed(1);\n    }));\n\n    return models;\n  }\n\n}\n","export default function createDrupalUrl(pathSuffix) {\n  return new URL(pathSuffix, window.location.origin + window.assetLinkDrupalBasePath);\n}","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n"],"names":["DrupalJSONAPIURLBuilder","settings","filterSpecifiers","filters","forEach","filterSpecifier","index","kind","op","attributeFilter","resourceAttribute","serializeAttributeAsParam","undefined","attribute","push","value","path","operator","relatedRecordFilter","Array","isArray","record","relation","map","e","id","join","QueryExpressionParseError","Error","relatedRecordsFilter","records","type","this","serializer","serializerFor","JSONAPISerializers","serialize","JSONAPIURLBuilder","DrupalJSONAPISource","defaultFetchSettings","Object","assign","headers","Accept","serializerSettingsFor","buildSerializerSettingsFor","sharedSettings","inflectors","drupal","buildInflector","input","replace","settingsByType","serializationOptions","URLBuilderClass","JSONAPISource","findRecord","SyncQueryOperators","findRelatedRecord","findRecords","cache","expression","options","exp","results","getRecordsSync","filter","filterRecords","sort","sortRecords","page","paginateRecords","findRelatedRecords","relationship","relatedIds","getRelatedRecordsSync","length","getRecordSync","raiseNotFoundExceptions","RecordNotFoundException","i","l","applyFilter","attributeKey","split","actual","deepGet","expected","toLowerCase","startsWith","includes","endsWith","sortSpecifiers","comparisonValues","Map","set","sortSpecifier","comparisonOrders","sortExpression","order","record1","record2","values1","get","values2","isNone","paginationOptions","limit","offset","slice","AssetLinkUI","app","_app","VBtn","VListItem","VListItemTitle","confirm","text","$dialog","title","promptText","prompt","custom","component","params","uuidv4","context","Vue","Promise","resolve","$on","dialogs","componentFn","wrapper","h","VDialog","props","fullscreen","on","ref","result","d","AssetLinkUtil","formatRFC3339","createDrupalUrl","geohash","haversine","assets","a","attributes","name","FarmOSConnectionStatusDetector","fetcherDelegate","default","fetch","data","$_running","$_barrier","Barrier","hasNetworkConnection","window","navigator","onLine","canReachFarmOS","isLoggedIn","created","addEventListener","$data","release","connection","$_mainLoop","computed","isOnline","beforeDestroy","methods","url","opts","method","requestUrl","URL","location","origin","assetLinkDrupalBasePath","isFarmOSRequest","host","pathname","res","status","checkConnectionStatus","throttle","$_checkConnectionStatus","arrive","apiUrl","currentEpochSecond","credentials","json","apiData","farmOsVersion","meta","farm","version","userRef","links","me","href","sleep","millis","setTimeout","parseInt","Date","getTime","waiting","timeoutMillis","race","toBeReleased","splice","p","PeekableAsyncIterator","delegate","_delegate","_next_iteration_result","next","EventBus","_handlersByEventName","eventName","handler","hasOwn","arg","handlers","promises","all","then","HttpAccessDeniedException","message","AssetLinkPluginListsCore","assetLink","_store","_vm","lists","_eventBus","_pluginReferenceTracker","PluginReferenceTracker","_defaultPluginList","HttpPluginList","_localPluginList","LocalPluginList","_extraPluginLists","_extraPluginListStoreKey","_getExtraPluginListUrls","extraPluginListUrls","pluginListUrl","pluginList","load","pluginListView","_updatePluginListViewInViewModel","pluginUrl","addPlugin","removePlugin","_modifyAndWriteStoredExtraPluginListUrls","idx","findIndex","plUrl","pluginListIndex","pl","_url","unload","_removePluginListViewFromViewModel","find","reload","getItem","pluginListUrlsItem","u","mutatorFn","pluginListUrls","shouldWrite","setItem","key","timestamp","vm","plVIndex","plV","sourceUrl","eventBus","_pluginReferences","listUrl","console","log","toString","pluginExists","pluginReferences","listIdx","indexOf","$emit","JSON","stringify","store","pluginReferenceTracker","isDefault","_storeKey","_isDefault","_latestPluginListView","skipCache","postProcessPluginList","_getHttpPluginList","plugins","pRef","ackPluginReference","freePluginReference","removeItem","cacheItem","pluginListRes","statusText","ok","_getLocalPluginList","_modifyAndWriteStoredList","pluginIndex","pluginListItem","error","pluginRef","AssetLinkPluginLoaderCore","_assetLink","startTime","performance","now","pluginInstance","_fetchPlugin","pluginDataUrl","import","pluginCls","pluginUrlWithoutParams","search","vuetify","vuetifyComponents","vuetifyDirectives","entries","entryName","entry","prototype","hasOwnProperty","call","directiveHook","r","rawPluginFileData","compiler","tags","Set","attrs","parseComponent","errors","template","src","compile","content","modules","postTransformNode","node","directives","add","tag","usedVuetifyTags","from","item","hyphenate","capitalize","camelize","kebabTag","camelTag","usedVuetifyDirectives","camelAttr","vue","moduleCache","getFile","addStyle","loadModule","components","t","registerPlugin","endTime","plugin","definedRoutes","definedActions","definedMetaActions","definedConfigActions","onLoad","handle","AssetLinkPluginHandle","pluginIdx","unloadPlugin","loadPlugin","searchParams","cacheKey","pluginSrc","pluginSrcWithSourceInfo","encodeURIComponent","btoa","_pluginInstance","routeName","routeDefiner","routeDef","routeHandle","missingFields","attr","expectedType","actionId","actionDefiner","actionDef","actionHandle","showIf","predicateFn","missingCallbacks","camelizeRE","str","_","c","toUpperCase","charAt","hyphenateRE","fetchJson","args","response","AssetLink","_viewModel","booted","bootProgress","bootText","connectionStatus","pendingUpdates","messages","_booted","$once","localforage","storeName","_cores","pluginLists","pluginLoader","_memory","_remote","_ui","_util","viewModel","ready","addRoute","removeRoute","reloadPlugin","detail","boot","_loadModels","_models","Orbit","_csrfAwareFetch","bind","_schema","RecordSchema","models","bucket","IndexedDBBucket","namespace","MemorySource","schema","cacheSettings","queryOperators","DrupalSyncQueryOperators","timeout","requestQueueSettings","autoProcess","updateViewModelPendingUpdates","requestQueue","reified","_backup","IndexedDBSource","defaultTransformOptions","useBuffer","_coordinator","Coordinator","sources","_remoteQueryStrategy","RequestStrategy","source","target","action","blocking","addStrategy","SyncStrategy","query","q","allRecordsFromBackup","sync","addRecord","activate","update","operations","$watch","empty","process","deactivate","strategies","removeStrategy","_precache","typeName","matches","match","resolveAsset","thisAsset","lastPrecacheTimeKey","lastPrecacheTime","getAssetTypes","assetTypes","drupal_internal__id","assetType","listAssetTypes","assetRef","isRefNumeric","test","findAsset","flatMap","asset","searchRequest","searchPhase","assetSearchPlugins","searchAssets","searchResultCursors","searchResultCursor","coiterateSearchCursors","peekableSearchResultCursors","bestNextCursor","doneBestNextCursorIndex","thisCursor","peek","thisCursorNextResult","weight","done","bestCursorNextResult","actions","values","route","isUnsafeMethod","addCsrfHeader","tokenResponse","token","Response","_loadModelsFromServer","serverSchema","serverRelatedSchemas","allOf","schemaRef","serverRelatedSchema","targetSchema","relatedSchema","definitions","items","$ref","relatedItemSchema","fromEntries","properties","attrName","relationships","keys","toFixed","pathSuffix","Vuetify","register","registered","cached","updatefound","updated","offline"],"sourceRoot":""}