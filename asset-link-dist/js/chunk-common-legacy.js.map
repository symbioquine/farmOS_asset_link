{"version":3,"file":"js/chunk-common-legacy.js","mappings":"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","sources":["webpack://alinkjs/./src/DrupalJSONAPIURLBuilder.js","webpack://alinkjs/./src/DrupalJSONAPISource.js","webpack://alinkjs/./src/DrupalSyncQueryOperators.js","webpack://alinkjs/./src/AssetLinkUI.js","webpack://alinkjs/./src/AssetLinkUtil.js","webpack://alinkjs/./src/FarmOSConnectionStatusDetector.js","webpack://alinkjs/./src/PeekableAsyncIterator.js","webpack://alinkjs/./src/util/currentEpochSecond.js","webpack://alinkjs/./src/util/EventBus.js","webpack://alinkjs/./src/HttpAccessDeniedException.js","webpack://alinkjs/./src/AssetLinkPluginListsCore.js","webpack://alinkjs/./src/AssetLinkPluginLoaderCore.js","webpack://alinkjs/./src/AssetLink.js","webpack://alinkjs/./src/createDrupalUrl.js","webpack://alinkjs/./src/plugins/vuetify.js","webpack://alinkjs/./src/registerServiceWorker.js"],"sourcesContent":["import { JSONAPIURLBuilder } from \"@orbit/jsonapi\";\nimport { QueryExpressionParseError } from \"@orbit/data\";\nimport { JSONAPISerializers } from '@orbit/jsonapi';\n\n/**\n * Extends {JSONAPIURLBuilder} to add support for Drupal JSON:API query operators.\n * \n * Loosely based on https://gist.github.com/bradjones1/18ff9ebdb85455f781a2a212577653ce\n */\nexport default class DrupalJSONAPIURLBuilder extends JSONAPIURLBuilder {\n\n  constructor(settings) {\n    super(settings);\n  }\n\n  buildFilterParam(filterSpecifiers) {\n    const filters = [];\n\n    filterSpecifiers.forEach((filterSpecifier, index) => {\n      if (\n        filterSpecifier.kind === 'attribute' &&\n        filterSpecifier.op === 'equal'\n      ) {\n        const attributeFilter = filterSpecifier;\n\n        // Note: We don't know the `type` of the attribute here, so passing `undefined`\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({ [resourceAttribute]: attributeFilter.value });\n      } else if (filterSpecifier.kind === 'attribute') {\n        const attributeFilter = filterSpecifier;\n        const resourceAttribute = this.serializeAttributeAsParam(\n          undefined,\n          attributeFilter.attribute\n        );\n        filters.push({\n          ['client-' + resourceAttribute + '-' + index]: {\n            path: resourceAttribute,\n            operator: attributeFilter.op,\n            value: attributeFilter.value\n          }\n        });\n      } else if (filterSpecifier.kind === 'relatedRecord') {\n        const relatedRecordFilter = filterSpecifier;\n        if (Array.isArray(relatedRecordFilter.record)) {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter.record\n              .map((e) => e.id)\n              .join(',')\n          });\n        } else {\n          filters.push({\n            [relatedRecordFilter.relation]: relatedRecordFilter?.record?.id\n          });\n        }\n      } else if (filterSpecifier.kind === 'relatedRecords') {\n        if (filterSpecifier.op !== 'equal') {\n          throw new Error(\n            `Operation \"${filterSpecifier.op}\" is not supported in JSONAPI for relatedRecords filtering`\n          );\n        }\n        const relatedRecordsFilter = filterSpecifier;\n        filters.push({\n          [relatedRecordsFilter.relation]: relatedRecordsFilter.records\n            .map((e) => e.id)\n            .join(',')\n        });\n      } else {\n        throw new QueryExpressionParseError(\n          `Filter operation ${filterSpecifier.op} not recognized for JSONAPISource.`\n        );\n      }\n    });\n\n    return filters;\n  }\n\n  serializeAttributeAsParam(type, attribute) {\n      if (this.serializer) {\n        return this.serializer.resourceAttribute(type, attribute);\n      } else {\n        const serializer = this.serializerFor(JSONAPISerializers.ResourceFieldParam);\n        return serializer.serialize(attribute, { type });\n      }\n    }\n\n}\n","import JSONAPISource, { JSONAPISerializers } from '@orbit/jsonapi';\nimport { buildSerializerSettingsFor, buildInflector } from '@orbit/serializers';\n\nimport DrupalJSONAPIURLBuilder from '@/DrupalJSONAPIURLBuilder';\n\n\n/**\n * Handle Drupal's `type/bundle` JSON:API resource pathing.\n * Based on: https://github.com/orbitjs/orbit/issues/714#issuecomment-1013952990\n */\nexport default class DrupalJSONAPISource extends JSONAPISource {\n  constructor(settings) {\n    const defaultFetchSettings = Object.assign({}, settings.defaultFetchSettings || {}, {\n      headers:{\n        Accept: 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json',\n      },\n    });\n\n    super(Object.assign({}, settings, {\n      defaultFetchSettings,\n      serializerSettingsFor: buildSerializerSettingsFor({\n        sharedSettings: {\n          inflectors: {\n            drupal: buildInflector(\n              {},\n              (input) => input.replace('--', '/')\n            )\n          }\n        },\n        settingsByType: {\n          [JSONAPISerializers.ResourceTypePath]: {\n            serializationOptions: {inflectors: ['drupal']}\n          }\n        }\n      }),\n      URLBuilderClass: DrupalJSONAPIURLBuilder,\n    }));\n  }\n\n}\n","import { SyncQueryOperators } from '@orbit/record-cache';\nimport { QueryExpressionParseError } from '@orbit/data';\nimport { RecordNotFoundException } from '@orbit/records';\nimport { deepGet, isNone } from '@orbit/utils';\n\n// Based on https://github.com/orbitjs/orbit/blob/2c4bf7038d2f74ba31e45e949c70ec4161ced28f/packages/@orbit/record-cache/src/operators/sync-query-operators.ts\nexport default {\n  findRecord: SyncQueryOperators.findRecord,\n  findRelatedRecord: SyncQueryOperators.findRelatedRecord,\n\n  findRecords(\n      cache,\n      expression,\n      // eslint-disable-next-line no-unused-vars\n      options\n    ) {\n      let exp = expression;\n      let results = cache.getRecordsSync(exp.records || exp.type);\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n\n  findRelatedRecords(\n      cache,\n      expression,\n      options\n    ) {\n      const exp = expression;\n      const { record, relationship } = exp;\n      const relatedIds = cache.getRelatedRecordsSync(record, relationship);\n      if (!relatedIds || relatedIds.length === 0) {\n        if (!cache.getRecordSync(record)) {\n          if (options?.raiseNotFoundExceptions) {\n            throw new RecordNotFoundException(record.type, record.id);\n          } else {\n            return undefined;\n          }\n        }\n\n        return [];\n      }\n      let results = cache.getRecordsSync(relatedIds);\n\n      if (exp.filter) {\n        results = filterRecords(results, exp.filter);\n      }\n      if (exp.sort) {\n        results = sortRecords(results, exp.sort);\n      }\n      if (exp.page) {\n        results = paginateRecords(results, exp.page);\n      }\n      return results;\n  },\n}\n\nfunction filterRecords(records, filters) {\n  return records.filter((record) => {\n    for (let i = 0, l = filters.length; i < l; i++) {\n      if (!applyFilter(record, filters[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction applyFilter(record, filter) {\n\n  if (filter.kind === 'attribute') {\n    let attributeKey = filter.attribute.split('.');\n\n    let actual = deepGet(record, ['attributes', ...attributeKey]);\n\n    let expected = filter.value;\n\n    // https://api.drupal.org/api/drupal/core%21modules%21jsonapi%21src%21Query%21EntityCondition.php/property/EntityCondition%3A%3AallowedOperators/9.4.x\n    switch (filter.op) {\n      case 'equal':\n      case '=':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() === expected.toLowerCase();\n        }\n        return actual === expected;\n      case '<>':\n        if (typeof actual === 'string') {\n          return actual.toLowerCase() !== expected.toLowerCase();\n        }\n        return actual !== expected;\n      case '>':\n        return actual > expected;\n      case '>=':\n        return actual >= expected;\n      case '<':\n        return actual < expected;\n      case '<=':\n        return actual <= expected;\n      case 'STARTS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().startsWith(expected.toLowerCase());\n      case 'CONTAINS':\n        return typeof actual === 'string' && actual.toLowerCase().includes(expected.toLowerCase());\n      case 'ENDS_WITH':\n        return typeof actual === 'string' && actual.toLowerCase().endsWith(expected.toLowerCase());\n      case 'IN':\n      case 'NOT IN':\n      case 'BETWEEN':\n      case 'NOT BETWEEN':\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} is not yet implemented for Store.`);\n      case 'IS NULL':\n        return actual === undefined || actual === null;\n      case 'IS NOT NULL':\n        return actual !== undefined && actual !== null;\n      default:\n        throw new QueryExpressionParseError(`Filter operation ${filter.op} not recognized for Store.`);\n    }\n  }\n  return SyncQueryOperators.applyFilter(record, filter);\n}\n\nfunction sortRecords(\n    records,\n    sortSpecifiers\n  ) {\n  const comparisonValues = new Map();\n\n  records.forEach((record) => {\n    comparisonValues.set(\n      record,\n      sortSpecifiers.map((sortSpecifier) => {\n        if (sortSpecifier.kind === 'attribute') {\n          let attributeKey = sortSpecifier.attribute.split('.');\n\n          return deepGet(record, [\n            'attributes',\n            ...attributeKey,\n          ]);\n        } else {\n          throw new QueryExpressionParseError(\n            'Sort specifier ${sortSpecifier.kind} not recognized for Store.'\n          );\n        }\n      })\n    );\n  });\n\n  const comparisonOrders = sortSpecifiers.map((sortExpression) =>\n    sortExpression.order === 'descending' ? -1 : 1\n  );\n\n  return records.sort((record1, record2) => {\n    const values1 = comparisonValues.get(record1);\n    const values2 = comparisonValues.get(record2);\n    for (let i = 0; i < sortSpecifiers.length; i++) {\n      if (values1[i] < values2[i]) {\n        return -comparisonOrders[i];\n      } else if (values1[i] > values2[i]) {\n        return comparisonOrders[i];\n      } else if (isNone(values1[i]) && !isNone(values2[i])) {\n        return comparisonOrders[i];\n      } else if (isNone(values2[i]) && !isNone(values1[i])) {\n        return -comparisonOrders[i];\n      }\n    }\n    return 0;\n  });\n}\n\nfunction paginateRecords(\n  records,\n  paginationOptions\n) {\n  if (paginationOptions.limit !== undefined) {\n    let offset =\n      paginationOptions.offset === undefined ? 0 : paginationOptions.offset;\n    let limit = paginationOptions.limit;\n\n    return records.slice(offset, offset + limit);\n  } else {\n    throw new QueryExpressionParseError(\n      'Pagination options not recognized for Store. Please specify `offset` and `limit`.'\n    );\n  }\n}\n","import Vue from 'vue';\nimport {\n  VBtn,\n  VDialog,\n  VListItem,\n  VListItemTitle,\n} from 'vuetify/lib'\nimport { v4 as uuidv4 } from 'uuid';\n\nexport default class AssetLinkUI {\n\n  constructor(app) {\n    this._app = app;\n  }\n\n  /**\n   * Provide some basic components to support Asset Link plugins defined as single (uncompiled) JS\n   * files.\n   * \n   * Commonly accessed via `assetLink.ui.c` e.g. `h(assetLink.ui.c.VBtn, { props: ...`\n   */\n  get c() {\n    return {\n      VBtn,\n      VListItem,\n      VListItemTitle,\n    };\n  }\n\n  /**\n   * \n   */\n  get dialog() {\n    return {\n      confirm: async (text) => {\n        return await this._app.$dialog.confirm({\n          text,\n          title: 'Confirmation'\n        });\n      },\n      promptText: async (text) => {\n        return await this._app.$dialog.prompt({\n          text,\n          title: 'Input',\n        });\n      },\n      custom: async (component, params) => {\n        const id = uuidv4();\n\n        const context = new Vue({});\n\n        const result = await new Promise(resolve => {\n          context.$on('submit', resolve);\n\n          this._app.dialogs.push({\n            id,\n            context,\n            componentFn: (wrapper, h) =>\n              h(VDialog, {\n                props: { value: true, fullscreen: true },\n                on: {\n                  input: () => resolve(undefined),\n                },\n              },  [h(component, {ref: 'dialogComponent', ...params})] ),\n          });\n        });\n\n        this._app.dialogs = this._app.dialogs.filter(d => d.id !== id);\n\n        return result;\n      },\n    };\n  }\n\n}\n","import { formatRFC3339 } from 'date-fns'\nimport createDrupalUrl from '@/createDrupalUrl';\nimport geohash from 'ngeohash';\nimport haversine from 'haversine-distance';\n\nexport default class AssetLinkUtil {\n\n  /**\n   * Format a date object as an RFC 3339 date string. e.g. '2019-09-18T19:00:52Z'\n   */\n  get formatRFC3339() {\n    return formatRFC3339;\n  }\n\n  /**\n   * Create a URL relative to the Drupal installation base path given the URL path suffix.\n   */\n  get createDrupalUrl() {\n    return createDrupalUrl;\n  }\n\n  /**\n   * The node-geohash module: https://github.com/sunng87/node-geohash\n   */\n  get geohash() {\n    return geohash;\n  }\n\n  /**\n   * A haversine distance function: https://github.com/dcousens/haversine-distance\n   */\n  get haversine() {\n    return haversine;\n  }\n\n  /**\n   * Roughly implements the same convention encoded in\n   * https://github.com/farmOS/farmOS/blob/04bf771d91cde8276b67090d2b97c4e4558332b9/modules/core/log/farm_log.module#L74-L88\n   */\n  summarizeAssetNames(assets) {\n    if (assets.length <= 3) {\n      return assets.map(a => a.attributes.name).join(\", \");\n    }\n    return `${assets[0].attributes.name} (+${assets.length - 1} more)`;\n  }\n\n}\n","import Vue from 'vue';\nimport fetch from 'cross-fetch';\nimport throttle from '@jcoreio/async-throttle'\nimport createDrupalUrl from '@/createDrupalUrl';\n\n/**\n * Responsible for detecting online/offline/login status\n * for our connection to the farmOS server both through\n * self-initiated polling and by observing the outcome of\n * decorated fetch requests.\n * \n * @implements {IHttpFetcher}\n */\nconst FarmOSConnectionStatusDetector = Vue.extend({\n\n  props: {\n    fetcherDelegate: {\n      type: Object,\n      default: function () {\n        return { fetch: fetch };\n      }\n    }\n  },\n\n  data() {\n    return {\n      $_running: false,\n      $_barrier: new Barrier(),\n\n      hasNetworkConnection: window.navigator.onLine,\n      canReachFarmOS: undefined,\n      isLoggedIn: undefined,\n    };\n  },\n\n  created() {\n    window.addEventListener('offline', () => {\n      this.hasNetworkConnection = false;\n      this.canReachFarmOS = false;\n    });\n    window.addEventListener('online', () => {\n      this.hasNetworkConnection = true;\n      this.$data.$_barrier.release();\n    });\n    if (window.navigator && window.navigator.connection) {\n      window.navigator.connection.addEventListener('change', () => this.$data.$_barrier.release());\n    }\n    this.$_mainLoop();\n  },\n\n  computed: {\n    isOnline() {\n      return this.canReachFarmOS && this.isLoggedIn;\n    },\n  },\n\n  beforeDestroy() {\n    this.$data.$_running = false;\n    this.$data.$_barrier.release();\n  },\n\n  methods: {\n\n    /**\n     * Decorate fetch requests to detect connection/authentication problems with\n     * requests that are already being sent.\n     */\n    async fetch(url, opts) {\n      const options = opts || {};\n\n      if (!options.method) options.method = 'GET';\n\n      const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n      const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n\n      try {\n        const res = await this.fetcherDelegate.fetch(url, options);\n        if (isFarmOSRequest && res.status === 403) {\n          this.$data.$_barrier.release();\n        }\n        return res;\n      } catch (error) {\n        if (isFarmOSRequest) {\n          this.$data.$_barrier.release();\n        }\n        throw error;\n      }\n    },\n\n    async $_mainLoop() {\n      this.$data.$_running = true;\n\n      const checkConnectionStatus = throttle(() => this.$_checkConnectionStatus(), 1000);\n\n      while (this.$data.$_running) {\n        await checkConnectionStatus();\n        await this.$data.$_barrier.arrive(60 * 1000);\n      }\n    },\n\n    async $_checkConnectionStatus() {\n      if (!this.hasNetworkConnection) {\n        return;\n      }\n\n      const apiUrl = createDrupalUrl(`api?cacheBust=${currentEpochSecond()}`);\n\n      try {\n        const res = await fetch(apiUrl, {credentials: 'same-origin', cache: 'no-cache'});\n\n        if (res.status !== 200) {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        const apiData = await res.json();\n\n        const farmOsVersion = apiData.meta?.farm?.version;\n\n        if (farmOsVersion !== '2.x') {\n          this.canReachFarmOS = false;\n          return;\n        }\n\n        this.canReachFarmOS = true;\n\n        const userRef = apiData.meta?.links?.me?.href;\n\n        this.isLoggedIn = userRef !== undefined\n      } catch (error) {\n        this.canReachFarmOS = false;\n      }\n    },\n  },\n\n});\n\nfunction sleep(millis) {\n  return new Promise(resolve => setTimeout(resolve, millis));\n}\n\nfunction currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n\nclass Barrier {\n  constructor() {\n    this.waiting = [];\n  }\n\n  arrive(timeoutMillis) {\n    return Promise.race([\n      sleep(timeoutMillis),\n      new Promise(resolve => this.waiting.push(resolve)),\n    ]);\n  }\n\n  release() {\n    const toBeReleased = this.waiting.splice(0);\n    toBeReleased.forEach(p => p());\n  }\n}\n\nexport default FarmOSConnectionStatusDetector;\n","export default class PeekableAsyncIterator {\n  constructor(delegate) {\n    this._delegate = delegate;\n    this._next_iteration_result = undefined;\n  }\n\n  async next() {\n    if (this._next_iteration_result !== undefined) {\n      const next = this._next_iteration_result;\n      this._next_iteration_result = undefined;\n      return next;\n    }\n    return await this._delegate.next();\n  }\n\n  async peek() {\n    if (this._next_iteration_result === undefined) {\n      this._next_iteration_result = await this._delegate.next();\n    }\n    return this._next_iteration_result;\n  }\n\n}\n","export default function currentEpochSecond() {\n  return parseInt(new Date().getTime() / 1000);\n}\n","/**\n * A simple async event bus.\n */\nexport default class EventBus {\n\n  constructor() {\n    this._handlersByEventName = {};\n  }\n\n  $on(eventName, handler) {\n    if (!Object.hasOwn(this._handlersByEventName, eventName)) {\n      this._handlersByEventName[eventName] = [];\n    }\n\n    this._handlersByEventName[eventName].push(handler);\n  }\n\n  async $emit(eventName, arg) {\n    const handlers = this._handlersByEventName[eventName] || [];\n\n    const promises = handlers.map(h => h(arg));\n\n    return Promise.all(promises).then(() => true);\n  }\n\n}\n","export default class HttpAccessDeniedException extends Error {\n  constructor(message, options) {\n    super(message, options);\n  }\n}\n","import Vue from 'vue';\n\nimport createDrupalUrl from '@/createDrupalUrl';\nimport currentEpochSecond from '@/util/currentEpochSecond';\nimport EventBus from '@/util/EventBus';\nimport HttpAccessDeniedException from '@/HttpAccessDeniedException';\n\nexport default class AssetLinkPluginListsCore {\n\n  constructor(assetLink) {\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        lists: [],\n      },\n    });\n\n    this._eventBus = new EventBus();\n\n    this._pluginReferenceTracker = new PluginReferenceTracker(this._eventBus);\n\n    this._defaultPluginList = new HttpPluginList(\n        assetLink._store, \n        createDrupalUrl('/alink/backend/default-plugins.repo.json'),\n        this._pluginReferenceTracker,\n        true,\n    );\n    this._localPluginList = new LocalPluginList(\n        assetLink._store,\n        this._pluginReferenceTracker,\n    );\n    this._extraPluginLists = [];\n\n    this._extraPluginListStoreKey = 'asset-link-extra-plugin-lists';\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  /**\n   * An async event bus used to signal when plugins are added/removed.\n   */\n  get eventBus() {\n    return this._eventBus;\n  }\n\n  async boot() {\n    const extraPluginListUrls = await this._getExtraPluginListUrls();\n\n    this._extraPluginLists = extraPluginListUrls.map(pluginListUrl =>\n      new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false));\n\n    for (let pluginList of [\n          this._defaultPluginList,\n          this._localPluginList,\n          ...this._extraPluginLists,\n        ]) {\n\n      const pluginListView = await pluginList.load();\n\n      this._updatePluginListViewInViewModel(pluginListView);\n    }\n  }\n\n  async addPluginToLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.addPlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removePluginFromLocalList(pluginUrl) {\n    const pluginListView = await this._localPluginList.removePlugin(pluginUrl);\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async addExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx >= 0) {\n        return false;\n      }\n      extraPluginListUrls.push(pluginListUrl);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex >= 0) {\n      return;\n    }\n\n    const pluginList = new HttpPluginList(this._store, pluginListUrl, this._pluginReferenceTracker, false);\n\n    this._extraPluginLists.push(pluginList);\n\n    const pluginListView = await pluginList.load();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async removeExtraPluginList(pluginListUrl) {\n    this._modifyAndWriteStoredExtraPluginListUrls(extraPluginListUrls => {\n      const idx = extraPluginListUrls.findIndex(plUrl => plUrl === pluginListUrl);\n      if (idx < 0) {\n        return false;\n      }\n      extraPluginListUrls.splice(idx, 1);\n    });\n\n    const pluginListIndex = this._extraPluginLists.findIndex(pl => pl._url === pluginListUrl);\n\n    if (pluginListIndex < 0) {\n      return;\n    }\n\n    const pluginList = this._extraPluginLists.splice(pluginListIndex, 1)[0];\n\n    await pluginList.unload();\n\n    this._removePluginListViewFromViewModel(pluginListUrl);\n  }\n\n  async reloadPluginList(pluginListUrl) {\n    const pluginList = [\n      this._defaultPluginList,\n      this._localPluginList,\n      ...this._extraPluginLists,\n    ].find(pl => pl._url === pluginListUrl);\n\n    if (!pluginList) {\n      return;\n    }\n\n    const pluginListView = await pluginList.reload();\n\n    this._updatePluginListViewInViewModel(pluginListView);\n  }\n\n  async _getExtraPluginListUrls() {\n    const pluginListUrlsItem = await this._store.getItem(this._extraPluginListStoreKey);\n\n    if (pluginListUrlsItem) {\n      return pluginListUrlsItem.value.map(u => new URL(u));\n    }\n\n    return [];\n  }\n\n  async _modifyAndWriteStoredExtraPluginListUrls(mutatorFn) {\n    const pluginListUrls = await this._getExtraPluginListUrls();\n    const shouldWrite = mutatorFn(pluginListUrls) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._extraPluginListStoreKey, {key: this._extraPluginListStoreKey, timestamp: currentEpochSecond(), value: pluginListUrls});\n    }\n    return pluginListUrls;\n  }\n\n  _updatePluginListViewInViewModel(pluginListView) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListView.sourceUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1, pluginListView);\n    } else {\n      vm.lists.push(pluginListView);\n    }\n  }\n\n  _removePluginListViewFromViewModel(pluginListUrl) {\n    const vm = this.vm;\n\n    const plVIndex = vm.lists.findIndex(plV => plV.sourceUrl === pluginListUrl);\n\n    if (plVIndex >= 0) {\n      vm.lists.splice(plVIndex, 1);\n    }\n  }\n\n}\n\nclass PluginReferenceTracker {\n  constructor(eventBus) {\n    this._eventBus = eventBus;\n\n    // Track which lists reference a given plugin by keeping\n    // a mapping between the plugin url and the list urls which\n    // reference it.\n    this._pluginReferences = {\n        // 'https://example.com/alink-plugins/MyAwesomePlugin.alink.js': [ 'https://example.com/cool-alink-plugins.repo.json' ],\n    };\n  }\n\n  async ackPluginReference(pluginUrl, listUrl) {\n    const pluginExists = Object.hasOwn(this._pluginReferences, pluginUrl.toString());\n\n    if (!pluginExists) {\n      this._pluginReferences[pluginUrl.toString()] = [];\n    }\n\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx < 0) {\n      pluginReferences.push(listUrl);\n    }\n\n    if (!pluginExists) {\n      await this._eventBus.$emit('add-plugin', pluginUrl);\n    }\n  }\n\n  /* eslint-disable no-console */\n  async freePluginReference(pluginUrl, listUrl) {\n    const pluginReferences = this._pluginReferences[pluginUrl.toString()];\n\n    if (!pluginReferences) {\n      console.log('freePluginReference unexpectedly found plugin missing from internal reference tracking', pluginUrl.toString(), listUrl.toString(), JSON.stringify(this._pluginReferences));\n      return;\n    }\n\n    const listIdx = pluginReferences.indexOf(listUrl.toString());\n\n    if (listIdx >= 0) {\n      pluginReferences.splice(listIdx, 1);\n    } else {\n      console.log('freePluginReference unexpectedly found plugin without expected reference', pluginUrl.toString(), listUrl.toString(), JSON.stringify(pluginReferences));\n    }\n\n    if (pluginReferences.length > 0) {\n      return;\n    }\n\n    await this._eventBus.$emit('remove-plugin', pluginUrl);\n  }\n}\n\nclass HttpPluginList {\n  constructor(store, url, pluginReferenceTracker, isDefault) {\n    this._store = store;\n    this._storeKey = `asset-link-cached-plugin-list:${url}`;\n    this._url = url;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n    this._isDefault = isDefault;\n    this._isLocal = false;\n\n    this._latestPluginListView = undefined;\n  }\n\n  async load(skipCache) {\n    this._latestPluginListView = postProcessPluginList(await this._getHttpPluginList(skipCache), this._isDefault, this._isLocal, this._url);\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return this._latestPluginListView;\n  }\n\n  async unload() {\n    if (!this._latestPluginListView) {\n      return;\n    }\n\n    await Promise.all(this._latestPluginListView.plugins.map(pRef => this._pluginReferenceTracker.freePluginReference(pRef.url, this._url)));\n\n    await this._store.removeItem(this._storeKey);\n  }\n\n  async reload() {\n    return await this.load(true);\n  }\n\n  async _getHttpPluginList(skipCache) {\n    const cacheItem = skipCache ? undefined : await this._store.getItem(this._storeKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginListRes = await fetch(this._url);\n\n    console.log(pluginListRes);\n    if (pluginListRes.status === 403) {\n      throw new HttpAccessDeniedException(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    } else if (!pluginListRes.ok) {\n      throw new Error(`HTTP Error ${pluginListRes.status}: ${pluginListRes.statusText}`);\n    }\n\n    const pluginList = await pluginListRes.json();\n\n    await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp, value: pluginList});\n\n    return pluginList;\n  }\n\n}\n\nclass LocalPluginList {\n  constructor(store, pluginReferenceTracker) {\n    this._store = store;\n    this._storeKey = 'local-plugin-list.repo.json';\n    this._url = new URL(\"indexeddb://asset-link/data/local-plugin-list.repo.json\", window.location.origin);\n    this._isDefault = false;\n    this._isLocal = true;\n    this._pluginReferenceTracker = pluginReferenceTracker;\n  }\n\n  async load() {\n    const pluginListView = postProcessPluginList(await this._getLocalPluginList(), this._isDefault, this._isLocal, this._url);\n\n    await Promise.all(pluginListView.plugins.map(pRef => this._pluginReferenceTracker.ackPluginReference(pRef.url, this._url)));\n\n    return pluginListView;\n  }\n\n  async reload() {\n    return await this.load();\n  }\n\n  async addPlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      if (pl.plugins.find(pRef => pRef.url === pluginUrl.toString())) {\n        return false;\n      }\n      pl.plugins.push({ url: pluginUrl.toString() });\n    });\n\n    await this._pluginReferenceTracker.ackPluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, this._isDefault, this._isLocal, this._url);\n  }\n\n  async removePlugin(pluginUrl) {\n    const pluginList = await this._modifyAndWriteStoredList(pl => {\n      const pluginIndex = pl.plugins.findIndex(pRef => pRef.url === pluginUrl.toString())\n\n      if (pluginIndex < 0) {\n        return false;\n      }\n\n      pl.plugins.splice(pluginIndex, 1);\n    });\n\n    await this._pluginReferenceTracker.freePluginReference(pluginUrl, this._url);\n\n    return postProcessPluginList(pluginList, this._isDefault, this._isLocal, this._url);\n  }\n\n  async _getLocalPluginList() {\n    const pluginListItem = await this._store.getItem(this._storeKey);\n\n    if (!pluginListItem) {\n      return { plugins: [] };\n    }\n\n    return pluginListItem.value;\n  }\n\n  async _modifyAndWriteStoredList(mutatorFn) {\n    const pluginList = await this._getLocalPluginList();\n    const shouldWrite = mutatorFn(pluginList) !== false;\n    if (shouldWrite) {\n      await this._store.setItem(this._storeKey, {key: this._storeKey, timestamp: currentEpochSecond(), value: pluginList});\n    }\n    return pluginList;\n  }\n}\n\nconst postProcessPluginList = (pluginList, isDefault, isLocal, sourceUrl) => {\n  pluginList.isDefault = isDefault;\n  pluginList.isLocal = isLocal;\n  pluginList.sourceUrl = sourceUrl;\n\n  if (!pluginList.error) {\n    pluginList.error = undefined;\n  }\n\n  if (!pluginList.plugins) {\n    pluginList.plugins = [];\n  }\n\n  pluginList.plugins = pluginList.plugins.map(pluginRef => {\n    // Resolve relative paths on this server, but still allow for\n    // arbitrary absolute/third-party urls\n    const pluginUrl = new URL(pluginRef.url, isLocal ? window.location.origin : pluginList.sourceUrl);\n\n    return {\n      url: pluginUrl,\n    };\n  });\n\n  return pluginList;\n};\n","import Vue from 'vue';\n\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { loadModule } from 'vue3-sfc-loader/dist/vue2-sfc-loader.esm.js';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nexport default class AssetLinkPluginLoaderCore {\n\n  constructor(assetLink) {\n    this._assetLink = assetLink;\n    this._store = assetLink._store;\n\n    this._vm = new Vue({\n      data: {\n        plugins: [],\n      },\n    });\n  }\n\n  /**\n   * A {Vue} instance used to expose some of this core's state to\n   * the UI in a reactive way.\n   */\n  get vm() {\n    return this._vm;\n  }\n\n  async boot() {\n    // TODO: ?\n  }\n\n  async loadPlugin(pluginUrl, opts) {\n    const options = opts || {};\n\n    const startTime = performance.now();\n\n    let pluginInstance = undefined;\n\n    try {\n      const pluginDataUrl = await this._fetchPlugin(pluginUrl, options);\n\n      const rawPluginSource = await fetch(pluginDataUrl).then(r => r.text());\n\n      if (pluginUrl.pathname.endsWith('alink.js')) {\n        const pluginSourceWithSourceInfo = `${rawPluginSource}\\n//# sourceURL=asset-link-plugin:./${encodeURIComponent(pluginUrl)}\\n`;\n\n        const pluginDataUrlWithSourceInfo = \"data:application/javascript;base64,\" + btoa(pluginSourceWithSourceInfo);\n\n        const pluginCls = (await import(/* webpackIgnore: true */ pluginDataUrlWithSourceInfo)).default;\n        pluginInstance = new pluginCls();\n      } else if (pluginUrl.pathname.endsWith('alink.vue')) {\n        const pluginUrlWithoutParams = new URL(pluginUrl.toString());\n        pluginUrlWithoutParams.search = '';\n\n        const vuetify = await import('vuetify/lib');\n\n        const vuetifyComponents = {};\n        const vuetifyDirectives = {};\n\n        Object.entries(vuetify).forEach(([entryName, entry]) => {\n          if (Object.prototype.hasOwnProperty.call(entry, 'component')) {\n            vuetifyComponents[entryName] = entry;\n          } else if (['bind', 'inserted', 'update', 'componentUpdated', 'unbind'].find(directiveHook => Object.prototype.hasOwnProperty.call(entry, directiveHook))) {\n            vuetifyDirectives[entryName] = entry;\n          }\n        });\n\n        let rawPluginFileData = await fetch(pluginDataUrl).then(r => r.text());\n\n        // Roughly based on https://harlanzw.com/blog/vue-automatic-component-imports/\n        // and https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/loader.js#L110-L144\n        const compiler = await import('vue-template-compiler');\n\n        const tags = new Set()\n        const attrs = new Set()\n        const component = compiler.parseComponent(rawPluginFileData);\n\n        if (component.errors.length > 0) {\n          throw new Error(`Could not parse component plugin: ${component.errors.join('\\n')}`);\n        }\n\n        if (component.template) {\n          if (component.template.src) {\n            throw new Error(`External component template content is not supported.`);\n          }\n          compiler.compile(component.template.content, {\n            modules: [{\n              postTransformNode: node => {\n                if (\"directives\" in node) {\n                  node.directives.forEach(({ name }) => attrs.add(name))\n                }\n                tags.add(node.tag)\n              }\n            }]\n          });\n        }\n\n        /* eslint-disable no-unused-vars */\n        const usedVuetifyTags = Array.from(tags).map(item => [hyphenate(item), capitalize(camelize(item))])\n          .filter(([kebabTag, camelTag]) => kebabTag.startsWith('v-') && Object.prototype.hasOwnProperty.call(vuetifyComponents, camelTag))\n          .map(([kebabTag, camelTag]) => [camelTag, vuetifyComponents[camelTag]]);\n\n        const usedVuetifyDirectives = Array.from(attrs).map(item => capitalize(camelize(item)))\n          .filter(camelAttr => Object.prototype.hasOwnProperty.call(vuetifyDirectives, camelAttr))\n          .map(camelAttr => [camelAttr, vuetifyDirectives[camelAttr]]);\n\n        if (!this.moduleCache) {\n          this.moduleCache = Object.assign(Object.create(null), {\n            vue: Vue,\n            'vuetify/lib': vuetify,\n\n            // TODO: Figure out how to make loading these cleaner/on-demand\n            'vue-codemirror': import('vue-codemirror'),\n            'codemirror/mode/javascript/javascript.js': import('codemirror/mode/javascript/javascript.js'),\n            'codemirror/mode/vue/vue.js': import('codemirror/mode/vue/vue.js'),\n            'codemirror/lib/codemirror.css': import('codemirror/lib/codemirror.css'),\n            'codemirror/theme/base16-dark.css': import('codemirror/theme/base16-dark.css'),\n          });\n        }\n\n        const options = {\n          moduleCache: this.moduleCache,\n          compiledCache: {\n            set: (key, str) => this._store.setItem(`asset-link-cached-compiled-plugin:${key}`, str),\n            get: (key) => this._store.getItem(`asset-link-cached-compiled-plugin:${key}`),\n          },\n          async getFile(url) {\n            if ( url === pluginUrlWithoutParams ) {\n              return rawPluginFileData;\n            } else {\n              throw new Error(`Secondary imports are not supported. url=${url}`);\n            }\n          },\n          addStyle() {\n            /* TODO: https://github.com/FranckFreiburger/vue3-sfc-loader/blob/80f10f9fd82d7dde6c8681d23d36e9ac3ab9a654/docs/examples.md?plain=1#L403-L453 */\n          },\n        };\n\n        pluginInstance = await loadModule(pluginUrlWithoutParams, options);\n\n        if (!pluginInstance.name) {\n          pluginInstance.name = `unnamed-sfc-plugin-${uuidv4()}`;\n        }\n\n        if (usedVuetifyTags.length && !pluginInstance.components) pluginInstance.components = {};\n        usedVuetifyTags.filter(t => !pluginInstance.components[t[0]]).forEach(t => pluginInstance.components[t[0]] = t[1]);\n\n        if (usedVuetifyDirectives.length && !pluginInstance.directives) pluginInstance.directives = {};\n        usedVuetifyDirectives.filter(t => !pluginInstance.directives[t[0]]).forEach(t => pluginInstance.directives[t[0]] = t[1]);\n\n        Vue.component(pluginInstance.name, pluginInstance);\n      } else {\n        pluginInstance = {};\n      }\n\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.rawSource = rawPluginSource;\n\n      this.registerPlugin(pluginInstance);\n    } catch (error) {\n      console.log(error);\n      pluginInstance = {};\n      pluginInstance.pluginUrl = pluginUrl;\n      pluginInstance.error = error;\n      this.registerPlugin(pluginInstance);\n    } finally {\n      const endTime = performance.now();\n      console.log(`Loading plugin ${pluginUrl} took ${endTime - startTime} milliseconds`);\n    }\n  }\n\n  /**\n   * Directly register a plugin with Asset Link. Note that plugins registered this way\n   * will not persist between sessions/reloads.\n   */\n  registerPlugin(plugin) {\n    plugin.definedRoutes = {};\n    plugin.definedSlots = {};\n    plugin.definedWidgetDecorators = {};\n    plugin.definedPluginIngestor = undefined;\n    plugin.attributedErrors = {};\n\n    this.vm.plugins.push(plugin);\n\n    if (typeof plugin.onLoad === 'function') {\n      const handle = new AssetLinkPluginHandle(plugin, this.vm);\n\n      plugin.onLoad(handle, this._assetLink);\n    }\n\n    this.vm.plugins.forEach(p => {\n      if (p !== plugin && p.definedPluginIngestor) {\n        // TODO: Catch errors\n        p.definedPluginIngestor.ingestorFn(plugin);\n      }\n      if (p !== plugin && plugin.definedPluginIngestor) {\n        plugin.definedPluginIngestor.ingestorFn(p);\n      }\n    });\n  }\n\n  async unloadPlugin(pluginUrl) {\n    const pluginIdx = this.vm.plugins.findIndex(p => p.pluginUrl.toString() === pluginUrl.toString());\n\n    const plugin = this.vm.plugins[pluginIdx];\n\n    if (typeof plugin.onUnload === 'function') {\n      plugin.onUnload(this._assetLink);\n    }\n\n    if (pluginIdx !== -1) {\n      this.vm.plugins.splice(pluginIdx, 1);\n    }\n\n    this.vm.plugins.forEach(otherPlugin => {\n      ['definedRoutes', 'definedSlots', 'definedWidgetDecorators', 'attributedErrors'].forEach(attributedKey => {\n        if (otherPlugin[attributedKey]) {\n          delete otherPlugin[attributedKey][pluginUrl.toString()];\n        }\n      });\n    });\n  }\n\n  async reloadPlugin(pluginUrl) {\n    await this.unloadPlugin(pluginUrl);\n    await this.loadPlugin(pluginUrl, { skipCache: true });\n  }\n\n  async _fetchPlugin(url, opts) {\n    const options = opts || {};\n\n    const skipCache = options.skipCache || (url.searchParams && url.searchParams.get('skipCache'));\n\n    const cacheKey = `asset-link-cached-plugin-src:${url}`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    const timestamp = currentEpochSecond();\n\n    if (!skipCache && cacheItem && (timestamp - cacheItem.timestamp) < 900) {\n      return cacheItem.value;\n    }\n\n    const pluginSrcRes = await fetch(url);\n\n    if (!pluginSrcRes.ok) {\n      throw new Error(`HTTP Error ${pluginSrcRes.status}: ${pluginSrcRes.statusText}`);\n    }\n\n    const pluginSrc = await pluginSrcRes.text();\n\n    const pluginDataUrl = \"data:application/javascript;base64,\" + btoa(pluginSrc);\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: pluginDataUrl});\n\n    return pluginDataUrl;\n  }\n\n}\n\nclass AssetLinkPluginHandle {\n\n  constructor(pluginInstance, vm, attributedTo) {\n    this._pluginInstance = pluginInstance;\n    this._vm = vm;\n    this._attributedTo = attributedTo || pluginInstance;\n  }\n\n  get thisPlugin() {\n    return this._pluginInstance;\n  }\n\n  defineRoute(routeName, routeDefiner) {\n    const routeDef = {name: routeName};\n\n    const routeHandle = {\n        path(path) {\n          routeDef.path = path;\n        },\n        componentFn(componentFn) {\n          routeDef.componentFn = componentFn;\n        },\n    };\n\n    routeDefiner(routeHandle);\n\n    const missingFields = Object.entries({'path': 'string', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof routeDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Route '${routeName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, routeDef);\n      return;\n    }\n\n    this._setAttributedDefinition('definedRoutes', routeName, routeDef);\n    this._vm.$emit('add-route', routeDef);\n  }\n\n  defineSlot(slotName, slotDefiner) {\n    const slotDef = {name: slotName};\n\n    const slotHandle = {\n        type(type) {\n          slotDef.type = type;\n        },\n        showIf(predicateFn) {\n          slotDef.predicateFn = predicateFn;\n        },\n        multiplexContext(contextMultiplexerFn) {\n          slotDef.contextMultiplexerFn = contextMultiplexerFn;\n        },\n        weight(weightFn) {\n          slotDef.weightFn = weightFn;\n        },\n        componentFn(componentFn) {\n          slotDef.componentFn = componentFn;\n        },\n    };\n\n    slotDefiner(slotHandle);\n\n    let missingFields = Object.entries({'type': 'string', 'predicateFn': 'function', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof slotDef[attr] !== expectedType);\n\n    if (!['undefined', 'function'].includes(typeof slotDef.contextMultiplexerFn)) {\n      missingFields.push(['contextMultiplexerFn', 'function?']);\n    }\n\n    if (!['undefined', 'function', 'number'].includes(typeof slotDef.weightFn)) {\n      missingFields.push(['weightFn', '(function|number)?']);\n    }\n\n    if (missingFields.length) {\n      console.log(`Slot '${slotName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, slotDef);\n      return;\n    }\n\n    const providedPredicateFn = slotDef.predicateFn;\n\n    // Decorate the predicate function to make the slots automatically filtered by type\n    slotDef.predicateFn = (context) => context.type === slotDef.type && providedPredicateFn(context);\n\n    const providedWeightFn = slotDef.weightFn;\n    // If no weight was provided, use the default of 100\n    if (providedWeightFn === undefined) {\n      slotDef.weightFn = () => 100;\n    }\n    // If the weight is a constant number, wrap it in a function that returns that number\n    else if (typeof providedWeightFn === 'number') {\n      slotDef.weightFn = () => providedWeightFn;\n    }\n\n    this._setAttributedDefinition('definedSlots', slotName, slotDef);\n  }\n\n  defineWidgetDecorator(widgetDecoratorName, widgetDecoratorDefiner) {\n    const widgetDecoratorDef = { name: widgetDecoratorName };\n\n    const widgetDecoratorHandle = {\n        targetWidgetName(targetWidgetName) {\n          widgetDecoratorDef.targetWidgetName = targetWidgetName;\n        },\n        appliesIf(predicateFn) {\n          widgetDecoratorDef.predicateFn = predicateFn;\n        },\n        weight(weightFn) {\n          widgetDecoratorDef.weightFn = weightFn;\n        },\n        componentFn(componentFn) {\n          widgetDecoratorDef.componentFn = componentFn;\n        },\n    };\n\n    widgetDecoratorDefiner(widgetDecoratorHandle);\n\n    const missingFields = Object.entries({'targetWidgetName': 'string', 'predicateFn': 'function', 'componentFn': 'function'})\n      .filter(([attr, expectedType]) => typeof widgetDecoratorDef[attr] !== expectedType);\n\n    if (!['undefined', 'function', 'number'].includes(typeof widgetDecoratorDef.weightFn)) {\n      missingFields.push(['weightFn', '(function|number)?']);\n    }\n\n    if (missingFields.length) {\n      console.log(`Widget decorator '${widgetDecoratorName}' is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, widgetDecoratorDef);\n      return;\n    }\n\n    const providedPredicateFn = widgetDecoratorDef.predicateFn;\n\n    // Decorate the predicate function to make the widget decorators automatically filtered by targetWidgetName\n    widgetDecoratorDef.predicateFn = (context) =>\n      context.widgetName === widgetDecoratorDef.targetWidgetName && providedPredicateFn(context);\n\n    const providedWeightFn = widgetDecoratorDef.weightFn;\n    // If no weight was provided, use the default of 100\n    if (providedWeightFn === undefined) {\n      widgetDecoratorDef.weightFn = () => 100;\n    }\n    // If the weight is a constant number, wrap it in a function that returns that number\n    else if (typeof providedWeightFn === 'number') {\n      widgetDecoratorDef.weightFn = () => providedWeightFn;\n    }\n\n    this._setAttributedDefinition('definedWidgetDecorators', widgetDecoratorName, widgetDecoratorDef);\n  }\n\n  definePluginIngestor(pluginIngestorDefiner) {\n    if (this._pluginInstance !== this._attributedTo) {\n      throw new Error(\"Plugin ingestors cannot be attributed to other plugins.\");\n    }\n    if (this._pluginInstance.definedPluginIngestor) {\n      throw new Error(\"Plugin ingestor already defined. Plugins cannot define multiple plugin ingestors.\");\n    }\n\n    const ingestorDef = {};\n\n    const ingestorHandle = {\n        onEveryPlugin(ingestorFn) {\n          ingestorDef.ingestorFn = ingestorFn;\n        },\n        // TODO: Consider allowing ingestors to react to plugin unloading\n    };\n\n    pluginIngestorDefiner(ingestorHandle);\n\n    const missingFields = Object.entries({'ingestorFn': 'function'})\n      .filter(([attr, expectedType]) => typeof ingestorDef[attr] !== expectedType);\n\n    if (missingFields.length) {\n      console.log(`Plugin ingestor is invalid due to missing or mismatched types for fields: ${JSON.stringify(missingFields)}`, ingestorDef);\n      return;\n    }\n\n    this._pluginInstance.definedPluginIngestor = ingestorDef;\n  }\n\n  onBehalfOf(otherPlugin, attributedHandlerFn) {\n    if (this._pluginInstance !== this._attributedTo) {\n      throw new Error(\"Plugins may only act on behalf of eachother directly - e.g. onBehalfOf blocks cannot be nested.\");\n    }\n\n    const attributedHandle = new AssetLinkPluginHandle(this._pluginInstance, this._vm, otherPlugin);\n\n    attributedHandlerFn(attributedHandle);\n  }\n\n  recordError(errorString) {\n    if (!this._pluginInstance.attributedErrors[this._attributedTo.pluginUrl.toString()]) {\n      this._pluginInstance.attributedErrors[this._attributedTo.pluginUrl.toString()] = [];\n    }\n\n    this._pluginInstance.attributedErrors[this._attributedTo.pluginUrl.toString()].push(errorString);\n  }\n\n  _setAttributedDefinition(defType, defKey, defValue) {\n    if (!this._pluginInstance[defType][this._attributedTo.pluginUrl.toString()]) {\n      this._pluginInstance[defType][this._attributedTo.pluginUrl.toString()] = {};\n    }\n\n    this._pluginInstance[defType][this._attributedTo.pluginUrl.toString()][defKey] = defValue;\n  }\n\n}\n\n//Copied from https://github.com/vuetifyjs/vuetify-loader/blob/9c828d72354d5c37ec97eb58badb9e164451e802/lib/util.js#L6-L18\nconst camelizeRE = /-(\\w)/g\nconst camelize = str => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n}\n\nconst capitalize = str => {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst hyphenateRE = /\\B([A-Z])/g\nconst hyphenate = str => {\n  return str.replace(hyphenateRE, '-$1').toLowerCase()\n}\n","import Vue from 'vue';\n\nimport { Coordinator, RequestStrategy, SyncStrategy } from '@orbit/coordinator';\nimport { Orbit } from '@orbit/core';\nimport { IndexedDBBucket } from '@orbit/indexeddb-bucket';\nimport { IndexedDBSource } from '@orbit/indexeddb';\nimport { RecordSchema } from '@orbit/records';\nimport { MemorySource } from '@orbit/memory';\nimport DrupalJSONAPISource from '@/DrupalJSONAPISource';\nimport DrupalSyncQueryOperators from '@/DrupalSyncQueryOperators';\n\nimport localforage from 'localforage';\n\nimport fetch from 'cross-fetch';\n\nimport AssetLinkUI from '@/AssetLinkUI';\nimport AssetLinkUtil from '@/AssetLinkUtil';\nimport createDrupalUrl from '@/createDrupalUrl';\nimport FarmOSConnectionStatusDetector from '@/FarmOSConnectionStatusDetector';\nimport PeekableAsyncIterator from '@/PeekableAsyncIterator';\nimport AssetLinkPluginListsCore from '@/AssetLinkPluginListsCore';\nimport AssetLinkPluginLoaderCore from '@/AssetLinkPluginLoaderCore';\n\nimport currentEpochSecond from '@/util/currentEpochSecond';\n\nconst fetchJson = (url, args) => fetch(url, args).then(response => response.json());\n\n\n\n/**\n * Core of the larger Asset Link application and API entry-point for plugins.\n * \n * TODO: Break out some of the responsibilities of this class into classes that can be\n * delegated to. e.g. plugin management, entities CRUD, etc.\n */\nexport default class AssetLink {\n\n  constructor(app) {\n    this._app = app;\n    this._viewModel = new Vue({\n      data: {\n        booted: false,\n        bootProgress: 0,\n        bootText: \"Starting\",\n\n        connectionStatus: new FarmOSConnectionStatusDetector(),\n\n        pendingUpdates: [],\n\n        messages: [],\n      },\n    });\n\n    this._booted = new Promise((resolve) => {\n      this._viewModel.$once('booted', () => {\n        this._viewModel.booted = true;\n        resolve(true);\n      });\n    });\n\n    this._store = localforage.createInstance({\n      name: 'asset-link',\n      storeName: 'data',\n    });\n\n    this._cores = {};\n    this._cores.pluginLists = new AssetLinkPluginListsCore(this);\n    this._cores.pluginLoader = new AssetLinkPluginLoaderCore(this);\n\n    this._memory = undefined;\n    this._remote = undefined;\n\n    this._ui = new AssetLinkUI(app);\n    this._util = new AssetLinkUtil();\n  }\n\n  /**\n   * The top-level {Vue} app component.\n   */\n  get app() {\n    return this._app;\n  }\n\n  /**\n   * A {Vue} instance used to expose some of Asset Link's state to\n   * its UI in a reactive way.\n   */\n  get viewModel() {\n    return this._viewModel;\n  }\n\n  /**\n   * UI components/methods exposed for Asset Link plugins.\n   */\n  get ui() {\n    return this._ui;\n  }\n\n  /**\n   * Utility methods exposed for Asset Link plugins.\n   */\n  get util() {\n    return this._util;\n  }\n\n  /**\n   * The map of AssetLink cores.\n   */\n  get cores() {\n    return this._cores;\n  }\n\n  /**\n   * The Orbit.js {MemorySource} which is used to access/modify farmOS assets/logs/etc.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get entitySource() {\n    return this._memory;\n  }\n\n  /**\n   * The Orbit.js {JSONAPISource} which is used to directly access/modify\n   * farmOS assets/logs/etc - unless you know what you are doing, use {#entitySource}\n   * instead.\n   *\n   * Will be {undefined} until Asset Link has booted.\n   */\n  get remoteEntitySource() {\n    return this._remote;\n  }\n\n  /**\n   * The currently loaded plugins.\n   */\n  get plugins() {\n    return this._cores.pluginLoader.vm.plugins;\n  }\n\n  /**\n   * A {Promise} that is fulfilled once Asset Link has booted.\n   */\n  get booted() {\n    return this._booted;\n  }\n\n  /* eslint-disable no-console,no-unused-vars */\n  async boot() {\n    this.viewModel.bootText = \"Initializing storage\";\n\n    await this._store.ready();\n\n    this._cores.pluginLists.eventBus.$on('add-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.loadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLists.eventBus.$on('remove-plugin', async pluginUrl => {\n      await this._cores.pluginLoader.unloadPlugin(pluginUrl);\n    });\n\n    this._cores.pluginLoader.vm.$on('add-route', routeDef => {\n      if (typeof this.app.addRoute === 'function') {\n        this.app.addRoute(routeDef);\n      }\n    });\n\n    this._cores.pluginLoader.vm.$on('remove-route', routeDef => {\n      if (typeof this.app.removeRoute === 'function') {\n        this.app.removeRoute(routeDef);\n      }\n    });\n\n    window.addEventListener('asset-link-plugin-changed', async e => {\n      await this._cores.pluginLoader.reloadPlugin(new URL(e.detail.pluginUrl));\n    });\n\n    await this._cores.pluginLoader.boot();\n    await this._cores.pluginLists.boot();\n\n    this.viewModel.bootText = \"Loading models...\";\n    this._models = await this._loadModels();\n\n    Orbit.fetch = this._csrfAwareFetch.bind(this);\n\n    this._schema = new RecordSchema({ models: this._models });\n\n    const bucket = new IndexedDBBucket({ namespace: 'asset-link-orbitjs-bucket' });\n\n    this._memory = new MemorySource({\n      schema: this._schema,\n      cacheSettings: {\n        queryOperators: DrupalSyncQueryOperators,\n      },\n    });\n\n    this._remote = new DrupalJSONAPISource({\n      schema: this._schema,\n      name: 'remote',\n      host: createDrupalUrl('/api'),\n      defaultFetchSettings: {\n        timeout: 10000,\n      },\n      bucket,\n      requestQueueSettings: {\n        autoProcess: this.viewModel.connectionStatus.isOnline || false,\n      },\n    });\n\n    const updateViewModelPendingUpdates = () => {\n      this.viewModel.pendingUpdates = this._remote.requestQueue.entries.filter(r => r.type === 'update');\n    };\n\n    this._remote.requestQueue.reified.then(updateViewModelPendingUpdates);\n    this._remote.requestQueue.on('change', updateViewModelPendingUpdates);\n\n    this._backup = new IndexedDBSource({\n      schema: this._schema,\n      name: 'backup',\n      namespace: 'asset-link-orbitjs-entities',\n      defaultTransformOptions: {\n        useBuffer: true,\n      },\n    });\n\n    this._coordinator = new Coordinator({\n      sources: [this._memory, this._remote, this._backup]\n    });\n\n    // Query the remote server when the memory source is queried (and online)\n    this._remoteQueryStrategy = new RequestStrategy({\n      name: 'remoteRequestStrategy',\n\n      source: 'memory',\n      on: 'beforeQuery',\n\n      target: 'remote',\n      action: 'query',\n\n      blocking: true\n    });\n    // Only use the remote query strategy when online\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._coordinator.addStrategy(this._remoteQueryStrategy);\n    }\n\n    // Update the remote server whenever the memory source is updated\n    this._coordinator.addStrategy(\n      new RequestStrategy({\n        source: 'memory',\n        on: 'beforeUpdate',\n\n        target: 'remote',\n        action: 'update',\n\n        blocking: false\n      })\n    );\n\n    // Sync all changes received from the remote server to the memory source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'remote',\n        target: 'memory',\n        blocking: false\n      })\n    );\n\n    // Sync all changes to the backup source\n    this._coordinator.addStrategy(\n      new SyncStrategy({\n        source: 'memory',\n        target: 'backup',\n        blocking: true\n      })\n    );\n\n    // Restore the backup source\n    const allRecordsFromBackup = await this._backup.query((q) => q.findRecords());\n    await this._memory.sync((t) => allRecordsFromBackup.map((r) => t.addRecord(r)));\n\n    await this._coordinator.activate();\n\n    this.viewModel.bootProgress = 100;\n\n    this._memory.on('update', update => {\n      console.log('_memory::update', update);\n\n      if (update.operations.op === 'updateRecord' && update.operations.record.type.startsWith('asset--')) {\n        this.viewModel.$emit('changed:asset', update.operations.record.type, update.operations.record.id);\n      }\n\n    });\n\n    this.viewModel.connectionStatus.$watch('isOnline', async (isOnline) => {\n      this._remote.requestQueue.autoProcess = isOnline;\n      if (isOnline && !this._remote.requestQueue.empty) {\n        this._remote.requestQueue.process();\n      }\n\n      await this._coordinator.deactivate();\n      if (isOnline) {\n        if (!this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.addStrategy(this._remoteQueryStrategy);\n        }\n      } else {\n        if (this._coordinator.strategies.includes(this._remoteQueryStrategy)) {\n          this._coordinator.removeStrategy(this._remoteQueryStrategy.name);\n        }\n      }\n      await this._coordinator.activate();\n    });\n\n    this.viewModel.$emit('booted');\n\n    if (this.viewModel.connectionStatus.isOnline) {\n      this._precache();\n    }\n\n    return true;\n  }\n\n  /**\n   * Gets the model for an entity type given that the type name. e.g. \"asset--plant\"\n   */\n  async getEntityModel(typeName) {\n    await this._booted;\n\n    return this._models[typeName];\n  }\n\n  async _precache() {\n    // Precache the current page's asset\n    const matches = window.location.href.match(/https?:\\/\\/.*\\/asset\\/(\\d+)/);\n    if (matches && matches.length >= 2) {\n      const thisAsset = await this.resolveAsset(matches[1]);\n      console.log(\"thisAsset=\", thisAsset);\n    }\n\n    const timestamp = currentEpochSecond();\n\n    const lastPrecacheTimeKey = `asset-link-last-precache-time`;\n\n    const lastPrecacheTime = await this._store.getItem(lastPrecacheTimeKey);\n\n    if (lastPrecacheTime && (timestamp - lastPrecacheTime) < 900) {\n      console.log(\"Skipping Asset Link precaching because it was done recently...\");\n      return;\n    }\n\n    // Precache recently changed assets\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    await this._memory.query((q) => assetTypes.map(assetType => q.findRecords(`asset--${assetType}`)\n        .sort('-changed')\n        .page({ offset: 0, limit: 100 })));\n\n    // TODO: Consider also precaching recently changed and recent/upcoming logs\n\n    await this._store.setItem(lastPrecacheTimeKey, timestamp);\n  }\n\n  /**\n   * Get a list of the asset_type entities.\n   */\n  async getAssetTypes() {\n    const listAssetTypes = async (source) => {\n      return await source.query((q) => q\n          .findRecords(`asset_type--asset_type`)\n          .sort('drupal_internal__id'));\n    };\n\n    const assetTypes = await listAssetTypes(this._memory.cache);\n\n    if (assetTypes.length) {\n      return assetTypes;\n    }\n\n    return await listAssetTypes(this._memory);\n  }\n\n  /**\n   * Get an asset by UUID or Drupal internal id.\n   */\n  async resolveAsset(assetRef) {\n    await this._booted;\n\n    const assetTypes = (await this.getAssetTypes()).map(t => t.attributes.drupal_internal__id);\n\n    const isRefNumeric = /^-?\\d+$/.test(assetRef);\n\n    let filter = { attribute: 'id', value: assetRef };\n    if (isRefNumeric) {\n      filter = { attribute: 'drupal_internal__id', value: parseInt(assetRef) };\n    }\n\n    const findAsset = async (source) => {\n      const results = await source.query(q => assetTypes.map(assetType => q\n          .findRecords(`asset--${assetType}`)\n          .filter(filter)\n          .sort('drupal_internal__id')));\n\n      const assets = results.flatMap(l => l);\n\n      return assets.find(a => a);\n    };\n\n    const asset = await findAsset(this._memory.cache);\n\n    if (asset) {\n      return asset;\n    }\n\n    return await findAsset(this._memory);\n  }\n\n  /**\n   * Central asset searching entry-point. Responsible for delegating to asset searching plugins.\n   */\n  searchAssets(searchRequest, searchPhase) {\n    console.log(\"searchAssets:\", JSON.stringify(searchRequest), searchPhase);\n\n    const assetSearchPlugins = this.plugins.filter(p => typeof p.searchAssets === 'function');\n\n    const searchResultCursors = [];\n\n    for (let i = 0; i < assetSearchPlugins.length; i += 1) {\n      const plugin = assetSearchPlugins[i];\n\n      /* eslint-disable no-await-in-loop */\n      const searchResultCursor = plugin.searchAssets(this, searchRequest, searchPhase);\n\n      if (searchResultCursor !== undefined) {\n        searchResultCursors.push(searchResultCursor);\n      }\n    }\n\n    async function* coiterateSearchCursors() {\n      console.log(\"coiterateSearchCursors: searchResultCursors =\", searchResultCursors);\n\n      const peekableSearchResultCursors = searchResultCursors.map(c => new PeekableAsyncIterator(c));\n\n      while(peekableSearchResultCursors.length > 0) {\n\n        console.log(\"coiterateSearchCursors: peekableSearchResultCursors.length =\", peekableSearchResultCursors.length, peekableSearchResultCursors);\n\n        let bestNextCursor = undefined;\n        let doneBestNextCursorIndex = undefined;\n        for (let i = 0; i < peekableSearchResultCursors.length; i += 1) {\n          const thisCursor = peekableSearchResultCursors[i];\n\n          const thisCursorNextResult = await thisCursor.peek();\n\n          if (thisCursorNextResult.value === undefined) {\n            continue;\n          }\n\n          if (bestNextCursor === undefined || thisCursorNextResult.value.weight < (await bestNextCursor.peek()).value.weight) {\n            bestNextCursor = thisCursor;\n            doneBestNextCursorIndex = thisCursorNextResult.done ? i : undefined;\n          }\n        }\n\n        if (bestNextCursor === undefined) {\n          return;\n        }\n\n        const bestCursorNextResult = await bestNextCursor.next();\n\n        if (bestCursorNextResult.value) {\n          yield bestCursorNextResult.value;\n        }\n\n        if (doneBestNextCursorIndex !== undefined) {\n          peekableSearchResultCursors.splice(doneBestNextCursorIndex, 1);\n        }\n\n      }\n    }\n\n    return coiterateSearchCursors();\n  }\n\n  getSlots(context) {\n    return this.getPluginDefinedComponents('definedSlots', context);\n  }\n\n  getWidgetDecorators(context) {\n    return this.getPluginDefinedComponents('definedWidgetDecorators', context);\n  }\n\n  getPluginDefinedComponents(componentDefKey, context) {\n    const sortingFn = (a1, a2) => {\n      if (a1.weight < a2.weight) {\n        return -1;\n      }\n      if (a1.weight > a2.weight) {\n        return 1;\n      }\n      if (a1.id < a2.id) {\n        return -1;\n      }\n      if (a1.id > a2.id) {\n        return 1;\n      }\n      return 0;\n    };\n\n    const componentDefs = plugin => Object.values(plugin[componentDefKey] || {})\n      .flatMap(cDefsById => Object.values(cDefsById));\n\n    return this.plugins.flatMap(plugin => componentDefs(plugin))\n      .filter(a => a.predicateFn(context))\n      .flatMap(a => {\n\n        let contexts = [context];\n        if (typeof a.contextMultiplexerFn === 'function') {\n          contexts = a.contextMultiplexerFn(context);\n        }\n\n        return contexts.map((c, idx) => ({\n            id: contexts.length === 1 ? a.id : (a.id + '.' + idx),\n            componentFn: (wrapper, h, children) => a.componentFn(wrapper, h, c, children),\n            weight: a.weightFn(c),\n        }));\n\n      })\n      .sort(sortingFn);\n  }\n\n  async _csrfAwareFetch(url, opts) {\n    const options = opts || {};\n\n    if (!options.method) options.method = 'GET';\n\n    const requestUrl = new URL(url, window.location.origin + window.assetLinkDrupalBasePath);\n\n    const isFarmOSRequest = requestUrl.host === window.location.host && requestUrl.pathname.startsWith(window.assetLinkDrupalBasePath);\n    const isUnsafeMethod = !['HEAD', 'GET', 'OPTIONS', 'TRACE'].includes(options.method.toUpperCase());\n\n    const addCsrfHeader = isFarmOSRequest && isUnsafeMethod;\n\n    try {\n      if (addCsrfHeader) {\n        const tokenResponse = await this.viewModel.connectionStatus.fetch(createDrupalUrl('/session/token'));\n\n        console.log(\"tokenResponse:\", tokenResponse);\n\n        const token = await tokenResponse.text();\n\n        // TODO: Cache the token\n        if (!options.headers) options.headers = {};\n        options.headers['X-CSRF-Token'] = token;\n      }\n  \n      return await this.viewModel.connectionStatus.fetch(url, options);\n    } catch (error) {\n      console.log(\"Error in _csrfAwareFetch\", typeof error, error);\n      if (error.message === 'Network request failed') {\n        return new Response(null, {\n          status: 503,\n          statusText: 'Service unavailable due to network error',\n        });\n      }\n      throw error;\n    }\n  }\n\n  async _loadModels() {\n    const cacheKey = `asset-link-cached-entity-models`;\n\n    const cacheItem = await this._store.getItem(cacheKey);\n\n    if (cacheItem) {\n      // TODO: If cache item is stale, schedule background refresh\n      return cacheItem.value;\n    }\n\n    const models = await this._loadModelsFromServer();\n\n    const timestamp = currentEpochSecond();\n\n    await this._store.setItem(cacheKey, {key: cacheKey, timestamp, value: models});\n\n    return models;\n  }\n\n  async _loadModelsFromServer() {\n    this.viewModel.bootText = \"Loading server schema\";\n    const serverSchema = await fetchJson(createDrupalUrl('/api/schema'));\n\n    const serverRelatedSchemas = serverSchema.allOf.flatMap(schemaRef => schemaRef.links || []);\n\n    const models = {};\n\n    await Promise.all(serverRelatedSchemas.map(async (serverRelatedSchema) => {\n      const relatedSchema = await fetchJson(serverRelatedSchema.targetSchema);\n\n      const relatedItemSchema = await fetchJson(relatedSchema.definitions.data.items.$ref);\n\n      const typeName = relatedItemSchema.definitions.type['const'];\n\n      models[typeName] = {\n        attributes: Object.fromEntries(\n            Object.entries(relatedItemSchema.definitions.attributes.properties)\n              .map(([attrName, attr]) => {\n                // Orbit.js seems to only support 'number', not 'integer' but handles the former well enough\n                if (attr.type === 'integer') {\n                  attr.type = 'number';\n                }\n\n                // https://www.drupal.org/project/jsonapi_schema/issues/3058850\n                if (attrName === 'third_party_settings') {\n                  attr.type = 'object';\n                }\n\n                return [attrName, attr];\n              })\n        ),\n        relationships: relatedItemSchema.definitions?.relationships?.properties || {},\n      };\n\n      this.viewModel.bootProgress = ((Object.keys(models).length / serverRelatedSchemas.length) * 100).toFixed(1);\n    }));\n\n    return models;\n  }\n\n}\n","export default function createDrupalUrl(pathSuffix) {\n  return new URL(pathSuffix, window.location.origin + window.assetLinkDrupalBasePath);\n}","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}service-worker.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n"],"names":["DrupalJSONAPIURLBuilder","settings","filterSpecifiers","filters","forEach","filterSpecifier","index","kind","op","attributeFilter","resourceAttribute","serializeAttributeAsParam","undefined","attribute","push","value","path","operator","relatedRecordFilter","Array","isArray","record","relation","map","e","id","join","QueryExpressionParseError","Error","relatedRecordsFilter","records","type","this","serializer","serializerFor","JSONAPISerializers","serialize","JSONAPIURLBuilder","DrupalJSONAPISource","defaultFetchSettings","Object","assign","headers","Accept","serializerSettingsFor","buildSerializerSettingsFor","sharedSettings","inflectors","drupal","buildInflector","input","replace","settingsByType","serializationOptions","URLBuilderClass","JSONAPISource","findRecord","SyncQueryOperators","findRelatedRecord","findRecords","cache","expression","options","exp","results","getRecordsSync","filter","filterRecords","sort","sortRecords","page","paginateRecords","findRelatedRecords","relationship","relatedIds","getRelatedRecordsSync","length","getRecordSync","raiseNotFoundExceptions","RecordNotFoundException","i","l","applyFilter","attributeKey","split","actual","deepGet","expected","toLowerCase","startsWith","includes","endsWith","sortSpecifiers","comparisonValues","Map","set","sortSpecifier","comparisonOrders","sortExpression","order","record1","record2","values1","get","values2","isNone","paginationOptions","limit","offset","slice","AssetLinkUI","app","_app","VBtn","VListItem","VListItemTitle","confirm","text","$dialog","title","promptText","prompt","custom","component","params","uuidv4","context","Vue","Promise","resolve","$on","dialogs","componentFn","wrapper","h","VDialog","props","fullscreen","on","ref","result","d","AssetLinkUtil","formatRFC3339","createDrupalUrl","geohash","haversine","assets","a","attributes","name","FarmOSConnectionStatusDetector","fetcherDelegate","default","fetch","data","$_running","$_barrier","Barrier","hasNetworkConnection","window","navigator","onLine","canReachFarmOS","isLoggedIn","created","addEventListener","$data","release","connection","$_mainLoop","computed","isOnline","beforeDestroy","methods","url","opts","method","requestUrl","URL","location","origin","assetLinkDrupalBasePath","isFarmOSRequest","host","pathname","res","status","checkConnectionStatus","throttle","$_checkConnectionStatus","arrive","apiUrl","currentEpochSecond","credentials","json","apiData","farmOsVersion","meta","farm","version","userRef","links","me","href","sleep","millis","setTimeout","parseInt","Date","getTime","waiting","timeoutMillis","race","toBeReleased","splice","p","PeekableAsyncIterator","delegate","_delegate","_next_iteration_result","next","EventBus","_handlersByEventName","eventName","handler","hasOwn","arg","handlers","promises","all","then","HttpAccessDeniedException","message","AssetLinkPluginListsCore","assetLink","_store","_vm","lists","_eventBus","_pluginReferenceTracker","PluginReferenceTracker","_defaultPluginList","HttpPluginList","_localPluginList","LocalPluginList","_extraPluginLists","_extraPluginListStoreKey","_getExtraPluginListUrls","extraPluginListUrls","pluginListUrl","pluginList","load","pluginListView","_updatePluginListViewInViewModel","pluginUrl","addPlugin","removePlugin","_modifyAndWriteStoredExtraPluginListUrls","idx","findIndex","plUrl","pluginListIndex","pl","_url","unload","_removePluginListViewFromViewModel","find","reload","getItem","pluginListUrlsItem","u","mutatorFn","pluginListUrls","shouldWrite","setItem","key","timestamp","vm","plVIndex","plV","sourceUrl","eventBus","_pluginReferences","listUrl","pluginExists","toString","pluginReferences","listIdx","indexOf","$emit","console","log","JSON","stringify","store","pluginReferenceTracker","isDefault","_storeKey","_isDefault","_isLocal","_latestPluginListView","skipCache","postProcessPluginList","_getHttpPluginList","plugins","pRef","ackPluginReference","freePluginReference","removeItem","cacheItem","pluginListRes","statusText","ok","_getLocalPluginList","_modifyAndWriteStoredList","pluginIndex","pluginListItem","isLocal","error","pluginRef","AssetLinkPluginLoaderCore","_assetLink","startTime","performance","now","pluginInstance","_fetchPlugin","pluginDataUrl","r","rawPluginSource","pluginSourceWithSourceInfo","encodeURIComponent","pluginDataUrlWithSourceInfo","btoa","import","pluginCls","pluginUrlWithoutParams","search","vuetify","vuetifyComponents","vuetifyDirectives","entries","entryName","entry","prototype","hasOwnProperty","call","directiveHook","rawPluginFileData","compiler","tags","Set","attrs","parseComponent","errors","template","src","compile","content","modules","postTransformNode","node","directives","add","tag","usedVuetifyTags","from","item","hyphenate","capitalize","camelize","kebabTag","camelTag","usedVuetifyDirectives","camelAttr","moduleCache","create","vue","compiledCache","str","getFile","addStyle","loadModule","components","t","rawSource","registerPlugin","endTime","plugin","definedRoutes","definedSlots","definedWidgetDecorators","definedPluginIngestor","attributedErrors","onLoad","handle","AssetLinkPluginHandle","ingestorFn","pluginIdx","onUnload","otherPlugin","attributedKey","unloadPlugin","loadPlugin","searchParams","cacheKey","pluginSrcRes","pluginSrc","attributedTo","_pluginInstance","_attributedTo","routeName","routeDefiner","routeDef","routeHandle","missingFields","attr","expectedType","_setAttributedDefinition","slotName","slotDefiner","slotDef","slotHandle","showIf","predicateFn","multiplexContext","contextMultiplexerFn","weight","weightFn","providedPredicateFn","providedWeightFn","widgetDecoratorName","widgetDecoratorDefiner","widgetDecoratorDef","widgetDecoratorHandle","targetWidgetName","appliesIf","widgetName","pluginIngestorDefiner","ingestorDef","ingestorHandle","onEveryPlugin","attributedHandlerFn","attributedHandle","errorString","defType","defKey","defValue","camelizeRE","_","c","toUpperCase","charAt","hyphenateRE","fetchJson","args","response","AssetLink","_viewModel","booted","bootProgress","bootText","connectionStatus","pendingUpdates","messages","_booted","$once","localforage","storeName","_cores","pluginLists","pluginLoader","_memory","_remote","_ui","_util","viewModel","ready","addRoute","removeRoute","reloadPlugin","detail","boot","_loadModels","_models","Orbit","_csrfAwareFetch","bind","_schema","RecordSchema","models","bucket","IndexedDBBucket","namespace","MemorySource","schema","cacheSettings","queryOperators","DrupalSyncQueryOperators","timeout","requestQueueSettings","autoProcess","updateViewModelPendingUpdates","requestQueue","reified","_backup","IndexedDBSource","defaultTransformOptions","useBuffer","_coordinator","Coordinator","sources","_remoteQueryStrategy","RequestStrategy","source","target","action","blocking","addStrategy","SyncStrategy","query","q","allRecordsFromBackup","sync","addRecord","activate","update","operations","$watch","empty","process","deactivate","strategies","removeStrategy","_precache","typeName","matches","match","resolveAsset","thisAsset","lastPrecacheTimeKey","lastPrecacheTime","getAssetTypes","assetTypes","drupal_internal__id","assetType","listAssetTypes","assetRef","isRefNumeric","test","findAsset","flatMap","asset","searchRequest","searchPhase","assetSearchPlugins","searchAssets","searchResultCursors","searchResultCursor","coiterateSearchCursors","peekableSearchResultCursors","bestNextCursor","doneBestNextCursorIndex","thisCursor","peek","thisCursorNextResult","done","bestCursorNextResult","getPluginDefinedComponents","componentDefKey","sortingFn","a1","a2","componentDefs","values","cDefsById","contexts","children","isUnsafeMethod","addCsrfHeader","tokenResponse","token","Response","_loadModelsFromServer","serverSchema","serverRelatedSchemas","allOf","schemaRef","serverRelatedSchema","targetSchema","relatedSchema","definitions","items","$ref","relatedItemSchema","fromEntries","properties","attrName","relationships","keys","toFixed","pathSuffix","Vuetify","register","registered","cached","updatefound","updated","offline"],"sourceRoot":""}